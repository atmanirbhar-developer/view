{"version":3,"sources":["../../src/index.ts","../../src/tagIds.ts","../../../src/data/tag.ts","../../../src/messages/index.ts","../../src/config.ts","../../src/api.ts","../../src/routes.ts","../../src/bare.ts","../../src/database.ts","../../src/configServer.ts","../../src/currentIds.ts","../../src/exerpt.ts","../../src/loader.ts","../../src/images.ts","../../src/session.ts","../../src/mock.ts","../../src/markdownToHtml.ts","hooks/useContext.ts","hooks/useFetchApi.ts","components/SelectTagsState.ts","hooks/useSelectTags.ts","components/ErrorMessage.tsx","hooks/useValidatedInput.ts","components/Label.tsx","components/createChild.tsx","components/Editor.tsx","hooks/usePagedownEditor.ts","components/getSubmitButton.tsx","../../ui-assets/icons/outline-email-24px.svg","../../ui-assets/icons/outline-chat-24px.svg","../../ui-assets/icons/outline-search-24px.svg","../../ui-assets/icons/outline-account_box-24px.svg","../../ui-assets/icons/outline-location_on-24px.svg","../../ui-assets/icons/outline-close-24px.svg","../../ui-assets/icons/outline-info-24px.svg","../../ui-assets/icons/outline-error-24px.svg","../../ui-assets/icons/outline-home-24px.svg","components/Validated.tsx","components/EditorTags.tsx","components/getDiscussionsSubtitle.tsx","components/getTagLink.tsx","components/getTags.tsx","components/getUserSummary.tsx","components/getWhen.tsx","components/getUserInfo.tsx","components/toLocaleString.ts","components/getDiscussionSummary.tsx","components/getMessage.tsx","components/getNavLinks.tsx","components/getPageNavLinks.tsx","components/getTagCount.tsx","components/ThrottledInput.tsx","hooks/useThrottledInput.ts","components/Topbar.tsx","layouts/renderLayout.tsx","layouts/index.tsx","routes/Home.tsx","components/htmlToReact.ts","routes/Users.tsx","forms/AnswerDiscussion.tsx","forms/EditTagInfo.tsx","forms/EditUserSettings.tsx","forms/Login.tsx","forms/NewDiscussion.tsx","routes/NotFound.tsx","routes/User.tsx","routes/Discussions.tsx","routes/Discussion.tsx","routes/NewDiscussion.tsx","routes/Tags.tsx","routes/Tag.tsx","routes/Login.tsx","routes/SiteMap.tsx","components/getImageSummary.tsx","components/getTagSummary.tsx","routes/Image.tsx","App.tsx","serviceWorker.ts","index.tsx","../../src/actions.ts","../../../src/data/index.ts","../../../src/messages/wire.ts","../../src/urls.ts"],"names":["o","TagIdDiscussions","prototype","exports","loginUser","tag","message","Current","this","next","CurrentIds","options","converter","makeHtml","markdown","AppContext","React","createContext","me","undefined","setMe","useMe","useContext","useFetchApi","getData","useFetchApi2","param","useState","prev","setParam","data","setData","error","setError","toggle","setToggle","newData","useMemo","param2","promise","Promise","resolve","reject","then","fetched","catch","useEffect","reason","console","log","reload","InputElement","inputElement","assert","stateValue","selectionStart","selectionEnd","isDirectionBackward","value","isLeftTrimmed","selectionDirection","length","substring","focus","start","end","setSelectionRange","width","getTextWidth","style","join","InputState","state","canMoveLeft","canMoveRight","currentStart","currentEnd","elements","getInputIndex","inputIndex","isFirst","isLast","elementStart","index","getWordStart","map","x","word","getElementStart","isLeftMoving","isRightMoving","mutableState","remove","MutableState","renderedState","context","selection","buffer","words","replaceElement","tagDictionary","renderState","validation","logRenderedState","tags","element","filter","isValid","validationError","result","newValue","invariant","editingWord","nWords","wordStart","deleteSpaceAfter","assertSpaceAt","deleteSpaceBefore","addSpaceBefore","atBufferEnd","deleteCount","spliceStart","spliceValue","stringSplice","splice","assertWords","where","setSelectionBoth","TagDictionary","inputValue","unwanted","type","findTags","max","found","key","startsWith","includes","sort","y","count","localeCompare","slice","concat","some","reducer","action","getMutableState","getInputState","isChange","getState","isEditorClick","isHintResult","hint","isDeleteTag","isTagClick","selectEndOf","isKeyDown","shiftKey","inputState","wanted","nextLeft","setSelectionStart","nextRight","setSelectionEnd","removeSelected","text","insert","after","title","force","json","JSON","stringify","counted","i","fragment","canvas","document","createElement","getContext","font","measureText","editing","setInput","setContent","addElement","canNewTag","exists","push","split","accumulated","wordIndex","wordEnd","forEach","assertElements","hints","getHints","toJSON","invalid","minimum","maximum","getValidationError","useSelectTags","inputTags","getAllTags","errorMessage","setErrorMessage","assertion","extra","setTimeout","useReducer","trim","initialState","dispatch","setTagDictionary","ErrorMessage","props","className","bold","useValidatedInput","inputs","buttonText","errorMessages","Map","input","Error","validate","label","set","posted","defaultValues","isAfterSubmit","onSubmitError","createInitialState","mapInputs","hideLabel","name","replace","toLocaleLowerCase","htmlFor","createLabel","get","validated","create","defaultValue","handleChange","once","setOnce","window","getPagedownEditor","run","usePagedownEditor","Fragment","onChange","e","target","id","placeholder","Editor","child","attributes","created","createChild","button","onClick","countErrors","size","noun","getButtonError","createValidated","currentState","isError","old","onSubmit","delete","optional","minLength","_extends","Object","assign","arguments","source","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_ref2","fill","d","_ref3","_ref","svgRef","height","viewBox","ref","ForwardRef","forwardRef","_ref4","cx","cy","r","Validated","children","cloneElement","icon","EditorTags","onEditorClick","onDeleteTag","onTagClick","onKeyDown","newinputState","isHandled","onHintResult","outputTag","getOnSelectTags","inputRef","createRef","handleKeyDown","preventDefault","Tag","close","current","handleDeleteTag","handleTagClick","showValidationError","validationErrorMessage","suffix","href","hrefAllTags","rel","showValidationResult","onClickCapture","tagName","onFocus","handleFocus","onBlur","ShowHints","ShowHint","getTag","summary","more","anchor","getMore","tabIndex","hasFocus","relatedTarget","related","isElement","relatedName","relatedClass","activeElement","targetName","activeElementName","div","getElementById","getDiscussionsSubtitle","left","info","to","Url","getTagInfoUrl","links","getTagEditUrl","route","newDiscussion","config","strNewQuestion","getDiscussionsOptionsUrl","getTagLink","getTagUrl","getTags","link","getUserSummary","option","getUserUrl","userName","src","gravatarHash","img","alt","gravatar","getWhen","when","getUserInfo","showWhen","location","toLocaleString","date","month","getMonth","year","Date","getFullYear","minutes","getMinutes","padStart","getDate","getHours","getDiscussionSummary","short","getDiscussionUrl","messageSummary","dateTime","stats","nAnswers","signature","userSummary","messageExerpt","getMessage","topic","dangerouslySetInnerHTML","toHtml","getNavLinks","spanifySelected","before","n","getPageNavLinks","nTotal","pageSize","numbers","first","last","rc","unshift","getPageNumbers","Math","floor","getTagCount","tagCount","ThrottledInput","api","setValue","handled","setHandled","isRunning","useRef","finished","handling","searchInput","finally","useThrottledInput","event","Topbar","Route","strTags","discussions","strQuestions","users","alert","login","setTitle","appname","renderContent","content","subTabs","footer","Array","isArray","subMenu","tabs","tab","selected","renderSubTabs","switchLayout","layout","right","rightColumn","rightButton","refDiv","refButton","hideOrShow","show","boundDiv","boundButton","classList","add","visible","showButtonLabel","closeButton","renderRightColumn","getClassName","main","tabbed","isTop","slug","slugDiv","navlink","renderTabs","mainColumn","subtitle","renderLayout","contents","getPage","showData","url","what","loadingError","loadingContents","Home","Api","getPublic","isHtml","lines","find","s","sliced","parse","html","trimHtml","require","Parser","ProcessNodeDefinitions","parser","processingInstructions","shouldProcessNode","node","processNode","attribs","Link","processDefaultNode","parseWithInstructions","htmlToReact","__html","showHome","Users","getUsers","showUsers","user","AnswerDiscussion","minLengths","body","discussionId","newMessage","__message","EditTagInfo","Data","tagSummaryLength","min","maxLength","rows","editTagInfo","history","getSummaryHint","EditUserSettings","email","aboutMe","editUserProfile","userId","idName","Login","password","NewDiscussion","outputTags","setOutputTags","tagValidation","NotFound","notFound","pathname","User","parsed","isUserOptions","isParserError","userTabType","canEdit","isUserActivityOptions","UserProfile","getUser","aboutMeDiv","showCommonUserLayout","showUserProfile","UserEditSettings","preferences","showUserSettings","UserActivity","page","getUserActivity","activity","summaries","tagCounts","getActivityContent","getActivityUrl","getUserActivityUrl","range","showUserActivity","gravatarSmall","profile","getUserOptionsUrl","settings","getSelected","Discussions","isDiscussionsOptions","pagesize","DiscussionsList","getDiscussions","showDiscussions","pageNumber","things","toString","toLowerCase","formatNumber","Discussion","isDiscussionOptions","discussion","DiscussionId","getDiscussion","showDiscussion","messages","getDiscussionOptionsUrl","getFirstMessage","getNextMessage","yourAnswer","Tags","isTagsOptions","TagsList","showTags","search","getTagsOptionsUrl","edit","getTagInfo","isTagInfo","isTagEdit","TagId","infoContent","showTag","SiteMap","getSiteMap","showSiteMap","images","getImageUrl","getImageSummary","features","getTagSummary","Image","isImage","ImageId","getImage","showImage","image","layers","renderLayers","layersWidth","handleLayerChange","alias","getAttribute","checked","level","listItems","layer","defaultChecked","renderNode","AppRoutes","exact","path","component","Page","siteMap","discussionsTagged","App","autologin","useCreateMe","Provider","basename","process","Boolean","hostname","match","ReactDOM","render","navigator","serviceWorker","ready","registration","unregister","resourceType","parts","Elements"],"mappings":"wUAAA,YAAS,cAAM,YAAK,cAAM,gBAAoB,kBAC9C,gBACS,QACT,YAAS,wBACT,aAAS,mB,ubCJT,YAQA,SAAS,EAAU,GACf,OAAK,QAAM,GAAS,EAAM,IAAS,EAAM,GAAE,IAAI,EAAM,aAmCzD,iBAGI,SAAF,EAAY,GADK,SAA2B,IAAI,IAE1C,KAAC,OAAS,EAqBhB,OAlBU,gBAAV,SAAc,GACZ,OAAO,KAAK,IAAI,IAAI,IAEZ,gBAAV,SAAc,EAAa,GACzB,KAAK,IAAI,IAAI,EAAK,IAEV,gBAAV,SAAc,GACR,OAAG,KAAK,IAAI,IAAI,IAGZ,wBAAV,WAAI,IAAJ,OACQ,EAAkC,GAKpC,OAJJ,KAAK,IAAI,SAAQ,SAAC,EAAO,GACvB,EApDN,SAAmB,EAAa,GAC9B,IAAK,EAAI,SAAS,KAChB,OAAO,EAGP,IAAI,EAAQ,EAAI,MAAM,KAClB,GAAc,EAAM,GAC1B,GAAK,EAKH,OADuC,EAAM,IAE3C,IAAK,QACH,IAAM,EAAa,EAAO,MAAK,SAAC,GAAW,SAAO,KAAP,KAC3C,IAAK,EAAY,CAEf,QAAQ,MAAM,wCAAwC,EAAG,KACzD,MAEF,EAAM,aAAW,EAAW,MAC5B,MACF,QAEE,QAAQ,MAAM,gDAAgD,EAAG,UAfrE,QAAQ,MAAM,uCAAuC,EAAG,KAmBxD,OAAK,EAwBG,CAAU,EAAK,EAAK,QAC1B,EAAG,KAAK,CAAE,IAAG,EAAE,MAAK,OAEf,GAEX,EAzBA,GA2BA,cAAE,SAAF,I,+CAaE,OAb+B,OAC7B,EAAF,uBAAI,GAEE,IAAE,EAAM,EAAU,GAChB,EAAQ,YAAM,IAAG,UAAC,GACpB,EAAJ,UAAM,IAAG,UAAC,EAAK,EAAQ,EAAQ,EAAI,IAEnC,EAAF,0BAEE,OADwC,YAAM,YAAW,WAC/C,KAAI,SAAC,GACb,MAAO,CAAE,IAAKA,EAAE,IAAK,MAAO,EAAE,WAGpC,EAbA,CAAiC,GAApB,gBAeb,kBAKI,SAAF,EAAY,EAAoB,GAAhC,MACE,YAAM,IAAU,KACZ,EAAC,QAAU,EACX,EAAC,UAAY,EACb,EAAC,UAAY,IAAI,IACrB,EAAK,YAAc,IAAI,IAEvB,IAAoB,2BAAW,CAA1B,IAAM,EAAK,KACR,EAAe,CAAE,GAAI,EAAM,GAAI,aAAc,SACnD,IAAK,EAAK,SAAS,GACjB,MAAM,IAAI,MAAM,mBAElB,IAAM,EAAM,aAAW,EAAM,MAC7B,EAAK,UAAU,IAAI,EAAM,GAAI,GAC7B,EAAK,YAAY,IAAI,EAAK,EAAM,I,SA+DpC,OAlFoC,OAsB5B,qBAAR,SAAiB,GACX,IAAE,EAAM,EAAU,GAClB,mBAAM,IAAG,UAAC,KAGV,EAAJ,UAAM,IAAG,UAAC,EAAK,KACR,IAEP,EAAF,0BAAO,GACD,IAAE,EAAe,CAAE,IAAG,GACtB,OAAG,KAAK,SAAS,IAErB,EAAF,wBAAK,GACH,IAAM,EAAK,KAAK,YAAY,IAAI,GAC1B,EAAe,EAAK,CAAE,GAAE,EAAE,aAAc,SAAY,CAAE,IAAG,GACzD,EAAM,EAAU,GAClB,GAAC,YAAM,IAAG,UAAC,GAGX,OAAG,GAGP,EAAF,mCAAgB,EAAc,GACxB,IAAE,EAAM,EAAU,GACtB,YAAM,IAAG,UAAC,GAAM,KAAK,IAGrB,EAAF,mCAAI,IAAJ,OACM,OAAG,KAAK,QAAQ,KAAI,SAAC,GACf,cAAO,QAEf,MAAO,CAAE,MAAK,EAAE,IAAG,EAAE,QAFD,UAEU,MADhB,YAAM,IAAG,OAAC,EAAU,CAAE,IAAK,KAAS,YAKpDC,EAAiBC,UAAU,UAA7B,sBAEM,OAAG,KAAK,QACT,KAAI,SAAC,GACI,YAER,MAAO,CAAE,IAAG,EAAE,QAFD,UAEU,MADT,YAAM,IAAG,OAAC,EAAU,CAAE,IAAK,KAAS,WAGnD,OACC,KAAK,UAAU,KAAI,SAAC,GACV,gBACF,EAAe,CAAE,GADN,KACU,aAAc,SACnC,EAAQ,YAAM,IAAG,OAAC,EAAU,IAAS,OAE3C,MAAO,CAAE,IADG,EAAK,OAAO,GAAO,IACjB,QAAO,EAAE,MAAK,QAOlC,EAAF,0BAAO,GAED,MAAG,CAAE,IADG,QAAM,GAAS,EAAM,IAAM,KAAK,UAAU,IAAI,EAAM,MAGpE,EAlFA,CAAsC,GAAzB,qBAqFb,IAAM,EAAsB,CAC1B,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,KACA,MACA,MAIF,yBAA8B,GAE1B,IADA,IAAI,EAAkB,EAAI,MAAM,KACzB,EAAI,EAAG,EAAI,EAAM,SAAU,EAAG,CACrC,IAAM,EAAO,EAAM,GACd,EAAU,SAAS,KACtB,EAAM,GAAK,EAAK,UAAU,EAAG,GAAG,oBAAsB,EAAK,UAAU,IAGvE,OAAK,EAAM,KAAK,O,wHCtLP,mBAAmB,CAAE,IAAK,GAAI,IAAK,M,8ICdhD,S,qKCNa,SAAS,CACpB,YAAY,EACZ,YAAY,EACV,WAAS,EACT,QAAO,YACP,UAAS,GACT,aAAY,IACZ,aAAY,YACZ,QAAO,OACP,eAAc,CACd,MAAO,iBACP,OAAQ,eACJ,KAAE,YAEN,cAAa,CACb,SAAS,EACT,SAAS,EACL,WAAO,GAEX,WAAU,CACV,MAAO,GACP,KAAM,M,k9CCrBV,YACI,EAAJ,MAyBA,SAAS,EAAQ,EAAa,GAI1B,OAxBJ,SAAa,EAAa,GAEtB,IAAI,EAAoB,GAUxB,OARE,IACF,EAAK,OAAS,OACd,EAAK,KAAO,KAAK,UAAU,GAC3B,EAAK,QAAU,CACb,eAAgB,qBAIf,SAAO,WAGH,YAAU,EAAK,EAAK,OAAS,EAAK,MAFlC,MAAM,EAAK,GAWb,CAAI,EAAK,GAAM,MAAK,SAAC,GACtB,IAAC,EAAS,GACN,UAAI,MAAM,EAAS,YAEvB,OAAG,EAAS,UAwBpB,SAAS,EAA6B,EAAyB,GAU3D,OATyB,IAAI,SAAe,SAAC,EAAS,GACtD,EAAQ,MAAK,SAAC,GACZ,IAAM,EAAgB,EAAQ,GAC9B,EAAQ,MAEV,EAAQ,OAAM,SAAC,GACb,EAAO,SAvBb,wB,mEACE,SAAO,EAAmB,MAAI,yBAGhC,oBAA+B,G,mEACvB,MAAN,GAAO,EAAiB,MAAI,YAAY,YAG1C,sB,mEACE,SAAO,EAA2B,MAAI,uBAGxC,mBAA8B,G,mEAC5B,SAAO,EAAgB,MAAI,WAAW,YAgBxC,2BAAsC,G,yEAGpC,OAFM,EAAM,MAAI,mBAAmB,GAEnC,GAAO,EADgD,EAA+B,GACnD,UAAQ,4BAG7C,0BAAqC,G,yEAGnC,OAFM,EAAM,MAAI,yBAAyB,GAEzC,GAAO,EAD+C,EAA8B,GACjD,UAAQ,2BAG7C,yBAAoC,G,yEAG5B,OAFA,EAAM,MAAI,wBAAwB,GAExC,GAAO,EAD8C,EAA6B,GAC/C,UAAQ,0BAG7CC,EAAQ,WAAR,W,mEACE,SAAO,EAAsB,MAAI,yBAGnC,mBAA8B,EAA0B,G,mEAEtD,SAAO,EADK,MAAI,kBAAkB,GACN,WAG9B,kBAA6B,G,mEAErB,MAAO,CAAb,EAAO,EADK,MAAI,aAAa,YAQ/B,iBAA4B,G,mEACpB,MAAN,GAAO,EAAuB,MAAI,eAAgB,WAGpD,sBAAiC,EAAsB,G,mEAC/C,MAAN,GAAO,EAAmB,MAAI,iBAAiB,GAAe,WAGhE,yBAAoC,G,mEAClC,SAAO,EAAkB,MAAI,uBAAwB,WAGvD,2BAAsC,EAAgB,G,mEAC9C,MAAN,GAAO,EAAkB,MAAI,uBAAuB,GAAS,WAG/D,uBAAkC,EAAa,G,mEACvC,MAAN,GAAO,EAAe,MAAI,mBAAmB,GAAM,WAiBrD,qBAAgC,G,2EA4B9B,OA3BM,EAAmB,IAAI,SACrB,OAAO,SAAU,oBACnB,EAAE,OAAO,SAAU,YACnB,EAAE,OAAO,gBAAiB,YAI1B,EAA6B,MAAM,EAHf,CACxB,QAAO,IAsBT,GAnBgC,IAAI,SAAgB,SAAC,EAAS,GAC5D,EACG,MAAK,SAAC,GACL,IAAK,EAAS,GAAI,CAChB,IAAM,EAAQ,IAAI,MAAS,EAAS,OAAM,IAAI,EAAS,YACtD,EAAc,IAAM,EACrB,QAAQ,MAAM,EAAM,SACpB,EAAO,GAET,EAAS,OAAO,MAAK,SAAC,GAEpB,EAAQ,SAGX,OAAM,SAAC,GACN,QAAQ,MAAM,EAAO,OACrB,EAAO,kB,+PCtKf,YACI,EAAJ,SACA,YACA,YAyHA,SAAgB,IACR,qBACJ,MAAK,CAAE,GADD,KACK,KADD,OACO,aADD,eACe,SADD,YA5GlC,sBAA2B,EAAa,GAEpC,QAAQ,IAAI,qBAAqB,GAGnC,IAAM,EAAyB,MAAI,YAAY,GACzC,EAAe,MAAI,gBAAgB,GACvC,IAAE,MAAI,cAAc,GAKpB,OAAM,GACN,IAAK,UACH,OAAO,EAAG,aAKR,IAAC,QACH,IAAM,EAAQ,MAAI,QAAQ,GAC1B,GAAI,MAAI,cAAc,GAEpB,OAEM,OAAD,EAAG,SAAS,EAAM,IAGvB,IAAC,OACH,GAAI,MAAI,QAAQ,GACd,OAAO,EAAG,mBAGZ,IAAM,EAAc,MAAI,cAAc,GACtC,GAAI,MAAI,cAAc,GAEpB,OAEM,aACR,OADc,eAEZ,IAAK,UACL,IAAK,eACL,UAAK,EACH,OAAO,EAAG,QAAQ,EAAK,GAAI,GACnB,IAAL,WAEH,IAAM,EAAe,MAAI,sBAAsB,GAC/C,GAAI,MAAI,cAAc,GAEpB,OAEF,OAAO,EAAG,gBAAgB,GAClB,QAER,OAIF,IAAC,aAED,IAAM,EAAU,MAAI,qBAAqB,GACzC,IAAK,MAAI,cAAc,GAErB,OADA,EAAQ,yBAAyB,EAAa,GACvC,EAAG,eAAe,GAMrB,EAAU,MAAI,oBAAoB,GAC9B,IAAL,MAAI,cAAc,GAAU,CAC/B,EAAQ,wBAAwB,EAAa,GAC7C,IAAM,EAAa,EAAG,cAAc,GACxB,IAAP,EAEH,OAEF,OAAO,EAKX,OAGE,IAAC,MACH,GAAI,MAAI,UAAU,GAChB,OAAO,EAAG,aAEN,EAAU,MAAI,cAAc,GAClC,IAAK,MAAI,cAAc,GACrB,OAAO,EAAG,QAAQ,GAEpB,IAAM,EAAM,MAAI,SAAS,GACzB,OAAK,MAAI,cAAc,QAIvB,EAHS,EAAG,OAAO,GAMrB,QACE,SAKNA,EAAQC,UAAYA,EAKpB,uBAA4B,EAAa,EAAgB,GAErD,QAAQ,IAAI,sBAAsB,EAAG,OAAO,KAAK,UAAU,OAAM,EAAW,IAG5E,IAAI,EAAyB,MAAI,YAAY,GACzC,EAAe,MAAI,gBAAgB,GACvC,IAAE,MAAI,cAAc,GAApB,CAKA,IAAI,GAAmB,IAAI,MAAO,cAgElC,OAAM,GACF,IAAC,QACH,OAAO,IACL,IAAC,MACH,IAAM,EAAU,MAAI,cAAc,GAClC,IAAK,MAAI,cAAc,GACrB,OAAO,EAAG,QAAQ,EAAU,EAAqB,aAOvD,IAAM,EA1EJ,SAAiB,GACb,OAAI,GACA,IAAD,aAKD,GADM,EAAe,MAAI,YAAY,GACnB,CAEhB,IAAM,EAAS,EACT,EAAY,EAAG,gBAErB,OAAO,EAAO,iBAAiB,EAAQ,EAAU,EAAQ,EAAc,GAK3E,GAAI,MAAI,gBAAgB,GAAW,CAC3B,EAAS,EAAf,IACM,EAAe,EAAG,mBAClB,EAAY,EAAG,gBACrB,OAAO,EAAO,oBAAoB,EAAQ,EAAU,EAAQ,EAAc,GAGlE,MAAH,CAAE,MAAO,8BAGZ,IAAD,OAID,IAAM,EAAY,MAAI,kBAAkB,GACxC,GAAI,EAAW,CACb,GAAI,IAAW,EAEb,MAAO,CAAE,MAAO,iDAEZ,EAAS,EACf,OAAO,EAAO,sBAAsB,EAAQ,EAAU,GAI1D,MAAO,CAAE,MAAO,wBAGlB,IAAK,MACH,IAAM,EAAM,MAAI,cAAc,GAC9B,GAAI,EAAK,CACD,EAAS,EACf,OAAO,EAAO,kBAAkB,EAAQ,EAAU,EAAQ,GAE5D,MAAO,CAAE,MAAO,uBAGZ,QACJ,MAAO,CAAE,MAAO,6BAmBP,CAAU,GACzB,IAAI,MAAI,cAAc,GAMtB,OAAO,EAAG,aAAa,GAJrB,QAAQ,IAAI,EAAO,U,kbN1NvB,QACA,eACS,SAET,gBACS,YAET,gBACS,SAET,eACS,SAET,eACS,QACT,aAAS,kBAIT,YACS,QADS,S,kFOtBlB,YA0CA,iBAAsB,GACpB,YAA4B,IAApB,EAAY,KA0BtB,sBAA2B,GAEzB,OAAO,MAAI,QAAQ,K,meCvErB,YAEA,WACA,SACA,SACA,SACA,SACA,SAWM,EAA0B,eAE1B,EAAkC,IAAI,IAEtC,EAAqB,GAErB,EAA8C,IAAI,IAGlD,EAA8C,GAC9C,EAA8C,GAG9C,EAA2C,IAAI,IAE/C,EAA0C,IAAI,IAE9C,EAAqC,IAAI,IAGzC,EAAmC,IAAI,mBAAiB,EAAW,GAEnE,EAAyB,IAAI,aAM7B,EAAgC,SAAC,GAAiB,SAAe,OAAf,IAaxD,SAAS,EAAmB,EAAgB,GAC1C,MAAO,CACL,GAAI,EACJ,KAAM,EAAK,KACX,aAAc,EAAK,aACnB,SAAU,EAAK,QAAQ,UAI3B,SAAS,EAAe,GACpB,OAAK,EAAmB,EAAQ,EAAS,IAAI,IAGjD,SAAS,EAAkB,GACvB,OAAK,EAAW,MAGpB,SAAS,EAAgB,GACvB,OAAO,EAAW,SAAS,OAAS,EAAW,SAAS,EAAW,SAAS,OAAS,GAAK,EAAW,MAKvG,SAAS,EAAkB,EAA4B,GACrD,MAAO,CAAC,EAAW,IA5BG,EA4BgB,EAAW,GA3B1C,IAAI,KAAK,EAAQ,UAAU,YADpC,IAAwB,EA+BxB,SAAS,EAAc,GACnB,IAAI,EAAyB,CAC7B,MAAO,GACP,YAAa,IAET,EAAuB,IAAI,IAgBjC,OAfE,EAAiB,SAAQ,SAAC,GACnB,WAAY,OACX,OAAI,SAAM,SACd,EAAI,IAAI,EAAQ,QAChB,EAAD,YAAY,KAAK,CACZ,GAAJ,EACI,KAAF,EACE,OAAK,IAAI,GACT,OAAE,EAAQ,OACV,cAAS,YAAU,EAAQ,UACjC,SAAU,EAAQ,SAClB,SAAU,EAAW,SAAS,YAGlC,EAAQ,SAAQ,SAAC,GAAW,SAAG,MAAM,KAAK,EAAd,OACrB,EA0BT,SAAS,EACP,EACA,EACA,EACA,EACA,GAKA,IAAM,EAAS,EACT,GAAS,EAAa,GAAK,EAE/B,MAAK,CAAE,MAAO,CAAE,OAAM,EAAE,KAAI,EAAE,SAAQ,EAAE,WAAU,GAAI,SADvC,EAAM,MAAM,EAAO,EAAQ,IAwH9C,SAAgB,IACZ,OAAK,EAAe,YAmLxB,SAAgB,EAAa,GACzB,OAAM,EAAO,MACT,IAAC,UACG,OAxIZ,SAAqB,GACb,0BAAE,WAAQ,SAId,OAHA,EAAO,IAAI,EAAQ,GACnB,EAAW,IAAI,EAAQ,IACvB,EAAO,IAAI,EAAQ,IAAI,cAAY,IAC9B,CAAM,KAAQ,KAAM,EAAK,MAmIrB,CAAY,GACjB,IAAC,kBACG,OAlIZ,SAA6B,GACnB,IAAF,8BAAE,WAAQ,WACV,EAAO,EAAS,IAAI,GAKxB,OAJA,EAAG,KAAO,EAAO,KACjB,EAAG,MAAQ,EAAO,MAClB,EAAG,QAAQ,SAAW,EAAO,SAC7B,EAAG,QAAQ,QAAU,EAAO,QACvB,CAAM,KAAQ,KAAM,EAAK,MA2HrB,CAAoB,GACzB,IAAC,WACG,OA1HZ,SAAsB,GAClB,IAAIC,EAAe,EAAO,gBAAgB,GAM1C,OALG,EAAe,OAAO,EAAI,MAE7B,QAAQ,MAAM,iBAEd,EAAM,KAAK,GACN,CAAE,IAAK,EAAI,KAmHP,CAAa,GAClB,IAAC,gBACG,OAlHZ,SAA2B,GAKvB,IAJI,gCAAE,WAAQ,SAAM,UAChB,EAAe,EAAO,GAEtB,EAAkB,GACN,uBAAM,CAAnB,IAAM,EAAG,KACR,EAAQ,EAAe,KAAK,GAChC,IAAK,EAAO,CACV,IAAK,eAAa,WAAY,CAG5B,QAAQ,MAAM,oCAAoC,GAClD,SAOF,GAHA,EADkC,EAAO,aAAa,EAAK,EAAO,SAAU,EAAO,WAGnF,EAAQ,EAAe,KAAK,IAI1B,SAGA,EAAG,KAAK,GAGZ,EAAK,SAAQ,SAAC,GAAU,SAAe,gBAAgB,EAA/B,MAExB,IAAI,EAA6B,CACjC,GAAI,EAAO,GACX,KAAM,EAAO,KACb,KAAM,EACN,MAAOC,EACP,SAAU,IAEV,EAAa,IAAI,EAAc,GAC/B,IAAI,EAAS,EAAkB,EAAY,GAO3C,OANA,EAAsB,QAAQ,GAC9B,EAAsB,QAAQ,GAEhC,EAAa,IAAI,EAAQ,QAAS,KAAK,GAErC,EAAiB,IAAI,EAAQ,UAAW,GACnC,EAqEI,CAAkB,GACvB,IAAC,aACH,OApEN,SAAwB,GAChB,6BAAE,iBAAc,YAChB,EAA6B,EAAe,IAAI,GAqBpD,OAnBA,EAAS,SAAS,KAAK,GAEvB,SAAgB,GAEZ,IAAC,IAAI,EAAI,EAAwB,OAAS,EAAG,GAAK,IAAK,EACzD,GAAI,EAAwB,GAAG,KAAO,EAAO,GAG3C,OAFA,EAAwB,OAAO,EAAG,QAClC,EAAwB,QAAQ,GAIhC,QAAI,IAAI,qCAEZ,CAAO,EAAkB,EAAY,IAErC,EAAW,IAAI,EAAQ,QAAS,KAAK,GACvC,EAAW,KAAK,SAAQ,SAAC,GAAU,SAAS,IAAI,EAAQ,QAAS,IAA9B,MAEjC,EAAiB,IAAI,EAAQ,UAAW,GACnC,CACD,YAAS,EAAe,EAAQ,QAChC,SAAM,EAAQ,SACd,SAAM,EAAQ,UA0CT,CAAe,GACpB,IAAC,cACH,OAxCN,SAAyB,GAEf,IAAF,0BAAE,QAAK,WACL,YAAS,aACX,EAA2B,EAAe,KAAK,GACnD,GAAG,EAAH,CAIF,GAAI,QAAM,GAAQ,CAGhB,IAAM,EAAiB,EAAQ,MAAK,SAAC,GAAM,SAAE,MAAQ,EAAV,OAC3C,EAAM,QAAU,EAAQ,OAAS,OAAU,EAC3C,EAAM,SAAW,EAAS,OAAS,OAAW,MACzC,CACL,GAA2B,UAAvB,EAAM,aAEF,OAEJ,IAAE,EAAoB,EAAU,MAAK,SAAC,GAAM,SAAE,KAAO,EAAT,MAC5C,EAAE,QAAU,EAChB,EAAM,SAAW,EAAS,OAAS,OAAW,EAE9C,MAAK,CAAE,IAAK,IAgBH,CAAgB,GACzB,QACE,MAAO,CAAE,MAAO,yBA5ZtB,2BACE,OAAO,EAAW,UAAU,QAE9B,8BACE,OAAO,EAAW,aAAa,QAqGjC,wBACI,MAAK,CACL,OAAQ,EACR,KAAM,EAAe,kBAIzB,oBAAyB,GACrB,OAAK,EAAU,MAAK,SAAC,GAAU,SAAM,KAAN,MAGnC,8BACI,IAAI,EAAyB,GAE7B,OADA,EAAO,SAAQ,SAAC,EAAM,GAAW,SAAG,KAAK,EAAmB,EAA3B,OAC5B,EAAG,MAAK,SAAC,EAAG,GAAM,SAAE,KAAK,cAAc,EAArB,UAG3B,mBAAwB,EAAgB,GACtC,IAAM,EAA6B,EAAS,IAAI,GAChD,GAAK,EAAL,CAGE,IAAI,EACJ,IAAW,OACP,EACA,CACE,MAAO,EAAK,OAEd,SAAE,OAAI,SAAM,iBAChB,MAAK,CACD,GAAF,EACE,OACJ,SAJ8B,WAK9B,aAAY,EACZ,QAAS,EAAK,QAAQ,QACtB,YAAa,KAIjB,2BAAgC,GAG5B,IAAI,EAAS,EAAQ,KAAK,GACtB,EAA0B,EAAa,IAAI,GAC3C,EAAyB,EAAQ,KAAO,EAAQ,KAAO,SACvD,EAA0B,WAAT,EAAoB,EAAW,EAAS,QAAQ,UAEjE,qCAAE,UAMF,IANS,WACsD,KAAI,SAAC,GACpE,IAAE,EAAuB,EAAmB,IAAI,EAAQ,WAExD,MAAG,CAD4B,EAAe,IAAI,GAClC,OAIpB,MAAK,CAAE,MAFD,QAEQ,YAFD,cAEc,MAAK,EAAE,UADF,EAAS,IAAI,GAAS,SAI1D,0BAA+B,GAC3B,IAAI,EAA4B,EAAQ,KAAO,EAAQ,KAAO,SAC1D,EAAkB,WAAT,EAET,EAAwC,EAAS,EAA0B,EAC3E,EAAM,EAAQ,IACd,EAAuB,EAEzB,EAAkB,QAAO,SAAC,GAGxB,IAFA,IAAM,EAAe,EAAK,GAEN,MADD,EAAe,IAAI,GACP,KAAX,eAAiB,CAAhC,IAAM,EAAK,KAEd,GADwB,EAAgB,GAC9B,MAAQ,EAAI,IACpB,OAAO,EAGX,OAAO,KAVT,EAYE,EAAyB,EAAS,EAAkB,EACpD,2DAAE,UAAO,aAOT,EAAe,OAAQ,GAAK,CAAE,IAAG,IAMjC,IALwC,EAAS,KAAI,SAAC,GAAS,SAAe,IAAI,EAAnB,OACW,KAAI,SAAC,GAAe,OAClG,EACA,EAAW,QAGX,MAAK,CAAE,MADD,QACQ,YADD,cACc,MAAO,IAGtC,yBAA8B,GAC1B,IAAI,EAAa,EAAe,IAAI,EAAQ,WAAW,IACvD,GAAG,EAAH,CAGF,IAAM,EAA2B,EAAQ,KAAO,EAAQ,KAAO,SACzD,EAA0B,WAAT,EAAoB,EAAW,SAAW,EAAW,SAAS,QAAQ,UACvF,8CAAE,UAON,OAxJJ,SACE,EACA,EACA,GAEQ,WAAI,SAAM,SAAM,UAClB,EAA0B,CAC9B,MAAO,GACP,GAAE,EACF,KAAI,EACJ,KAAM,EAAK,IAAI,GACf,MAAK,EACL,MAAK,EACL,SAAQ,GAEJ,EAAuB,IAAI,IAKjC,OAJE,EAAM,IAAI,EAAW,MAAM,QAC3B,EAAO,SAAQ,SAAC,GAAY,SAAQ,IAAI,EAAZ,WAC5B,EAAM,IAAI,EAAG,MAAM,QACnB,EAAM,SAAQ,SAAC,GAAW,SAAG,MAAM,KAAK,EAAd,OACrB,EAoIA,CAAe,EAPP,WAO6B,KAG9C,eAIA,mBAAwB,EAA0B,GAC9C,IAAI,EAAwB,IAAa,QAAO,SAAC,GAC7C,OAAH,GAAqB,EAAS,IAAI,SAAS,MAExC,EAAqB,EAAQ,KAAO,EAAQ,KAAO,UACpC,SAAjB,EAAQ,KACN,EAAC,MAAK,SAAC,EAAG,GAAM,SAAE,IAAI,cAAc,EAApB,QAEpB,EAAK,MAAK,SAAC,EAAG,GACZ,OAAO,EAAE,QAAU,EAAE,MAAQ,EAAE,IAAI,cAAc,EAAE,KAAO,EAAE,MAAQ,EAAE,SAGpE,iDACN,MAAO,CAAE,MADD,QACQ,UADD,aAIjB,kBAAuB,GACnB,IAAI,EAA2B,EAAe,KAAK,EAAI,KACvD,GAAG,EAAH,CAIA,GAAE,QAAM,GAAQ,CAGhB,IAAM,EAAiB,EAAQ,MAAK,SAAC,GAAM,SAAE,MAAQ,EAAV,OAE3C,MAAO,CAAE,MADD,QACQ,QADD,UACU,SADD,WACW,IAAK,EAAI,KAE5C,GAA2B,UAAvB,EAAM,aAAV,CAII,IAAE,EAAoB,EAAU,MAAK,SAAC,GAAM,SAAE,KAAO,EAAT,MAEhD,MAAO,CAAE,MADD,OACc,QADR,UACiB,SADR,WACkB,IAAK,EAAI,QA6ItD,iBAuBA,WAGE,SAAS,EAAS,EAAc,EAAgB,EAAkB,GAChE,GAAI,IAAW,EAAU,CACvB,IAAM,EAAgB,KAAK,UAAU,CAAE,OAAM,EAAE,SAAQ,GAAI,KAAM,GAC3D,EAAiB,KAAK,UAAU,EAAQ,KAAM,GACpD,QAAQ,MAAM,iBAAiB,EAAI,MAAM,EAAK,IAAI,IALxB,cAAY,GAQlC,SAAQ,SAAC,GAEf,OAAQ,EAAO,MACb,IAAK,UACH,EAAS,OAAQ,EAAO,OAAQ,EAAW,OAAO,OAAQ,GAC1D,MACF,IAAK,gBACH,EAAS,aAAc,EAAO,aAAc,EAAW,aAAa,OAAQ,GAC5E,EAAS,UAAW,EAAO,UAAW,EAAW,UAAU,OAAQ,GACnE,MACF,IAAK,aACH,EAAS,UAAW,EAAO,UAAW,EAAW,UAAU,OAAQ,GAMvE,EAAa,MAGjB,I,kFClfa,eAAe,CAC1B,YAAY,I,kFCKd,iBAEI,SAASC,IACLC,KAAC,MAAQ,EAKf,OAHED,EAAQL,UAAUO,KAAO,WACrB,QAAK,KAAK,OAElB,EARA,GAUIC,EAIA,WACA,KAAK,OAAS,IAAI,EAClB,KAAK,aAAe,IAAI,EACxB,KAAK,UAAY,IAAI,GAPZ,gB,kFChBb,YAEA,qBAA0B,GAGtB,IAFF,IACI,EACe,MAFK,EAAS,MAAM,KAEpB,eAAO,CAArB,IAAM,EAAI,KACb,GAAK,EAAK,OAAV,CAGI,MAAM,EAAG,OAAS,EAAK,OAAS,SAAO,aAAc,CACvD,GAAM,OACN,MAEE,EAAC,EAAK,EAAK,IAAM,EAAO,GAE5B,OAAK,GAAU,iB,+PCbnB,eAcA,SAAS,EAAe,EAAa,EAAW,EAAwB,GAyDtE,OAxDE,SAAO,EAAW,EAAY,EAAa,GACvC,UAAO,WAAkB,EACrB,UAAI,MAAM,8BAA8B,EAAM,qBAAqB,GAEvE,cAAW,GACP,IAAD,UACC,IAAD,SACC,IAAD,SACH,OACI,IAAD,SACH,MACF,IAAK,YACC,IAAD,SACC,IAAD,WACC,QACJ,MAAM,IAAI,MAAM,sCAAsC,GAEtD,SAAM,QAAQ,GAAd,CACI,IAAD,MAAM,QAAQ,GACT,MAAF,IAAI,MAAM,0CAA0C,GAEtD,GAAgB,IAAlB,EAAO,aAEJ,GAAsB,IAAlB,EAAO,OAEhB,IAAsB,2BAAO,CAC3B,EADgB,KACI,EAAO,QAExB,CAEG,GAAJ,EAAM,SAAW,EAAO,OAChB,MAAJ,IAAI,MAAM,oCAAoC,EAAO,OAAM,UAAU,EAAM,QAEnF,IAAK,IAAI,EAAI,EAAG,EAAI,EAAO,SAAU,EACnC,EAAW,EAAM,GAAI,EAAO,UAK9B,QAAa,EAAU,EAAQ,GAI/B,IAAC,IAAM,KAAO,EAAQ,CAClB,MAAW,EAAW,EAAW,IAAM,EAAM,EAC7C,GAAoB,qBAAf,EAAM,IACf,IAAK,IAAa,EAAS,IAAI,GAC7B,MAAM,IAAI,MAAM,uBAAuB,EAAQ,OAAO,KAAK,UAAU,GAAO,OAAO,KAAK,UAAU,SAGpG,EAAW,EAAM,GAAM,EAAO,GAAM,IAK1C,CAAW,EAAQ,GACZ,EA2BT,aAAS,0BAyCT,uBAA4B,GACxB,IAAI,EAAmB,GAEnB,EAnCsB,EANd,EAAQ,KAMyB,CALrB,CACxB,MAAO,MACP,OAAQ,EACR,SAAU,mCAsCV,EAAC,KAAI,MAAP,EAAW,EAAK,IAAI,EAAO,oBAjE7B,WACI,IAeI,EAAiC,EAfzB,EAAQ,KAeoC,CAdrB,CACnC,EACA,CACM,KAAE,SACF,MAAG,oBACH,SAAM,gCACV,QAAS,CACP,SAAU,WACV,QAAS,2DAEX,WAAY,MAGc,IAAI,IAAY,CAAC,kBAAmB,sBAEhE,OAAK,IAAI,IAAwB,GAkDI,GASjC,SAAQ,SAAC,EAAkB,GAC3B,EAAD,KATH,SAAqB,EAAgB,GAC7B,aAAM,UAAO,aACf,EAAuB,CAAE,KAAI,EAAE,MAAK,GACtC,OAAG,EAAO,cAAc,EAAQ,EAAU,GAMtC,CAAc,EAAQ,IAC1B,EAAD,KALH,SAA4B,EAAgB,GACxC,OAAG,EAAO,wBAAwB,EAAM,GAIpC,CAAqB,EAAQ,OA7CzC,WACI,IACI,EAA6B,CAC7B,OAAI,EACJ,SAAM,iDACN,SAAM,gCACN,UAAO,GAgBP,EAA2B,EArBnB,EAAQ,KAqB8B,CAdrB,CACzB,KACA,KAAE,2DACF,KAAE,CAAC,CAAE,IAAK,QACV,MAAG,EACH,SAAM,CAAC,UASiD,GAPjC,SAAC,EAAa,GACzC,YAAmB,IAAf,EAAO,WAIS,IAAb,EAAM,SAA2C,IAAvB,EAAM,iBAGvC,OAAK,IAAI,IAA4B,EAAO,KAAI,SAAC,GAAM,OAAC,EAAE,GAAH,OAyBR,GAqBrC,SAAQ,SAAC,EAA4B,GACvC,cAAO,aACf,EAAG,KAtBH,SACA,EACA,EACA,GAEI,IAAE,EAAgB,EAAW,KAC3B,EAAc,EAAW,KAAK,IAAI,GAChC,aAAU,cAAW,aAAU,WACjC,EAA6B,CACjC,MAAK,EACL,KAAM,EAAK,KAAI,SAAC,GAAQ,gBAClB,SAAE,GAEN,OAAG,EAAO,oBAAoB,EAAQ,EAAU,EAAQ,EAAc,GASlE,CAA0B,EAAc,EAAY,IAC5D,EAAG,KAAI,MAAP,EAAW,EAAS,KAAI,SAAC,GAAY,OARrC,SAA2B,EAAsB,GACzC,iBAAU,cAAW,aAAU,WACjC,EAA0B,CAAE,SAAQ,GAC1C,OAAO,EAAO,iBAAiB,EAAQ,EAAU,EAAQ,EAAc,GAKlC,CAAoB,EAApB,UAGvC,IAAM,EAAiC,EAAG,KAAI,SAAC,GAAW,OAAC,EAAQ,IAAI,KAAK,EAAO,UAAzB,cAQ1D,OAPA,EAAO,MAAK,SAAC,EAAG,GACd,OAAI,EAAE,KAAO,EAAE,GACN,EAAE,GAAK,EAAE,GAEX,EAAO,gBAAgB,EAAE,IAAM,EAAO,gBAAgB,EAAE,OAG1D,EAAO,KAAI,SAAC,GAAS,iB,kiDClM9B,wBACI,MAAK,K,08/PCgBT,IAAM,EAAyC,IAAI,IAEnD,SAAS,EAAS,GACd,IAAE,EAAe,EAAY,IAAI,GAKjC,OAJG,IACC,EAAW,GACX,EAAQ,IAAI,EAAQ,IAEnB,EAGT,oCAAyC,EAAgB,GACrD,IAAI,EAAe,EAAS,GAE5B,GAAE,EAAQ,MAAQ,EAAQ,SAAU,CAChC,MAAS,EAAa,YACrB,IACH,EAAS,GACT,EAAa,YAAc,GAEzB,EAAQ,OACV,EAAO,KAAO,EAAQ,MAEpBC,EAAQ,WACV,EAAO,SAAW,EAAQ,UAI5B,IAAI,EAAM,EAAa,YACrB,IACE,EAAI,OACN,EAAQ,KAAO,EAAI,MAEjB,EAAI,WACN,EAAQ,SAAW,EAAI,YAK7B,mCAAwC,EAAgB,GACtD,IAAM,EAAe,EAAS,GAE9B,GAAI,EAAQ,KAAM,CAChB,IAAI,EAAS,EAAa,WACrB,IACH,EAAS,GACT,EAAa,WAAa,GAExB,EAAQ,OACV,EAAO,KAAO,EAAQ,MAI1B,IAAM,EAAM,EAAa,WACrB,GACE,EAAI,OACN,EAAQ,KAAO,EAAI,Q,kFC3EzB,YACA,QAYA,qBAA0B,EAAa,EAAgB,GACnD,OAAK,IAAI,SAAwB,SAAC,EAAS,GACvC,YAAO,WACH,GAAF,SAAO,WAAL,CAEI,IAAF,EAA4B,IAAI,SAAa,SAAC,EAAS,GAE3D,EAAO,uCAOT,EALgC,CAC9B,IAAI,EACJ,WAAY,eACZ,KAAM,WAAM,gBATV,CAmBA,MAAS,cAAY,GAErB,EAD6B,SAAX,EACyB,cAAY,EAAK,EAAQ,KAAK,MAAM,IAA9D,aAAW,EAAK,GAClC,GAGK,EAAD,IAAI,MAAM,0BAA0B,IAKvC,MAA4B,IAAI,SAAa,SAAC,EAAS,GAE3D,EAAQ,MAOV,EALiC,CAC/B,IAAI,EACJ,WAAY,KACZ,KAAM,WAAM,eAGb,SAAO,gB,kFCrDd,IACI,EAAY,IADI,EAAQ,KACC,wBAG7B,kBAAuB,GAEnB,MAAK,CAAE,OADMC,EAAUC,SAASC,M,4UCGvBC,G,mCAAaC,IAAMC,cAA+B,CAC7DC,QAAIC,EACJC,MAAO,SAACF,QAGH,SAASG,IAEd,OADoCL,IAAMM,WAAWP,GACnCG,GC6Cb,SAASK,EAAmBC,GACjC,OAAOC,EAAaD,OAHA,GAMf,SAASC,EAEdD,EAEAE,GAC4B,IAAD,EACFV,IAAMW,cAA6BR,GADjC,mBACpBS,EADoB,KACdC,EADc,OAEHb,IAAMW,cAA4BR,GAF/B,mBAEpBW,EAFoB,KAEdC,EAFc,OAGDf,IAAMW,cAA4BR,GAHjC,mBAGpBa,EAHoB,KAGbC,EAHa,OASCjB,IAAMW,UAAkB,GATzB,mBASpBO,EAToB,KASZC,EATY,KAgB3B,IAAMC,EAAUpB,IAAMqB,SAAQ,WAiB5B,OAhByD,SAACC,GACxD,IAAMC,EAAUf,EAAQE,EAAOY,GAa/B,OAZ0B,IAAIE,SAAc,SAACC,EAASC,GACpDH,EAAQI,MAAK,SAACC,GAGZb,EAAQa,GAERH,OAEFF,EAAQM,OAAM,SAACb,GACbU,EAAOV,YAMZ,CAACR,EAASE,IAoBb,OAdAV,IAAM8B,WAAU,WACdtB,EAAQE,GACLiB,MAAK,SAACC,GACLb,EAAQa,GACRf,EAASH,MAEVmB,OAAM,SAACE,GACNC,QAAQC,IAAR,2BAAgCF,IAChCd,EAASc,QAEZ,CAACvB,EAASE,EAAOQ,IAIb,CAAEJ,KAAMF,IAASF,EAAQI,OAAOX,EAAWa,QAAOkB,OA5CzD,WACEf,GAAWD,IA2CoDE,W,oBChDtDe,EAAb,WAQE,WAAYC,EAAgCC,EAAgBC,GAAsB,yBAPzEC,oBAOwE,OANxEC,kBAMwE,OALxEC,yBAKwE,OAJxEC,WAIwE,OAHxEC,mBAGwE,OAFhEP,kBAEgE,MACzEG,EAA4DH,EAA5DG,eAAgBC,EAA4CJ,EAA5CI,aAAcI,EAA8BR,EAA9BQ,mBAAoBF,EAAUN,EAAVM,MACxDT,EAAI,WAAY,CACdM,iBACAC,eACAI,qBACAF,UAGFL,GAAQC,GAAcA,IAAeI,EAAO,wBAGrB,OAAnBH,IACFF,GAAO,EAAO,kCACdE,EAAiB,GAEE,OAAjBC,IACFH,GAAO,EAAO,gCACdG,EAAe,GAEbD,EAAiBC,IACnBH,GAAO,EAAO,4CACdE,EAAiB,GAInB,IADA,IAAII,GAAgB,EACbD,EAAMG,QAAuB,MAAbH,EAAM,IAC3BA,EAAQA,EAAMI,UAAU,KACtBP,IACAC,EACFG,GAAgB,EAGlBnD,KAAK+C,eAAiBA,EACtB/C,KAAKgD,aAAeA,EACpBhD,KAAKiD,oBAA6C,aAAvBG,EAC3BpD,KAAKkD,MAAQA,EACblD,KAAKmD,cAAgBA,EACrBnD,KAAK4C,aAAeA,EA9CxB,oDAkDI5C,KAAK4C,aAAaW,UAlDtB,iCAqDaL,EAAeM,EAAeC,GAEvCzD,KAAK4C,aAAaM,MAAQA,EAC1BlD,KAAK4C,aAAac,kBAAkBF,EAAOC,GAE3C,IAAME,EAAQC,EAAaV,EAAQ,KACnClD,KAAK4C,aAAaiB,MAAMF,MAAxB,UAAmCA,EAAnC,QA3DJ,+BAsEI,MAN4B,CAAC,UAAD,OAChB3D,KAAKgD,cADW,eAElBhD,KAAKgD,cAFa,oBAGbhD,KAAKiD,qBAHQ,iBAIhBjD,KAAKkD,QAEAY,KAAK,UAtE1B,KA6EMC,E,WAYJ,WAAYC,EAAsBpB,EAA4BC,GAAiB,yBAXtEoB,iBAWqE,OAVrEC,kBAUqE,OATrEC,kBASqE,OARrEC,gBAQqE,MACpEC,EAAaL,EAAbK,SADoE,EAEpCC,EAAcD,EAAUxB,GAAxD0B,EAFoE,EAEpEA,WAAYC,EAFwD,EAExDA,QAASC,EAF+C,EAE/CA,OACvBC,EA+cV,SAAyBL,EAA0CM,EAAe9B,GAChF,OAAO+B,EACLP,EAASQ,KAAI,SAACC,GAAD,OAAOA,EAAEC,QACtBJ,EACA9B,GAndqBmC,CAAgBX,EAAUE,EAAY1B,GAEnDE,EAA6DH,EAA7DG,eAAgBC,EAA6CJ,EAA7CI,aAAcC,EAA+BL,EAA/BK,oBAAqBC,EAAUN,EAAVM,MAGrD+B,EAAelC,IAAmBC,GAAgBC,EAClDiC,EAAgBnC,IAAmBC,IAAiBC,EAG1DjD,KAAKiE,YAAiC,IAAnBlB,IAAyByB,GAAWS,EAEvDjF,KAAKkE,aAAelB,IAAiBE,EAAMG,SAAWoB,GAAUS,EAEhElF,KAAKmE,aAAeO,EAAe3B,EACnC/C,KAAKoE,WAAaM,EAAe1B,E,qDAvBjC,OAAOhD,KAAKmE,aAAe,I,gCAG3B,OAAOnE,KAAKoE,WAAa,M,oDAuBZe,GACbA,EAAaC,OAAOpF,KAAKmE,aAAcnE,KAAKoE,gB,KAO1CiB,E,WAQJ,WAAYC,EAA8BC,GAAmB,yBAPrDC,eAOoD,OANpDC,YAMoD,OAHpDC,WAGoD,OAFpDH,aAEoD,MAElDvB,EAAoBsB,EAApBtB,MAAOK,EAAaiB,EAAbjB,SACfrE,KAAKwF,UAAYxB,EAAMwB,UACvBxF,KAAKyF,OAASzB,EAAMyB,OACpBzF,KAAK0F,MAAQrB,EAASQ,KAAI,SAACC,GAAD,OAAOA,EAAEC,QACnC/E,KAAKuF,QAAUA,EAN2C,IASlDhB,EAAeD,EAAcD,EAAUkB,EAAQ1C,QAA/C0B,WATkD,EAUVgB,EAAQ3C,aAAhDM,EAVkD,EAUlDA,MAAOH,EAV2C,EAU3CA,eAAgBC,EAV2B,EAU3BA,aAC/BhD,KAAK2F,eAAepB,EAAYrB,EAAO,CACrCM,MAAOT,EACPU,IAAKT,IAEPP,EAAI,eAAgB,CAClB+C,UAAWxF,KAAKwF,UAChBC,OAAQzF,KAAKyF,OACbC,MAAO1F,KAAK0F,Q,uDAMd,IAAM1B,EAAe,CAAEyB,OAAQzF,KAAKyF,OAAQD,UAAWxF,KAAKwF,WADpC,EAEoCxF,KAAKuF,QAAzD1C,EAFgB,EAEhBA,OAAQD,EAFQ,EAERA,aAAcgD,EAFN,EAEMA,cACxBN,EAA+BO,EAAY7B,EAAOnB,EAHhC,EAEqBiD,WAC+BlD,EAAcgD,GAC1FG,EAAiB,kCAAmCT,GAEpD,IAAMU,EAAiBV,EAAcjB,SAASQ,KAAI,SAACoB,GAAD,OAAaA,EAAQlB,QAAMmB,QAAO,SAACnB,GAAD,QAAYA,EAAK1B,UAC/F8C,GAAWb,EAAcc,gBAAgB/C,OAE/C,OADArD,KAAKuF,QAAQc,OAAO,CAAEL,OAAMG,YACrBb,I,qCAGMX,EAAe2B,EAAkBd,GAC9CxF,KAAKuG,YAEL,IAAMC,EAAsBxG,KAAK0F,MAAMf,GAEjC8B,EAASzG,KAAK0F,MAAMrC,QAAgD,KAAtCrD,KAAK0F,MAAM1F,KAAK0F,MAAMrC,OAAS,GAAY,EAAI,GAGnF,GAAImD,IAAgBF,EAApB,CAGA,IAAMI,EAAY9B,EAAa5E,KAAK0F,MAAOf,EAAO3E,KAAKuF,QAAQ1C,QAKzD8D,EAAgC,KAAbL,GAAmB3B,EAAQ8B,EAAS,EACzDE,GACF3G,KAAK4G,cAAcF,EAAYF,EAAYnD,QAG7C,IAAMwD,EAAiC,KAAbP,GAAmB3B,IAAU8B,EAAS,GAAe,IAAV9B,EACjEkC,GACF7G,KAAK4G,cAAcF,EAAY,GAGjC,IAAMI,EAAiBJ,IAAc1G,KAAK+G,eAAiBpC,EACvDmC,GAEF9G,KAAKuF,QAAQ1C,QAAQ2D,EAAYnD,UAAYiD,EAASjD,OAAQ,+BAGhEZ,EAAI,iBAAkB,CACpBkE,mBACAE,oBACAC,mBAIF,IAAME,EAAsBR,EAAYnD,QAAUsD,GAAoBE,EAAoB,EAAI,GACxFI,EAAsBJ,GAAqBC,EAAiBJ,EAAY,EAAIA,EAC5EQ,EAAuBJ,EAA4B,IAAMR,EAAjBA,EAY9C,GATAtG,KAAKyF,OAAS0B,EAAanH,KAAKyF,OAAQwB,EAAaD,EAAaE,GAE9DZ,EAASjD,OACXrD,KAAK0F,MAAMf,GAAS2B,EAEpBtG,KAAK0F,MAAM0B,OAAOzC,EAAO,GAIvBa,EAAW,CAEb,IAAMkB,EAAY9B,EAAa5E,KAAK0F,MAAOf,EAAO3E,KAAKuF,QAAQ1C,QAC/D7C,KAAKwF,UAAUhC,MAAQgC,EAAUhC,MAAQkD,EACzC1G,KAAKwF,UAAU/B,IAAM+B,EAAU/B,IAAMiD,OAGjC1G,KAAKwF,UAAUhC,MAAQkD,IACzB1G,KAAKwF,UAAUhC,OAASwD,GAEtBhH,KAAKwF,UAAU/B,IAAMiD,IACvB1G,KAAKwF,UAAU/B,KAAOuD,GAG1BhH,KAAKuG,e,kCAKLc,EAAYrH,KAAK0F,MAAO1F,KAAKyF,OAAQzF,KAAKuF,QAAQ1C,U,oCAE9B8B,GACpB3E,KAAKuF,QAAQ1C,OAAmD,MAA5C7C,KAAKyF,OAAOnC,UAAUqB,EAAOA,EAAQ,GAAY,uC,6BAGhEnB,EAAewD,GACpBhH,KAAKyF,OAAS0B,EAAanH,KAAKyF,OAAQjC,EAAOwD,EAAa,M,uCAI7CM,GACftH,KAAKwF,UAAUhC,MAAQ8D,EACvBtH,KAAKwF,UAAU/B,IAAM6D,I,wCAELA,GAChBtH,KAAKwF,UAAUhC,MAAQ8D,I,sCAETA,GACdtH,KAAKwF,UAAU/B,IAAM6D,I,oCAIrB,OAAOtH,KAAKyF,OAAOpC,OAASrD,KAAKyF,OAAOpC,OAAS,EAAI,I,kCAG3CsB,GACV,IAAM+B,EAAY9B,EAAa5E,KAAK0F,MAAOf,EAAO3E,KAAKuF,QAAQ1C,QAC/D7C,KAAKuH,iBAAiBb,EAAY1G,KAAK0F,MAAMf,GAAOtB,U,8BAGpDrD,KAAKuF,QAAQ3C,aAAaW,Y,KAQjBiE,EAAb,WAIE,WAAYxB,GAAmB,yBADdA,UACa,EAC5BhG,KAAKgG,KAAOA,EALhB,qDAOWyB,EAAoBpD,GAA0C,IAAD,OACpE,IAAKoD,EAAWpE,OACd,MAAO,GAGT,IAAMqE,EAAqBrD,EAAS6B,QAAO,SAACpB,GAAD,MAAkB,QAAXA,EAAE6C,QAAgB9C,KAAI,SAACC,GAAD,OAAOA,EAAEC,QAM3E6C,EAAW,SAACpE,EAAgBqE,GAChC,IAAMC,EAAQ,EAAK9B,KAChBE,QAAO,SAACrG,GAAD,OAAU2D,EAAQ3D,EAAIkI,IAAIC,WAAWP,GAAc5H,EAAIkI,IAAIzE,UAAU,GAAG2E,SAASR,MACxFvB,QAAO,SAACpB,GAAD,OAAQ4C,EAASO,SAASnD,EAAEiD,QAGtC,OADAD,EAAMI,MAAK,SAACpD,EAAGqD,GAAJ,OAAWrD,EAAEsD,QAAUD,EAAEC,MAAQtD,EAAEiD,IAAIM,cAAcF,EAAEJ,KAAOI,EAAEC,MAAQtD,EAAEsD,SAC9EN,EAAMQ,MAAM,EAAGT,IAElBC,EAAQF,GAAS,EA7BV,GA8Bb,OA9Ba,IA8BNE,EAAMzE,OAAsByE,EAAQA,EAAMS,OAAOX,GAAS,EA9BpD,EA8BsEE,EAAMzE,WA3B7F,6BA6BSoE,GACL,OAAOzH,KAAKgG,KAAKwC,MAAK,SAAC3I,GAAD,OAASA,EAAIkI,MAAQN,OA9B/C,+BAkCI,MAAM,GAAN,OAAUzH,KAAKgG,KAAK3C,OAApB,iBAlCJ,KAoGO,SAASoF,EAAQzE,EAAsB0E,GAC5CjG,EAAI,UAAWiG,GACf,IAAM9F,EAAe8F,EAAOnD,QAAQ3C,aAIpC,SAAS+F,IAEP,OADA5C,EAAiB,kBAAmB/B,GAC7B,IAAIqB,EAAarB,EAAO0E,EAAOnD,SAGxC,SAASqD,IACP,OAAO,IAAI7E,EAAWC,EAAOpB,EAAc8F,EAAOnD,QAAQ1C,QAG5D,GAnBF,SAAkB6F,GAChB,MAAuB,WAAhBA,EAAOf,KAkBVkB,CAASH,GAEX,OADmCC,IACfG,WAGtB,GAvCF,SAAuBJ,GACrB,MAAuB,gBAAhBA,EAAOf,KAsCVoB,CAAcL,GAAS,CAEzB9F,EAAaW,QACb,IAAM4B,EAA6BwD,IAEnC,OADAxD,EAAaoC,iBAAiBpC,EAAa4B,eACpC5B,EAAa2D,WAGtB,GA5CF,SAAsBJ,GACpB,MAAuB,eAAhBA,EAAOf,KA2CVqB,CAAaN,GAAS,CAExB9F,EAAaW,QACb,IAAM4B,EAA6BwD,IAGnC,OAFAxD,EAAaQ,eAAe+C,EAAOnE,WAAYmE,EAAOO,MACtD9D,EAAaoC,iBAAiBpC,EAAa4B,eACpC5B,EAAa2D,WAGtB,GAlDF,SAAqBJ,GACnB,MAAuB,cAAhBA,EAAOf,KAiDVuB,CAAYR,GAAS,CACvB,IAAMvD,EAA6BwD,IAEnC,OADAxD,EAAaQ,eAAe+C,EAAO/D,MAAO,IACnCQ,EAAa2D,WAGtB,GArDF,SAAoBJ,GAClB,MAAuB,aAAhBA,EAAOf,KAoDVwB,CAAWT,GAAS,CACtB,IAAMvD,EAA6BwD,IAKnC,OAHAxD,EAAaiE,YAAYV,EAAO/D,OAEhCQ,EAAa5B,QACN4B,EAAa2D,WAGtB,GA3DF,SAAmBJ,GACjB,MAAuB,YAAhBA,EAAOf,KA0DV0B,CAAUX,GAAS,CAAC,IACdX,EAAkBW,EAAlBX,IAAKuB,EAAaZ,EAAbY,SACb,OAAQvB,GACN,IAAK,OACL,IAAK,UAEH,IAAM5C,EAA6BwD,IAEnC,OADAxD,EAAaoC,iBAAiB,GACvBpC,EAAa2D,WAGtB,IAAK,MACL,IAAK,YAEH,IAAM3D,EAA6BwD,IAEnC,OADAxD,EAAaoC,iBAAiBpC,EAAa4B,eACpC5B,EAAa2D,WAGtB,IAAK,YACH,IAAMS,EAAyBX,IAEzBzD,EAA6BwD,IAC7Ba,EAASD,EAAWE,SAM1B,OALIH,EACFnE,EAAauE,kBAAkBF,GAE/BrE,EAAaoC,iBAAiBiC,GAEzBrE,EAAa2D,WAEtB,IAAK,aACH,IAAMS,EAAyBX,IAEzBzD,EAA6BwD,IAC7Ba,EAASD,EAAWI,UAM1B,OALIL,EACFnE,EAAayE,gBAAgBJ,GAE7BrE,EAAaoC,iBAAiBiC,GAEzBrE,EAAa2D,WAEtB,IAAK,YAEH,IAAMS,EAAyBX,IACzBzD,EAA6BwD,IAC/BW,GAEFC,EAAWM,eAAe1E,GAE5B,IAAMqE,EAASD,EAAWE,SAG1B,OAFAtE,EAAaC,OAAOoE,EAAQ,GAC5BrE,EAAaoC,iBAAiBiC,GACvBrE,EAAa2D,WAEtB,IAAK,SAEH,IAAMS,EAAyBX,IACzBzD,EAA6BwD,IAC/BW,GAEFC,EAAWM,eAAe1E,GAE5B,IAAMqE,EAASD,EAAWpF,aAG1B,OAFAgB,EAAaC,OAAOoE,EAAQ,GAC5BrE,EAAaoC,iBAAiBiC,GACvBrE,EAAa2D,YAQ1B,OADA/C,EAAiB,8BAA+B/B,GACzCA,EAST,SAASmD,EAAa2C,EAActG,EAAewD,EAAqB+C,GAEtE,IAEMC,EAFYF,EAAKxG,UAAU,EAAGE,GAEVuG,EADVD,EAAKxG,UAAUE,EAAQwD,GAGvC,OADAvE,EAAI,eAAgB,CAAEqH,OAAMtG,QAAOwD,cAAa+C,SAAQC,UACjDA,EAGF,SAASvH,EAAIwH,EAAezK,EAAW0K,GAC5C,GAAmBA,EAAnB,CAGA,IAAMC,EAAOC,KAAKC,UAAU7K,EAAG,KAAM,GACrCgD,QAAQC,IAAR,UAAewH,EAAf,eAA2BE,KAG7B,SAASpE,EAAiBkE,EAAe3E,GACvC7C,EAAIwH,EAAO3E,GAIb,SAAShB,EACPD,EACAxB,GAIA,IAFA,IAAI0B,EAAqB,EACrB+F,EAAU,EACLC,EAAI,EAAGA,EAAIlG,EAAShB,SAAUkH,EACZ,UAArBlG,EAASkG,GAAG5C,SACZ2C,EACF/F,EAAagG,GAIjB,OADA1H,EAAmB,IAAZyH,EAAe,sCACf,CACL/F,aACAC,QAAwB,IAAfD,EACTE,OAAQF,IAAeF,EAAShB,OAAS,GAiB7C,SAASuB,EAAac,EAA8Bf,EAAe9B,GAEjE,IADA,IAAI6D,EAAY,EACP6D,EAAI,EAAGA,EAAI5F,IAAS4F,EAAG,CAC9B,IAAMxF,EAAOW,EAAM6E,GAEnB7D,GAAa3B,EAAK1B,OAAS,EAI3BR,IAASkC,EAAK1B,OAAQ,4CAExB,OAAOqD,EAkBT,SAASW,EAAY3B,EAA8BD,EAAgB5C,GACjE,IADwF,IAAD,WAC9E0H,GACP,IAAMxF,EAAOW,EAAM6E,GACb7D,EAAY9B,EAAac,EAAO6E,EAAG1H,GACnC2H,EAAW/E,EAAOnC,UAAUoD,EAAWA,EAAY3B,EAAK1B,QAC9DR,EACEkC,IAASyF,EACT,kBAEA,WACE,MAAO,CACLzF,OACAyF,WACA9D,YACArD,OAAQ0B,EAAK1B,OACboC,SACAC,aAfC6E,EAAI,EAAGA,EAAI7E,EAAMrC,SAAUkH,EAAI,EAA/BA,GAsBX,SAAS3G,EAAakG,GAEpB,IAcMvE,EAda,WACjB,IAAM3B,EAAqB6G,OAAQ,CACjC,IAAMA,EAASC,SAASC,cAAc,UAChCpF,EAAUkF,EAAOG,WAAW,MAClC,IAAKrF,EACH,OAGFA,EAAQsF,KAAO,sDACdjH,EAAqB6G,OAASA,EAC9B7G,EAAqB2B,QAAUA,EAElC,OAAQ3B,EAAqB2B,QAEfqF,GAChB,OAAKrF,EAGEA,EAAQuF,YAAYhB,GAAMnG,MAFxB,GAWX,SAASkC,EACP7B,EACAnB,EACAiD,EACAlD,EACAgD,GAEA,IAAMvB,EAA8B,GAChC0G,OAA8BpK,EAC9B8G,EAAqB,GAEzB,SAASuD,EAASlB,EAActG,EAAeC,EAAab,GAC1DH,EAAI,WAAY,CAAEqH,OAAMtG,QAAOC,QAC/Bb,EAAaqI,WAAWnB,EAAMtG,EAAOC,GACrCgE,EAAaqC,EACbjH,EAAOW,GAAS,GAAKC,GAAOqG,EAAKzG,OAA3B,kCAA8DyG,EAA9D,YAAsEtG,EAAtE,YAA+EC,IAGvF,SAASyH,EAAWvD,EAAuB5C,GACzC,IAAMoB,GAAoBpB,EAAK1B,QAAUyC,EAAWqF,aAAgBvF,GAAiBA,EAAcwF,OAAOrG,GAC1GV,EAASgH,KAAK,CAAE1D,OAAM5C,OAAMoB,YAY9B,IARA,IAAMT,EAAkB1B,EAAMyB,OAAO6F,MAAM,KAAKpF,QAAO,SAACnB,GAAD,OAAUA,EAAK1B,UAChEmC,EAAYxB,EAAMwB,UAGpBkB,EAAY,EAEZ6E,OAA8E5K,EAEzE6K,EAAY,EAAGA,EAAY9F,EAAMrC,SAAUmI,EAAW,CAC7D,IAAMzG,EAAOW,EAAM8F,GAEbC,EAAU/E,EAAY3B,EAAK1B,OACjC,GAAImC,EAAUhC,MAAQiI,GAAWjG,EAAU/B,IAAMiD,EAI/CwE,EAAW,MAAOnG,OACb,CACL,IAAKnC,EAAc,CAMjBC,GAAO,EAAO,yBACd,SAKF,GAAI2C,EAAUhC,OAASkD,EAEjBlB,EAAU/B,KAAOgI,GAEnBT,EAASjG,EAAMS,EAAUhC,MAAQkD,EAAWlB,EAAU/B,IAAMiD,EAAW9D,GACvEmI,EAAU1G,EAAShB,OACnB6H,EAAW,QAASnG,KAGpBlC,GAAQ0I,EAAa,4CACrBA,EAAc,CACZ7E,YACAlD,MAAOgC,EAAUhC,MAAQkD,EACzBoD,KAAM/E,QAGL,CAEL,IAAKwG,EAAa,CAChB1I,GAAO,EAAO,gDACd,SAGF0I,EAAYzB,MAAQ,IAAM/E,EACtBS,EAAU/B,KAAOgI,IAEnBT,EAASO,EAAYzB,KAAMyB,EAAY/H,MAAOgC,EAAU/B,IAAM8H,EAAY7E,UAAW9D,GACrFmI,EAAU1G,EAAShB,OACnB6H,EAAW,QAASK,EAAYzB,MAChCyB,OAAc5K,IAMpB+F,GAAa3B,EAAK1B,OAAS,EAGN,qBAAZ0H,IAETA,EAAU1G,EAAShB,OAGfT,GAEFoI,EAAS,GAAI,EAAG,EAAGpI,GAErBsI,EAAW,QAAS,KAvKxB,SAAwB7G,EAA0CoB,EAAgB5C,GAChFwE,EACEhD,EAASQ,KAAI,SAACC,GAAD,OAAOA,EAAEC,QACtBU,EACA5C,GAEFyB,EAAcD,EAAUxB,GACxBwB,EAASqH,SAAQ,SAACzF,EAAStB,GAAV,OACf9B,IACIoD,EAAQlB,KAAK1B,QAA4B,UAAjB4C,EAAQ0B,MAAoBhD,IAAUN,EAAShB,OAAS,EAClF,kCAgKJsI,CAAetH,EAAUL,EAAMyB,OAAQ5C,GAEvC,IAAM+I,EAAqBhG,EAAqBA,EAAciG,SAASpE,EAAYpD,GAAxC,GAE1CuH,EAAcE,OAAS,iBAAM,IAAMF,EAAM/G,KAAI,SAACoE,GAAD,OAAUA,EAAKlB,OAAKjE,KAAK,KAAO,KAkB9E,IAAMsC,EAhBN,WACE,IAAMK,EAAiBpC,EAAS6B,QAAO,SAACD,GAAD,QAAeA,EAAQlB,KAAK1B,UAAQA,OACrE0I,EAAoB1H,EAAS6B,QAAO,SAACD,GAAD,OAAcA,EAAQE,WAAStB,KAAI,SAACoB,GAAD,OAAaA,EAAQlB,QAClG,OAAI0B,EAAS,GAAKX,EAAWkG,QACpB,iCAELvF,EAAS,GAAKX,EAAWmG,QACpB,uCAEHF,EAAQ1I,OACc,IAAnB0I,EAAQ1I,OAAR,eACK0I,EAAQ,GADb,sDAEKA,EAAQlH,KAAI,SAACE,GAAD,MAAU,IAAMA,EAAO,OAAKjB,KAAK,SAFlD,kCAIF,GAEeoI,GASxB,MAPqC,CACnClI,QACAK,WACAoD,aACAmE,QACAxF,mBCx0BG,SAAS+F,EACdC,EACAC,EACAvG,GAOA,MAEwCtF,IAAMW,cAA6BR,GAF3E,mBAEO2L,EAFP,KAEqBC,EAFrB,KAIA,SAAS1J,EAAO2J,EAAoB1M,EAAiB2M,GACnD,IAAKD,EAAW,CACd,GAAIC,EAAO,CACT,IAAMjN,EAAYiN,IACZtC,EAAOC,KAAKC,UAAU7K,EAAG,KAAM,GACrCM,EAAO,UAAMA,EAAN,eAAoBqK,GAG7BuC,YAAW,WAGTH,EAAgBzM,KACf,GACH0C,QAAQhB,MAAM1B,IAjBlB,MAuB0BU,IAAMmM,WAAWlE,EAAS2D,GAAW,SAACA,GAAD,OD6yB1D,SAAsBvJ,EAAgBuJ,EAAqBtG,GAChEjD,GAAQuJ,EAAU5D,MAAK,SAACV,GAAD,OAAWA,IAAUA,EAAM8E,UAAS,0BAA0B,WACnF,MAAO,CAAER,gBAEX,IAAM3G,EAAS2G,EAAUtI,KAAK,KACxBN,EAAQiC,EAAOpC,OAAS,EACxBW,EAAe,CAAEyB,SAAQD,UAAW,CAAEhC,QAAOC,IAAKD,IAExDf,EAAI,wBAAyB,CAAE2J,cAC/B,IAAM9G,EAA+BO,EAAY7B,EAAOnB,EAAQiD,GAEhE,OADAC,EAAiB,yBAA0BT,GACpCA,ECvzBLuH,CAAahK,EAAQuJ,EAAWtG,MAxBlC,mBAuBO9B,EAvBP,KAuBc8I,EAvBd,OA4B0CtM,IAAMW,cAAoCR,GA5BpF,mBA4BOiF,EA5BP,KA4BsBmH,EA5BtB,KAoDA,OAnBAvM,IAAM8B,WAAU,WAEd+J,IACGlK,MAAK,SAAC6D,GAEL,IAAMJ,EAA+B,IAAI4B,EAAcxB,GAEvD+G,EAAiBnH,MAElBvD,OAAM,SAACE,GAENgK,EAAgB,0BAAD,OAA2BhK,SAE7C,CAAC8J,IAMG,CAAErI,QAAO8I,WAAUlH,gBAAe/C,SAAQyJ,gB,YChEtCU,G,MAA2D,SAACC,GACvE,IAAMC,GAAqBD,EAAMX,aAAe,QAAU,WAAaW,EAAME,KAAO,QAAU,IAC9F,OAAO,uBAAGD,UAAWA,GAAYD,EAAMX,gBCQlC,SAASc,EACdC,EACAR,EACAS,GAQA,MAG0B9M,IAAMmM,WAC9BlE,EAoCJ,SAA8C4E,EAA6BrJ,GACzE,IAAMuJ,EAAgB,IAAIC,IAa1B,OAXAH,EAAO3B,SAAQ,SAAC+B,EAAO1F,GACrB,IAAM7E,EAAQc,EAAM+D,GACpB,GAAqB,kBAAV7E,EAMT,MAAM,IAAIwK,MAAM,2EALhB,IAAMpB,EAAeqB,EAASzK,EAAOuK,EAAMtN,QAASsN,EAAMG,OACtDtB,GACFiB,EAAcM,IAAI9F,EAAKuE,MAMtB,CACLwB,OAAQ9J,EACR+J,cAAe/J,EACfuJ,gBACAF,SACAW,eAAe,EACfC,mBAAetN,GAvDfuN,CAAmBb,EAAQR,IAL7B,mBAGO7I,EAHP,KAGc8I,EAHd,OAmHF,SACE9I,EACA8I,EACAQ,GAMA,IAAMa,EAA8C,IAAIX,IACxDxJ,EAAMqJ,OAAO3B,SAAQ,SAAC+B,EAAO1F,GAE3B,IAEM6F,EC3JH,SAAqBA,EAAeQ,GACzC,GAAIA,EACF,MAAO,CAAEC,UAAM1N,EAAWsF,aAAStF,GAErC,IAAM0N,EAAOT,EACVU,QAAQ,gBAAiB,IACzBA,QAAQ,KAAM,KACdC,oBAEH,MAAO,CAAEF,OAAMpI,QADC,2BAAOuI,QAASH,GAAOT,IDmJvBa,CAAYhB,EAAMG,MAAOH,EAAMW,WAEvC9B,EAAoCtI,EAAMgK,cAA4BhK,EAAMuJ,cAAcmB,IAAI3G,QAApCpH,EAI1DgO,EEpJH,SACLC,EACAC,EACAC,EACAlB,EACAtB,GAEA,GAAoB,WAAhBsC,EAAOjH,KACT,OCRkB,SAACsF,GAAiC,IAC9CW,EAAoDX,EAApDW,MAAOkB,EAA6C7B,EAA7C6B,aAAcD,EAA+B5B,EAA/B4B,aAAcvC,EAAiBW,EAAjBX,cCnBtC,WAA8B,IAAD,EACV9L,IAAMW,UAAkB,GADd,mBAC3B4N,EAD2B,KACrBC,EADqB,KASlCxO,IAAM8B,WAAU,WAETyM,IACFE,OAAeC,oBAAoBC,MACpCH,GAAQ,MAET,CAACD,IDYJK,GAEA,IAAMT,EACJ,kBAAC,IAAMU,SAAP,KACE,kBAAC,GAAD,CAAW/C,aAAcA,GACvB,8BAEEgD,SAAU,SAACC,GAAD,OAAOT,EAAaS,EAAEC,OAAOtM,QACvCuM,GAAG,YACHvC,UAAU,YACVmB,KAAMT,EAAMS,KACZqB,YAAY,qBACZb,aAAcA,MAOtB,OACE,kBAAC,IAAMQ,SAAP,KACGzB,EAAM3H,QACP,yBAAKiH,UAAU,aACb,yBAAKA,UAAU,aACb,6BACE,yBAAKuC,GAAG,cAAcvC,UAAU,iBAElC,6BACE,yBAAKuC,GAAG,oBAETd,KD/BAgB,CAAO,CACZ/B,QACAkB,eACAD,eACAvC,iBAmCJ,IAAMsD,EAhCN,WACE,OAAQhB,EAAOjH,MACb,IAAK,QACH,IAAMkI,EAAajB,EAAOiB,WACpBlI,EAAOkI,EAAWlI,KAAOkI,EAAWlI,KAAO,OACjD,OACE,yCACEA,KAAMA,GACFkI,EAFN,CAGExB,KAAMT,EAAMS,KACZqB,YAAad,EAAOc,YACpBb,aAAcA,EACdS,SAAU,SAACC,GAAD,OAAOT,EAAaS,EAAEC,OAAOtM,WAI7C,IAAK,WACH,IAAM2M,EAAajB,EAAOiB,WAC1B,OACE,8CACMA,EADN,CAEExB,KAAMT,EAAMS,KACZqB,YAAad,EAAOc,YACpBb,aAAcA,EACdS,SAAU,SAACC,GAAD,OAAOT,EAAaS,EAAEC,OAAOtM,WAI7C,QACE,MAAM,IAAIwK,MAAM,oBAGRoC,GACd,OACE,kBAAC,IAAMT,SAAP,KACGzB,EAAM3H,QACP,kBAAC,GAAD,CAAWqG,aAAcA,GAAesD,IFiGxBG,CAHCtC,EAAXmB,OACa,GAAK5K,EAAM+J,cAAchG,IANG,SAACzB,GAAD,OAAsBwG,EAAS,CAAE/E,MAAKzB,eAQrBsH,EAAOtB,GACzE6B,EAAUN,IAAI9F,EAAK4G,MAarB,IAAMqB,GKnLwBpC,ELoL5BN,EAAWM,MKpLgCqC,ELqL3C,kBAAMnD,EAAS,CAAE/E,IAAK,WAAYzB,SAAU,MKrLoBgG,ELyKlE,SAAwBtI,GACtB,IAAMkM,EAAclM,EAAMuJ,cAAc4C,KAClC3O,EAAwB,IAAhB0O,EAAoB,QAAU,SAM5C,OAL+BlM,EAAMiK,cACjCjK,EAAMiK,cACLjK,EAAMgK,eAAkBkC,EAAzB,eAEQ5C,EAAW8C,KAFnB,kDAEiE5O,EAFjE,gBACAb,EAOJ0P,CAAerM,GKjLf,6BACE,2BAAO2D,KAAK,SAASzE,MAAO0K,EAAOqC,QALvC,SAAqBV,GACnBU,OAKE,kBAAC,EAAD,CAAc3D,aAAcA,EAAca,MAAM,MAP/C,IAAyBS,EAAeqC,EAAqB3D,ELwLlE,MAAO,CAAE6B,YAAW6B,UAnJUM,CAAmBtM,EAAO8I,EAAUQ,GAA1Da,EAPR,EAOQA,UAAW6B,EAPnB,EAOmBA,OAEnB,MAAO,CACLO,aAAcvM,EAAM8J,OACpB0C,QAAsC,IAA7BxM,EAAMuJ,cAAc4C,KAC7BnC,cAAehK,EAAMgK,cACrBgC,SACA7B,YACAF,cAPoB,SAACzM,GAAD,OAAkBsL,EAAS,CAAE/E,IAAK,gBAAiBzB,SAAU9E,EAAM1B,YAiE3F,SAAS2I,EAA0BgI,EAAwB/H,GAAuC,IACxFX,EAAkBW,EAAlBX,IAAKzB,EAAaoC,EAAbpC,SACPwH,EAAiF2C,EAAjF3C,OAAQP,EAAyEkD,EAAzElD,cAA8BmD,EAA2CD,EAA1DzC,cAAyBC,EAAiCwC,EAAjCxC,cAAeF,EAAkB0C,EAAlB1C,cACrE,GAAY,aAARhG,EACF2I,GAAW,OACN,GAAY,kBAAR3I,EACTkG,EAAgB3H,MACX,CACL2H,OAAgBtN,GAEhBmN,EAAM,eAAQA,IAGE/F,GAAOzB,EAEvB,IAAMmH,EAAQgD,EAAIpD,OAAOqB,IAAI3G,GAEvBuE,EAAeqB,EAASrH,EAAUmH,EAAMtN,QAASsN,EAAMG,OAE7DL,EAAgB,IAAIC,IAAqBD,GAEpCjB,EAGHiB,EAAcM,IAAI9F,EAAKuE,GAFvBiB,EAAcoD,OAAO5I,GAMzB,MAAO,CACL+F,SACAP,gBACAF,OAAQoD,EAAIpD,OACZW,cAAe0C,EACfzC,gBACAF,iBAsDJ,SAASJ,EAASzK,EAAe/C,EAA4ByN,GAE3D,MADqBzN,EAAQyQ,YACR1N,GAAmB,KAAVA,GAC5B,MAAM,GAAN,OAAU0K,EAAV,gBAEF,IAAMvK,EAAUH,EAAYA,EAAMG,OAAV,EACxB,OAAIlD,EAAQ0Q,WAAaxN,EAASlD,EAAQ0Q,UACjC1Q,EAAQ0Q,WAAa,GAArB,UACAjD,EADA,6BAC0BzN,EAAQ0Q,UADlC,0BAEAjD,EAFA,6BAE0BzN,EAAQ0Q,UAFlC,oCAEuExN,EAFvE,UADT,EMxMF,SAASyN,IAA2Q,OAA9PA,EAAWC,OAAOC,QAAU,SAAUxB,GAAU,IAAK,IAAIjF,EAAI,EAAGA,EAAI0G,UAAU5N,OAAQkH,IAAK,CAAE,IAAI2G,EAASD,UAAU1G,GAAI,IAAK,IAAIxC,KAAOmJ,EAAcH,OAAOrR,UAAUyR,eAAeC,KAAKF,EAAQnJ,KAAQyH,EAAOzH,GAAOmJ,EAAOnJ,IAAY,OAAOyH,IAA2B6B,MAAMrR,KAAMiR,WAEhT,SAASK,EAAyBJ,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAAkEnJ,EAAKwC,EAAnEiF,EAEzF,SAAuC0B,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAA2DnJ,EAAKwC,EAA5DiF,EAAS,GAAQgC,EAAaT,OAAOU,KAAKP,GAAqB,IAAK3G,EAAI,EAAGA,EAAIiH,EAAWnO,OAAQkH,IAAOxC,EAAMyJ,EAAWjH,GAAQgH,EAASG,QAAQ3J,IAAQ,IAAayH,EAAOzH,GAAOmJ,EAAOnJ,IAAQ,OAAOyH,EAFxMmC,CAA8BT,EAAQK,GAAuB,GAAIR,OAAOa,sBAAuB,CAAE,IAAIC,EAAmBd,OAAOa,sBAAsBV,GAAS,IAAK3G,EAAI,EAAGA,EAAIsH,EAAiBxO,OAAQkH,IAAOxC,EAAM8J,EAAiBtH,GAAQgH,EAASG,QAAQ3J,IAAQ,GAAkBgJ,OAAOrR,UAAUoS,qBAAqBV,KAAKF,EAAQnJ,KAAgByH,EAAOzH,GAAOmJ,EAAOnJ,IAAU,OAAOyH,EAMne,IAAIuC,EAAqB,IAAMpH,cAAc,OAAQ,CACnDqH,KAAM,OACNC,EAAG,oBAGDC,EAAqB,IAAMvH,cAAc,OAAQ,CACnDsH,EAAG,wHAGD,EAAsB,SAA6BE,GACrD,IAAIC,EAASD,EAAKC,OACdnI,EAAQkI,EAAKlI,MACbgD,EAAQqE,EAAyBa,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMxH,cAAc,MAAOmG,EAAS,CACtDnN,MAAO,GACP0O,OAAQ,GACRC,QAAS,YACTC,IAAKH,GACJnF,GAAQhD,EAAqB,IAAMU,cAAc,QAAS,KAAMV,GAAS,KAAM8H,EAAOG,IAGvFM,EAAa,IAAMC,YAAW,SAAUxF,EAAOsF,GACjD,OAAoB,IAAM5H,cAAc,EAAqBmG,EAAS,CACpEsB,OAAQG,GACPtF,OAEU,ICnCf,SAAS,IAA2Q,OAA9P,EAAW8D,OAAOC,QAAU,SAAUxB,GAAU,IAAK,IAAIjF,EAAI,EAAGA,EAAI0G,UAAU5N,OAAQkH,IAAK,CAAE,IAAI2G,EAASD,UAAU1G,GAAI,IAAK,IAAIxC,KAAOmJ,EAAcH,OAAOrR,UAAUyR,eAAeC,KAAKF,EAAQnJ,KAAQyH,EAAOzH,GAAOmJ,EAAOnJ,IAAY,OAAOyH,IAA2B6B,MAAMrR,KAAMiR,WAEhT,SAAS,EAAyBC,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAAkEnJ,EAAKwC,EAAnEiF,EAEzF,SAAuC0B,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAA2DnJ,EAAKwC,EAA5DiF,EAAS,GAAQgC,EAAaT,OAAOU,KAAKP,GAAqB,IAAK3G,EAAI,EAAGA,EAAIiH,EAAWnO,OAAQkH,IAAOxC,EAAMyJ,EAAWjH,GAAQgH,EAASG,QAAQ3J,IAAQ,IAAayH,EAAOzH,GAAOmJ,EAAOnJ,IAAQ,OAAOyH,EAFxM,CAA8B0B,EAAQK,GAAuB,GAAIR,OAAOa,sBAAuB,CAAE,IAAIC,EAAmBd,OAAOa,sBAAsBV,GAAS,IAAK3G,EAAI,EAAGA,EAAIsH,EAAiBxO,OAAQkH,IAAOxC,EAAM8J,EAAiBtH,GAAQgH,EAASG,QAAQ3J,IAAQ,GAAkBgJ,OAAOrR,UAAUoS,qBAAqBV,KAAKF,EAAQnJ,KAAgByH,EAAOzH,GAAOmJ,EAAOnJ,IAAU,OAAOyH,EAMne,IAAI,EAAqB,IAAM7E,cAAc,OAAQ,CACnDqH,KAAM,OACNC,EAAG,oBAGD,EAAqB,IAAMtH,cAAc,OAAQ,CACnDsH,EAAG,iJAGD,EAAqB,SAA4BE,GACnD,IAAIC,EAASD,EAAKC,OACdnI,EAAQkI,EAAKlI,MACbgD,EAAQ,EAAyBkF,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMxH,cAAc,MAAO,EAAS,CACtDhH,MAAO,GACP0O,OAAQ,GACRC,QAAS,YACTC,IAAKH,GACJnF,GAAQhD,EAAqB,IAAMU,cAAc,QAAS,KAAMV,GAAS,KAAM,EAAO,IAGvF,EAAa,IAAMwI,YAAW,SAAUxF,EAAOsF,GACjD,OAAoB,IAAM5H,cAAc,EAAoB,EAAS,CACnEyH,OAAQG,GACPtF,OAEU,ICnCf,SAAS,IAA2Q,OAA9P,EAAW8D,OAAOC,QAAU,SAAUxB,GAAU,IAAK,IAAIjF,EAAI,EAAGA,EAAI0G,UAAU5N,OAAQkH,IAAK,CAAE,IAAI2G,EAASD,UAAU1G,GAAI,IAAK,IAAIxC,KAAOmJ,EAAcH,OAAOrR,UAAUyR,eAAeC,KAAKF,EAAQnJ,KAAQyH,EAAOzH,GAAOmJ,EAAOnJ,IAAY,OAAOyH,IAA2B6B,MAAMrR,KAAMiR,WAEhT,SAAS,EAAyBC,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAAkEnJ,EAAKwC,EAAnEiF,EAEzF,SAAuC0B,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAA2DnJ,EAAKwC,EAA5DiF,EAAS,GAAQgC,EAAaT,OAAOU,KAAKP,GAAqB,IAAK3G,EAAI,EAAGA,EAAIiH,EAAWnO,OAAQkH,IAAOxC,EAAMyJ,EAAWjH,GAAQgH,EAASG,QAAQ3J,IAAQ,IAAayH,EAAOzH,GAAOmJ,EAAOnJ,IAAQ,OAAOyH,EAFxM,CAA8B0B,EAAQK,GAAuB,GAAIR,OAAOa,sBAAuB,CAAE,IAAIC,EAAmBd,OAAOa,sBAAsBV,GAAS,IAAK3G,EAAI,EAAGA,EAAIsH,EAAiBxO,OAAQkH,IAAOxC,EAAM8J,EAAiBtH,GAAQgH,EAASG,QAAQ3J,IAAQ,GAAkBgJ,OAAOrR,UAAUoS,qBAAqBV,KAAKF,EAAQnJ,KAAgByH,EAAOzH,GAAOmJ,EAAOnJ,IAAU,OAAOyH,EAMne,IAAI,EAAqB,IAAM7E,cAAc,OAAQ,CACnDqH,KAAM,OACNC,EAAG,oBAGD,EAAqB,IAAMtH,cAAc,OAAQ,CACnDsH,EAAG,+OAGD,EAAuB,SAA8BE,GACvD,IAAIC,EAASD,EAAKC,OACdnI,EAAQkI,EAAKlI,MACbgD,EAAQ,EAAyBkF,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMxH,cAAc,MAAO,EAAS,CACtDhH,MAAO,GACP0O,OAAQ,GACRC,QAAS,YACTC,IAAKH,GACJnF,GAAQhD,EAAqB,IAAMU,cAAc,QAAS,KAAMV,GAAS,KAAM,EAAO,IAGvF,EAAa,IAAMwI,YAAW,SAAUxF,EAAOsF,GACjD,OAAoB,IAAM5H,cAAc,EAAsB,EAAS,CACrEyH,OAAQG,GACPtF,OAEU,ICnCf,SAAS,KAA2Q,OAA9P,GAAW8D,OAAOC,QAAU,SAAUxB,GAAU,IAAK,IAAIjF,EAAI,EAAGA,EAAI0G,UAAU5N,OAAQkH,IAAK,CAAE,IAAI2G,EAASD,UAAU1G,GAAI,IAAK,IAAIxC,KAAOmJ,EAAcH,OAAOrR,UAAUyR,eAAeC,KAAKF,EAAQnJ,KAAQyH,EAAOzH,GAAOmJ,EAAOnJ,IAAY,OAAOyH,IAA2B6B,MAAMrR,KAAMiR,WAEhT,SAAS,GAAyBC,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAAkEnJ,EAAKwC,EAAnEiF,EAEzF,SAAuC0B,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAA2DnJ,EAAKwC,EAA5DiF,EAAS,GAAQgC,EAAaT,OAAOU,KAAKP,GAAqB,IAAK3G,EAAI,EAAGA,EAAIiH,EAAWnO,OAAQkH,IAAOxC,EAAMyJ,EAAWjH,GAAQgH,EAASG,QAAQ3J,IAAQ,IAAayH,EAAOzH,GAAOmJ,EAAOnJ,IAAQ,OAAOyH,EAFxM,CAA8B0B,EAAQK,GAAuB,GAAIR,OAAOa,sBAAuB,CAAE,IAAIC,EAAmBd,OAAOa,sBAAsBV,GAAS,IAAK3G,EAAI,EAAGA,EAAIsH,EAAiBxO,OAAQkH,IAAOxC,EAAM8J,EAAiBtH,GAAQgH,EAASG,QAAQ3J,IAAQ,GAAkBgJ,OAAOrR,UAAUoS,qBAAqBV,KAAKF,EAAQnJ,KAAgByH,EAAOzH,GAAOmJ,EAAOnJ,IAAU,OAAOyH,EAMne,IAAI,GAAqB,IAAM7E,cAAc,OAAQ,CACnDqH,KAAM,OACNC,EAAG,oBAGD,GAAqB,IAAMtH,cAAc,OAAQ,CACnDsH,EAAG,mUAGD,GAA2B,SAAkCE,GAC/D,IAAIC,EAASD,EAAKC,OACdnI,EAAQkI,EAAKlI,MACbgD,EAAQ,GAAyBkF,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMxH,cAAc,MAAO,GAAS,CACtDhH,MAAO,GACP0O,OAAQ,GACRC,QAAS,YACTC,IAAKH,GACJnF,GAAQhD,EAAqB,IAAMU,cAAc,QAAS,KAAMV,GAAS,KAAM,GAAO,KAGvF,GAAa,IAAMwI,YAAW,SAAUxF,EAAOsF,GACjD,OAAoB,IAAM5H,cAAc,GAA0B,GAAS,CACzEyH,OAAQG,GACPtF,OAEU,ICnCf,SAAS,KAA2Q,OAA9P,GAAW8D,OAAOC,QAAU,SAAUxB,GAAU,IAAK,IAAIjF,EAAI,EAAGA,EAAI0G,UAAU5N,OAAQkH,IAAK,CAAE,IAAI2G,EAASD,UAAU1G,GAAI,IAAK,IAAIxC,KAAOmJ,EAAcH,OAAOrR,UAAUyR,eAAeC,KAAKF,EAAQnJ,KAAQyH,EAAOzH,GAAOmJ,EAAOnJ,IAAY,OAAOyH,IAA2B6B,MAAMrR,KAAMiR,WAEhT,SAAS,GAAyBC,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAAkEnJ,EAAKwC,EAAnEiF,EAEzF,SAAuC0B,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAA2DnJ,EAAKwC,EAA5DiF,EAAS,GAAQgC,EAAaT,OAAOU,KAAKP,GAAqB,IAAK3G,EAAI,EAAGA,EAAIiH,EAAWnO,OAAQkH,IAAOxC,EAAMyJ,EAAWjH,GAAQgH,EAASG,QAAQ3J,IAAQ,IAAayH,EAAOzH,GAAOmJ,EAAOnJ,IAAQ,OAAOyH,EAFxM,CAA8B0B,EAAQK,GAAuB,GAAIR,OAAOa,sBAAuB,CAAE,IAAIC,EAAmBd,OAAOa,sBAAsBV,GAAS,IAAK3G,EAAI,EAAGA,EAAIsH,EAAiBxO,OAAQkH,IAAOxC,EAAM8J,EAAiBtH,GAAQgH,EAASG,QAAQ3J,IAAQ,GAAkBgJ,OAAOrR,UAAUoS,qBAAqBV,KAAKF,EAAQnJ,KAAgByH,EAAOzH,GAAOmJ,EAAOnJ,IAAU,OAAOyH,EAMne,IAAI,GAAqB,IAAM7E,cAAc,OAAQ,CACnDqH,KAAM,OACNC,EAAG,oBAGD,GAAqB,IAAMtH,cAAc,OAAQ,CACnDsH,EAAG,6JAGDS,GAAqB,IAAM/H,cAAc,SAAU,CACrDgI,GAAI,GACJC,GAAI,EACJC,EAAG,MAGD,GAA2B,SAAkCV,GAC/D,IAAIC,EAASD,EAAKC,OACdnI,EAAQkI,EAAKlI,MACbgD,EAAQ,GAAyBkF,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMxH,cAAc,MAAO,GAAS,CACtDhH,MAAO,GACP0O,OAAQ,GACRC,QAAS,YACTC,IAAKH,GACJnF,GAAQhD,EAAqB,IAAMU,cAAc,QAAS,KAAMV,GAAS,KAAM,GAAO,GAAOyI,KAG9F,GAAa,IAAMD,YAAW,SAAUxF,EAAOsF,GACjD,OAAoB,IAAM5H,cAAc,GAA0B,GAAS,CACzEyH,OAAQG,GACPtF,OAEU,ICzCf,SAAS,KAA2Q,OAA9P,GAAW8D,OAAOC,QAAU,SAAUxB,GAAU,IAAK,IAAIjF,EAAI,EAAGA,EAAI0G,UAAU5N,OAAQkH,IAAK,CAAE,IAAI2G,EAASD,UAAU1G,GAAI,IAAK,IAAIxC,KAAOmJ,EAAcH,OAAOrR,UAAUyR,eAAeC,KAAKF,EAAQnJ,KAAQyH,EAAOzH,GAAOmJ,EAAOnJ,IAAY,OAAOyH,IAA2B6B,MAAMrR,KAAMiR,WAEhT,SAAS,GAAyBC,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAAkEnJ,EAAKwC,EAAnEiF,EAEzF,SAAuC0B,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAA2DnJ,EAAKwC,EAA5DiF,EAAS,GAAQgC,EAAaT,OAAOU,KAAKP,GAAqB,IAAK3G,EAAI,EAAGA,EAAIiH,EAAWnO,OAAQkH,IAAOxC,EAAMyJ,EAAWjH,GAAQgH,EAASG,QAAQ3J,IAAQ,IAAayH,EAAOzH,GAAOmJ,EAAOnJ,IAAQ,OAAOyH,EAFxM,CAA8B0B,EAAQK,GAAuB,GAAIR,OAAOa,sBAAuB,CAAE,IAAIC,EAAmBd,OAAOa,sBAAsBV,GAAS,IAAK3G,EAAI,EAAGA,EAAIsH,EAAiBxO,OAAQkH,IAAOxC,EAAM8J,EAAiBtH,GAAQgH,EAASG,QAAQ3J,IAAQ,GAAkBgJ,OAAOrR,UAAUoS,qBAAqBV,KAAKF,EAAQnJ,KAAgByH,EAAOzH,GAAOmJ,EAAOnJ,IAAU,OAAOyH,EAMne,IAAI,GAAqB,IAAM7E,cAAc,OAAQ,CACnDqH,KAAM,OACNC,EAAG,oBAGD,GAAqB,IAAMtH,cAAc,OAAQ,CACnDsH,EAAG,kHAGD,GAAsB,SAA6BE,GACrD,IAAIC,EAASD,EAAKC,OACdnI,EAAQkI,EAAKlI,MACbgD,EAAQ,GAAyBkF,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMxH,cAAc,MAAO,GAAS,CACtDhH,MAAO,GACP0O,OAAQ,GACRC,QAAS,YACTC,IAAKH,GACJnF,GAAQhD,EAAqB,IAAMU,cAAc,QAAS,KAAMV,GAAS,KAAM,GAAO,KAGvF,GAAa,IAAMwI,YAAW,SAAUxF,EAAOsF,GACjD,OAAoB,IAAM5H,cAAc,GAAqB,GAAS,CACpEyH,OAAQG,GACPtF,OAEU,ICnCf,SAAS,KAA2Q,OAA9P,GAAW8D,OAAOC,QAAU,SAAUxB,GAAU,IAAK,IAAIjF,EAAI,EAAGA,EAAI0G,UAAU5N,OAAQkH,IAAK,CAAE,IAAI2G,EAASD,UAAU1G,GAAI,IAAK,IAAIxC,KAAOmJ,EAAcH,OAAOrR,UAAUyR,eAAeC,KAAKF,EAAQnJ,KAAQyH,EAAOzH,GAAOmJ,EAAOnJ,IAAY,OAAOyH,IAA2B6B,MAAMrR,KAAMiR,WAEhT,SAAS,GAAyBC,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAAkEnJ,EAAKwC,EAAnEiF,EAEzF,SAAuC0B,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAA2DnJ,EAAKwC,EAA5DiF,EAAS,GAAQgC,EAAaT,OAAOU,KAAKP,GAAqB,IAAK3G,EAAI,EAAGA,EAAIiH,EAAWnO,OAAQkH,IAAOxC,EAAMyJ,EAAWjH,GAAQgH,EAASG,QAAQ3J,IAAQ,IAAayH,EAAOzH,GAAOmJ,EAAOnJ,IAAQ,OAAOyH,EAFxM,CAA8B0B,EAAQK,GAAuB,GAAIR,OAAOa,sBAAuB,CAAE,IAAIC,EAAmBd,OAAOa,sBAAsBV,GAAS,IAAK3G,EAAI,EAAGA,EAAIsH,EAAiBxO,OAAQkH,IAAOxC,EAAM8J,EAAiBtH,GAAQgH,EAASG,QAAQ3J,IAAQ,GAAkBgJ,OAAOrR,UAAUoS,qBAAqBV,KAAKF,EAAQnJ,KAAgByH,EAAOzH,GAAOmJ,EAAOnJ,IAAU,OAAOyH,EAMne,IAAI,GAAqB,IAAM7E,cAAc,OAAQ,CACnDqH,KAAM,OACNC,EAAG,oBAGD,GAAqB,IAAMtH,cAAc,OAAQ,CACnDsH,EAAG,yJAGD,GAAqB,SAA4BE,GACnD,IAAIC,EAASD,EAAKC,OACdnI,EAAQkI,EAAKlI,MACbgD,EAAQ,GAAyBkF,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMxH,cAAc,MAAO,GAAS,CACtDhH,MAAO,GACP0O,OAAQ,GACRC,QAAS,YACTC,IAAKH,GACJnF,GAAQhD,EAAqB,IAAMU,cAAc,QAAS,KAAMV,GAAS,KAAM,GAAO,KAGvF,GAAa,IAAMwI,YAAW,SAAUxF,EAAOsF,GACjD,OAAoB,IAAM5H,cAAc,GAAoB,GAAS,CACnEyH,OAAQG,GACPtF,OAEU,ICnCf,SAAS,KAA2Q,OAA9P,GAAW8D,OAAOC,QAAU,SAAUxB,GAAU,IAAK,IAAIjF,EAAI,EAAGA,EAAI0G,UAAU5N,OAAQkH,IAAK,CAAE,IAAI2G,EAASD,UAAU1G,GAAI,IAAK,IAAIxC,KAAOmJ,EAAcH,OAAOrR,UAAUyR,eAAeC,KAAKF,EAAQnJ,KAAQyH,EAAOzH,GAAOmJ,EAAOnJ,IAAY,OAAOyH,IAA2B6B,MAAMrR,KAAMiR,WAEhT,SAAS,GAAyBC,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAAkEnJ,EAAKwC,EAAnEiF,EAEzF,SAAuC0B,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAA2DnJ,EAAKwC,EAA5DiF,EAAS,GAAQgC,EAAaT,OAAOU,KAAKP,GAAqB,IAAK3G,EAAI,EAAGA,EAAIiH,EAAWnO,OAAQkH,IAAOxC,EAAMyJ,EAAWjH,GAAQgH,EAASG,QAAQ3J,IAAQ,IAAayH,EAAOzH,GAAOmJ,EAAOnJ,IAAQ,OAAOyH,EAFxM,CAA8B0B,EAAQK,GAAuB,GAAIR,OAAOa,sBAAuB,CAAE,IAAIC,EAAmBd,OAAOa,sBAAsBV,GAAS,IAAK3G,EAAI,EAAGA,EAAIsH,EAAiBxO,OAAQkH,IAAOxC,EAAM8J,EAAiBtH,GAAQgH,EAASG,QAAQ3J,IAAQ,GAAkBgJ,OAAOrR,UAAUoS,qBAAqBV,KAAKF,EAAQnJ,KAAgByH,EAAOzH,GAAOmJ,EAAOnJ,IAAU,OAAOyH,EAMne,IAAI,GAAqB,IAAM7E,cAAc,OAAQ,CACnDsH,EAAG,qGAGD,GAAsB,SAA6BE,GACrD,IAAIC,EAASD,EAAKC,OACdnI,EAAQkI,EAAKlI,MACbgD,EAAQ,GAAyBkF,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMxH,cAAc,MAAO,GAAS,CACtDhH,MAAO,GACP0O,OAAQ,GACRC,QAAS,YACTC,IAAKH,GACJnF,GAAQhD,EAAqB,IAAMU,cAAc,QAAS,KAAMV,GAAS,KAAM,KAGhF,GAAa,IAAMwI,YAAW,SAAUxF,EAAOsF,GACjD,OAAoB,IAAM5H,cAAc,GAAqB,GAAS,CACpEyH,OAAQG,GACPtF,OAEU,IC9Bf,SAAS,KAA2Q,OAA9P,GAAW8D,OAAOC,QAAU,SAAUxB,GAAU,IAAK,IAAIjF,EAAI,EAAGA,EAAI0G,UAAU5N,OAAQkH,IAAK,CAAE,IAAI2G,EAASD,UAAU1G,GAAI,IAAK,IAAIxC,KAAOmJ,EAAcH,OAAOrR,UAAUyR,eAAeC,KAAKF,EAAQnJ,KAAQyH,EAAOzH,GAAOmJ,EAAOnJ,IAAY,OAAOyH,IAA2B6B,MAAMrR,KAAMiR,WAEhT,SAAS,GAAyBC,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAAkEnJ,EAAKwC,EAAnEiF,EAEzF,SAAuC0B,EAAQK,GAAY,GAAc,MAAVL,EAAgB,MAAO,GAAI,IAA2DnJ,EAAKwC,EAA5DiF,EAAS,GAAQgC,EAAaT,OAAOU,KAAKP,GAAqB,IAAK3G,EAAI,EAAGA,EAAIiH,EAAWnO,OAAQkH,IAAOxC,EAAMyJ,EAAWjH,GAAQgH,EAASG,QAAQ3J,IAAQ,IAAayH,EAAOzH,GAAOmJ,EAAOnJ,IAAQ,OAAOyH,EAFxM,CAA8B0B,EAAQK,GAAuB,GAAIR,OAAOa,sBAAuB,CAAE,IAAIC,EAAmBd,OAAOa,sBAAsBV,GAAS,IAAK3G,EAAI,EAAGA,EAAIsH,EAAiBxO,OAAQkH,IAAOxC,EAAM8J,EAAiBtH,GAAQgH,EAASG,QAAQ3J,IAAQ,GAAkBgJ,OAAOrR,UAAUoS,qBAAqBV,KAAKF,EAAQnJ,KAAgByH,EAAOzH,GAAOmJ,EAAOnJ,IAAU,OAAOyH,EAMne,IAAI,GAAqB,IAAM7E,cAAc,OAAQ,CACnDqH,KAAM,OACNC,EAAG,oBAGD,GAAqB,IAAMtH,cAAc,OAAQ,CACnDsH,EAAG,kFAGD,GAAqB,SAA4BE,GACnD,IAAIC,EAASD,EAAKC,OACdnI,EAAQkI,EAAKlI,MACbgD,EAAQ,GAAyBkF,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMxH,cAAc,MAAO,GAAS,CACtDhH,MAAO,GACP0O,OAAQ,GACRC,QAAS,YACTC,IAAKH,GACJnF,GAAQhD,EAAqB,IAAMU,cAAc,QAAS,KAAMV,GAAS,KAAM,GAAO,KAGvF,GAAa,IAAMwI,YAAW,SAAUxF,EAAOsF,GACjD,OAAoB,IAAM5H,cAAc,GAAoB,GAAS,CACnEyH,OAAQG,GACPtF,OCtBQ6F,IDwBE,ICxBU,SAAC7F,GAA2B,IAC3CX,EAAiBW,EAAjBX,aAGFY,EAAaD,EAAM8F,SAAS9F,MAAMC,UAAwB,WAAaD,EAAM8F,SAAS9F,MAAMC,UAA9C,UAC9C0C,EAAStD,EAAgC9L,IAAMwS,aAAa/F,EAAM8F,SAAU,CAAE7F,cAAtDD,EAAM8F,SAC9BE,EAAQ3G,EAA2B,kBAAC,GAAD,CAAYY,UAAU,QAAQ8E,KAAK,iBAA/CrR,EAC7B,OACE,kBAAC,IAAM0O,SAAP,KACE,yBAAKnC,UAAU,aACZ0C,EACAqD,GAEH,kBAAC,EAAD,CAAc3G,aAAcA,O,WCDrB4G,GAAuD,SAACjG,GAAW,IACtEb,EAAkCa,EAAlCb,UAAW/F,EAAuB4G,EAAvB5G,OAD0D,EAGZ8F,EAAcC,EAFrCa,EAAfZ,WAE2EY,GAA9FjJ,EAHqE,EAGrEA,MAAO8I,EAH8D,EAG9DA,SAAUlH,EAHoD,EAGpDA,cAAe/C,EAHqC,EAGrCA,OAAQyJ,EAH6B,EAG7BA,aAH6B,EnBm1BxE,SACLzJ,EACAiD,EACAO,EACAyG,EACA9I,EACA4B,GAEA,SAASgF,EAAWhI,GAClB,MAAO,CACLA,aAAc,IAAID,EAAaC,EAAcC,GAC7CA,SACAwD,SACAT,gBACAE,cAsEJ,MAAO,CAAEqN,cAlET,SAAuBvQ,GACrBkK,EAAS,CAAEnF,KAAM,cAAepC,QAASqF,EAAWhI,MAiE9BwQ,YA/DxB,SAAqBzO,EAAe/B,GAClCkK,EAAS,CAAEnF,KAAM,YAAapC,QAASqF,EAAWhI,GAAe+B,WA8D9B0O,WA5DrC,SAAoB1O,EAAe/B,GACjCkK,EAAS,CAAEnF,KAAM,WAAYpC,QAASqF,EAAWhI,GAAe+B,WA2DjB2K,SAzDjD,SAAkB1M,GAChBkK,EAAS,CAAEnF,KAAM,SAAUpC,QAASqF,EAAWhI,MAwDU0Q,UAtD3D,SAAmB1Q,EAAgCmF,EAAauB,GAC9D,GAAY,UAARvB,EAEF,OAAO,EAMT,SAASwL,IACP,OAAO,IAAIxP,EAAWC,EAAO,IAAIrB,EAAaC,EAAcC,GAASA,GA2BvE,GAzBA,WACE,OAAQkF,GACN,IAAK,OACL,IAAK,UAEH,OAAQzD,EAAcN,EAAMK,SAAUxB,GAAQ2B,QAChD,IAAK,MACL,IAAK,YAEH,OAAQF,EAAcN,EAAMK,SAAUxB,GAAQ4B,OAChD,IAAK,YACL,IAAK,YAEH,OAD+B8O,IACbtP,YAEpB,IAAK,aACL,IAAK,SAEH,OAD+BsP,IACbrP,aAKtB,OAAO,EAELsP,GAAa,CACf,IAAMjO,EAAmBqF,EAAWhI,GAEpC,OADAkK,EAAS,CAAEnF,KAAM,UAAWpC,UAASwC,MAAKuB,cACnC,EAET,OAAO,GAY6DmK,aAVtE,SAAsB7Q,EAAgC8Q,GAAoB,IAChEnP,EAAeD,EAAcN,EAAMK,SAAUxB,GAA7C0B,WACRuI,EAAS,CACPnF,KAAM,aACNpC,QAASqF,EAAWhI,GACpBqG,KAAMyK,EACNnP,iBmB95BkFoP,CACpF9Q,EACAoK,EACA5G,EACAyG,EACA9I,EACA4B,GANMuN,EALqE,EAKrEA,cAAeC,EALsD,EAKtDA,YAAaC,EALyC,EAKzCA,WAAY/D,EAL6B,EAK7BA,SAAUgE,EALmB,EAKnBA,UAAWG,EALQ,EAKRA,aAa/DG,EAAWpT,IAAMqT,YAyBvB,SAAS/E,EAAaS,GACpBD,EAASC,EAAEC,QAGb,SAASsE,EAAcvE,GACjB+D,EAAU/D,EAAEC,OAA4BD,EAAExH,IAAKwH,EAAEjG,WACnDiG,EAAEwE,iBAiBN,IAAMC,EAAyC,SAAC/G,GAAW,IACjDnD,EAAyBmD,EAAzBnD,KAAMnF,EAAmBsI,EAAnBtI,MAAOwB,EAAY8G,EAAZ9G,QAGf8N,EACJ,uBAAGhE,QAAS,SAACV,GAAD,OAtChB,SAAyB5K,EAAe4K,GACtC6D,EAAYzO,EAAOiP,EAASM,SAC5B3E,EAAEwE,iBAoCmBI,CAAgBxP,EAAO4K,IAAItF,MAAM,cAClD,kBAAC,GAAD,CAAYoI,OAAO,QAGjBnF,EAAY/G,EAAU,MAAQ,cACpC,OACE,0BAAM+G,UAAWA,EAAW+C,QAAS,SAACV,GAAD,OAvCzC,SAAwB5K,EAAe4K,GACrC8D,EAAW1O,EAAOiP,EAASM,SAC3B3E,EAAEwE,iBAqC4CK,CAAezP,EAAO4K,KAC/DzF,EACAmK,IA/EsE,MAwF7E,WAEE,KADkBhH,EAAMoH,uBAAyBrQ,EAAMoC,gBAAgB/C,QAErE,MAAO,CACL6J,UAAW,aACX+F,UAAMtS,EACNyF,qBAAiBzF,GAGrB,IACMsS,EAAO,kBAAC,GAAD,CAAY/F,UAAU,UAC7BoH,EAAyBtQ,EAAMoC,gBAE/BmO,EAC0D,MAA9DD,EAAuBA,EAAuBjR,OAAS,QAAa1C,EAClE,kBAAC,IAAM0O,SAAP,KACG,iBACD,uBAAGmF,KAAMvH,EAAMwH,YAAajF,OAAO,SAASkF,IAAI,uBAAhD,gBAGC,KAQP,MAAO,CAAEtO,gBAJP,uBAAG8G,UAAU,SACVoH,EADH,IAC4BC,GAGJtB,OAAM/F,UAnBd,gCAqByByH,GAArCvO,EAtHqE,EAsHrEA,gBAAiB6M,EAtHoD,EAsHpDA,KAAM/F,EAtH8C,EAsH9CA,UAqB/B,OACE,yBAAKuC,GAAG,YACN,yBAAKvC,UAAWA,EAAW0H,eArH/B,SAA2BrF,GAC2B,QAArCA,EAAEC,OAAuBqF,SAKxC1B,EAAcS,EAASM,WAgHlBlQ,EAAMK,SAASQ,KAtBtB,SAAoBoB,EAA0BtB,GAC5C,IAAMwB,GAAW8G,EAAMoH,qBAAuBpO,EAAQE,QACtD,MAAwB,QAAjBF,EAAQ0B,KACb,kBAACqM,EAAD,CAAKlK,KAAM7D,EAAQlB,KAAMJ,MAAOA,EAAOoD,IAAKpD,EAAOwB,QAASA,IAE5D,2BACEwB,KAAK,OACLI,IAAI,QACJwK,IAAKqB,EACL1G,UAAW/G,OAAUxF,EAAY,UACjCgD,MAAO,GACP2P,UAAWQ,EACXxE,SAAUR,EACVgG,QAAS,SAACvF,GAAD,OAAOwF,GAAYxF,GAAG,IAC/ByF,OAAQ,SAACzF,GAAD,OAAOwF,GAAYxF,GAAG,SAS7B0D,GAEH,kBAAC,GAAD,CAAWrH,MAAO5H,EAAM4H,MAAOnE,WAAYzD,EAAMyD,WAAYpB,OA5FjE,SAA0BqN,GACxBD,EAAaG,EAASM,QAAUR,MA4F9B,kBAAC,EAAD,CAAcpH,aAAcA,IAC3BlG,IAmBD6O,GAAqD,SAAChI,GAAW,IAC7DrB,EAA8BqB,EAA9BrB,MAAOnE,EAAuBwF,EAAvBxF,WAAYpB,EAAW4G,EAAX5G,OAC3B,OAAKoB,EAAWpE,OAId,yBAAK6J,UAAU,aACXtB,EAAMvI,OAEJuI,EAAM/G,KAAI,SAACoE,GAAD,OAAU,kBAAC,GAAD,CAAUA,KAAMA,EAAMxB,WAAYA,EAAYpB,OAAQA,EAAQ0B,IAAKkB,EAAKlB,SAD5F,qBALC,yBAAKmF,UAAU,sBAmBpBgI,GAAmD,SAACjI,GAAW,IAC3DhE,EAA6BgE,EAA7BhE,KAAMxB,EAAuBwF,EAAvBxF,WAAYpB,EAAW4G,EAAX5G,OAmB1B,IAAMxG,EAjBN,SAAgBkI,GACd,IAAMpD,EAAQoD,EAAI2J,QAAQjK,GAC1B,OACE,0BAAMyF,UAAU,QACF,IAAXvI,EACCoD,EAEA,kBAAC,IAAMsH,SAAP,KACGtH,EAAIzE,UAAU,EAAGqB,GAClB,0BAAMuI,UAAU,SAASzF,GACxBM,EAAIzE,UAAUqB,EAAQ8C,EAAWpE,UAOhC8R,CAAOlM,EAAKlB,KAElBK,EAAQa,EAAKb,MAAQ,0BAAM8E,UAAU,cAAhB,WAAqCjE,EAAKb,YAAgBzH,EAE/EyU,EAAUnM,EAAKmM,QAAU,2BAAInM,EAAKmM,cAAezU,EAavD,IAAM0U,EAXN,SAAiBtN,GACf,IAAMkL,EAAO,kBAAC,GAAD,CAAWtP,MAAM,KAAK0O,OAAO,OAGpCiD,EACJ,uBAAGd,KAAI,gBAAWzM,EAAX,SAAuByH,OAAO,SAASkF,IAAI,uBAC/CzB,GAGL,OAAO,uBAAG/F,UAAU,aAAaoI,GAEtBC,CAAQtM,EAAKlB,KAC1B,OACE,yBACEmF,UAAU,OACVsI,SAAU,EACVzN,IAAKkB,EAAKlB,IACVkI,QAAS,SAACV,GAAD,OAAOlJ,EAAO4C,EAAKlB,MAC5BuL,UAAW,SAAC/D,GACI,UAAVA,EAAExH,KAAiB1B,EAAO4C,EAAKlB,KACnCwH,EAAEwE,kBAEJe,QAAS,SAACvF,GAAD,OAAOwF,GAAYxF,GAAG,IAC/ByF,OAAQ,SAACzF,GAAD,OAAOwF,GAAYxF,GAAG,KAE7B1P,EACAuI,EACAgN,EACAC,IAMP,SAASN,GAAYxF,EAAkCkG,GAKrD,IAAMjG,EAASD,EAAEC,OACXkG,EAAgBnG,EAAEmG,cAElBC,EAAmCD,GAPzC,SAAmBC,GACjB,YAA4ChV,IAApCgV,EAAwBd,QAMwBe,CAAUF,GAAiBA,OAAgB/U,EAE/FkV,EAAeH,EAA6BC,EAAuBA,EAAQd,QAArB,WAAvB,UAC/BiB,EAAgBH,EAAeA,EAAQzI,UAAb,GAE1B6I,EAAgBrL,SAASqL,cAG/BtT,EAAI,cAAe,CACjBgT,WACAO,WAJiBxG,EAAOqF,QAKxBoB,kBAJwBF,EAAgBA,EAAclB,QAAU,iBAKhEgB,cACAC,iBAGFL,EAAWA,GAA6B,SAAjBK,EAEvB,IAAMI,EAAMxL,SAASyL,eAAe,YAElCD,EAAIhJ,UADFuI,EACc,WAEA,GCzSb,SAASW,GACdnM,EACAoM,EACAxW,EACAqI,GAEA,IAAMoO,EAAQzW,EAAkB,kBAAC,IAAD,CAAS0W,GAAIC,MAAIC,cAAc5W,IAA/B,aAAZc,EACd+V,EACH7W,GAAgB,SAATqI,EACN,yBAAKgF,UAAU,kBACb,4BACE,4BACE,kBAAC,IAAD,CAAMqJ,GAAIC,MAAIC,cAAc5W,IAA5B,qBAEF,4BACE,kBAAC,IAAD,CAAM0W,GAAIC,MAAIG,cAAc9W,IAA5B,4BAPkBc,EAa5B,OACE,kBAAC,IAAM0O,SAAP,KACE,yBAAKnC,UAAU,YACb,4BAAKjD,GACL,yBAAKiD,UAAU,QACb,kBAAC,IAAD,CAAMqJ,GAAIC,MAAII,MAAMC,cAAe3J,UAAU,cAC1C4J,SAAOC,eAAe/G,UAI5B0G,EACD,yBAAKxJ,UAAU,qBACb,yBAAKA,UAAU,SAASmJ,GACxB,yBAAKnJ,UAAU,QACZoJ,EACD,kBAAC,IAAD,CACEC,GAAIC,MAAIQ,yBAAyB,CAAE9O,KAAM,SAAUrI,QACnDqN,UAAoB,WAAThF,EAAoB,gBAAavH,GAF9C,UAMA,kBAAC,IAAD,CACE4V,GAAIC,MAAIQ,yBAAyB,CAAE9O,KAAM,SAAUrI,QACnDqN,UAAoB,WAAThF,EAAoB,gBAAavH,GAF9C,aC1CH,SAASsW,GAAWpX,GACzB,IAAM2U,EAAOgC,MAAIU,UAAUrX,GAC3B,OACE,kBAAC,IAAD,CAAMqN,UAAU,MAAMqJ,GAAI/B,GACvB3U,EAAIkI,KCHJ,SAASoP,GAAQnR,GACtB,OACE,yBAAKkH,UAAU,SACZlH,EAAKnB,KAAI,SAAChF,GACT,IAAMuX,EAAOH,GAAWpX,GAExB,OAAO,kBAAC,IAAMwP,SAAP,CAAgBtH,IAAKlI,EAAIkI,KAAMqP,EAA/B,SCLR,SAASC,GACdjC,EACAkC,GAEA,IAAM9C,EAAOgC,MAAIe,WAAWnC,GACtBoC,EAAW,kBAAC,IAAD,CAASjB,GAAI/B,GAAOY,EAAQ/G,MACvC8B,EAAuB,UAAhBmH,EAAOnH,KAAmB,GAAqB,QAAhBmH,EAAOnH,KAAiB,GAAK,IAEnEsH,EAAG,0CAAsCrC,EAAQsC,aAA9C,cAAuE,EAAPvH,EAAhE,qBACHwH,EAAM,yBAAKF,IAAKA,EAAKG,IAAKxC,EAAQ/G,KAAM1K,MAAOwM,EAAMkC,OAAQlC,IAC7DlG,EAAQqN,EAAOrN,MAAQmL,EAAQ/G,UAAO1N,EAM5C,MAAO,CAAE6W,WAAUK,SAJjB,kBAAC,IAAD,CAAStB,GAAI/B,EAAMvK,MAAOA,EAAOiD,UAAU,YACxCyK,GAGwB5P,IAAKyM,GCpB7B,SAASsD,GAAQC,GACtB,OAAO,yBAAK7K,UAAU,QAAQ6K,GCEzB,SAASC,GAAY5C,EAA2BjF,EAAoB4H,GAA8B,IAAD,EAClEV,GAAejC,EAAS,CAC1DnL,OAAO,EACPkG,SAFMqH,EAD8F,EAC9FA,SAAUK,EADoF,EACpFA,SAAU9P,EAD0E,EAC1EA,IAItBkQ,EAAYF,EAAmBD,GAAQC,QAApBpX,EACzB,OACE,yBAAKuM,UAAU,YAAYnF,IAAKA,GAC7BkQ,EACAJ,EACD,yBAAK3K,UAAU,WACZsK,EACApC,EAAQ8C,SAAW,0BAAMhL,UAAU,iBAAiBkI,EAAQ8C,eAAmBvX,ICjBjF,SAASwX,GAAeC,GAC7B,IAAMC,EAAQ,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OAAOD,EAAKE,YAClGC,GAAO,IAAIC,MAAOC,gBAAkBL,EAAKK,cAAgB,GAAlD,aAA6D,GAAKL,EAAKK,eAAenV,UAAU,IACvGoV,GAAW,GAAKN,EAAKO,cAAcC,SAAS,EAAG,KACrD,MAAM,GAAN,OAAUP,EAAV,YAAmBD,EAAKS,WAAxB,OAAoCN,EAApC,eAA+CH,EAAKU,WAApD,YAAkEJ,GCK7D,SAASK,GAAqB3D,GAAqE,IAApC4D,EAAmC,wDACjGxE,EAAOgC,MAAIyC,iBAAiB7D,GAC5B2C,EAAOI,GAAe,IAAIK,KAAKpD,EAAQ8D,eAAeC,WACtDC,EAAQJ,OAAQrY,EACpB,yBAAKuM,UAAU,SACb,yBAAKA,UAAU,WACb,gCAASkI,EAAQiE,UADnB,IAC4D,IAArBjE,EAAQiE,SAAiB,SAAW,YAIzEC,EAAYN,EAChB,yBAAK9L,UAAU,aAAa4K,GAAQC,IAEpCC,GAAY5C,EAAQ8D,eAAeK,YAAa,QAASxB,GAErD9R,EACJ,yBAAKiH,UAAU,sBACZkM,EACD,yBAAKlM,UAAU,WACb,4BACE,kBAAC,IAAD,CAASqJ,GAAI/B,GAAOY,EAAQ/G,OAE9B,yBAAKnB,UAAU,WAAWkI,EAAQ8D,eAAeM,eAChDrC,GAAQ/B,EAAQpP,MAChBsT,IAIP,MAAO,CAAErT,UAAS8B,IAAKyM,GC9BzB,SAASiF,GAAW3Z,EAAuB6E,EAAeqB,GACxD,IAAM0T,EAAQ1T,EAAOmR,GAAQnR,QAAQrF,EAC/BoX,EAAOI,GAAe,IAAIK,KAAK1Y,EAAQqZ,WAU7C,MAAO,CAAEpR,IAAK,GAAKpD,EAAOsB,QARxB,kBAAC,IAAMoJ,SAAP,KACE,yBAAKnC,UAAU,WACb,yBAAKyM,wBAAyBC,iBAAO9Z,EAAQQ,YAC5CoZ,EACA1B,GAAYlY,EAAQyZ,YAAa,QAASxB,MCZ5C,SAAS8B,GACdrQ,EACAgL,EACAvK,EACAiK,EACA4F,GAEA,OAAOtQ,EAAO3E,KAAI,SAACC,EAAGH,GACpB,IAAKG,EAAG,CACN,IAAMiV,EAAkBvQ,EAAO7E,EAAQ,GAAmCqV,EAC1E,OACE,0BAAMjS,IAAK,QAAUgS,EAAQ7M,UAAU,QAAvC,UAJ0B,IAStBpD,EAAYhF,EAAZgF,KAAMkQ,EAAMlV,EAANkV,EACd,GAAIF,GAAmB5F,IAAY8F,EACjC,OACE,0BAAM9M,UAAU,WAAWnF,IAAK+B,GAC7BA,GAIP,IAAMoD,EAAYgH,IAAY8F,EAAI,gBAAarZ,EAC/C,OACE,kBAAC,IAAD,CAAS4V,GAAI/B,EAAKwF,GAAIjS,IAAK+B,EAAMG,MAAOA,EAAM+P,GAAI9M,UAAWA,GAC1DpD,MCGF,SAASmQ,GACd/F,EACAgG,EACAC,EACA3F,GAIA,OAAOqF,GAtCT,SAAwB3F,EAAiBrM,GACvC,SAASuS,EAAQC,EAAeC,GAI9B,IADA,IAAMC,EAAe,GACZhQ,EAAI8P,EAAO9P,GAAK+P,IAAQ/P,EAC/BgQ,EAAGlP,KAAKd,GAEV,OAAOgQ,EAET,IAQMA,GAPJ1S,GAAO,EACHuS,EAAQ,EAAGvS,GACXqM,EAAU,GAAK,EACfkG,EAAQ,EAAG,GAAG7R,OAAO,MAAC5H,EAAWkH,IACjCA,EAAMqM,GAAW,EACjB,CAAC,OAAGvT,GAAW4H,OAAO6R,EAAQvS,EAAM,EAAGA,IACvC,CAAC,OAAGlH,GAAW4H,OAAO6R,EAAQlG,EAAU,EAAGA,EAAU,IAAI3L,YAAO5H,EAAWkH,IACfhD,KAAI,SAACC,GAAD,OACpEA,EAAI,CAAEgF,KAAM,GAAKhF,EAAGkV,EAAGlV,QAAMnE,KAQ/B,OANIuT,EAAU,GACZqG,EAAGC,QAAQ,CAAE1Q,KAAM,OAAQkQ,EAAG9F,EAAU,IAEtCA,EAAUrM,GACZ0S,EAAGlP,KAAK,CAAEvB,KAAM,OAAQkQ,EAAG9F,EAAU,IAEhCqG,EAUQE,CAAevG,EADlBwG,KAAKC,MAAMT,EAASC,IAAaD,EAASC,EAAW,EAAI,IAE1C3F,GAAM,SAACwF,GAAD,MAAO,cAAgBA,IAAG9F,GAAS,GCrC/D,SAAS0G,GAAYC,GAA0B,IAC5C9S,EAAe8S,EAAf9S,IAAKK,EAAUyS,EAAVzS,MACPmM,EAASnM,GAAmB,IAAVA,EAAT,aAA6BA,QAAUzH,EACtD,OACE,yBAAKuM,UAAU,QAAQnF,IAAKA,GAC1B,0BAAMmF,UAAU,OAAOnF,GACtBwM,GCAA,IAAMuG,GAA+D,SAAC7N,GAAgC,IACnG8N,EAAqB9N,EAArB8N,IAAKrL,EAAgBzC,EAAhByC,YAD6F,ECUrG,SAA2BqL,GAA6C,IAAD,EAClDva,IAAMW,SAAS,IADmC,mBACrE+B,EADqE,KAC9D8X,EAD8D,OAE9Cxa,IAAMW,SAAS,IAF+B,mBAErE8Z,EAFqE,KAE5DC,EAF4D,OAGpC1a,IAAMW,cAA6BR,GAHC,mBAGrE2L,EAHqE,KAGvDC,EAHuD,KAKtE4O,EAAY3a,IAAM4a,QAAgB,GAIxC,SAASC,EAASC,GAChBH,EAAUjH,SAAU,EACpBgH,EAAWI,GA8Bb,OA3BA9a,IAAM8B,WAAU,WACd,IAAI6Y,EAAUjH,QAAd,CAKA,IAAMoH,EAAWpY,EACboY,IAAaL,IAKjBE,EAAUjH,SAAU,EAEpB6G,EAAI,CAAEQ,YAAaD,IAChBnZ,MAAK,eAGLE,OAAM,SAACE,GACNgK,EAAgBhK,EAAOzC,YAExB0b,SAAQ,WAEP9O,WAAW2O,EAvCG,IAuCsBC,UAEvC,CAACpY,EAAO+X,EAASF,IAEb,CAAE7X,QAAO8X,WAAU1O,gBDjDgBmP,CAAkBV,GAApD7X,EAFkG,EAElGA,MAAO8X,EAF2F,EAE3FA,SAAU1O,EAFiF,EAEjFA,aAGzB,OACE,kBAAC,IAAM+C,SAAP,KACE,2BAAO1H,KAAK,OAAO2H,SAJF,SAACoM,GAAD,OAAgDV,EAASU,EAAMlM,OAAOtM,QAI5CA,MAAOA,EAAOwM,YAAaA,IACtE,kBAAC,EAAD,CAAcpD,aAAcA,MEVrBqP,I,OAAkC,WAC7C,IAAMjb,EAAKG,IAKX,OACE,yBAAKqM,UAAU,UACb,yBAAKA,UAAU,aACb,wBAAIA,UAAU,SACZ,wBAAIA,UAAU,QACZ,kBAAC,IAAD,CAASqJ,GAAG,QAAQtM,MAAM,SACxB,kBAAC,GAAD,CAAWtG,MAAM,KAAK0O,OAAO,SAGjC,wBAAInF,UAAU,QACZ,kBAAC,IAAD,CAASqJ,GAAIqF,QAAM5V,KAAMiE,MAAO6M,SAAO+E,SACrC,kBAAC,EAAD,CAAalY,MAAM,KAAK0O,OAAO,SAGlC3R,EACC,kBAAC,IAAM2O,SAAP,KACE,wBAAInC,UAAU,QACZ,kBAAC,IAAD,CAASqJ,GAAIqF,QAAME,YAAa7R,MAAO6M,SAAOiF,cAC5C,kBAAC,EAAD,CAAcpY,MAAM,KAAK0O,OAAO,SAGpC,wBAAInF,UAAU,QACZ,kBAAC,IAAD,CAASqJ,GAAIqF,QAAMI,MAAO/R,MAAM,SAC9B,kBAAC,GAAD,CAAkBtG,MAAM,KAAK0O,OAAO,SAGxC,wBAAInF,UAAU,QACZ,kBAAC,IAAD,CAASqJ,GAAG,SAAStM,MAAM,gBAAgBgG,QA/BzD,SAA2BV,GACzB0M,MAAM,yEACN1M,EAAEwE,mBA8BY,kBAAC,EAAD,CAAWpQ,MAAM,KAAK0O,OAAO,SAGjC,wBAAInF,UAAU,QAAQmK,GAAe3W,EAAI,CAAEuJ,OAAO,EAAMkG,KAAM,UAAW0H,WAG3E,wBAAI3K,UAAU,QACZ,kBAAC,IAAD,CAASqJ,GAAIqF,QAAMM,MAAOhP,UAAU,SAApC,6B,qBCrCd,SAASiP,GAASlS,GAChBS,SAAST,MAAT,UAAoBA,EAApB,cAA+B6M,SAAOsF,SAoBxC,SAASC,GAAcC,EAAsBC,EAAmBC,GAC9D,GAAIC,MAAMC,QAAQJ,GAAU,CAC1B,IAAMjY,EAAWiY,EAAQzX,KAAI,SAACC,EAAGH,GAC/B,IAAMgY,EAAoB,IAAVhY,GAAe4X,EApBrC,SAAuBA,GACrB,OACE,yBAAKrP,UAAU,mBAAmBnF,IAAI,WACpC,yBAAKmF,UAAU,QACb,4BAAKqP,EAAQzS,MACb,6BACGyS,EAAQK,KAAK/X,KAAI,SAACgY,EAAKlY,GAAN,OAChB,kBAAC,IAAD,CAAS4R,GAAIsG,EAAIrI,KAAMzM,IAAK,GAAKpD,EAAOuI,UAAWvI,IAAU4X,EAAQO,SAAW,gBAAanc,GAC1Fkc,EAAI/S,YAY4BiT,CAAcR,QAAW5b,EAC5DuM,EAAsB,IAAVvI,GAAe4X,EAAU,gBAAkB,UAC7D,OACE,kBAAC,IAAMlN,SAAP,CAAgBtH,IAAK,GAAKpD,GACvBgY,EACD,yBAAKzP,UAAWA,EAAWnF,IAAKjD,EAAEiD,KAC/BjD,EAAEmB,aAKX,OAAQuW,EAGN,kBAAC,IAAMnN,SAAP,KACGhL,EACD,yBAAK6I,UAAU,UAAUnF,IAAI,UAC1ByU,IALLnY,EAUJ,OACE,kBAAC,IAAMgL,SAAP,KACGiN,EACAE,GAwGP,SAASQ,GAAaC,GAAiB,IAAD,EAlEtC,SAA2BC,GACzB,IAAKA,EACH,MAAO,CAAEC,YAAa,KAAMC,YAAa,MAG3C,IAAMC,EAAS7c,IAAMqT,YACfyJ,EAAY9c,IAAMqT,YAExB,SAAS0J,EAAWC,GAClB,IAAMC,EAAWJ,EAAOnJ,QAClBwJ,EAAcJ,EAAUpJ,QACzBuJ,GAAaC,IAGdF,GACFC,EAASE,UAAUvY,OAAO,UAC1BsY,EAAYC,UAAUC,IAAI,YAE1BH,EAASE,UAAUC,IAAI,UACvBF,EAAYC,UAAUvY,OAAO,YAYjC,SAAS8H,EAAUmB,EAAcwP,GAC/B,OAAOA,EAAUxP,EAAOA,EAAO,UAGjC,IAAM+O,EACJ,4BACElQ,UAAWA,EAAU,uBAAwBgQ,EAAMW,SACnDlW,KAAK,SACLsI,QAjBJ,SAAuByL,GACrB6B,GAAW,GACX7B,EAAM3H,kBAgBJxB,IAAK+K,GAEJJ,EAAMY,iBAILC,EACJ,4BAAQ7Q,UAAU,sBAAsBvF,KAAK,SAASsI,QArBxD,SAAuByL,GACrB6B,GAAW,GACX7B,EAAM3H,kBAmBwE9J,MAAM,SAClF,kBAAC,GAAD,CAAYtG,MAAM,KAAK0O,OAAO,QAWlC,MAAO,CAAE8K,YANP,yBAAKjQ,UAAWA,EAAU,eAAgBgQ,EAAMW,SAAUha,MAAO,CAAEF,MAAOuZ,EAAMvZ,OAAS4O,IAAK8K,GAC3FU,EACAb,EAAMjX,SAIWmX,eAQeY,CAAkBf,EAAOC,OAAtDC,EAD4B,EAC5BA,YAAaC,EADe,EACfA,YAkBrB,IAAMlQ,EAhBN,SAAsBvJ,GACpB,OAAQA,GACN,IAAK,OACH,MAAO,cACT,IAAK,OACH,MAAO,mBACT,IAAK,SACH,MAAO,qBACT,IAAK,OACH,MAAO,mBACT,IAAK,OACH,MAAO,mBACT,QACE,MAAM,IAAI+J,MAAM,oBAGJuQ,CAAahB,EAAOtZ,OAEtC,QAxBiChD,IAwBtBsc,EAAOiB,KAxBIC,OA2BpB,OADAhC,GAASc,EAAOiB,KAAKjU,OACd,yBAAKiD,UAAWA,GA3H3B,SAAoBgR,EAAYE,GAC9B,IAAMlR,EAAakR,EAAqB,mBAAb,WACrBC,EAAOH,EAAKC,OAAOD,EAAKpB,UAAUuB,KAClCC,EAAWD,EAAmB,yBAAKnR,UAAU,QAAQmR,QAAnC1d,EACxB,OACE,kBAAC,IAAM0O,SAAP,KACE,yBAAKnC,UAAWA,GACd,yBAAKA,UAAU,QACZgR,EAAKC,OAAOtZ,KAAI,SAACgY,EAAKlY,GAAN,OACf,kBAAC,IAAD,CACE4R,GAAIsG,EAAI0B,QAAQ/J,KAChBzM,IAAK,GAAKpD,EACVuI,UAAWvI,IAAUuZ,EAAKpB,SAAW,gBAAanc,GAEjDkc,EAAI0B,QAAQzU,SAGhBwU,IAGL,yBAAKpR,UAAU,UACZgR,EAAKC,OAAOtZ,KAAI,SAACgY,EAAKlY,GACrB,OACE,yBAAKuI,UAAWvI,IAAUuZ,EAAKpB,SAAW,cAAWnc,EAAWoH,IAAK,GAAKpD,GACvE0X,GAAcQ,EAAIP,QAASO,EAAIN,eAmGPiC,CAAWvB,EAAOiB,MAAM,IAG7D,IAAMO,EAAapC,GAAcY,EAAOiB,KAAK5B,QAASW,EAAOiB,KAAK3B,QAASU,EAAOiB,KAAK1B,QACvFL,GAASc,EAAOiB,KAAKjU,OAErB,IAAMA,EAAQgT,EAAOiB,KAAKQ,SAAWzB,EAAOiB,KAAKQ,SAAW,4BAAKzB,EAAOiB,KAAKjU,OAE7E,MAAqB,SAAjBgT,EAAOtZ,MAEP,kBAAC,IAAM0L,SAAP,KACE,yBAAKnC,UAAWA,GACbkQ,EACD,yBAAKlQ,UAAU,UAAUjD,GACzB,yBAAKiD,UAAU,WAAWuR,IAE3BtB,GAKH,kBAAC,IAAM9N,SAAP,KACE,yBAAKnC,UAAWA,GACbkQ,EACAqB,GAEFtB,GAMF,SAASwB,GAAa1B,GAC3B,IAAM2B,EAAW5B,GAAaC,GAC9B,OAAO,yBAAK/P,UAAU,eAAe0R,GC/MhC,SAASC,GACdzc,EACA0c,GACqB,IACbxd,EAAiCc,EAAjCd,KAAME,EAA2BY,EAA3BZ,MAAOkB,EAAoBN,EAApBM,OAAQd,EAAYQ,EAAZR,QAQ7B,OAAO+c,GANgBrd,EACnBwd,EAAS,CAAExd,OAAMoB,SAAQd,YACzBJ,EAYN,SAAsBA,GACpB,IAAMud,EAAOvd,EAAcud,IACrBC,EAAOD,EAAM,oCAAUA,EAAV,KAAsB,CAAEpe,kBAO3C,MAAO,CAAEud,KAAM,CAAEjU,MAAO,QAASqS,QAL/B,kBAAC,IAAMjN,SAAP,KACG2P,EACD,qCAAWxd,EAAM1B,WAGuB6D,MAAO,QApB/Csb,CAAazd,GACb0d,IAKN,IAAMA,GAA0B,CAC9BhB,KAAM,CAAEjU,MAAO,aAAcqS,QAAS,OACtC3Y,MAAO,UCzBF,IAAMwb,GAAgC,WAK3C,OAAON,GAFmC5d,EAAame,MAAIC,UADnB,YAEE,SAACjd,GAAD,OAI5C,SAAkBA,EAAiCqK,GAAqC,IAC9EnL,EAASc,EAATd,KACAge,EAAW7S,EAAX6S,OAF6E,MAGrF,WACE,IAAMC,EAAQje,EAAKgK,MAAM,SACnBxD,EAAQyX,EAAMC,MAAK,SAACC,GAAD,OAAOA,EAAEzX,WAAWsX,EAAS,OAAS,SAC/D,OAAIxX,EAIK,CAAEmC,MAHKqV,EAASxX,EAAMxE,UAAU,EAAGwE,EAAMzE,OAAS,GAAGuJ,OAAS9E,EAAMxE,UAAU,GAAGsJ,OAGxE8S,OAFDH,EAAMjX,MAAM,GAAGxE,KAAK,SAI5B,CAAEmG,MAAO,YAAayV,OAAQpe,GAGfqe,GAAlB1V,EAf6E,EAe7EA,MAAOyV,EAfsE,EAetEA,OAGTpD,ECHD,SAAqBsD,GAC1BA,EAzBF,SAAkBA,GAqBhB,OADAA,GADAA,GADAA,GAFAA,GADAA,GADAA,GADAA,GADAA,GADAA,GAFAA,GAFAA,GADAA,GADAA,GADAA,GADAA,GADAA,EAAOA,EAAKtR,QAAQ,qBAAsB,mBAC9BA,QAAQ,qBAAsB,mBAC9BA,QAAQ,kBAAmB,gBAC3BA,QAAQ,kBAAmB,gBAC3BA,QAAQ,eAAgB,aACxBA,QAAQ,eAAgB,aAExBA,QAAQ,uBAAwB,oBAEhCA,QAAQ,yBAA0B,qBAClCA,QAAQ,yBAA0B,qBAClCA,QAAQ,sBAAuB,kBAC/BA,QAAQ,sBAAuB,kBAC/BA,QAAQ,mBAAoB,eAC5BA,QAAQ,mBAAoB,eAE5BA,QAAQ,iBAAkB,cAC1BA,QAAQ,iBAAkB,cAC1BA,QAAQ,iBAAkB,aAK/BuR,CAASD,GAD4C,MAInBE,EAAQ,KAA3CC,EAJsD,EAItDA,OAAQC,EAJ8C,EAI9CA,uBACVC,EAAS,IAAIF,EAQbG,EAAyB,CAC3B,CAEEC,kBAAmB,SAAUC,GAC3B,MAAqB,MAAdA,EAAK/R,MAEdgS,YAAa,SAAUD,EAAWrN,GAChC,IAAIyB,EAAO4L,EAAKE,QAAL,KACX,OAAO9f,IAAMmK,cAAc4V,IAAM,CAAEhK,GAAI/B,GAAQzB,KAGnD,CAEEoN,kBAAmB,SAAUC,GAC3B,OAAO,GAETC,YAvByB,IAAIL,EAAuBxf,KAuBhBggB,qBAIxC,OADmBP,EAAOQ,sBAAP,eAAqCb,EAArC,WAzBD,WAChB,OAAO,IAwB0EM,GD7BnEQ,CAFHpB,EAASI,EAAS9F,iBAAO8F,GAAQiB,QAG9C,MAAO,CAAEzC,KAAM,CAAEjU,QAAOqS,WAAW3Y,MAAO,QAvBqCid,CAASxe,EAAS,CAAEkd,QAHpF,QEHV,IAAMuB,GAAiC,WAC5C,OAAOhC,GAAQ9d,EAAYqe,MAAI0B,UAAWC,KAG5C,SAASA,GAAU3e,GAAwD,IACjEd,EAASc,EAATd,KAQR,MAAO,CACL4c,KAAM,CAAE5B,QAPR,yBAAKpP,UAAU,aACZ5L,EAAKuD,KAAI,SAACmc,GACT,OAAOhJ,GAAYgJ,EAAM,WAKL/W,MAAO,SAC/BtG,MAAO,QCbJ,IAAMsd,GAAmE,SAAChU,GAI/E,IAJyF,EAiBrBG,EAbhC,IAAII,IAAoB,CAC1D,CACE,WACA,CACEI,MAAO,OACPQ,WAAW,EACXjO,QAAS,CAAE0Q,UAAWiG,SAAOoK,WAAWC,MACxCvS,OAAQ,CAAEjH,KAAM,cAIE,CAAErH,SAAU,IACjB,CAAEsN,MAAO,mBAAoBwC,KAAM,WAC9CG,EAjBiF,EAiBjFA,aAAcC,EAjBmE,EAiBnEA,QAASR,EAjB0D,EAiB1DA,OAAQ7B,EAjBkD,EAiBlDA,UAAWF,EAjBuC,EAiBvCA,cAM1CmT,EAAyBnU,EAAzBmU,aAAc1e,EAAWuK,EAAXvK,OAyBtB,OAPE,0BAAMwK,UAAU,SAASwD,SAhB3B,SAAsBgL,GACpBA,EAAM3H,iBACFvD,GAIJ4O,MAAIiC,WAAWD,EAAc7Q,GAC1BpO,MAAK,SAACmf,GAGL5e,OAEDL,MAAM4L,KAKP,2CACCE,EAAUO,IAAI,YACf,yBAAKxB,UAAU,UAAU8C,KCrClBuR,GAAyD,SAACtU,GAA6B,IAAD,EAGtDuU,OAAKC,iBAAnC5Q,EAHoF,EAGzF6Q,IAAqBC,EAHoE,EAGzE9Z,IAElBwF,EAA8B,IAAIG,IAAoB,CAC1D,CACE,UACA,CACEI,MAAO,UACPzN,QAAS,CAAE0Q,aACXjC,OAAQ,CACNjH,KAAM,WACN+H,YAAa,GACbG,WAAY,CAAE+R,KAAM,EAAGD,gBAI7B,CACE,WACA,CACE/T,MAAO,cACPzN,QAAS,CAAEyQ,UAAU,GACrBhC,OAAQ,CAAEjH,KAAM,cAKdyN,EAAsBnI,EAAtBmI,QAAS9U,EAAa2M,EAAb3M,SA5BgF,EAmC7B8M,EAClEC,EAPsB,CACtB+H,QAASA,GAAoB,GAC7B9U,SAAUA,GAAsB,IAGf,CAAEsN,MAAO,aAAcwC,KAAM,SACxCG,EAnCyF,EAmCzFA,aAAcC,EAnC2E,EAmC3EA,QAASR,EAnCkE,EAmClEA,OAAQ7B,EAnC0D,EAmC1DA,UAAWF,EAnC+C,EAmC/CA,cA8BlD,OACE,0BAAMf,UAAU,kBAAkBwD,SApBpC,SAAsBgL,GACpBA,EAAM3H,iBACFvD,GAKJ4O,MAAIyC,YAAY5U,EAAMpN,IAAK0Q,GACxBpO,MAAK,SAACtC,GAEL,IAAMkf,EAAMvI,MAAIC,cAAc5W,GAI9BoN,EAAM6U,QAAQzW,KAAK0T,MAEpB1c,MAAM4L,KAKP,yBAAKf,UAAU,WACZiB,EAAUO,IAAI,WACf,uBAAGxB,UAAU,QAAb,6CACA,uBAAGA,UAAU,aA7BnB,WACE,IAAM9E,EAAgBuZ,EAAYpR,EAAa6E,QAAQ/R,OACvD,MAAM,GAAN,OAAU+E,EAAV,oBA2B8B2Z,KAE5B,yBAAK7U,UAAU,WAAWiB,EAAUO,IAAI,aACxC,yBAAKxB,UAAU,WAAW8C,KCxEnBgS,GAAmE,SAAC/U,GAG/E,IAAMI,EAA8B,IAAIG,IAAoB,CAC1D,CACE,OACA,CACEI,MAAO,eACPzN,QAAS,GACTyO,OAAQ,CAAEjH,KAAM,QAAS+H,YAAa,WAAYG,WAAY,MAGlE,CACE,WACA,CACEjC,MAAO,sBACPzN,QAAS,CAAEyQ,UAAU,GACrBhC,OAAQ,CAAEjH,KAAM,QAAS+H,YAAa,WAAYG,WAAY,MAGlE,CACE,QACA,CACEjC,MAAO,QACPzN,QAAS,GACTyO,OAAQ,CAAEjH,KAAM,QAAS+H,YAAa,WAAYG,WAAY,MAGlE,CACE,UACA,CACEjC,MAAO,WACPzN,QAAS,CAAEyQ,UAAU,GACrBhC,OAAQ,CAAEjH,KAAM,cAKd0G,EAAmCpB,EAAnCoB,KAAM6J,EAA6BjL,EAA7BiL,SAAU+J,EAAmBhV,EAAnBgV,MAAOC,EAAYjV,EAAZiV,QAtCiF,EA8C5C9U,EAClEC,EARsB,CACtBgB,OACA6J,SAAUA,GAAsB,GAChC+J,QACAC,QAASA,GAAoB,IAEZ,CAAEtU,MAAO,eAAgBwC,KAAM,qBAC1CG,EA9CwG,EA8CxGA,aAAcC,EA9C0F,EA8C1FA,QAASR,EA9CiF,EA8CjFA,OAAQ7B,EA9CyE,EA8CzEA,UAAWF,EA9C8D,EA8C9DA,cAyBlD,OACE,0BAAMf,UAAU,kBAAkBwD,SApBpC,SAAsBgL,GACpBA,EAAM3H,iBACFvD,GAKJ4O,MAAI+C,gBAAgBlV,EAAMmV,OAAQ7R,GAC/BpO,MAAK,SAACkgB,GAEL,IAAMtD,EAAMvI,MAAIe,WAAW8K,GAI3BpV,EAAM6U,QAAQzW,KAAK0T,MAEpB1c,MAAM4L,KAKP,oCACA,kDACA,yBAAKf,UAAU,UACZD,EAAM4K,SACP,yBAAK3K,UAAU,UACZiB,EAAUO,IAAI,QACdP,EAAUO,IAAI,cAGlBP,EAAUO,IAAI,WACf,gDACCP,EAAUO,IAAI,SACf,yBAAKxB,UAAU,UAAU8C,KChGlBsS,I,OAAiC,WAG5C,IAHkD,EA0BkBlV,EAvBhC,IAAII,IAAoB,CAC1D,CACE,WACA,CACEI,MAAO,WACPQ,WAAW,EACXjO,QAAS,GACTyO,OAAQ,CAAEjH,KAAM,QAAS+H,YAAa,WAAYG,WAAY,MAGlE,CACE,WACA,CACEjC,MAAO,WACPQ,WAAW,EACXjO,QAAS,GACTyO,OAAQ,CAAEjH,KAAM,QAAS+H,YAAa,WAAYG,WAAY,QAK5C,CAAE2H,SAAU,GAAI+K,SAAU,IAC/B,CAAE3U,MAAO,SAAUwC,KAAM,UACpCG,EA1B0C,EA0B1CA,aAAcC,EA1B4B,EA0B5BA,QAASR,EA1BmB,EA0BnBA,OAAQ7B,EA1BW,EA0BXA,UAAWF,EA1BA,EA0BAA,cAM5CrN,E7Cf8BJ,IAAMM,WAAWP,GACnCK,M6C8ClB,OAlBE,kBAAC,IAAMyO,SAAP,KACE,sFACA,6FACA,0BAAMnC,UAAU,QAAQwD,SAf5B,SAAsBgL,GACpBA,EAAM3H,iBACFvD,GAIJ4O,MAAIlD,MAAM3L,GACPpO,MAAK,SAACoX,GAAD,OAAmC3Y,EAAM2Y,MAC9ClX,MAAM4L,KAQL,yBAAKf,UAAU,KAAKiB,EAAUO,IAAI,aAClC,yBAAKxB,UAAU,KAAKiB,EAAUO,IAAI,aAClC,yBAAKxB,UAAU,KAAK8C,IAEtB,sDACA,6FACA,8FACA,4BACE,kDACA,oEAEF,2IC3DOwS,GAA6D,SAACvV,GAGzE,IAHuG,EA2BpBG,EAxB/C,IAAII,IAAoB,CAC1D,CACE,QACA,CACEI,MAAO,QACPzN,QAAS,CAAE0Q,UAAWiG,SAAOoK,WAAWjX,OACxC2E,OAAQ,CAAEjH,KAAM,QAAS+H,YAAa,GAAIG,WAAY,MAG1D,CACE,WACA,CACEjC,MAAO,OACPzN,QAAS,CAAE0Q,UAAWiG,SAAOoK,WAAWC,MACxCvS,OAAQ,CAAEjH,KAAM,cAKE,CAAEsC,MAAO,GAAI3J,SAAU,GAAI0F,KAAM,IACtC,CACjB4H,MAAOkJ,SAAOC,eAAe/G,OAC7BI,KAAM0G,SAAOC,eAAe3G,OAEtBG,EA3B+F,EA2B/FA,aAAcC,EA3BiF,EA2BjFA,QAASxC,EA3BwE,EA2BxEA,cAAegC,EA3ByD,EA2BzDA,OAAQ7B,EA3BiD,EA2BjDA,UAAWF,EA3BsC,EA2BtCA,cA3BsC,EAmCnEzN,IAAMW,SAAqB,CAC7D6E,KAAM,GACNG,SAAS,IArC4F,mBAmChGsc,EAnCgG,KAmCpFC,EAnCoF,KAwC/FZ,EAAY7U,EAAZ6U,QAiBR,IAzDuG,EA0D/DhL,SAAO6L,cAAvC3W,EA1D+F,EA0D/FA,QAASC,EA1DsF,EA0DtFA,QAASd,EA1D6E,EA0D7EA,UAsB1B,OApBE,0BAAM+B,UAAU,SAASwD,SAlB3B,SAAsBgL,GACpBA,EAAM3H,kBACFvD,GAAYiS,EAAWtc,SAI3BiZ,MAAIvI,cAAJ,2BAAuBtG,GAAvB,IAAqCvK,KAAMyc,EAAWzc,QACnD7D,MAAK,SAACkgB,GAEL,IAAMtD,EAAMvI,MAAIyC,iBAAiBoJ,GACjCP,EAAQzW,KAAK0T,MAEd1c,MAAM4L,KAOP,yBAAKf,UAAU,WAAWiB,EAAUO,IAAI,UACxC,yBAAKxB,UAAU,WAAWiB,EAAUO,IAAI,aACxC,yBAAKxB,UAAU,WACb,2BAAOsB,QAAQ,QAAf,QACA,kBAAC,GAAD,CACEpC,UAToB,GAUpB/F,OAAQqc,EACRrW,WAAY+S,MAAI/S,WAChBL,QAASA,EACTC,QAASA,EACTd,UAAWA,EACXkJ,oBAAqBrG,EACrByG,YAAa+B,MAAII,MAAM5Q,QAG3B,yBAAKkH,UAAU,WAAW8C,KC/EnB4S,GAAyD,SAAC3V,GACrE,OAAO4V,GAAS5V,IAGX,SAAS4V,GAAS5V,EAA4BzL,GACnD,IAAMshB,EAAW7V,EAAMiL,SAAS4K,SAChC,OACE,6BACE,yCACA,gDACoB,8BAAOA,IAE3B,kBAAC,EAAD,CAAcxW,aAAc9K,KCL3B,IAAMuhB,GAAqD,SAAC9V,GACjE,IAAM+V,EAASxM,MAAIyM,cAAchW,EAAMiL,UACjCxX,EAAKG,IACX,GAAI2V,MAAI0M,cAAcF,GACpB,OAAOH,GAAS5V,EAAO+V,EAAOxhB,OAJgE,IAMxF2hB,EAAsBH,EAAtBG,YAAanC,EAASgC,EAAThC,KACfoC,IAAY1iB,GAAMsgB,EAAKvR,KAAO/O,EAAG+O,GACvC,OAAQ0T,GACN,IAAK,UACL,UAAKxiB,EACH,OAAO,kBAAC,GAAD,iBAAiBsM,EAAjB,CAAwBwC,GAAIuR,EAAKvR,GAAIpB,KAAM2S,EAAK3S,KAAM+U,QAASA,KACxE,IAAK,eACH,OAAKA,EAGE,kBAAC,GAAD,iBAAsBnW,EAAtB,CAA6BwC,GAAIuR,EAAKvR,GAAIpB,KAAM2S,EAAK3S,KAAM+U,QAASA,KAFlEP,GAAS5V,EAAO,0CAG3B,IAAK,WACH,IAAM9M,EAAUqW,MAAI6M,sBAAsBpW,EAAMiL,UAChD,OAAI1B,MAAI0M,cAAc/iB,GACb0iB,GAAS5V,EAAO9M,EAAQqB,OAE1B,kBAAC,GAAD,iBAAkByL,EAAlB,CAAyB9M,QAASA,EAASijB,QAASA,KAC7D,QACE,OAAOP,GAAS5V,EAAO,4BASvBqW,GAAkD,SAACrW,GAAsB,IACrEwC,EAAsBxC,EAAtBwC,GAAIpB,EAAkBpB,EAAlBoB,KAAM+U,EAAYnW,EAAZmW,QACZf,EAAS7hB,IAAMqB,SAAqB,WACxC,MAAO,CAAE4N,KAAIpB,UACZ,CAACoB,EAAIpB,IAMR,OAAOwQ,GAJsC5d,EAAame,MAAImE,QAASlB,IAC1B,SAACjgB,GAAD,OA0CxC,SAAyBA,EAAoCqK,GAAsC,IAC1FuU,EAAS5e,EAAfd,KACFuW,EAAWR,GAAe2J,EAAM,CACpC/W,OAAO,EACPkG,KAAM,SACL0H,SACKqK,EAAsBlB,EAAtBkB,QAAShK,EAAa8I,EAAb9I,SACXsL,EAActB,EAAsB,yBAAKvI,wBAAyBC,iBAAOsI,UAAjDvhB,EACxB2b,EACJ,yBAAKpP,UAAU,wBACZ2K,EACD,yBAAK3K,UAAU,UACb,4BAAK8T,EAAK3S,MACT6J,EACC,uBAAGhL,UAAU,YACX,kBAAC,GAAD,CAAevJ,MAAM,KAAK0O,OAAO,OADnC,IAC4C6F,QAE1CvX,EACJ,yBAAKuM,UAAU,SACb,wCACCsW,KAKT,OAAOC,GAAqBzC,EAAM,UAAW1E,EAAS7P,EAAM2W,SAlE1DM,CAAgBthB,EAAS,CAAEghB,gBAKzBO,GAAuD,SAAC1W,GAAsB,IAC1EwC,EAA+BxC,EAA/BwC,GAAIpB,EAA2BpB,EAA3BoB,KAAM+U,EAAqBnW,EAArBmW,QAAStB,EAAY7U,EAAZ6U,QACrBO,EAAS7hB,IAAMqB,SAAqB,WACxC,MAAO,CAAE4N,KAAIpB,UACZ,CAACoB,EAAIpB,IAMR,OAAOwQ,GAJsC5d,EAAame,MAAImE,QAASlB,IAC1B,SAACjgB,GAAD,OAyDxC,SACLA,EACAqK,GACS,IACKuU,EAAS5e,EAAfd,KACFuW,EAAWR,GAAe2J,EAAM,CACpC/W,OAAO,EACPkG,KAAM,SACL0H,SAGGyE,EACJ,yBAAKpP,UAAU,yBACb,kBAAC,GAAD,CACE4U,QAASrV,EAAMqV,QACfzT,KAAM2S,EAAK3S,KACX6J,SAAU8I,EAAK9I,SACfgK,QAASlB,EAAKkB,QACdD,MAAOjB,EAAK4C,YAAa3B,MACzBG,OAAQpB,EAAKvR,GACboI,SAAUA,KAIhB,OAAO4L,GAAqBzC,EAAM,eAAgB1E,EAAS7P,EAAM2W,SAhF/DS,CAAiBzhB,EAAS,CAAEghB,UAAStB,gBAYnCgC,GAA2D,SAAC7W,GAA6B,MAEnDA,EAAM9M,QAAxC6gB,EAFqF,EAErFA,KAAMmC,EAF+E,EAE/EA,YAAajb,EAFkE,EAElEA,KAAM6b,EAF4D,EAE5DA,KACzBX,EAAYnW,EAAZmW,QACA3T,EAAauR,EAAbvR,GAAIpB,EAAS2S,EAAT3S,KACNlO,EAAUK,IAAMqB,SAAiC,WACrD,MAAO,CAAEmf,KAAM,CAAEvR,KAAIpB,QAAQ8U,cAAajb,OAAM6b,UAC/C,CAACtU,EAAIpB,EAAM8U,EAAajb,EAAM6b,IAMjC,OAAOlF,GAJ8C5d,EAAame,MAAI4E,gBAAiB7jB,IAClC,SAACiC,GAAD,OA6DhD,SAA0BA,EAA4CqK,GAAsC,IACnGwX,EAAa7hB,EAAnBd,KAgBR,IAAMgb,EAfN,WACE,IAAK2H,EAASC,UAAU7gB,OACtB,MAAO,CAAC,CAAE4C,QAAS,qEAA+C8B,IAAK,SAEzE,IAAMoc,EAAYF,EAASE,UAAUjc,MAAK,SAACpD,EAAGqD,GAAJ,OAAUrD,EAAEiD,IAAIM,cAAcF,EAAEJ,QAOpEsS,EAAmB,CAAEpU,QALzB,kBAAC,IAAMoJ,SAAP,KACE,sCAAQ4U,EAASE,UAAU9gB,OAA3B,YAAqCyT,SAAO+E,UAC5C,yBAAK3O,UAAU,QAAQiX,EAAUtf,IAAI+V,MAGC7S,IAAK,QACzC9H,EAAoBgkB,EAASC,UAAUrf,KAAI,SAACuQ,GAAD,OAAa2D,GAAqB3D,GAAS,MAC5F,MAAO,CAACiF,GAAO9R,OAAOtI,GAERmkB,GAEhB,SAASC,EAAerD,EAAmB9Y,GACzC,OAAOsO,MAAI8N,mBAAmB,CAAEtD,OAAMmC,YAAa,WAAYjb,SAEjE,IAAMqU,EAAmB,CACvBzS,KAAoC,IAA9Bma,EAASC,UAAU7gB,OAAe,YAAlC,UAAmD4gB,EAASC,UAAU7gB,OAAtE,aACNyZ,SAAkC,WAAxBmH,EAASM,MAAMrc,KAAoB,EAAI,EACjD0U,KAAM,CACJ,CAAE9S,KAAM,SAAU0K,KAAM6P,EAAeJ,EAAS7O,QAAS,WACzD,CAAEtL,KAAM,SAAU0K,KAAM6P,EAAeJ,EAAS7O,QAAS,aAI7D,OAAOqO,GAAqBQ,EAAS7O,QAAS,WAAYkH,EAAS7P,EAAM2W,QAAS7G,GA3FhFiI,CAAiBpiB,EAAS,CAAEghB,gBA+FhC,SAASK,GACPrO,EACA+N,EACA7G,EACA8G,EACA7G,GAEA,IAAMkI,EAAgBpN,GAAejC,EAAS,CAC5CnL,OAAO,EACPkG,KAAM,UACL0H,SACGwG,EACJ,kBAAC,IAAMhP,SAAP,KACE,4BAAK+F,EAAQ/G,MACZoW,GAMCC,EAAe,CACnBnG,QAAS,CACP/J,KAAMgC,MAAImO,kBAAkB,CAAE3D,KAAM5L,EAAS+N,YAAa,YAC1DrZ,KAAM,WAERwS,QAAS,8CAGLsI,EAAgB,CACpBrG,QAAS,CACP/J,KAAMgC,MAAImO,kBAAkB,CAAE3D,KAAM5L,EAAS+N,YAAa,iBAC1DrZ,KAAM,QAERwS,QAAS,6CACT+B,QAGI4F,EAAgB,CACpB1F,QAAS,CACP/J,KAAMgC,MAAImO,kBAAkB,CAAE3D,KAAM5L,EAAS+N,YAAa,aAC1DrZ,KAAM,YAERwS,QAAS,6CACTC,UACA8B,QA4BF,MAAO,CACLH,KAPiB,CACjBpB,SApBF,WACE,OAAQqG,GACN,IAAK,UAEH,OADAuB,EAAQpI,QAAUA,EACX,EACT,IAAK,eAIH,OAHI8G,IACFwB,EAAStI,QAAUA,GAEd,EACT,IAAK,WAEH,OADA2H,EAAS3H,QAAUA,EACZ8G,EAAU,EAAI,EACvB,QACE,MAAM,IAAI1V,MAAM,2BAGLmX,GAIf5a,MAAOmL,EAAQ/G,KACf8P,OAAQiF,EAAU,CAACsB,EAASE,EAAWX,GAAY,CAACS,EAAST,IAK7DtgB,MAAO,UCzPJ,IAAMmhB,GAA4D,SAAC7X,GAExE,IAAM9M,EAAUqW,MAAIuO,qBAAqB9X,EAAMiL,UAC/C,OAAI1B,MAAI0M,cAAc/iB,GACb0iB,GAAS5V,EAAO9M,EAAQqB,OAI1B,kBAAC,GAAD,CAAiB0G,KAAM/H,EAAQ+H,KAAM8c,SAAU7kB,EAAQ6kB,SAAUjB,KAAM5jB,EAAQ4jB,KAAMlkB,IAAKM,EAAQN,OAGrGolB,GAAmE,SAAChY,GAAmC,IACnG/E,EAA8B+E,EAA9B/E,KAAM8c,EAAwB/X,EAAxB+X,SAAUjB,EAAc9W,EAAd8W,KAAMlkB,EAAQoN,EAARpN,IACxBM,EAAkCK,IAAMqB,SAAQ,WACpD,MAAO,CAAEqG,OAAM8c,WAAUjB,OAAMlkB,SAC9B,CAACqI,EAAM8c,EAAUjB,EAAMlkB,IAE1B,OAAOgf,GAAQ5d,EAAame,MAAI8F,eAAgB/kB,GAAUglB,KAG5D,SAASA,GAAgB/iB,GAAoD,IACnEd,EAASc,EAATd,KACAijB,EAAqBjjB,EAArBijB,MAAOL,EAAc5iB,EAAd4iB,UACPkB,EAA4Cb,EAA5Ca,WAAYlL,EAAgCqK,EAAhCrK,OAAQC,EAAwBoK,EAAxBpK,SAAUjS,EAAcqc,EAAdrc,KAAMrI,EAAQ0kB,EAAR1kB,IACtCoK,EAASpK,EAAD,UAEE,WAATqI,EAAoB,SAAW,kBAFxB,aAE8CrI,EAAIkI,IAFlD,aAE0D+O,SAAOiF,cAFjE,cACHjF,SAAOiF,cAGZ2C,EAAWtI,GAAuBnM,EAgC1C,SAAsB7B,EAAeid,GAEnC,IAAM9K,EAAKnS,EAAMkd,WAAWhX,QAAQ,0BAA2B,OAAS,IAAM+W,EAAOE,cACrF,OAAiB,IAAVnd,GAA6C,MAA9Bid,EAAOA,EAAOhiB,OAAS,GAAakX,EAAGjX,UAAU,EAAGiX,EAAGlX,OAAS,GAAKkX,EAnC5CiL,CAAatL,EAAQpD,SAAOiF,cAAelc,EAAKqI,GAEzFsU,EACJ,kBAAC,IAAMnN,SAAP,KACE,yBAAKnC,UAAU,mBACb,yBAAKA,UAAU,QACZ+M,GAAgBmL,EAAYlL,EAAQC,GAAU,SAAC4J,GAAD,OAAUvN,MAAIQ,yBAAyB,CAAE+M,OAAM7b,OAAMrI,YAEtG,yBAAKqN,UAAU,QACZ2M,GACC,CAAC,GAAI,GAAI,IAAIhV,KAAI,SAACmV,GAChB,MAAO,CAAElQ,KAAM,GAAKkQ,EAAGA,SAEzB,SAACA,GAAD,OAAexD,MAAIQ,yBAAyB,CAAEgO,SAAUhL,EAAmBna,WAC3E,SAACma,GAAD,qBAAuBA,EAAvB,qBACAG,GACA,GAEF,0BAAMjN,UAAU,QAAhB,eAQR,MAAO,CACLgR,KAAM,CAAE5B,QAHM4H,EAAUrf,KAAI,SAACuQ,GAAD,OAAa2D,GAAqB3D,MAG7CnL,QAAOyU,WAAUlC,UAClC7Y,MAAO,UCvDJ,IAAM8hB,GAA2D,SAACxY,GACvE,IAAM+V,EAASxM,MAAIkP,oBAAoBzY,EAAMiL,UAC7C,OAAI1B,MAAI0M,cAAcF,GACbH,GAAS5V,EAAO+V,EAAOxhB,OAGzB,kBAAC,GAAD,CAAcmkB,WAAY3C,EAAO2C,WAAYzd,KAAM8a,EAAO9a,KAAM6b,KAAMf,EAAOe,QAGhF6B,GAA+D,SAAC3Y,GAAkC,IAC9F/E,EAA2B+E,EAA3B/E,KAAMyd,EAAqB1Y,EAArB0Y,WAAY5B,EAAS9W,EAAT8W,KACpB5jB,EAAiCK,IAAMqB,SAAQ,WACnD,MAAO,CACLqG,OACA6b,OACA4B,WAAY,CAAElW,GAAIkW,EAAWlW,GAAIpB,KAAMsX,EAAWtX,SAEnD,CAACnG,EAAMyd,EAAWlW,GAAIkW,EAAWtX,KAAM0V,IAE1C,OAAOlF,GAAQ5d,EAAame,MAAIyG,cAAe1lB,GAAU2lB,KAGpD,SAASA,GAAe1jB,GAAmD,IACxEd,EAAiBc,EAAjBd,KAAMoB,EAAWN,EAAXM,OACN+M,EAA2CnO,EAA3CmO,GAAIpB,EAAuC/M,EAAvC+M,KAAMrI,EAAiC1E,EAAjC0E,KAAMqU,EAA2B/Y,EAA3B+Y,MAAOkK,EAAoBjjB,EAApBijB,MAAOwB,EAAazkB,EAAbykB,SAC9B7L,EAAWqK,EAAXrK,OAEFqC,EAAgCrC,EAElC,CACEpQ,KAAiB,IAAXoQ,EAAe,WAAf,UAA+BA,EAA/B,YACN4C,SAA8B,WAApBxb,EAAKijB,MAAMrc,KAAoB,EAAI,EAC7C0U,KAAM,CACJ,CACE9S,KAAM,SACN0K,KAAMgC,MAAIwP,wBAAwB,CAChCL,WAAYrkB,EACZ4G,KAAM,YAGV,CACE4B,KAAM,SACN0K,KAAMgC,MAAIwP,wBAAwB,CAChCL,WAAYrkB,EACZ4G,KAAM,mBAhBdvH,EAsBE2b,EAAuB,GAC7BA,EAAQjR,KpBtCH,SAAyBvL,EAAuBkG,GACrD,OAAOyT,GAAW3Z,EAAS,EAAGkG,GoBqCjBigB,CAAgB5L,EAAOrU,IACpC+f,EAASra,SAAQ,SAAC5L,EAAS6E,GAAV,OAAoB2X,EAAQjR,KpBnCxC,SAAwBvL,EAAuB6E,GACpD,OAAO8U,GAAW3Z,EAAS6E,EAAQ,GoBkCeuhB,CAAepmB,EAAS6E,OAE1E,IAAM6X,EACJ+H,EAAMrK,OAASqK,EAAMpK,SACnB,yBAAKjN,UAAU,UACb,yBAAKA,UAAU,SACZ+M,GAAgBsK,EAAMa,WAAYb,EAAMrK,OAAQqK,EAAMpK,UAAU,SAAC4J,GAAD,OAC/DvN,MAAIwP,wBAAwB,CAC1BL,WAAYrkB,EACZyiB,OACA7b,KAAMqc,EAAMrc,iBAKlBvH,EAEAwlB,EAAa,kBAAC,GAAD,CAAkB/E,aAAc3R,EAAI/M,OAAQA,IAG/D,OAFA4Z,EAAQjR,KAAK,CAAEpF,QAASkgB,EAAYpe,IAAK,WAElC,CACLmW,KAAM,CAAE5B,UAASrS,MAAOoE,EAAMkO,UAASC,UACvC7Y,MAAO,QC7EJ,IAAM6e,GAA8D,SAACvV,GAQ1E,OAAO0R,GAJgB,CACrBT,KAAM,CAAE5B,QAHM,kBAAC,GAAD,CAAsBwF,QAAS7U,EAAM6U,UAGlC7X,MAFL6M,SAAOC,eAAe9M,OAGlCtG,MAAO,UCHEyiB,GAAqD,SAACnZ,GAEjE,IAAM9M,EAAUqW,MAAI6P,cAAcpZ,EAAMiL,UACxC,OAAI1B,MAAI0M,cAAc/iB,GACb0iB,GAAS5V,EAAO9M,EAAQqB,OAE1B,kBAAC,GAAD,CAAU0G,KAAM/H,EAAQ+H,KAAM8c,SAAU7kB,EAAQ6kB,SAAUjB,KAAM5jB,EAAQ4jB,QAG3EuC,GAAqD,SAACrZ,GAA4B,IAC9E/E,EAAyB+E,EAAzB/E,KAAM8c,EAAmB/X,EAAnB+X,SAAUjB,EAAS9W,EAAT8W,KAClB5jB,EAA2BK,IAAMqB,SAAQ,WAC7C,MAAO,CAAEqG,OAAM8c,WAAUjB,UACxB,CAAC7b,EAAM8c,EAAUjB,IAEpB,OAAOlF,GAAQ5d,EAAame,MAAIjI,QAAShX,GAAUomB,KAGrD,SAASA,GAASnkB,GAAoD,IAC5Dd,EAAkBc,EAAlBd,KAAMM,EAAYQ,EAAZR,QACN2iB,EAAqBjjB,EAArBijB,MAAOJ,EAAc7iB,EAAd6iB,UACTla,EAAQ6M,SAAO+E,QAIf2K,EACJ,yBAAKtZ,UAAU,UACb,kBAAC,GAAD,CAAgB6N,IAAKnZ,EAAS8N,YAAY,uBAC1C,kBAAC,EAAD,OAIEgP,EACJ,kBAAC,IAAMrP,SAAP,KACE,yBAAKnC,UAAU,YACb,4BAAKjD,IAEP,yBAAKiD,UAAU,qBACb,yBAAKA,UAAU,SAASsZ,GACxB,yBAAKtZ,UAAU,QACb,kBAAC,IAAD,CACEqJ,GAAIC,MAAIiQ,kBAAkB,CAAEve,KAAM,YAClCgF,UAA0B,YAAfqX,EAAMrc,KAAqB,gBAAavH,GAFrD,WAMA,kBAAC,IAAD,CACE4V,GAAIC,MAAIiQ,kBAAkB,CAAEve,KAAM,SAClCgF,UAA0B,SAAfqX,EAAMrc,KAAkB,gBAAavH,GAFlD,WAWF6b,EACJ,kBAAC,IAAMnN,SAAP,KACE,yBAAKnC,UAAU,mBACb,yBAAKA,UAAU,SACf,yBAAKA,UAAU,QACZ+M,GAAgBsK,EAAMa,WAAYb,EAAMrK,OAAQqK,EAAMpK,UAAU,SAAC4J,GAAD,OAC/DvN,MAAIiQ,kBAAkB,CAAE1C,OAAM7b,KAAMqc,EAAMrc,aAwCpD,MAAO,CACLgW,KAAM,CAAE5B,QARR,yBAAKpP,UAAU,YACZiX,EAAUtf,KAAI,SAACgW,GACd,OA5BN,SAAoBA,GAElB,IAAM9S,EAAM8S,EAAS9S,IACflI,EAAMoX,GAAW4D,GACjBzS,EAAQyS,EAASzS,MAAQ,0BAAM8E,UAAU,cAAhB,WAAqC2N,EAASzS,YAAgBzH,EACvFyU,EAAUyF,EAASzF,QAAU,yBAAKlI,UAAU,UAAU2N,EAASzF,cAAiBzU,EAChF+lB,EACJ,6BACE,kBAAC,IAAD,CAAMxZ,UAAU,YAAYqJ,GAAIC,MAAIG,cAAc,CAAE5O,SAApD,SAMJ,OACE,yBAAKmF,UAAU,WAAWnF,IAAKA,GAC5BlI,EACAuI,EACAgN,EACAsR,GASMC,CAAW9L,OAMQ5Q,QAAOyU,WAAUlC,UAC/C7Y,MAAO,QCxGJ,IAAMqQ,GAAoD,SAAC/G,GAChE,IAAMqJ,EAAOE,MAAIoQ,UAAU3Z,EAAMiL,UACjC,IAAK1B,MAAI0M,cAAc5M,GACrB,OAAO,kBAAC,GAAD,CAAOzW,IAAKyW,EAAKvO,IAAKhD,KAAK,OAAO+c,QAAS7U,EAAM6U,UAE1D,IAAM4E,EAAOlQ,MAAIqQ,UAAU5Z,EAAMiL,UACjC,OAAK1B,MAAI0M,cAAcwD,GAGhB7D,GAAS5V,GAFP,kBAAC,GAAD,CAAOpN,IAAK6mB,EAAK3e,IAAKhD,KAAK,OAAO+c,QAAS7U,EAAM6U,WAMtDgF,GAA6C,SAAC7Z,GAAuB,IACjEpN,EAAuBoN,EAAvBpN,IAAKkF,EAAkBkI,EAAlBlI,KAAM+c,EAAY7U,EAAZ6U,QAIb/Z,EAAiCvH,IAAMqB,SAAQ,WACnD,MAAO,CAAEkG,IAAKlI,EAAKkF,UAClB,CAAClF,EAAKkF,IAIT,OAAO8Z,GAAQ5d,EAAame,MAAIjK,OAAQpN,IAFQ,SAAC3F,GAAD,OAMlD,SAAiBA,EAAuCqK,GAA0B,IACxEnL,EAASc,EAATd,KACAyD,EAAS0H,EAAT1H,KAEFkF,EAAiB,SAATlF,EAAA,gCAA2CzD,EAAKyG,IAAhD,sBAAmEzG,EAAKyG,IAAxE,KAER2W,EAAoB,SAAT3Z,OAAkBpE,EAAYyV,GAAuBnM,EAAO,WAAY3I,EAAM,QAiC/F,MAJuB,CACrB4c,KAAM,CAAE5B,QANC,SAATvX,EACE,kBAAC,GAAD,CAAalF,IAAKyB,EAAKyG,IAAK+Z,QAASrV,EAAMqV,QAAS1M,QAAS9T,EAAK8T,QAAS9U,SAAUgB,EAAKhB,WAvB9F,WACE,IAAM8U,EAAU9T,EAAK8T,QAAU9T,EAAK8T,QAAU,+CACxC9U,EAAWgB,EAAKhB,SACpB,yBAAKqZ,wBAAyBC,iBAAOtY,EAAKhB,YAE1C,yBAAK4M,UAAU,gBAAgB,oDAE3BI,EAAehM,EAAK8T,SAAa9T,EAAKhB,SAAW,gBAAkB,kBACzE,OACE,yBAAK4M,UAAU,YACb,yBAAKA,UAAU,WAAWkI,GACzB9U,EACD,yBAAK4M,UAAU,QACb,kBAAC,IAAD,CAAMqJ,GAAIC,MAAIG,cAAcrV,GAAO4L,UAAU,cAC1CI,KAWPyZ,GAGe9c,QAAOyU,YACxB/a,MAAO,QA1CPqjB,CAAQ5kB,EAAS,CAAE2C,OAAM+c,gBC7BtB,IAAMQ,GAAiC,WAG5C,OAAO3D,GADgB,CAAET,KAAM,CAAE5B,QADjB,kBAAC,GAAD,MAC0BrS,MAAO,SAAWtG,MAAO,UCAxDsjB,GAAmC,WAC9C,OAAOpI,GAAQ9d,EAAYqe,MAAI8H,YAAaC,KAG9C,SAASA,GAAY/kB,GAAgD,IAC3Dd,EAASc,EAATd,KACFgb,EAAuB,GAgB7Bhb,EAAK8lB,OAAO1b,SAAQ,SAAC5G,GAAD,OAAOwX,EAAQjR,KCvB9B,SAAyB+J,GAC9B,IAAMZ,EAAOgC,MAAI6Q,YAAYjS,GAS7B,MAAO,CAAEnP,QAPP,kBAAC,IAAMoJ,SAAP,KACE,4BACE,kBAAC,IAAD,CAASkH,GAAI/B,GAAOY,EAAQ/G,OAE9B,yBAAKsL,wBAAyBC,iBAAOxE,EAAQA,YAG/BrN,IAAKyM,GDaiB8S,CAAgBxiB,OAExD,IAAMyiB,EACJ,kBAAC,IAAMlY,SAAP,KACE,wCACA,yBAAKnC,UAAU,YACZ5L,EAAK0E,KAAKnB,KAAI,SAAChF,GACd,IAAMyc,EE5BT,SAAuBlH,GAC5B,IAAMZ,EAAOgC,MAAIU,UAAU9B,GACrBxH,EAAQwH,EAAQnL,MAAMqE,QAAQ,IAJzB,QAMX,MAAO,CAAErI,QADO,kBAAC,IAAD,CAASsQ,GAAI/B,GAAO5G,GAClB7F,IAAKyM,GFwBCgT,CAAc3nB,GAQ9B,OAAO,0BAAMkI,IAAKuU,EAAQvU,KAAMuU,EAAQrW,cAQhD,OAFAqW,EAAQjR,KAAK,CAAEpF,QAASshB,EAAUxf,IAAK,YAEhC,CAAEmW,KAAM,CAAEjU,MAAO,WAAYqS,WAAW3Y,MAAO,UG5CjD,IAAM8jB,GAAsD,SAACxa,GAClE,IAAM+V,EAASxM,MAAIkR,QAAQza,EAAMiL,UACjC,OAAI1B,MAAI0M,cAAcF,GACbH,GAAS5V,EAAO+V,EAAOxhB,OAOzB,kBAAC,GAAD,CAASiO,GAAIuT,EAAOvT,GAAIpB,KAAM2U,EAAO3U,QAGxCsZ,GAAgD,SAAC1a,GAAuB,IAIpEwC,EAAaxC,EAAbwC,GAAIpB,EAASpB,EAAToB,KACNgU,EAAS7hB,IAAMqB,SAAqB,WACxC,MAAO,CAAE4N,KAAIpB,UACZ,CAACoB,EAAIpB,IAER,OAAOwQ,GAAQ5d,EAAame,MAAIwI,SAAUvF,GAASwF,KAGrD,SAASA,GAAUzlB,GAA8C,IACvDd,EAASc,EAATd,KACF8lB,EACJ,yBAAKla,UAAU,gBACb,yBAAKuK,IAAKnW,EAAKwmB,MAAMrQ,IAAKpF,OAAQ/Q,EAAKwmB,MAAMzV,OAAQ1O,MAAOrC,EAAKwmB,MAAMnkB,MAAOiU,IAAI,MAGhFsF,EAAS5b,EAAKymB,OAEhB,CACE9hB,QAAS+hB,GAAa1mB,EAAKymB,OAAQ,GACnCpkB,MAAOrC,EAAK2mB,YACZnK,gBAAiB,cACjBD,SAAS,QALXld,EAOJ,MAAO,CACLud,KAAM,CAAE5B,QAAS8K,EAAQnd,MAAO3I,EAAK+M,MACrC1K,MAAO,OACPuZ,SAOJ,SAASgL,GAAkBxM,GACzB,IAAMlM,EAASkM,EAAMlM,OACf2Y,EAAuB3Y,EAAO4Y,aAAa,QAC3CC,EAAmB7Y,EAAO6Y,QAChCpM,MAAM,mCAAD,OAAoCoM,EAAU,OAAS,OAAvD,iBAAsEF,EAAtE,kBAaP,SAASH,GAAaD,EAA0BO,GAC9C,IAAMpb,EAAsB,IAAVob,EAAc,oBAAiB3nB,EAC3C4nB,EAAYR,EAAOljB,KAAI,SAACub,GAC5B,IAxBiBoI,EAwBXL,GAxBWK,EAwBSpI,GAvBf+H,MAAQK,EAAML,MAAQK,EAAMna,KAAKkX,cAAcjX,QAAQ,IAAK,OAAOA,QAAQ,IAAK,KAwB3F,OACE,wBAAIvG,IAAKogB,EAAOjb,UAAWkT,EAAKrN,SAAW,cAAWpS,GAf5D,SAAoByf,EAAsB+H,GAExC,OACE,+BACE,2BAAOxgB,KAAK,WAAW8gB,gBAAgB,EAAMnZ,SAAU4Y,GAAmB7Z,KAAM8Z,IAC/E/H,EAAK/R,MAWHqa,CAAWtI,EAAM+H,GACjB/H,EAAKrN,UAAYiV,GAAa5H,EAAKrN,SAAUuV,EAAQ,OAI5D,OAAO,wBAAIpb,UAAWA,GAAYqb,GCxEpC,IAgBMI,GAAqC,WAEzC,OACE,kBAAC,IAAMtZ,SAAP,KACE,kBAAC,GAAD,MACA,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAmBuZ,OAAK,EAACC,KAAK,SAASC,UAAWC,KAClD,kBAAC,IAAD,CAAmBH,OAAK,EAACC,KAAK,IAAIC,UAAWC,KAC7C,kBAAC,IAAD,CAAmBH,OAAK,EAACC,KAAK,QAAQC,UAAWC,KACjD,kBAAC,IAAD,CAAmBH,OAAK,EAACC,KAAMjN,QAAMM,MAAO4M,UAAWC,KACvD,kBAAC,IAAD,CAAmBH,OAAK,EAACC,KAAMjN,QAAMoN,QAASF,UAAWC,KACzD,kBAAC,IAAD,CAAmBH,OAAK,EAACC,KAAMjN,QAAME,YAAagN,UAAWC,KAC7D,kBAAC,IAAD,CAAmBH,OAAK,EAACC,KAAMjN,QAAM/E,cAAeiS,UAAWC,KAC/D,kBAAC,IAAD,CAAmBH,OAAK,EAACC,KAAMjN,QAAMI,MAAO8M,UAAWC,KACvD,kBAAC,IAAD,CAAmBH,OAAK,EAACC,KAAMjN,QAAM5V,KAAM8iB,UAAWC,KACtD,kBAAC,IAAD,CAAmBF,KAAMjN,QAAMqN,kBAAmBH,UAAWC,KAC7D,kBAAC,IAAD,CAAmBF,KAAMjN,QAAMI,MAAO8M,UAAWC,KACjD,kBAAC,IAAD,CAAmBF,KAAMjN,QAAMwL,OAAQ0B,UAAWC,KAClD,kBAAC,IAAD,CAAmBF,KAAMjN,QAAME,YAAagN,UAAWC,KACvD,kBAAC,IAAD,CAAmBF,KAAMjN,QAAM5V,KAAM8iB,UAAWC,KAChD,kBAAC,IAAD,CAAmBD,UAAWC,QAMvBG,GA1CsB,WAAM,M3DYpC,WAGL,IAAMC,EAAYrS,SAAOqS,UAAYvpB,2BAAce,EACnD,OAAOH,IAAMW,SAAagoB,G2DdNC,GAFqB,mBAElC1oB,EAFkC,KAE9BE,EAF8B,KAOzC,OAHA8J,SAAST,MAAT,UAAoB6M,SAAOsF,SAIzB,kBAAC7b,EAAW8oB,SAAZ,CAAqBnmB,MAAO,CAAExC,KAAIE,UAChC,kBAAC,IAAD,CAA2B0oB,SAAUC,SACnC,kBAAC,GAAD,SCXYC,QACW,cAA7Bva,OAAOiJ,SAASuR,UAEe,UAA7Bxa,OAAOiJ,SAASuR,UAEhBxa,OAAOiJ,SAASuR,SAASC,MAAM,2DCXnCC,IAASC,OAAO,kBAAC,GAAD,MAASlf,SAASyL,eAAe,SDyH3C,kBAAmB0T,WACrBA,UAAUC,cAAcC,MAAM5nB,MAAK,SAAC6nB,GAClCA,EAAaC,iB,keEjInB,gBACI,EAAJ,MAEA,SAgCA,0BAA+B,EAAuB,EAAkB,GACpE,MAAK,CAAE,KAAM,WAAY,OAAM,EAAE,SAAQ,EAAE,OAAM,IAGrD,6BAAkC,GAC9B,IAAI,EAAU,EAAO,QAAU,EAAO,QAAU,GAC5C,EAAW,EAAO,SAAW,EAAO,SAAW,GAEnD,MAAK,CACL,KAAM,WACN,OAH4B,CAAE,MAAO,EAAO,MAAO,QAAO,EAAE,SAAQ,GAIpE,SAAU,EAAO,SACjB,OAAQ,EAAO,SAInB,wBAA6B,EAAa,EAAkB,GAM1D,MAAO,CAAE,KAAM,WAAY,OALG,CAC5B,MAAO,gBAAc,GACrB,QAAS,GACT,SAAU,IAEuB,SAAQ,EAAE,OAAM,IAGrD,2BAAgC,GACtB,iBAAU,WACZ,EAAM,aAAW,EAAO,OAAO,OACnC,OAAF,OAAY,EAAO,QAAM,CAAE,SAAQ,EAAE,OAAM,EAAE,IAAG,KASlD,yBAA8B,EAAsB,EAAkB,GAClE,MAAK,CAAE,KAAM,UAAW,OAAM,EAAE,SAAQ,EAAE,OAAM,IAOpD,0BAA+B,GACrB,iBAAU,WACZ,WAAE,SAAM,UAGR,EATR,SAAa,GACX,OAAO,EAAO,WAAW,OAAO,OAAO,GAAO,OAAO,OAQhC,CAAI,EAAM,OAAO,qBAStC,MAAO,CAAE,OAAM,EAAE,KARM,CACjB,OACA,MAAC,EACD,SAAI,EACR,aAAY,EACZ,QAAS,GACT,WAAY,MAWhB,iCAAsC,EAA8B,EAAkB,GAClF,MAAK,CAAE,KAAM,kBAAmB,OAAM,EAAE,SAAQ,EAAE,OAAM,IAG5D,mCAAwC,EAAoB,GACxD,IAAI,EAAW,EAAO,QAAQ,SAAW,EAAO,QAAQ,SAAW,GAC/D,EAAU,EAAO,QAAQ,QAAU,EAAO,QAAQ,QAAU,GAOhE,MAAK,CAAE,KAAM,kBAAmB,OANG,CACnC,KAAM,EAAO,KACb,MAAO,EAAO,MACd,SAAQ,EACR,QAAO,GAEiC,SAAU,EAAO,SAAU,OAAM,IAG7E,kCAAuC,GAErC,MAAO,CAAE,OADD,SACS,OADD,WAalB,+BACE,EACA,EACA,EAEA,EAEA,GAEA,MAAO,CACL,KAAM,gBACN,OAAM,EACN,SAAQ,EACR,OAAM,EACN,aAAY,EACZ,UAAS,IAIb,gCAAqC,GAC3B,iBAAU,WAAQ,iBAAc,cAClC,WAAE,UAAO,aAGb,MAAK,CAAE,OADc,CAAE,GAAI,EAAc,KAAM,GAChC,KAHQ,OAGF,MAFI,CAAE,SAAQ,EAAE,OAAM,EAAE,UAAS,EAAE,SAAQ,KAcpE,4BACE,EACA,EACA,EAEA,EAEA,GAEA,MAAO,CACL,KAAM,aACN,OAAM,EACN,SAAQ,EACR,OAAM,EACN,UAAS,EACT,aAAY,IAIhB,6BAAkC,GACxB,iBAAU,WAGlB,MAAO,CAAE,aAHiB,eAGH,QADM,CAAE,SAAQ,EAAE,OAAM,EAAE,UAFT,YAEoB,SADpD,qBAaV,6BACE,EACA,EACA,EAEA,GAEA,MAAO,CAAE,KAAM,cAAe,OAAM,EAAE,SAAQ,EAAE,OAAM,EAAE,IAAG,IAG7D,8BAAmC,GAEjC,MAAO,CAAE,IADD,MACM,OADD,WAUf,2BAAgC,GAC9B,OAAQ,EAAO,MACb,IAAK,UACH,OAAO,EACT,IAAK,kBACH,OAAO,EACT,IAAK,WACH,OAAO,EACT,IAAK,gBACH,OAAO,EACT,IAAK,aACH,OAAO,EACT,IAAK,cACH,OAAO,EACT,QACE,MAAM,IAAI,MAAM,qB,6I/E/OtB,U,kKgFUA,U,gCCiBA,SAAS,EAAgB,GAErB,IAAI,EAAkC,IAAI,IAAyB,EAAM,MAAM,KAAI,SAAC,GAAS,OAAC,EAAK,GAAN,OAgB/F,OAduC,EAAM,YAAY,KAAI,SAAC,GACxD,MAAG,CACL,GAAI,EAAK,GACT,KAAM,EAAK,KACX,KAAM,EAAK,KACX,eAAgB,CACd,YAAa,EAAM,IAAI,EAAK,QAC5B,cAAe,EAAK,cACpB,SAAU,EAAK,UAEjB,SAAU,EAAK,a,iDAarB,6BAAkC,GAChC,IAAM,EAAY,EAAgB,GAClC,MAAO,CAAE,MAAO,EAAM,MAAO,UAAS,IAqBxC,4BAAiC,GAC/B,IAAM,EAAkC,IAAI,IAAyB,EAAM,MAAM,KAAI,SAAC,GAAS,OAAC,EAAK,GAAN,OAEvF,OAAI,SAAM,SAAM,UAAO,UAAO,aAEtC,SAAS,EAAc,GACrB,MAAO,CACL,YAAa,EAAM,IAAI,EAAK,QAC5B,SAAU,EAAK,SACf,SAAU,EAAK,UAInB,MAAO,CACL,GAAE,EACF,KAAI,EACJ,KAAI,EACJ,MAAO,EAAc,GACrB,MAAO,EACP,SAAU,EAAS,IAAI,KAa3B,8BAAmC,GACjC,IAAM,EAAY,EAAgB,GAC5B,EAAuB,EAAM,MAAM,GACnC,EAAQ,EAAM,MACpB,MAAO,CAAE,QAAO,EAAE,UAAS,EAAE,UAAW,EAAM,UAAW,MAAK,K,yTCpGhE,IAAM,EAAoB,CAAE,aAAc,QACpC,EAA4B,CAChC,aAAc,OACd,MAAO,CAAC,KAAM,SAEV,EAAgC,CACpC,aAAc,OACd,MAAO,CAAC,OAAQ,KAAM,SAIlB,EAA6B,CAC/BC,aAAY,QACZC,MAAK,CAAC,KAAM,SAGV,EAA0B,CAAE,aAAc,cAC1C,EAAkC,CACtC,aAAc,aACd,MAAO,CAAC,KAAM,SAGV,EAAsB,CAAE,aAAc,WAEtC,EAAsB,CAAE,aAAc,MAAO,KAAM,OACnD,EAAmB,CAAE,aAAc,OAKnC,EAAsC,CAC1C,aAAc,aACd,MAAO,CAAC,SAAU,QAEd,EAA4B,CAChC,aAAc,MACd,MAAO,CAAC,MAAO,SAEX,EAA4B,CAChC,aAAc,MACd,MAAO,CAAC,MAAO,SAEX,EAA2B,CAAE,aAAc,MAAO,MAAO,CAAC,QAG1D,EAAoB,CAAE,aAAc,SACpC,EAA4B,CAAE,aAAc,aAAc,KAAM,OAChE,EAA6B,CACjC,aAAc,aACZ,MAAK,CAAC,KAAM,SAAU,WAEpB,EAAmC,CACvC,aAAc,OACd,MAAO,CAAC,OAAQ,OAclB,SAAS,EAAU,GACf,OAAM1K,GACF,IAAC,MACD,IAAC,OACD,IAAC,SACD,IAAC,OACD,IAAC,SACD,IAAC,SACD,IAAC,MACH,OAAO,EACT,QACE,OAAO,GAsFb,SAAS,EAAS,GACd,IAAI,GAAc,EAClB,MAAmB,kBAAP,EAAkB,OAAK,EAIvC,SAAgB,EAAQ,GAEtB,OAAO,EACJ,QAAQ,mBAAoB,IAC5B,QAAQ,KAAM,KACd,oBAGL,SAAS,EAA2B,EAAkB,EAAS,GACrD,qBAAc,UAChB,EAAe,GAYnB,OAXF,EAAG,KAAK,EAAQ,IAChB,EAAM,SAAQ,SAAC,GACb,GAAI,EAAU,GACZ,EAAG,KAAK,OACH,CACL,IAAM,EAAe,EACf,EAAQ,GAAK,EAAK,GAClB,EAAe,SAAR,EAAmC,SAAjB,EAA0B,mBAAmB,GAAS,EAAQ,GAAU,EACvG,EAAG,KAAK,OAGL,IAAM,EAAG,KAAK,MAAQ,EAAU,EAAQ,SAAW,IAG5D,SAAS,EAAQ,EAAc,GACrB,qBAAc,SAChB,EAAe,GAKnB,OAJA,EAAC,KAAK,EAAQ,IACZ,GACF,EAAG,KAAK,GAEH,IAAM,EAAG,KAAK,MAAQ,EAAU,EAAQ,SAAW,IAhC5D,YAyCA,iBAEI,SAAF,EAAY,GACV,KAAK,MAAQ,EAUf,OARA,2BAAM,GACJ,IAAM,EAAQ,KAAK,MAAM,MAAK,SAAC,GAAM,SAAE,KAAF,KACrC,OAAS,EAAQ,EAAM,QAAK,GAE9B,2BAAM,GACJ,IAAM,EAAQ,KAAK,MAAM,MAAK,SAAC,GAAM,SAAE,KAAF,KACrC,OAAS,EAAQ,EAAM,QAAK,GAEhC,EAbA,GAeM,EAAgB,IAAI,EAA4B,CACpD,CAAC,UAAW,WACZ,CAAC,QAAS,SACV,CAAC,aAAc,eACf,CAAC,OAAQ,SACT,CAAC,QAAS,UACV,CAAC,MAAO,UAGV,SAAS,EAAQ,GACb,IAAI,EAAO,EAAc,MAAM,GAC/B,IAAG,EACH,MAAM,IAAI,MAAM,4BAA4B,EAAY,KAE1D,OAAO,EAGT,2BAAgC,GAE9B,OAD2B,IAAI,EAAS,GACxB,mBAiBlB,uBAA4B,GACxB,GAAa,MAAX,EAAI,GAKN,MAAM,IAAI,MAAM,kCAGhB,IAAI,EAAY,EAAI,QAAQ,MACX,IAAf,IACE,EAAE,EAAI,UAAU,EAAG,IAGvB,IAAI,EAAa,EAAI,QAAQ,KACzB,GAAwB,IAAhB,EAAoB,EAAI,UAAU,GAAc,GAK5D,OAJkB,IAAhB,IACF,EAAM,EAAI,UAAU,EAAG,IAGlB,CAAE,SAAU,EAAK,OAAQ,IAUlC,iBAII,SAAF,EAAY,GAEE,IAAI,EAAR,WAAU,WACd,MAAwB,MAAd,EAAO,GACb,UAAI,MAAM,qCAEd,GAAgB,MAAhB,EAAS,GACL,UAAI,MAAM,uCAElB,KAAK,SAA+B,IAApB,EAAS,OAAe,GAAK,EAAS,UAAU,GAAG,MAAM,KACzE,KAAK,QAAU,IAAI,EAAQ,GAyB7B,OAtBE,EAAF,4BAA2B,GACzB,OAhNJ,SAAS,EAAyB,EAAoB,GAC5C,qBAAc,UACpB,GAAG,EAAS,QAAU,EAAS,KAAO,EAAQ,GAA9C,CAGA,GAAE,EAAS,SAAW,EAAI,EAAM,OAAhC,CAeA,IADA,IAAE,EAAK,GACA,EAAe,EAAG,EAAY,EAAG,EAAe,EAAS,SAAU,IAAgB,EAAW,CACjG,IAAE,EAAO,EAAM,GACb,EAAU,EAAS,GACrB,KAAU,IAEN,GAAF,IAAY,EACN,YAOZ,OADqB,GAEnB,IAAK,KACH,IAAM,EAAK,EAAS,GACpB,IAAK,EACH,OAEF,EAAE,OAAQ,GAAE,CAAE,GAAE,IAChB,MACF,IAAK,OACHlF,EAAK,EAAH,KAAQ,GAAE,CAAE,KAAM,IACpB,MACF,IAAK,MACH,EAAE,OAAQ,GAAE,CAAE,IAAK,IACnB,MACF,QACE,QAGJ,OAAK,EA5CD,KAAM,QAAsC,SAA5B,EAAM,EAAM,OAAS,IAAiB,EAAS,SAAW,EAAM,OAAQ,CACpF,IAIA,EAAQ,EAAO,EAJI,CACvB,aAAY,EACZ,MAAO,EAAM,MAAM,EAAG,EAAM,OAAS,KAGvC,GAAI,EACF,cAAY,GAAK,CAAE,KAAM,OAkMtB,CAAO,KAAK,SAAU,IAG7B,EAAF,4BAAS,GACH,OAAG,KAAK,QAAQ,IAAI,IAGxB,EAAF,2BAAQ,GACF,OAlKR,SAAe,EAAwB,GAC7B,qBAAc,SACpB,SAAG,EAAa,QAAU,EAAa,KAAO,EAAQ,MAGxB,IAAxB,EAAa,SAAiB,GAAkC,IAAxB,EAAa,QAAgB,EAAa,KAAO,GA6JxF,CAAM,KAAK,SAAU,IAG5B,EAAF,qCACE,IAAK,KAAK,SAAS,OACjB,MAAO,UAET,IAAM,EAAe,EAAc,MAAM,KAAK,SAAS,IACvD,OAAK,GACI,CAAE,MAAO,4BAA4B,KAAK,SAAS,GAAE,MAIlE,EAvCA,GAqDA,SAAgB,EAAc,GAC1B,YAAmC,IAA7B,EAAmB,MAD7B,kBAIA,IAAM,EAAmC,CAAE,MAAO,mBAQlD,aAGE,WAAY,GACV,GAAI,GAAY,EAAS,OAAQ,CAC/B,IAAM,EAAQ,EAAS,OAAO,UAAU,GAAG,MAAM,KACjD,KAAK,OAAS,EACX,QAAO,SAAC,GAAM,SAAE,OAAF,KACd,KAAI,SAAC,GACJ,IAAM,EAAQ,EAAE,MAAM,KACtB,OAAO,EAAM,OAAS,EAAI,CAAC,EAAM,GAAI,EAAM,IAAM,CAAC,EAAM,QAAI,WAGhE,KAAK,OAAS,GAmBlB,OAfE,EAAF,uBAAI,GACE,IAAE,EAAQ,KAAK,OAAO,MAAK,SAAC,GAAM,SAAE,KAAF,KACtC,OAAS,EAAQ,EAAM,QAAK,GAE5B,EAAF,wBAAK,EAAc,GACjB,IAAK,EACH,MAAM,IAAI,MAAM,qCAElB,KAAK,OAAO,KAAK,CAAC,EAAM,KAE1B,8BACE,OAAQ,KAAK,OAAO,OAEhB,IAAM,KAAK,OAAO,KAAI,SAAC,GAAS,OAAC,EAAK,GAAK,EAAK,GAAK,IAAM,EAAK,GAAK,EAArC,MAA+C,KAAK,KADpF,IAGR,EAhCA,GAsCM,EAAe,IAAI,EAA2B,CAClD,CAAC,UAAW,WACZ,CAAC,WAAY,cA0Bf,SAAgB,EAAc,GAC5B,IAAM,EAAW,IAAI,EAAS,GAC1B,EAA2B,EAAS,SAAS,GAC/C,GAAE,EACF,MAAO,CAAE,KAAI,EAAE,YAAa,gBAG5B,KADA,EAAK,EAAS,SAAS,IAEvB,OAAO,EAEP,IAAI,EAAM,EAAS,SAAS,OAC5B,IAAG,EACC,MAAG,CAAE,KAAI,GAEf,IAAM,EAAuC,EAAa,MAAM,GAChE,OAAK,EAGE,CAAE,KAAI,EAAE,YAAW,GAFjB,CAAE,MAAO,wBAzBpB,mBAAwB,GAEtB,OADiB,IAAI,EAAS,GACd,QAAQ,IAG1B,yBACE,OAAO,EAAQ,IAGjB,kBAqBA,iCAAsC,GAClC,IAAI,EAAc,EAAc,GAChC,GAAE,EAAc,GAChB,OAAO,EAED,aAAM,gBACZ,GAAkB,aAAhB,EACE,MAAG,CAAE,MAAO,wBAUZ,MARJ,SAA0B,GAC1B,IAAM,EAAO,EAAQ,IAAI,QACnB,EAAO,EAAQ,IAAI,QACzB,MAAO,CACL,KAAM,EAAO,EAAe,MAAM,QAAQ,EAC1C,KAAM,EAAO,EAAS,QAAQ,GAG5B,WACN,MAAO,CAAE,KAAI,EAAE,KADP,OACa,YAAW,EAAE,KADpB,SAIhB,sBAA2B,GACzB,OAAO,EAAS,EAAW,IAG7B,6BAAkC,GAChC,GAA4B,iBAAxB,EAAQ,YACV,OAAO,EAAS,EAAe,EAAQ,MAEvC,IAAI,EAAmB,IAAI,EAI3B,OAHE,EAAQ,aACV,EAAQ,KAAK,MAAO,EAAa,MAAM,EAAQ,cAE1C,EAAS,EAAW,EAAQ,KAAM,IAG3C,8BAAmC,GAC/B,IAAI,EAAmB,IAAI,EAQ3B,OAPF,EAAQ,KAAK,MAAO,EAAa,MAAM,aACnC,EAAQ,MACV,EAAQ,KAAK,OAAQ,EAAe,MAAM,EAAQ,OAEhD,EAAQ,MACV,EAAQ,KAAK,OAAQ,GAAK,EAAQ,MAE7B,EAAS,EAAW,EAAQ,KAAM,IAO3C,mBAAwB,GACpB,IACI,EADW,IAAI,EAAS,GACa,SAAS,GACpD,OAAO,GAAgB,GAGzB,uBAA4B,GACxB,OAAK,EAAS,EAAY,IAS9B,IAAM,EAAW,IAAI,EAAwB,CAC3C,CAAC,UAAW,WACZ,CAAC,OAAQ,UAiEX,SAAgB,EAAwB,GACtC,OAAO,EAAS,EAAwB,GAzD1C,yBAA8B,GAC1B,IAAI,EAAW,IAAI,EAAS,GAC5B,IAAG,EAAS,QAAQ,GAChB,OAAG,EAEP,IAAI,EAAO,EAAS,SAAS,QACzB,EAAO,EAAS,SAAS,QAC7B,MAAK,CACL,KAAM,EAAO,EAAS,MAAM,QAAQ,EACpC,SAAU,GACV,KAAM,EAAO,EAAS,QAAQ,IAIlC,qBAA0B,GAEtB,OADe,IAAI,EAAS,GACd,QAAQ,IAG1B,6BAAkC,GAC9B,IAAI,EAAO,OAAqB,GAAM,CAAE,SAAU,KAC9C,EAAmB,IAAI,EAQ3B,OAPE,EAAQ,MACV,EAAQ,KAAK,OAAQ,EAAS,MAAM,EAAQ,OAE1C,EAAQ,MACV,EAAQ,KAAK,OAAQ,GAAK,EAAQ,MAEpC,EAAQ,KAAK,WAAY,GAAK,EAAQ,UAC/B,EAAQ,EAAW,IAO5B,2BACI,OAAK,EAAQ,IAEjB,wBACI,OAAK,EAAQ,IAEjB5a,EAAQ,UAAR,SAA0B,GACxB,OAAO,EAAwB,IAGjCA,EAAQ,cAAR,SAA8B,GAC5B,OAAO,EAAS,EAAc,IAEhC,yBAA8B,GAC1B,OAAK,EAAS,EAAc,IAEhC,wBAA6B,GACzB,OAAK,EAAS,EAAa,IAG/B,4BAQAA,EAAQ,UAAR,SAA0B,GACxB,IACM,EADqB,IAAI,EAAS,GACnB,SAAS,GAC9B,OAAO,GAAY,GAGrB,qBAA0B,GACxB,IACM,EADqB,IAAI,EAAS,GACnB,SAAS,GAC9B,OAAO,GAAY,GAGrBA,EAAQ,SAAR,SAAyB,GACvB,IACM,EADqB,IAAI,EAAS,GACnB,SAAS,GAC9B,OAAO,GAAY,GAUrB,IAAM,EAAkB,IAAI,EAA+B,CACzD,CAAC,SAAU,UACX,CAAC,SAAU,YAGP,EAAY,IAAI,EAAwB,CAC5C,CAAC,GAAI,MACL,CAAC,GAAI,MACL,CAAC,GAAI,QAUP,gCAAqC,GACjC,IAAI0E,EAAW,IAAI+lB,EAASlS,GACxB,EAAM,EAAS,SAAS,GACxB,EAA+B,MAAtB,EAAS,SACxB,IAAK,IAAQ,EAAS,QAAQ,KAAsB,EAClD,OAAO,EAET,IAAM,EAAO,EAAS,SAAS,QACzB,EAAW,EAAS,SAAS,YAC7B,EAAO,EAAS,SAAS,QAC7B,MAAK,CACL,KAAM,EAAO,EAAgB,MAAM,QAAQ,EAC3C,SAAU,EAAW,EAAU,MAAM,QAAY,EACjD,KAAM,EAAO,EAAS,QAAQ,EAC9B,IAAK,IAIT,oCAAyC,GACvC,IAAM,EAAmB,IAAI,EAU7B,OATI,EAAQ,MACV,EAAQ,KAAK,OAAQ,EAAgB,MAAM,EAAQ,OAEjD,EAAQ,UACV,EAAQ,KAAK,WAAY,GAAK,EAAQ,UAEpC,EAAQ,MACV,EAAQ,KAAK,OAAQ,GAAK,EAAQ,MAE5B,EAAQ,IAA2C,EAAS,EAAwB,EAAQ,IAAK,GAAnF,EAAQ,EAAkB,IASlD,IAAM,EAAiB,IAAI,EAA8B,CACvD,CAAC,SAAU,UACX,CAAC,SAAU,YASb,+BAAoC,GAClC,IAAM,EAAW,IAAI,EAAS,GACxB,EAAiC,EAAS,SAAS,GACzD,IAAK,EACH,OAAO,EAGT,IAAM,EAAO,EAAS,SAAS,QACzB,EAAO,EAAS,SAAS,QAC/B,MAAO,CACL,WAAU,EACV,KAAM,EAAO,EAAe,MAAM,QAAQ,EAC1C,KAAM,EAAO,EAAS,QAAQ,IAIlC,4BAAiC,GAC/B,OAAO,EAAS,EAAiB,IAGnC,mCAAwC,GACtC,IAAM,EAAU,IAAI,EAOpB,OANI,EAAQ,MACV,EAAQ,KAAK,OAAQ,EAAe,MAAM,EAAQ,OAEhD,EAAQ,MACV,EAAQ,KAAK,OAAQ,GAAK,EAAQ,MAE7B,EAAS,EAAiB,EAAQ,WAAY,IAOvD,2BACE,OAAO,EAAQ,IAWjB,0BACE,OAAO,QAAM,OAGf,kCACE,OAAO,QAAM,eAGf,4BAAiC,GAC/B,OAAO,EAAS,EAAgB,CAAE,GAAI,KAGxC,kCAAuC,GACrC,OAAO,EAAS,EAAsB,CAAE,GAAI,KAG9C,8BAAmC,GACjC,OAAO,EAAS,EAAc,CAAE,IAAK,KAGvC,mBAAwB,GAEtB,OAD2B,IAAI,EAAS,GACxB,QAAQ,IAG1B,2BAAgC,GAE9B,OAD2B,IAAI,EAAS,GACxB,QAAQ,IAG1B,uBAA4B,GAC1B,IACM,EADqB,IAAI,EAAS,GACjB,SAAS,GAChC,OAAO,EAAQ,EAAM,QAAK,GAG5B,6BAAkC,GAChC,IACM,EADqB,IAAI,EAAS,GACjB,SAAS,GAChC,OAAO,EAAQ,EAAM,QAAK,GAG5B,yBAA8B,GAC5B,IACM,EADqB,IAAI,EAAS,GACjB,SAAS,GAChC,OAAO,EAAQ,EAAM,SAAM,GAOhB,QAAQ,CACnB,MAAO,EAAQ,GACf,QAAS,EAAQ,GACjB,YAAa,EAAQ,GACrB,kBAAmB,EApvBkB,CACrC,aAAc,aACZ,KAAI,WAmvBN,MAAO,EAAQ,GACf,OAAQ,EAtwBiB,CAAE,aAAc,UAuwBzC,cAAe,EAAQ,GACvB,KAAM,EAAQ,K,iFlF/xBhB,YAAS,wBACT,aAAS,yB,iFADT,aAAS,0BAAY,4BAAa,0B","file":"static/js/main.8087a0c9.chunk.js","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar routes_1 = require(\"./routes\");\r\nexports.routeOnGet = routes_1.routeOnGet;\r\nexports.routeOnPost = routes_1.routeOnPost;\r\nexports.loginUser = routes_1.loginUser;\r\n//# sourceMappingURL=index.js.map","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar server_types_1 = require(\"server-types\");\r\n// export function getTagText(title: string) {\r\n//   // preserve only alphanumeric and whitespace and hyphen, then convert all whitespace, then toLower\r\n//   return slugify(title);\r\n// }\r\nfunction getMapKey(tagId) {\r\n    return server_types_1.isTag(tagId) ? tagId.tag : tagId.id + \" \" + tagId.resourceType;\r\n}\r\nfunction getTagKey(key, images) {\r\n    if (!key.includes(\" \")) {\r\n        return key;\r\n    }\r\n    // do the reverse of what `add(tagId: TagId)` did, above\r\n    var split = key.split(\" \");\r\n    var id = +split[0];\r\n    if (!id) {\r\n        // shouldn't happen\r\n        console.error(\"TagIdCounts.read -- unexpected key \\\"\" + key + \"\\\"\");\r\n    }\r\n    else {\r\n        var resourceType = split[1];\r\n        switch (resourceType) {\r\n            case \"Image\":\r\n                var foundImage = images.find(function (idName) { return idName.id === id; });\r\n                if (!foundImage) {\r\n                    // shouldn't happen -- was the image deleted or something?\r\n                    console.error(\"TagIdCounts.read -- image not found \\\"\" + key + \"\\\"\");\r\n                    break;\r\n                }\r\n                key = server_types_1.getTagText(foundImage.name);\r\n                break;\r\n            default:\r\n                // shouldn't happen -- are we meant to be implementing support for using another resourceType as a TagId?\r\n                console.error(\"TagIdCounts.read -- unexpected resourceType \\\"\" + key + \"\\\"\");\r\n                break;\r\n        }\r\n    }\r\n    return key;\r\n}\r\n// this class mimics a Map<TagId, TValue>\r\nvar TagIdMap = /** @class */ (function () {\r\n    function TagIdMap(images) {\r\n        this.map = new Map();\r\n        this.images = images;\r\n    }\r\n    TagIdMap.prototype.get = function (key) {\r\n        return this.map.get(key);\r\n    };\r\n    TagIdMap.prototype.set = function (key, value) {\r\n        this.map.set(key, value);\r\n    };\r\n    TagIdMap.prototype.has = function (key) {\r\n        return this.map.has(key);\r\n    };\r\n    TagIdMap.prototype.getKeyPairs = function () {\r\n        var _this = this;\r\n        var rc = [];\r\n        this.map.forEach(function (value, key) {\r\n            key = getTagKey(key, _this.images);\r\n            rc.push({ key: key, value: value });\r\n        });\r\n        return rc;\r\n    };\r\n    return TagIdMap;\r\n}());\r\nvar TagIdCounts = /** @class */ (function (_super) {\r\n    __extends(TagIdCounts, _super);\r\n    function TagIdCounts() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    TagIdCounts.prototype.add = function (tagId) {\r\n        // if this has a resource type then convert it to a string with an internal space (which a key can't have)\r\n        var key = getMapKey(tagId);\r\n        var count = _super.prototype.get.call(this, key);\r\n        _super.prototype.set.call(this, key, count ? count + 1 : 1);\r\n    };\r\n    TagIdCounts.prototype.read = function () {\r\n        var rc = _super.prototype.getKeyPairs.call(this);\r\n        return rc.map(function (o) {\r\n            return { key: o.key, count: o.value };\r\n        });\r\n    };\r\n    return TagIdCounts;\r\n}(TagIdMap));\r\nexports.TagIdCounts = TagIdCounts;\r\nvar TagIdDiscussions = /** @class */ (function (_super) {\r\n    __extends(TagIdDiscussions, _super);\r\n    function TagIdDiscussions(allImages, allTags) {\r\n        var _this = _super.call(this, allImages) || this;\r\n        _this.allTags = allTags;\r\n        _this.allImages = allImages;\r\n        _this.imageKeys = new Map();\r\n        _this.imageKeyIds = new Map();\r\n        // if images are pre-loaded then pre-load the corresponding tagId\r\n        for (var _i = 0, allImages_1 = allImages; _i < allImages_1.length; _i++) {\r\n            var image = allImages_1[_i];\r\n            var tagId = { id: image.id, resourceType: \"Image\" };\r\n            if (!_this.addTagId(tagId)) {\r\n                throw new Error(\"duplicate image\");\r\n            }\r\n            var key = server_types_1.getTagText(image.name);\r\n            _this.imageKeys.set(image.id, key);\r\n            _this.imageKeyIds.set(key, image.id);\r\n        }\r\n        return _this;\r\n    }\r\n    TagIdDiscussions.prototype.addTagId = function (tagId) {\r\n        var key = getMapKey(tagId);\r\n        if (_super.prototype.has.call(this, key)) {\r\n            return false;\r\n        }\r\n        _super.prototype.set.call(this, key, []);\r\n        return true;\r\n    };\r\n    TagIdDiscussions.prototype.addTag = function (tag) {\r\n        var tagId = { tag: tag };\r\n        return this.addTagId(tagId);\r\n    };\r\n    TagIdDiscussions.prototype.find = function (tag) {\r\n        var id = this.imageKeyIds.get(tag);\r\n        var tagId = id ? { id: id, resourceType: \"Image\" } : { tag: tag };\r\n        var key = getMapKey(tagId);\r\n        if (!_super.prototype.has.call(this, key)) {\r\n            return undefined;\r\n        }\r\n        return tagId;\r\n    };\r\n    // called from postNewDiscussion which has already verified that this TagId can be found\r\n    TagIdDiscussions.prototype.addDiscussionId = function (tagId, discussionId) {\r\n        var key = getMapKey(tagId);\r\n        _super.prototype.get.call(this, key).push(discussionId);\r\n    };\r\n    // called from getSiteMap which only wants tags (it sends images separately)\r\n    TagIdDiscussions.prototype.siteTagCounts = function () {\r\n        var _this = this;\r\n        return this.allTags.map(function (tag) {\r\n            var title = tag.title, key = tag.key, summary = tag.summary;\r\n            var count = _super.prototype.get.call(_this, getMapKey({ tag: key })).length;\r\n            return { title: title, key: key, summary: summary, count: count };\r\n        });\r\n    };\r\n    // called from getAllTags which wants tags and images\r\n    TagIdDiscussions.prototype.tagCounts = function () {\r\n        var _this = this;\r\n        // same as siteTagCounts() except no title\r\n        return this.allTags\r\n            .map(function (tag) {\r\n            var key = tag.key, summary = tag.summary;\r\n            var count = _super.prototype.get.call(_this, getMapKey({ tag: key })).length;\r\n            return { key: key, summary: summary, count: count };\r\n        })\r\n            .concat(this.allImages.map(function (image) {\r\n            var summary = image.summary, id = image.id;\r\n            var tagId = { id: id, resourceType: \"Image\" };\r\n            var count = _super.prototype.get.call(_this, getMapKey(tagId)).length;\r\n            var key = _this.getKey(tagId).key;\r\n            return { key: key, summary: summary, count: count };\r\n        }));\r\n    };\r\n    // called from various places\r\n    // assumes the images exist but doesn't assume a tag exists\r\n    // assumes that any TagId is valid i.e. that corresponding image exists\r\n    TagIdDiscussions.prototype.getKey = function (tagId) {\r\n        var key = server_types_1.isTag(tagId) ? tagId.tag : this.imageKeys.get(tagId.id);\r\n        return { key: key };\r\n    };\r\n    return TagIdDiscussions;\r\n}(TagIdMap));\r\nexports.TagIdDiscussions = TagIdDiscussions;\r\n// https://titlecaseconverter.com/rules/\r\nvar titleCase = [\r\n    \"at\",\r\n    \"by\",\r\n    \"in\",\r\n    \"of\",\r\n    \"on\",\r\n    \"up\",\r\n    \"to\",\r\n    \"but\",\r\n    \"for\",\r\n    \"off\",\r\n    \"out\",\r\n    \"via\",\r\n    \"for\",\r\n    \"and\",\r\n    \"nor\",\r\n    \"but\",\r\n    \"or\",\r\n    \"yet\",\r\n    \"so\",\r\n];\r\n// used when auto-adding a tag\r\nfunction simulateTitle(tag) {\r\n    var words = tag.split(\"-\");\r\n    for (var i = 0; i < words.length; ++i) {\r\n        var word = words[i];\r\n        if (!titleCase.includes(word)) {\r\n            words[i] = word.substring(0, 1).toLocaleUpperCase() + word.substring(1);\r\n        }\r\n    }\r\n    return words.join(\" \");\r\n}\r\nexports.simulateTitle = simulateTitle;\r\n//# sourceMappingURL=tagIds.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.tagSummaryLength = { min: 20, max: 460 };\r\n//# sourceMappingURL=tag.js.map","\"use strict\";\r\n/*\r\n  These are interfaces are used between the client API and the server but not seen by the UI\r\n*/\r\nfunction __export(m) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__export(require(\"./wire\"));\r\n//# sourceMappingURL=index.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.config = {\r\n    serverless: true,\r\n    loginfails: false,\r\n    autologin: true,\r\n    appname: \"Prototype\",\r\n    mockdelay: 25,\r\n    exerptlength: 200,\r\n    strQuestions: \"Questions\",\r\n    strTags: \"Tags\",\r\n    strNewQuestion: {\r\n        title: \"Ask a question\",\r\n        button: \"Ask Question\",\r\n        noun: \"question\",\r\n    },\r\n    tagValidation: {\r\n        minimum: true,\r\n        maximum: true,\r\n        canNewTag: false,\r\n    },\r\n    minLengths: {\r\n        title: 15,\r\n        body: 30,\r\n    },\r\n};\r\n//# sourceMappingURL=config.js.map","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar server_mock_1 = require(\"server-mock\");\r\nvar shared_lib_1 = require(\"shared-lib\");\r\n// you could temporarily change this to enable logging, for debugging\r\nvar isLogging = false;\r\nfunction get(url, body) {\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\r\n    var init = {};\r\n    if (body) {\r\n        init.method = \"POST\";\r\n        init.body = JSON.stringify(body);\r\n        init.headers = {\r\n            \"Content-Type\": \"application/json\",\r\n        };\r\n    }\r\n    if (!shared_lib_1.config.serverless) {\r\n        return fetch(url, init);\r\n    }\r\n    else {\r\n        return server_mock_1.mockFetch(url, init.method, init.body);\r\n    }\r\n}\r\n// https://stackoverflow.com/questions/41103360/how-to-use-fetch-in-typescript\r\nfunction getT(url, body) {\r\n    if (isLogging) {\r\n        console.log(\"getT(\" + url + \")\");\r\n    }\r\n    return get(url, body).then(function (response) {\r\n        if (!response.ok) {\r\n            throw new Error(response.statusText);\r\n        }\r\n        return response.json();\r\n    });\r\n}\r\n/*\r\n  function to get data\r\n*/\r\nfunction getSiteMap() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, getT(shared_lib_1.Url.getSiteMapUrl())];\r\n        });\r\n    });\r\n}\r\nexports.getSiteMap = getSiteMap;\r\nfunction getImage(image) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, getT(shared_lib_1.Url.getImageUrl(image))];\r\n        });\r\n    });\r\n}\r\nexports.getImage = getImage;\r\nfunction getUsers() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, getT(shared_lib_1.Url.getUsersUrl())];\r\n        });\r\n    });\r\n}\r\nexports.getUsers = getUsers;\r\nfunction getUser(user) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, getT(shared_lib_1.Url.getUserUrl(user))];\r\n        });\r\n    });\r\n}\r\nexports.getUser = getUser;\r\nfunction convertPromise(promise, convert) {\r\n    var rc = new Promise(function (resolve, reject) {\r\n        promise.then(function (wire) {\r\n            var wanted = convert(wire);\r\n            resolve(wanted);\r\n        });\r\n        promise.catch(function (error) {\r\n            reject(error);\r\n        });\r\n    });\r\n    return rc;\r\n}\r\nfunction getUserActivity(options) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var url, wirePromise;\r\n        return __generator(this, function (_a) {\r\n            url = shared_lib_1.Url.getUserActivityUrl(options);\r\n            wirePromise = getT(url);\r\n            return [2 /*return*/, convertPromise(wirePromise, shared_lib_1.Message.unwireUserActivity)];\r\n        });\r\n    });\r\n}\r\nexports.getUserActivity = getUserActivity;\r\nfunction getDiscussions(options) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var url, wirePromise;\r\n        return __generator(this, function (_a) {\r\n            url = shared_lib_1.Url.getDiscussionsOptionsUrl(options);\r\n            wirePromise = getT(url);\r\n            return [2 /*return*/, convertPromise(wirePromise, shared_lib_1.Message.unwireDiscussions)];\r\n        });\r\n    });\r\n}\r\nexports.getDiscussions = getDiscussions;\r\nfunction getDiscussion(options) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var url, wirePromise;\r\n        return __generator(this, function (_a) {\r\n            url = shared_lib_1.Url.getDiscussionOptionsUrl(options);\r\n            wirePromise = getT(url);\r\n            return [2 /*return*/, convertPromise(wirePromise, shared_lib_1.Message.unwireDiscussion)];\r\n        });\r\n    });\r\n}\r\nexports.getDiscussion = getDiscussion;\r\nfunction getAllTags() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, getT(shared_lib_1.Url.getAllTagsUrl())];\r\n        });\r\n    });\r\n}\r\nexports.getAllTags = getAllTags;\r\nfunction getTags(options, data) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var url;\r\n        return __generator(this, function (_a) {\r\n            url = shared_lib_1.Url.getTagsOptionsUrl(options);\r\n            return [2 /*return*/, getT(url, data)];\r\n        });\r\n    });\r\n}\r\nexports.getTags = getTags;\r\nfunction getTag(tag) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var url;\r\n        return __generator(this, function (_a) {\r\n            url = shared_lib_1.Url.getTagKeyUrl(tag);\r\n            return [2 /*return*/, getT(url)];\r\n        });\r\n    });\r\n}\r\nexports.getTag = getTag;\r\n/*\r\n  function to post data\r\n*/\r\nfunction login(data) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, getT(shared_lib_1.Url.postLoginUrl(), data)];\r\n        });\r\n    });\r\n}\r\nexports.login = login;\r\nfunction newMessage(discussionId, data) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, getT(shared_lib_1.Url.postNewAnswerUrl(discussionId), data)];\r\n        });\r\n    });\r\n}\r\nexports.newMessage = newMessage;\r\nfunction newDiscussion(data) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, getT(shared_lib_1.Url.postNewDiscussionUrl(), data)];\r\n        });\r\n    });\r\n}\r\nexports.newDiscussion = newDiscussion;\r\nfunction editUserProfile(userId, data) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, getT(shared_lib_1.Url.postEditUserProfileUrl(userId), data)];\r\n        });\r\n    });\r\n}\r\nexports.editUserProfile = editUserProfile;\r\nfunction editTagInfo(tag, data) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, getT(shared_lib_1.Url.postEditTagInfoUrl(tag), data)];\r\n        });\r\n    });\r\n}\r\nexports.editTagInfo = editTagInfo;\r\n/*\r\n  function to get markdown\r\n\r\n  it's difficult to import markdown into the server\r\n\r\n  for example `import home from \"../server_data/home.md\";` seem to work\r\n\r\n  this comment involves a babel macro which might work ...\r\n\r\n  https://github.com/facebook/create-react-app/issues/3722#issuecomment-458124126\r\n\r\n  ... but instead the following uses fetch to read the file from the public directory.\r\n*/\r\nfunction getPublic(filename) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var headers, init, promise, result;\r\n        return __generator(this, function (_a) {\r\n            headers = new Headers();\r\n            headers.append(\"Accept\", \"application/json\");\r\n            headers.append(\"pragma\", \"no-cache\");\r\n            headers.append(\"cache-control\", \"no-cache\");\r\n            init = {\r\n                headers: headers,\r\n            };\r\n            promise = fetch(filename, init);\r\n            result = new Promise(function (resolve, reject) {\r\n                promise\r\n                    .then(function (response) {\r\n                    if (!response.ok) {\r\n                        var error = new Error(response.status + \" \" + response.statusText);\r\n                        error.url = filename;\r\n                        console.error(error.message);\r\n                        reject(error);\r\n                    }\r\n                    response.text().then(function (text) {\r\n                        // console.log(text);\r\n                        resolve(text);\r\n                    });\r\n                })\r\n                    .catch(function (reason) {\r\n                    console.error(reason.error);\r\n                    reject(reason);\r\n                });\r\n            });\r\n            return [2 /*return*/, result];\r\n        });\r\n    });\r\n}\r\nexports.getPublic = getPublic;\r\n//# sourceMappingURL=api.js.map","\"use strict\";\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result[\"default\"] = mod;\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar shared_lib_1 = require(\"shared-lib\");\r\nvar Action = __importStar(require(\"./actions\"));\r\nvar DB = __importStar(require(\"./database\"));\r\nvar Session = __importStar(require(\"./session\"));\r\n/*\r\n  This unwraps and dispatches data received from the client.\r\n\r\n  It should do this more carefully than it does currently,\r\n  using typeguards which assert the existence of every element of the received data,\r\n  and/or it should be wrapped in try/catch handlers,\r\n  e.g. in case malformed data is received from a corrupt client.\r\n*/\r\n// you could temporarily change this to enable logging, for debugging\r\nvar isLogging = true;\r\nfunction routeOnGet(url, userIdLogin) {\r\n    if (isLogging) {\r\n        console.log(\"server routeOnGet \" + url);\r\n    }\r\n    // parse the URL\r\n    var location = shared_lib_1.Url.getLocation(url);\r\n    var resourceType = shared_lib_1.Url.getResourceType(location);\r\n    if (shared_lib_1.Url.isParserError(resourceType)) {\r\n        // should return 400 Bad Request\r\n        return undefined;\r\n    }\r\n    switch (resourceType) {\r\n        case \"SiteMap\":\r\n            return DB.getSiteMap();\r\n        // case \"Login\":\r\n        //   return DB.getSiteMap();\r\n        case \"Image\": {\r\n            var image = shared_lib_1.Url.isImage(location);\r\n            if (shared_lib_1.Url.isParserError(image)) {\r\n                // should return 400 Bad Request\r\n                return undefined;\r\n            }\r\n            return DB.getImage(image.id);\r\n        }\r\n        case \"User\": {\r\n            if (shared_lib_1.Url.isUsers(location)) {\r\n                return DB.getUserSummaries();\r\n            }\r\n            var userOptions = shared_lib_1.Url.isUserOptions(location);\r\n            if (shared_lib_1.Url.isParserError(userOptions)) {\r\n                // should return 404 Not Found\r\n                return undefined;\r\n            }\r\n            var user = userOptions.user, userTabType = userOptions.userTabType;\r\n            switch (userTabType) {\r\n                case \"Profile\":\r\n                case \"EditSettings\":\r\n                case undefined:\r\n                    return DB.getUser(user.id, userIdLogin);\r\n                case \"Activity\":\r\n                    // the UserActivityOptions also carries DiscussionsOptions\r\n                    var userActivity = shared_lib_1.Url.isUserActivityOptions(location);\r\n                    if (shared_lib_1.Url.isParserError(userActivity)) {\r\n                        // should return 400 Bad Request\r\n                        return undefined;\r\n                    }\r\n                    return DB.getUserActivity(userActivity);\r\n                default:\r\n                    // should return 500 Internal Server Error\r\n                    return undefined;\r\n            }\r\n        }\r\n        case \"Discussion\": {\r\n            {\r\n                var options = shared_lib_1.Url.isDiscussionsOptions(location);\r\n                if (!shared_lib_1.Url.isParserError(options)) {\r\n                    Session.getSetDiscussionsOptions(userIdLogin, options);\r\n                    return DB.getDiscussions(options);\r\n                }\r\n                // else maybe a specific discussion\r\n            }\r\n            {\r\n                var options = shared_lib_1.Url.isDiscussionOptions(location);\r\n                if (!shared_lib_1.Url.isParserError(options)) {\r\n                    Session.getSetDiscussionOptions(userIdLogin, options);\r\n                    var discussion = DB.getDiscussion(options);\r\n                    if (!discussion) {\r\n                        // should return 404 Not Found\r\n                        return undefined;\r\n                    }\r\n                    return discussion;\r\n                }\r\n            }\r\n            // should return 400 Bad Request\r\n            return undefined;\r\n        }\r\n        case \"Tag\": {\r\n            if (shared_lib_1.Url.isAllTags(location)) {\r\n                return DB.getAllTags();\r\n            }\r\n            var options = shared_lib_1.Url.isTagsOptions(location);\r\n            if (!shared_lib_1.Url.isParserError(options)) {\r\n                return DB.getTags(options);\r\n            }\r\n            var key = shared_lib_1.Url.isTagKey(location);\r\n            if (!shared_lib_1.Url.isParserError(key)) {\r\n                return DB.getTag(key);\r\n            }\r\n            // should return 400 Bad Request\r\n            return undefined;\r\n        }\r\n        default:\r\n            return undefined;\r\n    }\r\n}\r\nexports.routeOnGet = routeOnGet;\r\n// this is a mock function to be improved\r\nfunction loginUser() {\r\n    var _a = DB.getUser(1, 1), id = _a.id, name = _a.name, gravatarHash = _a.gravatarHash, location = _a.location;\r\n    return { id: id, name: name, gravatarHash: gravatarHash, location: location };\r\n}\r\nexports.loginUser = loginUser;\r\nfunction routeOnPost(url, userId, json) {\r\n    if (isLogging) {\r\n        console.log(\"server routeOnPost \" + url + \" -- \" + JSON.stringify(json, undefined, 2));\r\n    }\r\n    // parse the URL\r\n    var location = shared_lib_1.Url.getLocation(url);\r\n    var resourceType = shared_lib_1.Url.getResourceType(location);\r\n    if (shared_lib_1.Url.isParserError(resourceType)) {\r\n        // should return 400 Bad Request\r\n        return undefined;\r\n    }\r\n    var dateTime = new Date().toUTCString();\r\n    // convert from resource: Resource plus json: any to Action.Any\r\n    function getAction(resourceType) {\r\n        switch (resourceType) {\r\n            case \"Discussion\": {\r\n                // new answer\r\n                {\r\n                    // get the discussionId from the URL\r\n                    var discussionId = shared_lib_1.Url.isNewAnswer(location);\r\n                    if (discussionId) {\r\n                        // and other input data\r\n                        var posted = json;\r\n                        var messageId = DB.messageIdNext();\r\n                        // construct the action\r\n                        return Action.createNewMessage(posted, dateTime, userId, discussionId, messageId);\r\n                    }\r\n                }\r\n                // new discussion\r\n                if (shared_lib_1.Url.isNewDiscussion(location)) {\r\n                    var posted = json;\r\n                    var discussionId = DB.discussionIdNext();\r\n                    var messageId = DB.messageIdNext();\r\n                    return Action.createNewDiscussion(posted, dateTime, userId, discussionId, messageId);\r\n                }\r\n                return { error: \"Unexpected Discussion post\" };\r\n            }\r\n            case \"User\": {\r\n                // edit settings\r\n                {\r\n                    // get the userId from the URL\r\n                    var urlUserId = shared_lib_1.Url.isEditUserProfile(location);\r\n                    if (urlUserId) {\r\n                        if (userId !== urlUserId) {\r\n                            // should return 403 Forbidden\r\n                            return { error: \"Expected user to edit their own settings only\" };\r\n                        }\r\n                        var posted = json;\r\n                        return Action.createEditUserProfile(posted, dateTime, userId);\r\n                    }\r\n                }\r\n                return { error: \"Unexpected User post\" };\r\n            }\r\n            case \"Tag\": {\r\n                var tag = shared_lib_1.Url.isEditTagInfo(location);\r\n                if (tag) {\r\n                    var posted = json;\r\n                    return Action.createEditTagInfo(posted, dateTime, userId, tag);\r\n                }\r\n                return { error: \"Unexpected Tag post\" };\r\n            }\r\n            default:\r\n                return { error: \"Unexpected resource type\" };\r\n        }\r\n    }\r\n    // handle things which are implemented as a POST because they include JSON body data\r\n    // but which aren't a type of action which updates the database data\r\n    switch (resourceType) {\r\n        case \"Login\":\r\n            return loginUser();\r\n        case \"Tag\":\r\n            var options = shared_lib_1.Url.isTagsOptions(location);\r\n            if (!shared_lib_1.Url.isParserError(options)) {\r\n                return DB.getTags(options, json.searchInput);\r\n            }\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n    var action = getAction(resourceType);\r\n    if (shared_lib_1.Url.isParserError(action)) {\r\n        // should return 400 Bad Request\r\n        console.log(action.error);\r\n        return undefined;\r\n    }\r\n    return DB.handleAction(action);\r\n}\r\nexports.routeOnPost = routeOnPost;\r\n//# sourceMappingURL=routes.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar shared_lib_1 = require(\"shared-lib\");\r\nfunction isTag(tag) {\r\n    return tag.tag !== undefined;\r\n}\r\nexports.isTag = isTag;\r\nfunction getTagText(title) {\r\n    // preserve only alphanumeric and whitespace and hyphen, then convert all whitespace, then toLower\r\n    return shared_lib_1.Url.slugify(title);\r\n}\r\nexports.getTagText = getTagText;\r\n//# sourceMappingURL=bare.js.map","\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result[\"default\"] = mod;\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar server_types_1 = require(\"server-types\");\r\nvar Action = __importStar(require(\"./actions\"));\r\nvar configServer_1 = require(\"./configServer\");\r\nvar currentIds_1 = require(\"./currentIds\");\r\nvar exerpt_1 = require(\"./exerpt\");\r\nvar loader_1 = require(\"./loader\");\r\nvar tagIds_1 = require(\"./tagIds\");\r\n/*\r\n  This is an in-RAM database\r\n  or its API wraps an external database.\r\n*/\r\n/*\r\n  Data -- not exported\r\n*/\r\nvar allImages = loader_1.loadImages();\r\nvar allUsers = new Map();\r\nvar allTags = [];\r\nvar allDiscussions = new Map();\r\n// these are both an array of [discussionId, time]\r\nvar sortedDiscussionsNewest = [];\r\nvar sortedDiscussionsActive = [];\r\n// map userId to sorted array of messages\r\nvar userMessages = new Map();\r\n// map messageId to discussionId\r\nvar messageDiscussions = new Map();\r\nvar userTags = new Map();\r\n// map key to array of discussionId\r\nvar tagDiscussions = new tagIds_1.TagIdDiscussions(allImages, allTags);\r\nvar currentIds = new currentIds_1.CurrentIds();\r\n/*\r\n  helper functions\r\n*/\r\nvar getKeyFromTagId = function (tagId) { return tagDiscussions.getKey(tagId); };\r\nfunction messageIdNext() {\r\n    return currentIds.messageId.next();\r\n}\r\nexports.messageIdNext = messageIdNext;\r\nfunction discussionIdNext() {\r\n    return currentIds.discussionId.next();\r\n}\r\nexports.discussionIdNext = discussionIdNext;\r\nfunction getMessageTime(message) {\r\n    return new Date(message.dateTime).getTime();\r\n}\r\nfunction getUserSummaryFrom(userId, data) {\r\n    return {\r\n        id: userId,\r\n        name: data.name,\r\n        gravatarHash: data.gravatarHash,\r\n        location: data.profile.location,\r\n    };\r\n}\r\nfunction getUserSummary(userId) {\r\n    return getUserSummaryFrom(userId, allUsers.get(userId));\r\n}\r\nfunction getMessageStarted(discussion) {\r\n    return discussion.first;\r\n}\r\nfunction getMessageEnded(discussion) {\r\n    return discussion.messages.length ? discussion.messages[discussion.messages.length - 1] : discussion.first;\r\n}\r\nfunction getDiscussionTime(discussion, getMessage) {\r\n    return [discussion.id, getMessageTime(getMessage(discussion))];\r\n}\r\nfunction wireSummaries(discussionMessages) {\r\n    var rc = {\r\n        users: [],\r\n        discussions: [],\r\n    };\r\n    var userIds = new Set();\r\n    discussionMessages.forEach(function (discussionMessage) {\r\n        var discussion = discussionMessage[0], message = discussionMessage[1];\r\n        var id = discussion.id, name = discussion.name, tags = discussion.tags;\r\n        userIds.add(message.userId);\r\n        rc.discussions.push({\r\n            id: id,\r\n            name: name,\r\n            tags: tags.map(getKeyFromTagId),\r\n            userId: message.userId,\r\n            messageExerpt: exerpt_1.getExerpt(message.markdown),\r\n            dateTime: message.dateTime,\r\n            nAnswers: discussion.messages.length,\r\n        });\r\n    });\r\n    userIds.forEach(function (userId) { return rc.users.push(getUserSummary(userId)); });\r\n    return rc;\r\n}\r\nfunction wireDiscussion(discussion, messages, range) {\r\n    var id = discussion.id, name = discussion.name, tags = discussion.tags, first = discussion.first;\r\n    var rc = {\r\n        users: [],\r\n        id: id,\r\n        name: name,\r\n        tags: tags.map(getKeyFromTagId),\r\n        first: first,\r\n        range: range,\r\n        messages: messages,\r\n    };\r\n    var userIds = new Set();\r\n    userIds.add(discussion.first.userId);\r\n    messages.forEach(function (message) { return userIds.add(message.userId); });\r\n    userIds.add(rc.first.userId);\r\n    userIds.forEach(function (userId) { return rc.users.push(getUserSummary(userId)); });\r\n    return rc;\r\n}\r\nfunction getRange(nTotal, sort, pageSize, pageNumber, array) {\r\n    var length = pageSize;\r\n    var start = (pageNumber - 1) * pageSize;\r\n    var selected = array.slice(start, start + length);\r\n    return { range: { nTotal: nTotal, sort: sort, pageSize: pageSize, pageNumber: pageNumber }, selected: selected };\r\n}\r\n/*\r\n  GET functions\r\n*/\r\nfunction getSiteMap() {\r\n    return {\r\n        images: allImages,\r\n        tags: tagDiscussions.siteTagCounts(),\r\n    };\r\n}\r\nexports.getSiteMap = getSiteMap;\r\nfunction getImage(id) {\r\n    return allImages.find(function (image) { return image.id === id; });\r\n}\r\nexports.getImage = getImage;\r\nfunction getUserSummaries() {\r\n    var rc = [];\r\n    allUsers.forEach(function (data, userId) { return rc.push(getUserSummaryFrom(userId, data)); });\r\n    return rc.sort(function (x, y) { return x.name.localeCompare(y.name); });\r\n}\r\nexports.getUserSummaries = getUserSummaries;\r\nfunction getUser(userId, userIdLogin) {\r\n    var data = allUsers.get(userId);\r\n    if (!data) {\r\n        return undefined;\r\n    }\r\n    var preferences = userId !== userIdLogin\r\n        ? undefined\r\n        : {\r\n            email: data.email,\r\n        };\r\n    var _a = getUserSummaryFrom(userId, data), id = _a.id, name = _a.name, gravatarHash = _a.gravatarHash, location = _a.location;\r\n    return {\r\n        id: id,\r\n        name: name,\r\n        location: location,\r\n        gravatarHash: gravatarHash,\r\n        aboutMe: data.profile.aboutMe,\r\n        preferences: preferences,\r\n    };\r\n}\r\nexports.getUser = getUser;\r\nfunction getUserActivity(options) {\r\n    // same kind of processing as some combination of getDiscussions and getDiscussion\r\n    // like getDiscussion, we don't have two pre-sorted arrays to choose from, so may have to select from a reversed copy\r\n    var userId = options.user.id;\r\n    var messages = userMessages.get(userId);\r\n    var sort = options.sort ? options.sort : \"Oldest\";\r\n    var sortedMessages = sort === \"Oldest\" ? messages : messages.slice().reverse();\r\n    // like getDiscussions\r\n    var _a = getRange(messages.length, sort, 30, options.page ? options.page : 1, sortedMessages), range = _a.range, selected = _a.selected;\r\n    var discussionMessages = selected.map(function (message) {\r\n        var discussionId = messageDiscussions.get(message.messageId);\r\n        var discussion = allDiscussions.get(discussionId);\r\n        return [discussion, message];\r\n    });\r\n    var _b = wireSummaries(discussionMessages), users = _b.users, discussions = _b.discussions;\r\n    var tagCounts = userTags.get(userId).read();\r\n    return { users: users, discussions: discussions, range: range, tagCounts: tagCounts };\r\n}\r\nexports.getUserActivity = getUserActivity;\r\nfunction getDiscussions(options) {\r\n    var sort = options.sort ? options.sort : \"Active\";\r\n    var active = sort === \"Active\";\r\n    // two collections of pre-sorted discussions (using different sort-orders) to choose from\r\n    var sortedDiscussions = active ? sortedDiscussionsActive : sortedDiscussionsNewest;\r\n    var tag = options.tag;\r\n    var filteredDiscussions = !tag\r\n        ? sortedDiscussions\r\n        : sortedDiscussions.filter(function (pair) {\r\n            var discussionId = pair[0];\r\n            var discussion = allDiscussions.get(discussionId);\r\n            for (var _i = 0, _a = discussion.tags; _i < _a.length; _i++) {\r\n                var tagId = _a[_i];\r\n                var found = getKeyFromTagId(tagId);\r\n                if (found.key === tag.key) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        });\r\n    var getMessage = active ? getMessageEnded : getMessageStarted;\r\n    var _a = getRange(filteredDiscussions.length, sort, options.pagesize ? options.pagesize : 50, options.page ? options.page : 1, filteredDiscussions), range = _a.range, selected = _a.selected;\r\n    var discussionRange = __assign(__assign({}, range), { tag: tag });\r\n    var selectedDiscussions = selected.map(function (pair) { return allDiscussions.get(pair[0]); });\r\n    var discussionMessages = selectedDiscussions.map(function (discussion) { return [\r\n        discussion,\r\n        getMessage(discussion),\r\n    ]; });\r\n    var _b = wireSummaries(discussionMessages), users = _b.users, discussions = _b.discussions;\r\n    return { users: users, discussions: discussions, range: discussionRange };\r\n}\r\nexports.getDiscussions = getDiscussions;\r\nfunction getDiscussion(options) {\r\n    var discussion = allDiscussions.get(options.discussion.id);\r\n    if (!discussion) {\r\n        return undefined;\r\n    }\r\n    var sort = options.sort ? options.sort : \"Oldest\";\r\n    var sortedMessages = sort === \"Oldest\" ? discussion.messages : discussion.messages.slice().reverse();\r\n    var _a = getRange(discussion.messages.length, sort, 30, options.page ? options.page : 1, sortedMessages), range = _a.range, selected = _a.selected;\r\n    return wireDiscussion(discussion, selected, range);\r\n}\r\nexports.getDiscussion = getDiscussion;\r\nfunction getAllTags() {\r\n    return tagDiscussions.tagCounts();\r\n}\r\nexports.getAllTags = getAllTags;\r\nfunction getTags(options, searchInput) {\r\n    var tags = getAllTags().filter(function (tagCount) {\r\n        return !searchInput ? true : tagCount.key.includes(searchInput);\r\n    });\r\n    var sort = options.sort ? options.sort : \"Popular\";\r\n    if (options.sort === \"Name\") {\r\n        tags.sort(function (x, y) { return x.key.localeCompare(y.key); });\r\n    }\r\n    else {\r\n        tags.sort(function (x, y) {\r\n            return x.count === y.count ? x.key.localeCompare(y.key) : y.count - x.count;\r\n        });\r\n    }\r\n    var _a = getRange(tags.length, sort, options.pagesize, options.page ? options.page : 1, tags), range = _a.range, selected = _a.selected;\r\n    return { range: range, tagCounts: selected };\r\n}\r\nexports.getTags = getTags;\r\nfunction getTag(tag) {\r\n    var tagId = tagDiscussions.find(tag.key);\r\n    if (!tagId) {\r\n        // should return 404 Not Found\r\n        return undefined;\r\n    }\r\n    if (server_types_1.isTag(tagId)) {\r\n        // ideally allags would be a map instead of an array, but in practice we don't have so many tags that it matters\r\n        // also we're targetting down-level JS so it's inconvenient to iterate map values\r\n        var found = allTags.find(function (x) { return x.key === tagId.tag; });\r\n        var title = found.title, summary = found.summary, markdown = found.markdown;\r\n        return { title: title, summary: summary, markdown: markdown, key: tag.key };\r\n    }\r\n    else {\r\n        if (tagId.resourceType !== \"Image\") {\r\n            // should return 500 Internal Server Error\r\n            return undefined;\r\n        }\r\n        var image = allImages.find(function (x) { return x.id === tagId.id; });\r\n        var name = image.name, summary = image.summary, markdown = image.markdown;\r\n        return { title: name, summary: summary, markdown: markdown, key: tag.key };\r\n    }\r\n}\r\nexports.getTag = getTag;\r\n/*\r\n  POST functions\r\n*/\r\nfunction postNewUser(action) {\r\n    var _a = Action.extractNewUser(action), userId = _a.userId, user = _a.user;\r\n    allUsers.set(userId, user);\r\n    userMessages.set(userId, []);\r\n    userTags.set(userId, new tagIds_1.TagIdCounts(allImages));\r\n    return { id: userId, name: user.name };\r\n}\r\nfunction postEditUserProfile(action) {\r\n    var _a = Action.extractEditUserProfile(action), userId = _a.userId, posted = _a.posted;\r\n    var user = allUsers.get(userId);\r\n    user.name = posted.name;\r\n    user.email = posted.email;\r\n    user.profile.location = posted.location;\r\n    user.profile.aboutMe = posted.aboutMe;\r\n    return { id: userId, name: user.name };\r\n}\r\nfunction postNewTopic(action) {\r\n    var tag = Action.extractNewTopic(action);\r\n    if (!tagDiscussions.addTag(tag.key)) {\r\n        // FIXME\r\n        console.error(\"!postNewTopic\");\r\n    }\r\n    allTags.push(tag);\r\n    return { key: tag.key };\r\n}\r\nfunction postNewDiscussion(action) {\r\n    var _a = Action.extractNewDiscussion(action), idName = _a.idName, tags = _a.tags, message = _a.first;\r\n    var discussionId = idName.id;\r\n    // ensure that the tags exist and/or can be created\r\n    var tagIds = [];\r\n    for (var _i = 0, tags_1 = tags; _i < tags_1.length; _i++) {\r\n        var tag = tags_1[_i];\r\n        var tagId = tagDiscussions.find(tag);\r\n        if (!tagId) {\r\n            if (!configServer_1.configServer.autoAddTag) {\r\n                // FIXME\r\n                console.error(\"postNewDiscussion can't auto-add \" + tag);\r\n                continue;\r\n            }\r\n            // auto-create it now\r\n            var newTopic = Action.createNewTag(tag, action.dateTime, action.userId);\r\n            handleAction(newTopic);\r\n            // try again to find it\r\n            tagId = tagDiscussions.find(tag);\r\n            if (!tagId) {\r\n                // FIXME\r\n                continue;\r\n            }\r\n        }\r\n        tagIds.push(tagId);\r\n    }\r\n    // the discussion is associated with tags\r\n    tagIds.forEach(function (tagId) { return tagDiscussions.addDiscussionId(tagId, discussionId); });\r\n    // new discussion\r\n    var discussion = {\r\n        id: idName.id,\r\n        name: idName.name,\r\n        tags: tagIds,\r\n        first: message,\r\n        messages: [],\r\n    };\r\n    allDiscussions.set(discussionId, discussion);\r\n    var active = getDiscussionTime(discussion, getMessageStarted);\r\n    sortedDiscussionsNewest.unshift(active);\r\n    sortedDiscussionsActive.unshift(active);\r\n    // the user owns this message\r\n    userMessages.get(message.userId).push(message);\r\n    // the message is associated with this discussion\r\n    messageDiscussions.set(message.messageId, discussionId);\r\n    return idName;\r\n}\r\nfunction postNewMessage(action) {\r\n    var _a = Action.extractNewMessage(action), discussionId = _a.discussionId, message = _a.message;\r\n    var discussion = allDiscussions.get(discussionId);\r\n    // add to the discussion\r\n    discussion.messages.push(message);\r\n    // this discussion is now the most active\r\n    function activate(active) {\r\n        // search backwards because it's likely to be more towards the end\r\n        for (var i = sortedDiscussionsActive.length - 1; i >= 0; --i) {\r\n            if (sortedDiscussionsActive[i][0] === active[0]) {\r\n                sortedDiscussionsActive.splice(i, 1);\r\n                sortedDiscussionsActive.unshift(active);\r\n                return;\r\n            }\r\n        }\r\n        console.log(\"error active discussion not found\");\r\n    }\r\n    activate(getDiscussionTime(discussion, getMessageEnded));\r\n    // the user owns this message\r\n    userMessages.get(message.userId).push(message);\r\n    discussion.tags.forEach(function (tagId) { return userTags.get(message.userId).add(tagId); });\r\n    // the message is associated with this discussion\r\n    messageDiscussions.set(message.messageId, discussionId);\r\n    return {\r\n        userSummary: getUserSummary(message.userId),\r\n        markdown: message.markdown,\r\n        dateTime: message.dateTime,\r\n    };\r\n}\r\nfunction postEditTagInfo(action) {\r\n    // this logic is similar to getTag()\r\n    var _a = Action.extractEditTagInfo(action), tag = _a.tag, posted = _a.posted;\r\n    var summary = posted.summary, markdown = posted.markdown;\r\n    var tagId = tagDiscussions.find(tag);\r\n    if (!tagId) {\r\n        // should return 404 Not Found\r\n        return undefined;\r\n    }\r\n    if (server_types_1.isTag(tagId)) {\r\n        // ideally allags would be a map instead of an array, but in practice we don't have so many tags that it matters\r\n        // also we're targetting down-level JS so it's inconvenient to iterate map values\r\n        var found = allTags.find(function (x) { return x.key === tagId.tag; });\r\n        found.summary = summary.length ? summary : undefined;\r\n        found.markdown = markdown.length ? markdown : undefined;\r\n    }\r\n    else {\r\n        if (tagId.resourceType !== \"Image\") {\r\n            // should return 500 Internal Server Error\r\n            return undefined;\r\n        }\r\n        var image = allImages.find(function (x) { return x.id === tagId.id; });\r\n        image.summary = summary;\r\n        image.markdown = markdown.length ? markdown : undefined;\r\n    }\r\n    return { key: tag };\r\n}\r\nfunction handleAction(action) {\r\n    switch (action.type) {\r\n        case \"NewUser\":\r\n            return postNewUser(action);\r\n        case \"EditUserProfile\":\r\n            return postEditUserProfile(action);\r\n        case \"NewTopic\":\r\n            return postNewTopic(action);\r\n        case \"NewDiscussion\":\r\n            return postNewDiscussion(action);\r\n        case \"NewMessage\":\r\n            return postNewMessage(action);\r\n        case \"EditTagInfo\":\r\n            return postEditTagInfo(action);\r\n        default:\r\n            return { error: \"Unexpected post type\" };\r\n    }\r\n}\r\nexports.handleAction = handleAction;\r\n/*\r\n  Loader\r\n*/\r\nfunction onLoad() {\r\n    // images are pre-loaded separately; add the corresponding tagIds\r\n    var actions = loader_1.loadActions(getKeyFromTagId);\r\n    function assertId(what, actual, expected, action) {\r\n        if (actual !== expected) {\r\n            var first = JSON.stringify({ actual: actual, expected: expected }, null, 2);\r\n            var second = JSON.stringify(action, null, 2);\r\n            console.error(\"onLoad assert \" + what + \"Id \" + first + \" \" + second);\r\n        }\r\n    }\r\n    actions.forEach(function (action) {\r\n        // assert that the embedded IDs are in the expected sequence\r\n        switch (action.type) {\r\n            case \"NewUser\":\r\n                assertId(\"user\", action.userId, currentIds.userId.next(), action);\r\n                break;\r\n            case \"NewDiscussion\":\r\n                assertId(\"discussion\", action.discussionId, currentIds.discussionId.next(), action);\r\n                assertId(\"message\", action.messageId, currentIds.messageId.next(), action);\r\n                break;\r\n            case \"NewMessage\":\r\n                assertId(\"message\", action.messageId, currentIds.messageId.next(), action);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        // delegate to the action handler (to replay what happened when the action originally occured)\r\n        handleAction(action);\r\n    });\r\n}\r\nonLoad();\r\n//# sourceMappingURL=database.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.configServer = {\r\n    autoAddTag: false,\r\n};\r\n//# sourceMappingURL=configServer.js.map","\"use strict\";\r\n/*\r\n  This class tracks which is the next ID value to be assigned a new resource.\r\n  Beware that it's difficult to do this if there are two server instances,\r\n  then again the current implementation keeps the whole database in local cache.\r\n*/\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Current = /** @class */ (function () {\r\n    function Current() {\r\n        this.value = 0;\r\n    }\r\n    Current.prototype.next = function () {\r\n        return ++this.value;\r\n    };\r\n    return Current;\r\n}());\r\nvar CurrentIds = /** @class */ (function () {\r\n    function CurrentIds() {\r\n        this.userId = new Current();\r\n        this.discussionId = new Current();\r\n        this.messageId = new Current();\r\n    }\r\n    return CurrentIds;\r\n}());\r\nexports.CurrentIds = CurrentIds;\r\n//# sourceMappingURL=currentIds.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar shared_lib_1 = require(\"shared-lib\");\r\nfunction getExerpt(markdown) {\r\n    var words = markdown.split(\" \");\r\n    var rc;\r\n    for (var _i = 0, words_1 = words; _i < words_1.length; _i++) {\r\n        var word = words_1[_i];\r\n        if (!word.length) {\r\n            continue;\r\n        }\r\n        if (rc && rc.length + word.length > shared_lib_1.config.exerptlength) {\r\n            rc += \" ...\";\r\n            break;\r\n        }\r\n        rc = rc ? rc + \" \" + word : word;\r\n    }\r\n    return rc ? rc : \"(no message)\";\r\n}\r\nexports.getExerpt = getExerpt;\r\n//# sourceMappingURL=exerpt.js.map","\"use strict\";\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result[\"default\"] = mod;\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Action = __importStar(require(\"./actions\"));\r\nfunction assertTypeT(loaded, wanted, optional, alternate) {\r\n    function assertType(found, wanted, keyNames) {\r\n        if (typeof wanted !== typeof found) {\r\n            throw new Error(\"assertType expected \" + typeof wanted + \" but found \" + typeof found);\r\n        }\r\n        switch (typeof wanted) {\r\n            case \"boolean\":\r\n            case \"number\":\r\n            case \"string\":\r\n                return; // primitive value type -- done checking\r\n            case \"object\":\r\n                break; // more to check\r\n            case \"undefined\":\r\n            case \"symbol\":\r\n            case \"function\":\r\n            default:\r\n                throw new Error(\"assertType does not support \" + typeof wanted);\r\n        }\r\n        if (Array.isArray(wanted)) {\r\n            if (!Array.isArray(found)) {\r\n                throw new Error(\"assertType expected an array but found \" + found);\r\n            }\r\n            if (wanted.length === 0) {\r\n                // throw new Error(`assertType can't deduce the expected type from a zero-length array`);\r\n            }\r\n            else if (wanted.length === 1) {\r\n                // assume we want a homogenous array with all elements the same type\r\n                for (var _i = 0, found_1 = found; _i < found_1.length; _i++) {\r\n                    var element = found_1[_i];\r\n                    assertType(element, wanted[0]);\r\n                }\r\n            }\r\n            else {\r\n                // assume we want a tuple\r\n                if (found.length !== wanted.length) {\r\n                    throw new Error(\"assertType expected tuple length \" + wanted.length + \" found \" + found.length);\r\n                }\r\n                for (var i = 0; i < wanted.length; ++i) {\r\n                    assertType(found[i], wanted[i]);\r\n                }\r\n            }\r\n            return;\r\n        }\r\n        if (alternate && alternate(wanted, found)) {\r\n            // matches the alternate version\r\n            return;\r\n        }\r\n        for (var key in wanted) {\r\n            var expected = keyNames ? keyNames + \".\" + key : key;\r\n            if (typeof found[key] === \"undefined\") {\r\n                if (!optional || !optional.has(expected)) {\r\n                    throw new Error(\"assertType expected \" + expected + \" in \" + JSON.stringify(wanted) + \" is \" + JSON.stringify(found));\r\n                }\r\n            }\r\n            else {\r\n                assertType(found[key], wanted[key], expected);\r\n            }\r\n        }\r\n    }\r\n    assertType(loaded, wanted);\r\n    return loaded;\r\n}\r\n/*\r\n  `loadXxx(): Xxx` functions\r\n*/\r\nfunction loadUsers() {\r\n    var found = require(\"server-data/json/users.json\");\r\n    var sample = [\r\n        1,\r\n        {\r\n            name: \"ChrisW\",\r\n            email: \"cwellsx@gmail.com\",\r\n            dateTime: \"Thu, 03 Jan 2019 22:35:05 GMT\",\r\n            profile: {\r\n                location: \"Normandy\",\r\n                aboutMe: \"I wrote this!\\n\\nFurther details are to be supplied ...\",\r\n            },\r\n            favourites: [],\r\n        },\r\n    ];\r\n    var optional = new Set([\"profile.aboutMe\", \"profile.location\"]);\r\n    var loaded = assertTypeT(found, [sample], optional);\r\n    return new Map(loaded);\r\n}\r\nvar server_data_1 = require(\"server-data\");\r\nexports.loadImages = server_data_1.loadImages;\r\nfunction loadTags() {\r\n    var found = require(\"server-data/json/tags.json\");\r\n    var sample = {\r\n        title: \"foo\",\r\n        userId: 0,\r\n        dateTime: \"Thu, 03 Jan 2019 22:35:05 GMT\",\r\n    };\r\n    var loaded = assertTypeT(found, [sample]);\r\n    return loaded;\r\n}\r\nfunction loadDiscussions() {\r\n    var found = require(\"server-data/json/discussions.json\");\r\n    var sampleMessage = {\r\n        userId: 7,\r\n        markdown: \"Maecenas dignissim et ante sit amet fermentum.\",\r\n        dateTime: \"Thu, 03 Jan 2019 22:35:05 GMT\",\r\n        messageId: 1,\r\n    };\r\n    var sample = {\r\n        id: 1,\r\n        name: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit?\",\r\n        tags: [{ tag: \"foo\" }],\r\n        first: sampleMessage,\r\n        messages: [sampleMessage],\r\n    };\r\n    var alternate = function (wanted, found) {\r\n        if (wanted.tag === undefined) {\r\n            // not the wanted we're trying to match\r\n            return false;\r\n        }\r\n        return found.id !== undefined && found.resourceType !== undefined;\r\n    };\r\n    var loaded = assertTypeT(found, [sample], undefined, alternate);\r\n    return new Map(loaded.map(function (x) { return [x.id, x]; }));\r\n}\r\nfunction loadActions(getKeyFromTagId) {\r\n    var rc = [];\r\n    var tags = loadTags();\r\n    rc.push.apply(rc, tags.map(Action.createStoredTopic));\r\n    var users = loadUsers();\r\n    function userToNewUser(userId, user) {\r\n        var name = user.name, email = user.email, dateTime = user.dateTime;\r\n        var posted = { name: name, email: email };\r\n        return Action.createNewUser(posted, dateTime, userId);\r\n    }\r\n    function userToNewUserProfile(userId, user) {\r\n        return Action.createStoredUserProfile(user, userId);\r\n    }\r\n    users.forEach(function (user, userId) {\r\n        rc.push(userToNewUser(userId, user));\r\n        rc.push(userToNewUserProfile(userId, user));\r\n    });\r\n    var discussions = loadDiscussions();\r\n    function discussionToNewDiscussion(discussionId, discussion, first) {\r\n        var title = discussion.name;\r\n        var tags = discussion.tags.map(getKeyFromTagId);\r\n        var markdown = first.markdown, messageId = first.messageId, dateTime = first.dateTime, userId = first.userId;\r\n        var posted = {\r\n            title: title,\r\n            tags: tags.map(function (tag) { return tag.key; }),\r\n            markdown: markdown,\r\n        };\r\n        return Action.createNewDiscussion(posted, dateTime, userId, discussionId, messageId);\r\n    }\r\n    function messageToNewMessage(discussionId, message) {\r\n        var markdown = message.markdown, messageId = message.messageId, dateTime = message.dateTime, userId = message.userId;\r\n        var posted = { markdown: markdown };\r\n        return Action.createNewMessage(posted, dateTime, userId, discussionId, messageId);\r\n    }\r\n    discussions.forEach(function (discussion, discussionId) {\r\n        var first = discussion.first, messages = discussion.messages;\r\n        rc.push(discussionToNewDiscussion(discussionId, discussion, first));\r\n        rc.push.apply(rc, messages.map(function (message) { return messageToNewMessage(discussionId, message); }));\r\n    });\r\n    var sorted = rc.map(function (action) { return [action, new Date(action.dateTime).getTime()]; });\r\n    sorted.sort(function (x, y) {\r\n        if (x[1] !== y[1]) {\r\n            return x[1] - y[1];\r\n        }\r\n        return Action.getLoadPriority(x[0]) - Action.getLoadPriority(y[0]);\r\n    });\r\n    return sorted.map(function (pair) { return pair[0]; });\r\n}\r\nexports.loadActions = loadActions;\r\n//# sourceMappingURL=loader.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction loadImages() {\r\n    return [];\r\n}\r\nexports.loadImages = loadImages;\r\n//# sourceMappingURL=images.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar sessionData = new Map();\r\nfunction getOrSet(userId) {\r\n    var sessionState = sessionData.get(userId);\r\n    if (!sessionState) {\r\n        sessionState = {};\r\n        sessionData.set(userId, sessionState);\r\n    }\r\n    return sessionState;\r\n}\r\nfunction getSetDiscussionsOptions(userId, options) {\r\n    var sessionState = getOrSet(userId);\r\n    // write any new explicitly-set options to the session state\r\n    if (options.sort || options.pagesize) {\r\n        var stored = sessionState.discussions;\r\n        if (!stored) {\r\n            stored = {};\r\n            sessionState.discussions = stored;\r\n        }\r\n        if (options.sort) {\r\n            stored.sort = options.sort;\r\n        }\r\n        if (options.pagesize) {\r\n            stored.pagesize = options.pagesize;\r\n        }\r\n    }\r\n    // get any old options from the session state\r\n    var old = sessionState.discussions;\r\n    if (old) {\r\n        if (old.sort) {\r\n            options.sort = old.sort;\r\n        }\r\n        if (old.pagesize) {\r\n            options.pagesize = old.pagesize;\r\n        }\r\n    }\r\n}\r\nexports.getSetDiscussionsOptions = getSetDiscussionsOptions;\r\nfunction getSetDiscussionOptions(userId, options) {\r\n    var sessionState = getOrSet(userId);\r\n    // write any new explicitly-set options to the session state\r\n    if (options.sort) {\r\n        var stored = sessionState.discussion;\r\n        if (!stored) {\r\n            stored = {};\r\n            sessionState.discussion = stored;\r\n        }\r\n        if (options.sort) {\r\n            stored.sort = options.sort;\r\n        }\r\n    }\r\n    // get any old options from the session state\r\n    var old = sessionState.discussion;\r\n    if (old) {\r\n        if (old.sort) {\r\n            options.sort = old.sort;\r\n        }\r\n    }\r\n}\r\nexports.getSetDiscussionOptions = getSetDiscussionOptions;\r\n//# sourceMappingURL=session.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar server_1 = require(\"server\");\r\nvar shared_lib_1 = require(\"shared-lib\");\r\n// you could temporarily change this to enable logging, for debugging\r\nvar isLogging = false;\r\nfunction mockFetch(url, method, body) {\r\n    return new Promise(function (resolve, reject) {\r\n        setTimeout(function () {\r\n            if (shared_lib_1.config.loginfails) {\r\n                // simulate login failure\r\n                var failPromise_1 = new Promise(function (resolve, reject) {\r\n                    // no possible need to call reject because we already have the data\r\n                    reject(\"Don't get JSON if request failed\");\r\n                });\r\n                var failure = {\r\n                    ok: false,\r\n                    statusText: \"Unauthorized\",\r\n                    json: function () { return failPromise_1; },\r\n                };\r\n                resolve(failure);\r\n                return;\r\n            }\r\n            // a real server would infer the userId from authentication cookies\r\n            // and not trust the client to pass its userId as an API parameter\r\n            // but for the mock implementation we get and pass it from app context\r\n            // const me: I.UserSummary | undefined = React.useContext(AppContext).me;\r\n            // const userId: number | undefined = me ? me.idName.id : undefined;\r\n            var userId = server_1.loginUser().id;\r\n            var isPost = method === \"POST\";\r\n            var json = !isPost ? server_1.routeOnGet(url, userId) : server_1.routeOnPost(url, userId, JSON.parse(body));\r\n            if (!json) {\r\n                // from inside setTimeout we must reject not throw\r\n                // https://stackoverflow.com/questions/33445415/javascript-promises-reject-vs-throw\r\n                reject(new Error(\"No mock data found for \" + url));\r\n            }\r\n            if (isLogging) {\r\n                console.log(JSON.stringify(json, null, 2));\r\n            }\r\n            var jsonPromise = new Promise(function (resolve, reject) {\r\n                // no possible need to call reject because we already have the data\r\n                resolve(json);\r\n            });\r\n            var response = {\r\n                ok: true,\r\n                statusText: \"OK\",\r\n                json: function () { return jsonPromise; },\r\n            };\r\n            resolve(response);\r\n        }, shared_lib_1.config.mockdelay);\r\n    });\r\n}\r\nexports.mockFetch = mockFetch;\r\n//# sourceMappingURL=mock.js.map","\"use strict\";\r\n// https://github.com/mmillican/pagedown/blob/master/README.md\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n// it's JavaScript with no TypeScript declarations\r\nvar pagedown = require(\"pagedown\");\r\nvar converter = new pagedown.getSanitizingConverter(); // instead of just new pagedown.Converter();\r\n// return type matches what can be passed as a parameter to React elements' dangerouslySetInnerHTML property.\r\nfunction toHtml(markdown) {\r\n    var __html = converter.makeHtml(markdown);\r\n    return { __html: __html };\r\n}\r\nexports.toHtml = toHtml;\r\n//# sourceMappingURL=markdownToHtml.js.map","import { config, Data, loginUser } from \"client\";\nimport React from \"react\";\n\ntype Me = Data.UserSummary | undefined;\n\ntype AppContextProps = {\n  me?: Data.UserSummary;\n  setMe(me: Me): void;\n};\n\n// https://fettblog.eu/typescript-react/context/\nexport const AppContext = React.createContext<AppContextProps>({\n  me: undefined,\n  setMe: (me: Me) => {},\n});\n\nexport function useMe(): Me {\n  const appContext: AppContextProps = React.useContext(AppContext);\n  return appContext.me;\n}\n\nexport function useSetMe(): (me: Me) => void {\n  const appContext: AppContextProps = React.useContext(AppContext);\n  return appContext.setMe;\n}\nexport function useCreateMe(): [Me, React.Dispatch<React.SetStateAction<Me>>] {\n  // https://fettblog.eu/typescript-react/context/ and\n  // https://reactjs.org/docs/context.html#updating-context-from-a-nested-component\n  const autologin = config.autologin ? loginUser() : undefined;\n  return React.useState<Me>(autologin);\n}\n","import React from \"react\";\r\n\r\n/*\r\n  This is a \"high-order component\", a \"custom hook\" -- it separates \"getting\" the data from \"presenting\" the data.\r\n\r\n  - https://reactjs.org/docs/higher-order-components.html\r\n  - https://reactjs.org/docs/hooks-custom.html\r\n\r\n  The sequence of events is:\r\n\r\n  1. Called for the first time\r\n  2. Returns `undefined` as the data value\r\n  3. useEffect fires and:\r\n     - Call getData to fetch data from the server\r\n     - Call setData to write the fetched data into the state\r\n     - Returns the fetched data value\r\n\r\n  Fetching data is as described at:\r\n\r\n  - https://reactjs.org/docs/hooks-faq.html#how-can-i-do-data-fetching-with-hooks\r\n  - https://overreacted.io/a-complete-guide-to-useeffect/\r\n  - https://www.robinwieruch.de/react-hooks-fetch-data\r\n\r\n  And using a hook with TypeScript:\r\n\r\n  - https://www.carlrippon.com/typed-usestate-with-typescript/\r\n\r\n  The template supports a parameter of type TParam (which is optional and may be void/undefined).\r\n  If specified then the parameter is passed to the getData function.\r\n\r\n  ---\r\n\r\n  Also, as described here ...\r\n\r\n  https://stackoverflow.com/questions/56096560/avoid-old-data-when-using-useeffect-to-fetch-data\r\n\r\n  ... if the parameter value changes then there's a brief wndow before the useEffect hook is run.\r\n  Therefore the param value is stored in state whenever the data value is stored,\r\n  and the data value is discarded when it's associated param value doesn't match the current param value.\r\n\r\n  The solution described here ...\r\n\r\n  https://overreacted.io/a-complete-guide-to-useeffect/#but-i-cant-put-this-function-inside-an-effect\r\n\r\n  ... i.e. to \"wrap it into the useCallback Hook\" was insufficient because it leaves a brief\r\n  timing hole before the useEffect fires and the data is refetched.\r\n*/\r\n\r\nexport interface FetchingT<TData, TParam2> {\r\n  // type of data returned by the client API\r\n  data: TData | undefined;\r\n  error: Error | undefined;\r\n  reload: () => void;\r\n  newData: (param2: TParam2) => Promise<void>;\r\n}\r\n\r\n// this gets data from the server\r\ntype IoGetDataT<TData, TParam, TParam2 = void> = (param: TParam, param2?: TParam2) => Promise<TData>;\r\n\r\n// this value is passed as param to useGetLayout when TParam is void\r\n// or I could have implemented a copy-and-paste of useGetLayout without the TParam\r\nconst isVoid: void = (() => {})();\r\n\r\nexport function useFetchApi<TData>(getData: IoGetDataT<TData, void, void>): FetchingT<TData, void> {\r\n  return useFetchApi2(getData, isVoid);\r\n}\r\n\r\nexport function useFetchApi2<TData, TParam, TParam2 = void>(\r\n  // client API function\r\n  getData: IoGetDataT<TData, TParam, TParam2>,\r\n  // parameter passed to the getData function\r\n  param: TParam\r\n): FetchingT<TData, TParam2> {\r\n  const [prev, setParam] = React.useState<TParam | undefined>(undefined);\r\n  const [data, setData] = React.useState<TData | undefined>(undefined);\r\n  const [error, setError] = React.useState<Error | undefined>(undefined);\r\n\r\n  // we pass the reload function to the getLayout function so that it can force a reload e.g. after\r\n  // posting a new message to the server. We force a reload because nothing has changed on the client --\r\n  // not even the URL -- but we want to fetch/refresh the data from the server.\r\n  // https://stackoverflow.com/questions/46240647/can-i-call-forceupdate-in-stateless-component\r\n  const [toggle, setToggle] = React.useState<boolean>(true);\r\n  function reload() {\r\n    setToggle(!toggle); // toggle the state to force render\r\n  }\r\n\r\n  // we pass a newData function to the getLayout function so that it can invoke the network I/O function again\r\n  // with a new parameter (see the ThrottledInput function) and store the new data and the new parameter back here\r\n  const newData = React.useMemo(() => {\r\n    const getDataAgain: (param2: TParam2) => Promise<void> = (param2: TParam2) => {\r\n      const promise = getData(param, param2);\r\n      const rc: Promise<void> = new Promise<void>((resolve, reject) => {\r\n        promise.then((fetched: TData) => {\r\n          // the layout function has fetched new data with a new parameter\r\n          // so redo now what was originally done at the end of useEffect\r\n          setData(fetched);\r\n          // setParam(param);\r\n          resolve();\r\n        });\r\n        promise.catch((error) => {\r\n          reject(error);\r\n        });\r\n      });\r\n      return rc;\r\n    };\r\n    return getDataAgain;\r\n  }, [getData, param]);\r\n\r\n  // add the reload function to the extra data which we pass as a parameter to the layout function\r\n  // so that the layout function can call reload() if it wants to\r\n  //const extra2: TExtra & Extra<TParam2> = { ...extra, reload, newData };\r\n\r\n  React.useEffect(() => {\r\n    getData(param)\r\n      .then((fetched) => {\r\n        setData(fetched);\r\n        setParam(param);\r\n      })\r\n      .catch((reason) => {\r\n        console.log(`useEffect failed ${reason}`);\r\n        setError(reason);\r\n      });\r\n  }, [getData, param, toggle]);\r\n\r\n  // TODO https://www.robinwieruch.de/react-hooks-fetch-data/#react-hooks-abort-data-fetching\r\n\r\n  return { data: prev === param ? data : undefined, error, reload, newData };\r\n}\r\n","import { Data } from \"client\";\r\n\r\n// you could temporarily change this to enable logging, for debugging\r\nconst isLogging = false;\r\n\r\n/*\r\n  Type definitions\r\n*/\r\n\r\ntype TagCount = Data.TagCount;\r\n\r\n// these are properties to configurare the validation of tags\r\nexport interface Validation {\r\n  // whether a minimum number of tags must be defined, e.g. 1\r\n  minimum: boolean;\r\n  // whether a maximum number of tags must be defined, e.g. 5\r\n  maximum: boolean;\r\n  // whether the user can create new tags, or whether tags must match what's already in the dictionary\r\n  canNewTag: boolean;\r\n  // whether to show validation error messages -- they're hidden until the user first presses the form's submit button\r\n  showValidationError: boolean;\r\n  // the href used for the link to \"popular tags\" in the validation error message -- i.e. \"/tags\"\r\n  hrefAllTags: string;\r\n}\r\n\r\n// the results are pushed back to the parent via this callback\r\nexport interface OutputTags {\r\n  tags: string[];\r\n  isValid: boolean;\r\n}\r\nexport type ParentCallback = (outputTags: OutputTags) => void;\r\n\r\nexport type Assert = (assertion: boolean, message: string, extra?: () => object) => void;\r\n\r\n// this is extra data which event handlers pass (as part of the action) from the function component to the reducer\r\ninterface Context {\r\n  inputElement: InputElement;\r\n  assert: Assert;\r\n  result: ParentCallback;\r\n  tagDictionary?: TagDictionary;\r\n  validation: Validation;\r\n}\r\n\r\n// this is like the input data from which the RenderedState is calculated\r\n// these and other state elements are readonly so that event handlers must mutate MutableState instead\r\ninterface State {\r\n  // the selection range within the buffer\r\n  // this may even span multiple words, in which case all the selected words are in the <input> element\r\n  readonly selection: { readonly start: number; readonly end: number };\r\n  // the words (i.e. the tags when this is split on whitespace)\r\n  readonly buffer: string;\r\n}\r\n\r\n// this interface identifies the array of <input> and <Tag> elements to be rendered, and the word associated with each\r\nexport interface RenderedElement {\r\n  // the string value of this word\r\n  readonly word: string;\r\n  // whether this word is rendered by a Tag element or by the one input element\r\n  readonly type: \"tag\" | \"input\";\r\n  // whether this word matches an existing tag in the dictionary\r\n  readonly isValid: boolean;\r\n}\r\n\r\n// this interface combines the two states, and is what's stored using useReducer\r\nexport interface RenderedState {\r\n  // the buffer which contains the tag-words, and the selection within the buffer\r\n  readonly state: State;\r\n  // how that's rendered i.e. the <input> element plus <Tag> elements\r\n  readonly elements: ReadonlyArray<RenderedElement>;\r\n  // the current (\"semi-controlled\") value of the <input> element\r\n  readonly inputValue: string;\r\n  // the hints associated with the inputValue, taken from the TagDictionary\r\n  hints: TagCount[];\r\n  // the validation error message (zero length if there isn't one)\r\n  validationError: string;\r\n}\r\n\r\n// this wraps the current state of the <input> control\r\nexport class InputElement {\r\n  readonly selectionStart: number;\r\n  readonly selectionEnd: number;\r\n  readonly isDirectionBackward: boolean;\r\n  readonly value: string;\r\n  readonly isLeftTrimmed: boolean;\r\n  private readonly inputElement: HTMLInputElement;\r\n\r\n  constructor(inputElement: HTMLInputElement, assert: Assert, stateValue?: string) {\r\n    let { selectionStart, selectionEnd, selectionDirection, value } = inputElement;\r\n    log(\"getInput\", {\r\n      selectionStart,\r\n      selectionEnd,\r\n      selectionDirection,\r\n      value,\r\n    });\r\n\r\n    assert(!stateValue || stateValue === value, \"stateValue !== value\");\r\n\r\n    // TypeScript declaration says these may be null, though I haven't seen that in practice?\r\n    if (selectionStart === null) {\r\n      assert(false, \"unexpected null selectionStart\");\r\n      selectionStart = 0;\r\n    }\r\n    if (selectionEnd === null) {\r\n      assert(false, \"unexpected null selectionEnd\");\r\n      selectionEnd = 0;\r\n    }\r\n    if (selectionStart > selectionEnd) {\r\n      assert(false, \"unexpected selectionStart > selectionEnd\");\r\n      selectionStart = 0;\r\n    }\r\n    // left trim if the user entered leading spaces\r\n    let isLeftTrimmed = false;\r\n    while (value.length && value[0] === \" \") {\r\n      value = value.substring(1);\r\n      --selectionStart;\r\n      --selectionEnd;\r\n      isLeftTrimmed = true;\r\n    }\r\n\r\n    this.selectionStart = selectionStart;\r\n    this.selectionEnd = selectionEnd;\r\n    this.isDirectionBackward = selectionDirection === \"backward\";\r\n    this.value = value;\r\n    this.isLeftTrimmed = isLeftTrimmed;\r\n    this.inputElement = inputElement;\r\n  }\r\n\r\n  focus(): void {\r\n    this.inputElement.focus();\r\n  }\r\n\r\n  setContent(value: string, start: number, end: number): void {\r\n    // set the value before the selection, otherwise the selection might be invalid\r\n    this.inputElement.value = value;\r\n    this.inputElement.setSelectionRange(start, end);\r\n    // dynammically readjust the width of the input element to match its content\r\n    const width = getTextWidth(value + \"0\");\r\n    this.inputElement.style.width = `${width}px`;\r\n  }\r\n\r\n  toJSON(): string {\r\n    // JSON.stringify cannot handle `inputElement: HTMLInputElement` so the purpose of this is to exclude that\r\n    const printable: string[] = [\r\n      `start: ${this.selectionEnd}`,\r\n      `end: ${this.selectionEnd}`,\r\n      `backward: ${this.isDirectionBackward}`,\r\n      `value: ${this.value}`,\r\n    ];\r\n    return printable.join(\", \");\r\n  }\r\n}\r\n\r\n// this combines the state of the <input> control with the position of the <input> within the RenderedState\r\n// it exists only to help the KeyDown event handlers determine whether keys like ArrowLeft will change the selected word\r\n// beware that, when this runs, the <input> control's value may not yet have been written to the elements[editing].word\r\nclass InputState {\r\n  readonly canMoveLeft: boolean;\r\n  readonly canMoveRight: boolean;\r\n  readonly currentStart: number;\r\n  readonly currentEnd: number;\r\n  get nextLeft(): number {\r\n    return this.currentStart - 1;\r\n  }\r\n  get nextRight(): number {\r\n    return this.currentEnd + 1;\r\n  }\r\n\r\n  constructor(state: RenderedState, inputElement: InputElement, assert: Assert) {\r\n    const { elements } = state;\r\n    const { inputIndex, isFirst, isLast } = getInputIndex(elements, assert);\r\n    const elementStart = getElementStart(elements, inputIndex, assert);\r\n\r\n    const { selectionStart, selectionEnd, isDirectionBackward, value } = inputElement;\r\n\r\n    // if a range is selected then which end of the range is moving?\r\n    const isLeftMoving = selectionStart === selectionEnd || isDirectionBackward;\r\n    const isRightMoving = selectionStart === selectionEnd || !isDirectionBackward;\r\n\r\n    // can move left if at the start of the <input> and if there are other <Tag> elements before the <input> element\r\n    this.canMoveLeft = selectionStart === 0 && !isFirst && isLeftMoving;\r\n    // can move right if at the end of the <input> and if there are other <Tag> elements after the <input> element\r\n    this.canMoveRight = selectionEnd === value.length && !isLast && isRightMoving;\r\n\r\n    this.currentStart = elementStart + selectionStart;\r\n    this.currentEnd = elementStart + selectionEnd;\r\n  }\r\n\r\n  removeSelected(mutableState: MutableState): void {\r\n    mutableState.remove(this.currentStart, this.currentEnd);\r\n  }\r\n}\r\n\r\n// this is a class which event-handlers use to mutate the current state\r\n// its methods are whatever primitive methods are required by the event handlers which use it\r\n// it's contructed from the previous RenderedState, then mutated, and then eventually returns the new RenderedState\r\nclass MutableState {\r\n  private selection: { start: number; end: number };\r\n  private buffer: string;\r\n  // store the elements as word because until the mutation stops we don't know which will be the input element\r\n  // e.g. what's currently current input element may be deleted and/or the input may be moved to a different word\r\n  private words: string[];\r\n  private context: Context;\r\n\r\n  constructor(renderedState: RenderedState, context: Context) {\r\n    // load the data from the previous state into non-readonly elements\r\n    const { state, elements } = renderedState;\r\n    this.selection = state.selection;\r\n    this.buffer = state.buffer;\r\n    this.words = elements.map((x) => x.word); // use concat with no parameters to convert from ReadonlyArray to []\r\n    this.context = context;\r\n\r\n    // stash the input -- i.e. update the buffered data to reflect whatever is currently in the <input> element\r\n    const { inputIndex } = getInputIndex(elements, context.assert);\r\n    const { value, selectionStart, selectionEnd } = context.inputElement;\r\n    this.replaceElement(inputIndex, value, {\r\n      start: selectionStart,\r\n      end: selectionEnd,\r\n    });\r\n    log(\"MutableState\", {\r\n      selection: this.selection,\r\n      buffer: this.buffer,\r\n      words: this.words,\r\n    });\r\n  }\r\n\r\n  // called when the event handler has finished mutating this MutableState\r\n  getState(): RenderedState {\r\n    const state: State = { buffer: this.buffer, selection: this.selection };\r\n    const { assert, inputElement, tagDictionary, validation } = this.context;\r\n    const renderedState: RenderedState = renderState(state, assert, validation, inputElement, tagDictionary);\r\n    logRenderedState(\"MutableState.getState returning\", renderedState);\r\n    // do a callback to the parent to say what the current tags are (excluding the empty <input> word if there is one)\r\n    const tags: string[] = renderedState.elements.map((element) => element.word).filter((word) => !!word.length);\r\n    const isValid = !renderedState.validationError.length;\r\n    this.context.result({ tags, isValid });\r\n    return renderedState;\r\n  }\r\n\r\n  replaceElement(index: number, newValue: string, selection?: { start: number; end: number }): void {\r\n    this.invariant();\r\n\r\n    const editingWord: string = this.words[index];\r\n    // a special case is when the input element is empty and the last word -- then it's beyond the end of the buffer\r\n    const nWords = this.words.length - (this.words[this.words.length - 1] === \"\" ? 1 : 0);\r\n\r\n    // if the new word matches the existing word then the replace will do nothing\r\n    if (editingWord === newValue) {\r\n      return;\r\n    }\r\n    const wordStart = getWordStart(this.words, index, this.context.assert);\r\n\r\n    // possibly insert or delete whitespace before or after the word being added or deleted\r\n\r\n    // if we delete the whole word and this isn't the last word then also delete the space after this word\r\n    const deleteSpaceAfter = newValue === \"\" && index < nWords - 1;\r\n    if (deleteSpaceAfter) {\r\n      this.assertSpaceAt(wordStart + editingWord.length);\r\n    }\r\n    // if we delete the last word then delete the space before it\r\n    const deleteSpaceBefore = newValue === \"\" && index === nWords - 1 && index !== 0;\r\n    if (deleteSpaceBefore) {\r\n      this.assertSpaceAt(wordStart - 1);\r\n    }\r\n    // if we add another word beyond a previous word (i.e. beyond the end of the buffer) then insert the space before it\r\n    const addSpaceBefore = wordStart === this.atBufferEnd() && index;\r\n    if (addSpaceBefore) {\r\n      // assert this word was previously empty and is being changed to non-empty\r\n      this.context.assert(!editingWord.length && !!newValue.length, \"unexpected at end of buffer\");\r\n    }\r\n\r\n    log(\"replaceElement\", {\r\n      deleteSpaceAfter,\r\n      deleteSpaceBefore,\r\n      addSpaceBefore,\r\n    });\r\n    // calculate the deleteCount, and adjust deleteCount and/or wordStart and/or newValue, to insert or delete spaces\r\n\r\n    const deleteCount: number = editingWord.length + (deleteSpaceAfter || deleteSpaceBefore ? 1 : 0);\r\n    const spliceStart: number = deleteSpaceBefore || addSpaceBefore ? wordStart - 1 : wordStart;\r\n    const spliceValue: string = !addSpaceBefore ? newValue : \" \" + newValue;\r\n\r\n    // mutate the buffer\r\n    this.buffer = stringSplice(this.buffer, spliceStart, deleteCount, spliceValue);\r\n    // mutate the word in the elements array\r\n    if (newValue.length) {\r\n      this.words[index] = newValue;\r\n    } else {\r\n      this.words.splice(index, 1);\r\n    }\r\n\r\n    // adjust the selected range after mutating the text\r\n    if (selection) {\r\n      // called from constructor where new selection is taken from the <input> element\r\n      const wordStart = getWordStart(this.words, index, this.context.assert);\r\n      this.selection.start = selection.start + wordStart;\r\n      this.selection.end = selection.end + wordStart;\r\n    } else {\r\n      // called from onDeleteTag where existing selection must be adjusted to account for the deleted element\r\n      if (this.selection.start > wordStart) {\r\n        this.selection.start -= deleteCount;\r\n      }\r\n      if (this.selection.end > wordStart) {\r\n        this.selection.end -= deleteCount;\r\n      }\r\n    }\r\n    this.invariant();\r\n  }\r\n\r\n  private invariant() {\r\n    // we mutate the state but because we make several mutations this asserts that the state remains sane or predictable\r\n    assertWords(this.words, this.buffer, this.context.assert);\r\n  }\r\n  private assertSpaceAt(index: number) {\r\n    this.context.assert(this.buffer.substring(index, index + 1) === \" \", \"expected a space at this location\");\r\n  }\r\n\r\n  remove(start: number, deleteCount: number): void {\r\n    this.buffer = stringSplice(this.buffer, start, deleteCount, \"\");\r\n  }\r\n\r\n  // the start and end of the selection range are usually the same\r\n  setSelectionBoth(where: number): void {\r\n    this.selection.start = where;\r\n    this.selection.end = where;\r\n  }\r\n  setSelectionStart(where: number): void {\r\n    this.selection.start = where;\r\n  }\r\n  setSelectionEnd(where: number): void {\r\n    this.selection.end = where;\r\n  }\r\n  // the location of the selection index beyond the end of the buffer (starting the empty, to-be-defined next tag)\r\n  atBufferEnd(): number {\r\n    return this.buffer.length ? this.buffer.length + 1 : 0;\r\n  }\r\n\r\n  selectEndOf(index: number) {\r\n    const wordStart = getWordStart(this.words, index, this.context.assert);\r\n    this.setSelectionBoth(wordStart + this.words[index].length);\r\n  }\r\n  focus() {\r\n    this.context.inputElement.focus();\r\n  }\r\n}\r\n\r\n// we want to display a maximum of 6 hints\r\nconst maxHints = 6;\r\n\r\n// this is a class to lookup hints for existing tags which match the current input value\r\nexport class TagDictionary {\r\n  // the current implementation repeatedly iterates the whole dictionary\r\n  // if that's slow (because the dictionary is large) in future we could partition the dictionary by letter\r\n  private readonly tags: TagCount[];\r\n  constructor(tags: TagCount[]) {\r\n    this.tags = tags;\r\n  }\r\n  getHints(inputValue: string, elements: RenderedElement[]): TagCount[] {\r\n    if (!inputValue.length) {\r\n      return [];\r\n    }\r\n    // don't want what we already have i.e. what matches other tags\r\n    const unwanted: string[] = elements.filter((x) => x.type === \"tag\").map((x) => x.word);\r\n    // we'll select tags in the following priority:\r\n    // 1. Tags where the inputValue matches the beginning of the tag\r\n    // 2. If #1 returns too many tags, then prefer tags with a higher count because they're the more popular/more likely\r\n    // 3. If #1 doesn't return enough tags, then find tags where the inputValue matches within the tag\r\n    // 4. If #3 returns too many tags, then prefer tags with a higher count\r\n    const findTags = (start: boolean, max: number): TagCount[] => {\r\n      const found = this.tags\r\n        .filter((tag) => (start ? tag.key.startsWith(inputValue) : tag.key.substring(1).includes(inputValue)))\r\n        .filter((x) => !unwanted.includes(x.key));\r\n      // higher counts first, else alphabetic\r\n      found.sort((x, y) => (x.count === y.count ? x.key.localeCompare(y.key) : y.count - x.count));\r\n      return found.slice(0, max);\r\n    };\r\n    const found = findTags(true, maxHints);\r\n    return found.length === maxHints ? found : found.concat(findTags(false, maxHints - found.length));\r\n  }\r\n  exists(inputValue: string): boolean {\r\n    return this.tags.some((tag) => tag.key === inputValue);\r\n  }\r\n  toJSON(): string {\r\n    // not worth logging all the elements\r\n    return `${this.tags.length} elements`;\r\n  }\r\n}\r\n\r\n/*\r\n  The reducer\r\n*/\r\n\r\ninterface ActionEditorClick {\r\n  type: \"EditorClick\";\r\n  context: Context;\r\n}\r\ninterface ActionHintResult {\r\n  type: \"HintResult\";\r\n  context: Context;\r\n  hint: string;\r\n  inputIndex: number;\r\n}\r\ninterface ActionDeleteTag {\r\n  type: \"DeleteTag\";\r\n  context: Context;\r\n  index: number;\r\n}\r\ninterface ActionTagClick {\r\n  type: \"TagClick\";\r\n  context: Context;\r\n  index: number;\r\n}\r\ninterface ActionKeyDown {\r\n  type: \"KeyDown\";\r\n  context: Context;\r\n  key: string;\r\n  shiftKey: boolean;\r\n}\r\ninterface ActionChange {\r\n  type: \"Change\";\r\n  context: Context;\r\n}\r\n\r\nexport type Action =\r\n  | ActionEditorClick\r\n  | ActionHintResult\r\n  | ActionDeleteTag\r\n  | ActionTagClick\r\n  | ActionKeyDown\r\n  | ActionChange;\r\n\r\nfunction isEditorClick(action: Action): action is ActionEditorClick {\r\n  return action.type === \"EditorClick\";\r\n}\r\nfunction isHintResult(action: Action): action is ActionHintResult {\r\n  return action.type === \"HintResult\";\r\n}\r\nfunction isDeleteTag(action: Action): action is ActionDeleteTag {\r\n  return action.type === \"DeleteTag\";\r\n}\r\nfunction isTagClick(action: Action): action is ActionTagClick {\r\n  return action.type === \"TagClick\";\r\n}\r\nfunction isKeyDown(action: Action): action is ActionKeyDown {\r\n  return action.type === \"KeyDown\";\r\n}\r\nfunction isChange(action: Action): action is ActionChange {\r\n  return action.type === \"Change\";\r\n}\r\n\r\nexport function reducer(state: RenderedState, action: Action): RenderedState {\r\n  log(\"reducer\", action);\r\n  const inputElement = action.context.inputElement;\r\n\r\n  // this function returns a MutableState instance, which is based on the previous state plus the passed-in context\r\n  // the passed-in context includes the new content of the <input> element\r\n  function getMutableState(): MutableState {\r\n    logRenderedState(\"getMutableState\", state);\r\n    return new MutableState(state, action.context);\r\n  }\r\n  // this function returns a InputState instance\r\n  function getInputState(): InputState {\r\n    return new InputState(state, inputElement, action.context.assert);\r\n  }\r\n\r\n  if (isChange(action)) {\r\n    const mutableState: MutableState = getMutableState();\r\n    return mutableState.getState();\r\n  }\r\n\r\n  if (isEditorClick(action)) {\r\n    // click on the <div> => set focus on the <input> within the <div>\r\n    inputElement.focus();\r\n    const mutableState: MutableState = getMutableState();\r\n    mutableState.setSelectionBoth(mutableState.atBufferEnd());\r\n    return mutableState.getState();\r\n  }\r\n\r\n  if (isHintResult(action)) {\r\n    // click on a hint => set focus on the <input>\r\n    inputElement.focus();\r\n    const mutableState: MutableState = getMutableState();\r\n    mutableState.replaceElement(action.inputIndex, action.hint);\r\n    mutableState.setSelectionBoth(mutableState.atBufferEnd());\r\n    return mutableState.getState();\r\n  }\r\n\r\n  if (isDeleteTag(action)) {\r\n    const mutableState: MutableState = getMutableState();\r\n    mutableState.replaceElement(action.index, \"\");\r\n    return mutableState.getState();\r\n  }\r\n\r\n  if (isTagClick(action)) {\r\n    const mutableState: MutableState = getMutableState();\r\n    // want to position the cursor at the end of the selected word\r\n    mutableState.selectEndOf(action.index);\r\n    // clicking on the tag made the input lose the focus\r\n    mutableState.focus();\r\n    return mutableState.getState();\r\n  }\r\n\r\n  if (isKeyDown(action)) {\r\n    const { key, shiftKey } = action;\r\n    switch (key) {\r\n      case \"Home\":\r\n      case \"ArrowUp\": {\r\n        // move selection to start of first tag\r\n        const mutableState: MutableState = getMutableState();\r\n        mutableState.setSelectionBoth(0);\r\n        return mutableState.getState();\r\n      }\r\n\r\n      case \"End\":\r\n      case \"ArrowDown\": {\r\n        // move selection to end of last tag\r\n        const mutableState: MutableState = getMutableState();\r\n        mutableState.setSelectionBoth(mutableState.atBufferEnd());\r\n        return mutableState.getState();\r\n      }\r\n\r\n      case \"ArrowLeft\": {\r\n        const inputState: InputState = getInputState();\r\n        // we're at the left of the input so traverse into the previous tag\r\n        const mutableState: MutableState = getMutableState();\r\n        const wanted = inputState.nextLeft;\r\n        if (shiftKey) {\r\n          mutableState.setSelectionStart(wanted);\r\n        } else {\r\n          mutableState.setSelectionBoth(wanted);\r\n        }\r\n        return mutableState.getState();\r\n      }\r\n      case \"ArrowRight\": {\r\n        const inputState: InputState = getInputState();\r\n        // we're at the right of the input so traverse into the next tag\r\n        const mutableState: MutableState = getMutableState();\r\n        const wanted = inputState.nextRight;\r\n        if (shiftKey) {\r\n          mutableState.setSelectionEnd(wanted);\r\n        } else {\r\n          mutableState.setSelectionBoth(wanted);\r\n        }\r\n        return mutableState.getState();\r\n      }\r\n      case \"Backspace\": {\r\n        // same as ArrowLeft except also delete the space between the two tags\r\n        const inputState: InputState = getInputState();\r\n        const mutableState: MutableState = getMutableState();\r\n        if (shiftKey) {\r\n          // also delete whatever is selected\r\n          inputState.removeSelected(mutableState);\r\n        }\r\n        const wanted = inputState.nextLeft;\r\n        mutableState.remove(wanted, 1);\r\n        mutableState.setSelectionBoth(wanted);\r\n        return mutableState.getState();\r\n      }\r\n      case \"Delete\": {\r\n        // same as ArrowRight except also delete the space between the two tags\r\n        const inputState: InputState = getInputState();\r\n        const mutableState: MutableState = getMutableState();\r\n        if (shiftKey) {\r\n          // also delete whatever is selected\r\n          inputState.removeSelected(mutableState);\r\n        }\r\n        const wanted = inputState.currentStart;\r\n        mutableState.remove(wanted, 1);\r\n        mutableState.setSelectionBoth(wanted);\r\n        return mutableState.getState();\r\n      }\r\n      default:\r\n        break;\r\n    } // switch\r\n  } // if isKeyDown\r\n\r\n  logRenderedState(\"reducer returning old state\", state);\r\n  return state;\r\n} // reducer\r\n\r\n/*\r\n  Various helper functions\r\n*/\r\n\r\n// Helper function analogous to Array.splice -- string has built-in slice but no splice\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/splice\r\nfunction stringSplice(text: string, start: number, deleteCount: number, insert: string): string {\r\n  // up to but not including start\r\n  const textStart = text.substring(0, start);\r\n  const textEnd = text.substring(start + deleteCount);\r\n  const after = textStart + insert + textEnd;\r\n  log(\"stringSplice\", { text, start, deleteCount, insert, after });\r\n  return after;\r\n}\r\n\r\nexport function log(title: string, o: object, force?: boolean): void {\r\n  if (!isLogging && !force) {\r\n    return;\r\n  }\r\n  const json = JSON.stringify(o, null, 2);\r\n  console.log(`${title} -- ${json}`);\r\n}\r\n\r\nfunction logRenderedState(title: string, renderedState: RenderedState): void {\r\n  log(title, renderedState);\r\n}\r\n\r\n// this identifies the index of the one-and-only <input> element within the array of RenderedElement\r\nfunction getInputIndex(\r\n  elements: ReadonlyArray<RenderedElement>,\r\n  assert: Assert\r\n): { inputIndex: number; isFirst: boolean; isLast: boolean } {\r\n  let inputIndex: number = 0;\r\n  let counted = 0;\r\n  for (let i = 0; i < elements.length; ++i) {\r\n    if (elements[i].type === \"input\") {\r\n      ++counted;\r\n      inputIndex = i;\r\n    }\r\n  }\r\n  assert(counted === 1, \"expected exactly one input element\");\r\n  return {\r\n    inputIndex,\r\n    isFirst: inputIndex === 0,\r\n    isLast: inputIndex === elements.length - 1,\r\n  };\r\n}\r\n\r\n// the getElementStart and assertElements functions have two versions\r\n// i.e. they work with ReadonlyArray<RenderedElement> or ReadonlyArray<string>\r\n// that's because the MutableState class works with ReadonlyArray<string> instead of ReadonlyArray<RenderedElement>\r\n// because it doesn't yet know the type associated with each word\r\n\r\n// Helper function to determine the offset into the buffer associated with a given RenderedElement\r\nfunction getElementStart(elements: ReadonlyArray<RenderedElement>, index: number, assert: Assert): number {\r\n  return getWordStart(\r\n    elements.map((x) => x.word),\r\n    index,\r\n    assert\r\n  );\r\n}\r\nfunction getWordStart(words: ReadonlyArray<string>, index: number, assert: Assert): number {\r\n  let wordStart = 0;\r\n  for (let i = 0; i < index; ++i) {\r\n    const word = words[i];\r\n    // +1 because there's a whitespace between i.e. after each word\r\n    wordStart += word.length + 1;\r\n    // assert all words are significant (and visible)\r\n    // it's OK if the last word is empty i.e. if the <input> element is beyond the end of the buffer\r\n    // that wouldn't trigger this assertion because we're only testing for all i < index\r\n    assert(!!word.length, \"getWordStart unexpected zero-length word\");\r\n  }\r\n  return wordStart;\r\n}\r\n\r\n// assert that the state is as predicted\r\nfunction assertElements(elements: ReadonlyArray<RenderedElement>, buffer: string, assert: Assert): void {\r\n  assertWords(\r\n    elements.map((x) => x.word),\r\n    buffer,\r\n    assert\r\n  );\r\n  getInputIndex(elements, assert);\r\n  elements.forEach((element, index) =>\r\n    assert(\r\n      !!element.word.length || (element.type === \"input\" && index === elements.length - 1),\r\n      \"unexpected zero-length word\"\r\n    )\r\n  );\r\n}\r\nfunction assertWords(words: ReadonlyArray<string>, buffer: string, assert: Assert): void {\r\n  for (let i = 0; i < words.length; ++i) {\r\n    const word = words[i];\r\n    const wordStart = getWordStart(words, i, assert);\r\n    const fragment = buffer.substring(wordStart, wordStart + word.length);\r\n    assert(\r\n      word === fragment,\r\n      \"assertElements\",\r\n      // don't bother to call JSON.stringify unless the assertion has actually failed\r\n      () => {\r\n        return {\r\n          word,\r\n          fragment,\r\n          wordStart,\r\n          length: word.length,\r\n          buffer,\r\n          words,\r\n        };\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\nfunction getTextWidth(text: string) {\r\n  // https://stackoverflow.com/a/21015393/49942\r\n  const getContext = (): CanvasRenderingContext2D | undefined => {\r\n    if (!(getTextWidth as any).canvas) {\r\n      const canvas = document.createElement(\"canvas\");\r\n      const context = canvas.getContext(\"2d\");\r\n      if (!context) {\r\n        return undefined;\r\n      }\r\n      // matches the font famly and size defined in App.css\r\n      context.font = '14px Arial, \"Helvetica Neue\", Helvetica, sans-serif';\r\n      (getTextWidth as any).canvas = canvas;\r\n      (getTextWidth as any).context = context;\r\n    }\r\n    return (getTextWidth as any).context as CanvasRenderingContext2D;\r\n  };\r\n  const context = getContext();\r\n  if (!context) {\r\n    return 20;\r\n  }\r\n  return context.measureText(text).width;\r\n}\r\n\r\n/*\r\n  Functions which construct the RenderedState\r\n*/\r\n\r\n// this function calculates a new RenderedState and sets the InputElement content and selection, for a given State value\r\n// it's called from initialState and from MutableState\r\nfunction renderState(\r\n  state: State,\r\n  assert: Assert,\r\n  validation: Validation,\r\n  inputElement?: InputElement,\r\n  tagDictionary?: TagDictionary\r\n): RenderedState {\r\n  const elements: RenderedElement[] = [];\r\n  let editing: number | undefined = undefined;\r\n  let inputValue: string = \"\";\r\n\r\n  function setInput(text: string, start: number, end: number, inputElement: InputElement): void {\r\n    log(\"setInput\", { text, start, end });\r\n    inputElement.setContent(text, start, end);\r\n    inputValue = text;\r\n    assert(start >= 0 && end <= text.length, `setInput invalid range: ${text} ${start} ${end}`);\r\n  }\r\n\r\n  function addElement(type: \"tag\" | \"input\", word: string): void {\r\n    const isValid: boolean = !word.length || validation.canNewTag || (!!tagDictionary && tagDictionary.exists(word));\r\n    elements.push({ type, word, isValid });\r\n  }\r\n\r\n  // split the buffer\r\n  const words: string[] = state.buffer.split(\" \").filter((word) => word.length);\r\n  const selection = state.selection;\r\n\r\n  // this is where each word starts, an index into the buffer\r\n  let wordStart = 0;\r\n  // this accumulates previous words within the selection, when selection is a range which spans more than one word\r\n  let accumulated: { wordStart: number; start: number; text: string } | undefined = undefined;\r\n\r\n  for (let wordIndex = 0; wordIndex < words.length; ++wordIndex) {\r\n    const word = words[wordIndex];\r\n    // e.g. if a word's length is 1, then the positions within this word are 0 (start) and 1 (end)\r\n    const wordEnd = wordStart + word.length;\r\n    if (selection.start > wordEnd || selection.end < wordStart) {\r\n      // selection is not in this word\r\n      // - selection starts beyond the end of the word\r\n      // - or selection ends before the start of the word\r\n      addElement(\"tag\", word);\r\n    } else {\r\n      if (!inputElement) {\r\n        // the initialState function should set the selection at the end of the buffer\r\n        // i.e. beyond any words (if there are any words)\r\n        // or at the start of the buffer if there are no words,\r\n        // so that it isn't necessary to set the selection inside the input element\r\n        // given that the input element hasn't been created in the DOM yet\r\n        assert(false, \"invalid initial state\");\r\n        continue;\r\n      }\r\n      // selection includes some of this word\r\n      // - selection starts on or before the end of the word\r\n      // - or selection ends on or after the start of the word\r\n      if (selection.start >= wordStart) {\r\n        // selection starts in this word\r\n        if (selection.end <= wordEnd) {\r\n          // selection starts and ends in this word\r\n          setInput(word, selection.start - wordStart, selection.end - wordStart, inputElement);\r\n          editing = elements.length;\r\n          addElement(\"input\", word);\r\n        } else {\r\n          // starts in this word but ends in a future word\r\n          assert(!accumulated, \"shouldn't accumulate anything previously\");\r\n          accumulated = {\r\n            wordStart,\r\n            start: selection.start - wordStart,\r\n            text: word,\r\n          };\r\n        }\r\n      } else {\r\n        // selection started before this word\r\n        if (!accumulated) {\r\n          assert(false, \"should have accumulated something previously\");\r\n          continue; // this is bad but better than referencing accumulated when it's undefined\r\n        }\r\n        // add to what's already accumulated, including inter-word whitespace\r\n        accumulated.text += \" \" + word;\r\n        if (selection.end <= wordEnd) {\r\n          // selection ends in this word\r\n          setInput(accumulated.text, accumulated.start, selection.end - accumulated.wordStart, inputElement);\r\n          editing = elements.length;\r\n          addElement(\"input\", accumulated.text);\r\n          accumulated = undefined;\r\n        } else {\r\n          // selection ends in a future word (and we already added this word to the accumulator)\r\n        }\r\n      }\r\n    }\r\n    wordStart += word.length + 1;\r\n  }\r\n\r\n  if (typeof editing === \"undefined\") {\r\n    // we haven't pushed the <input> element yet, so push it now\r\n    editing = elements.length;\r\n    // if (initializing) then the `input` and `inputRef` values haven't yet been created because the state is created\r\n    // before they are, via the call to initialState -- but when it is created it's initially empty so that's alright\r\n    if (inputElement) {\r\n      // the <input> element is already part of the DOM; reset it now\r\n      setInput(\"\", 0, 0, inputElement);\r\n    }\r\n    addElement(\"input\", \"\");\r\n  }\r\n\r\n  assertElements(elements, state.buffer, assert);\r\n\r\n  const hints: TagCount[] = !tagDictionary ? [] : tagDictionary.getHints(inputValue, elements);\r\n  // if logging only log the keyword of each hint, otherwise logging the tags' summaries makes it long and hard to read\r\n  (hints as any).toJSON = () => \"[\" + hints.map((hint) => hint.key).join(\",\") + \"]\";\r\n\r\n  function getValidationError(): string {\r\n    const nWords: number = elements.filter((element) => !!element.word.length).length;\r\n    const invalid: string[] = elements.filter((element) => !element.isValid).map((element) => element.word);\r\n    if (nWords < 1 && validation.minimum) {\r\n      return \"Please enter at least one tag;\";\r\n    }\r\n    if (nWords > 5 && validation.maximum) {\r\n      return \"Please enter a maximum of five tags.\";\r\n    }\r\n    if (!!invalid.length) {\r\n      return invalid.length === 1\r\n        ? `Tag '${invalid[0]}' does not match an existing topic.`\r\n        : `Tags ${invalid.map((word) => \"'\" + word + \"'\").join(\" and \")} do not match existing topics.`;\r\n    }\r\n    return \"\";\r\n  }\r\n  const validationError = getValidationError();\r\n\r\n  const renderedState: RenderedState = {\r\n    state,\r\n    elements,\r\n    inputValue,\r\n    hints,\r\n    validationError,\r\n  };\r\n  return renderedState;\r\n}\r\n\r\n// this function calculates the initial state, calculated from props and used to initialize useState\r\nexport function initialState(assert: Assert, inputTags: string[], validation: Validation): RenderedState {\r\n  assert(!inputTags.some((found) => found !== found.trim()), \"input tags not trimmed\", () => {\r\n    return { inputTags };\r\n  });\r\n  const buffer = inputTags.join(\" \");\r\n  const start = buffer.length + 1;\r\n  const state: State = { buffer, selection: { start, end: start } };\r\n\r\n  log(\"initialState starting\", { inputTags });\r\n  const renderedState: RenderedState = renderState(state, assert, validation);\r\n  logRenderedState(\"initialState returning\", renderedState);\r\n  return renderedState;\r\n}\r\n\r\nexport function getOnSelectTags(\r\n  assert: Assert,\r\n  validation: Validation,\r\n  result: ParentCallback,\r\n  dispatch: (action: Action) => void,\r\n  state: RenderedState,\r\n  tagDictionary?: TagDictionary\r\n) {\r\n  function getContext(inputElement: HTMLInputElement): Context {\r\n    return {\r\n      inputElement: new InputElement(inputElement, assert),\r\n      assert,\r\n      result,\r\n      tagDictionary,\r\n      validation,\r\n    };\r\n  }\r\n\r\n  function onEditorClick(inputElement: HTMLInputElement) {\r\n    dispatch({ type: \"EditorClick\", context: getContext(inputElement) });\r\n  }\r\n  function onDeleteTag(index: number, inputElement: HTMLInputElement) {\r\n    dispatch({ type: \"DeleteTag\", context: getContext(inputElement), index });\r\n  }\r\n  function onTagClick(index: number, inputElement: HTMLInputElement) {\r\n    dispatch({ type: \"TagClick\", context: getContext(inputElement), index });\r\n  }\r\n  function onChange(inputElement: HTMLInputElement) {\r\n    dispatch({ type: \"Change\", context: getContext(inputElement) });\r\n  }\r\n  function onKeyDown(inputElement: HTMLInputElement, key: string, shiftKey: boolean): boolean {\r\n    if (key === \"Enter\") {\r\n      // do nothing and prevent form submission\r\n      return true;\r\n    }\r\n    // apparently dispatch calls the reducer asynchonously, i.e. after this event handler returns, which will be too\r\n    // late to call e.preventDefault(), and so we need two-stage processing, i.e. some here and some inside the reducer:\r\n    // - here we need to test whether the action will or should be handled within the reducer\r\n    // - later in the reducer we need to actually perform the action\r\n    function newinputState() {\r\n      return new InputState(state, new InputElement(inputElement, assert), assert);\r\n    }\r\n    function isHandled(): boolean {\r\n      switch (key) {\r\n        case \"Home\":\r\n        case \"ArrowUp\":\r\n          // move selection to start of first tag\r\n          return !getInputIndex(state.elements, assert).isFirst;\r\n        case \"End\":\r\n        case \"ArrowDown\":\r\n          // move selection to end of last tag\r\n          return !getInputIndex(state.elements, assert).isLast;\r\n        case \"ArrowLeft\":\r\n        case \"Backspace\": {\r\n          const inputState: InputState = newinputState();\r\n          return inputState.canMoveLeft;\r\n        }\r\n        case \"ArrowRight\":\r\n        case \"Delete\": {\r\n          const inputState: InputState = newinputState();\r\n          return inputState.canMoveRight;\r\n        }\r\n        default:\r\n          break;\r\n      } // switch\r\n      return false;\r\n    }\r\n    if (isHandled()) {\r\n      const context: Context = getContext(inputElement);\r\n      dispatch({ type: \"KeyDown\", context, key, shiftKey });\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  function onHintResult(inputElement: HTMLInputElement, outputTag: string) {\r\n    const { inputIndex } = getInputIndex(state.elements, assert);\r\n    dispatch({\r\n      type: \"HintResult\",\r\n      context: getContext(inputElement),\r\n      hint: outputTag,\r\n      inputIndex,\r\n    });\r\n  }\r\n\r\n  return { onEditorClick, onDeleteTag, onTagClick, onChange, onKeyDown, onHintResult };\r\n}\r\n","import { Data } from \"client\";\r\nimport React from \"react\";\r\nimport {\r\n  Action,\r\n  Assert,\r\n  initialState,\r\n  reducer,\r\n  RenderedState,\r\n  TagDictionary,\r\n  Validation,\r\n} from \"../components/SelectTagsState\";\r\n\r\ntype TagCount = Data.TagCount;\r\n\r\nexport function useSelectTags(\r\n  inputTags: string[],\r\n  getAllTags: () => Promise<TagCount[]>,\r\n  validation: Validation\r\n): {\r\n  state: RenderedState;\r\n  dispatch: React.Dispatch<Action>;\r\n  tagDictionary: TagDictionary | undefined;\r\n  assert: Assert;\r\n  errorMessage: string | undefined;\r\n} {\r\n  // this is an optional error message\r\n  const [errorMessage, setErrorMessage] = React.useState<string | undefined>(undefined);\r\n\r\n  function assert(assertion: boolean, message: string, extra?: () => object): void {\r\n    if (!assertion) {\r\n      if (extra) {\r\n        const o: object = extra();\r\n        const json = JSON.stringify(o, null, 2);\r\n        message = `${message} -- ${json}`;\r\n      }\r\n      // write to errorMessage state means it's displayed by the `<ErrorMessage errorMessage={errorMessage} />` element\r\n      setTimeout(() => {\r\n        // do it after a timeout because otherwise if we do this during a render then React will complain with:\r\n        //   \"Too many re-renders. React limits the number of renders to prevent an infinite loop.\"\r\n        setErrorMessage(message);\r\n      }, 0);\r\n      console.error(message);\r\n    }\r\n  }\r\n\r\n  // see ./EDITOR.md and the definition of the RenderedState interface for a description of this state\r\n  // also https://fettblog.eu/typescript-react/hooks/#usereducer says that type is infered from signature of reducer\r\n  const [state, dispatch] = React.useReducer(reducer, inputTags, (inputTags) =>\r\n    initialState(assert, inputTags, validation)\r\n  );\r\n\r\n  // this is a dictionary of existing tags\r\n  const [tagDictionary, setTagDictionary] = React.useState<TagDictionary | undefined>(undefined);\r\n\r\n  // useEffect to fetch all the tags from the server exactly once\r\n  // React's elint rules demand that getAllTags be specified in the deps array, but the value of getAllTags\r\n  // (which we're being passed as a parameter) is utimately a function at module scope, so it won't vary\r\n  React.useEffect(() => {\r\n    // get tags from server\r\n    getAllTags()\r\n      .then((tags) => {\r\n        // use them to contruct a dictionary\r\n        const tagDictionary: TagDictionary = new TagDictionary(tags);\r\n        // save the dictionary in state\r\n        setTagDictionary(tagDictionary);\r\n      })\r\n      .catch((reason) => {\r\n        // alarm the user\r\n        setErrorMessage(`getAllTags() failed -- ${reason}`);\r\n      });\r\n  }, [getAllTags]);\r\n\r\n  /*\r\n    Event handlers\r\n  */\r\n\r\n  return { state, dispatch, tagDictionary, assert, errorMessage };\r\n}\r\n","import React from \"react\";\r\nimport \"ui-assets/css/ErrorMessage.css\";\r\n\r\n/*\r\n  Simple component to show an error message (or not if there isn't one)\r\n*/\r\n\r\nexport interface ErrorMessageProps {\r\n  errorMessage?: string;\r\n  bold?: boolean;\r\n}\r\n\r\nexport const ErrorMessage: React.FunctionComponent<ErrorMessageProps> = (props: ErrorMessageProps) => {\r\n  const className: string = (props.errorMessage ? \"error\" : \"hidden\") + (props.bold ? \" bold\" : \"\");\r\n  return <p className={className}>{props.errorMessage}</p>;\r\n};\r\n","import React from \"react\";\r\nimport \"ui-assets/css/ErrorMessage.css\";\r\nimport { CreateAny, createChild } from \"../components/createChild\";\r\nimport { getSubmitButton } from \"../components/getSubmitButton\";\r\nimport { createLabel } from \"../components/Label\";\r\n\r\n/*\r\n  Component to display an <input> or <taxarea> element with a validation error message\r\n*/\r\n\r\ninterface ValidationOptions {\r\n  optional?: boolean;\r\n  minLength?: number;\r\n}\r\n\r\nexport interface Input {\r\n  label: string;\r\n  hideLabel?: boolean;\r\n  options: ValidationOptions;\r\n  create: CreateAny;\r\n}\r\n\r\nexport function useValidatedInput<T extends object>(\r\n  inputs: Map<keyof T, Input>,\r\n  initialState: T,\r\n  buttonText: { label: string; noun: string }\r\n): {\r\n  currentState: T;\r\n  isError: boolean;\r\n  isAfterSubmit: boolean;\r\n  button: React.ReactElement;\r\n  mapInputs: Map<keyof T, React.ReactElement>;\r\n  onSubmitError: (error: Error) => void;\r\n} {\r\n  // ideally TypeScript could deduce the type arguments of React.useReducer from the parameters passed to it\r\n  // but it gets confused if we don't specify those arguments, perhaps because the parameters are themselves generic,\r\n  const [state, dispatch] = React.useReducer<React.Reducer<ValidatedState<T>, Action<T>>>(\r\n    reducer,\r\n    createInitialState(inputs, initialState)\r\n  );\r\n  const { mapInputs, button } = createValidated<T>(state, dispatch, buttonText);\r\n  const onSubmitError = (error: Error) => dispatch({ key: \"onSubmitError\", newValue: error.message });\r\n  return {\r\n    currentState: state.posted,\r\n    isError: state.errorMessages.size !== 0,\r\n    isAfterSubmit: state.isAfterSubmit,\r\n    button,\r\n    mapInputs,\r\n    onSubmitError,\r\n  };\r\n}\r\n\r\n/*\r\n  State to contain the data for validated elements\r\n\r\n  Assume that input/initial data values of type T will to be posted to the server in an object of type T.\r\n*/\r\n\r\ninterface ValidatedState<T extends object> {\r\n  // initial state defines the initial defaultValue for each input element\r\n  defaultValues: T;\r\n  // edited state to be posted\r\n  posted: T;\r\n  // validation errors\r\n  errorMessages: Map<keyof T, string>;\r\n  // could define input elsewhere, but it's convenient to define it here in state where it's accessible to dispatcher\r\n  inputs: Map<keyof T, Input>;\r\n  // don't display validation errors until after first submit attempt\r\n  isAfterSubmit: boolean;\r\n  // summary of other validation errors, displayed next to the submit button\r\n  onSubmitError: string | undefined;\r\n}\r\n\r\nfunction createInitialState<T extends object>(inputs: Map<keyof T, Input>, state: T): ValidatedState<T> {\r\n  const errorMessages = new Map<keyof T, string>();\r\n  // test the initial validity of each value (which will be recalculated onChange)\r\n  inputs.forEach((input, key) => {\r\n    const value = state[key];\r\n    if (typeof value === \"string\") {\r\n      const errorMessage = validate(value, input.options, input.label);\r\n      if (errorMessage) {\r\n        errorMessages.set(key, errorMessage);\r\n      }\r\n    } else {\r\n      throw new Error(\"This type of input validation can only be used for string-type elements\");\r\n    }\r\n  });\r\n  return {\r\n    posted: state,\r\n    defaultValues: state,\r\n    errorMessages,\r\n    inputs,\r\n    isAfterSubmit: false,\r\n    onSubmitError: undefined,\r\n  };\r\n}\r\n\r\n/*\r\n  A reducer for the above state\r\n*/\r\n\r\ntype Action<T extends object> = {\r\n  key: keyof T | \"onSubmit\" | \"onSubmitError\";\r\n  newValue: string;\r\n};\r\n\r\nfunction reducer<T extends object>(old: ValidatedState<T>, action: Action<T>): ValidatedState<T> {\r\n  const { key, newValue } = action;\r\n  let { posted, errorMessages, isAfterSubmit: onSubmit, onSubmitError, defaultValues } = old;\r\n  if (key === \"onSubmit\") {\r\n    onSubmit = true;\r\n  } else if (key === \"onSubmitError\") {\r\n    onSubmitError = newValue;\r\n  } else {\r\n    onSubmitError = undefined;\r\n    // new state from old state\r\n    posted = { ...posted };\r\n    // cast to any because this template doesn't know that every element is of type string\r\n    // alternative would be to add an\r\n    (posted as any)[key] = newValue;\r\n    // input data for this key\r\n    const input = old.inputs.get(key)!;\r\n    // errorMessage for this value\r\n    const errorMessage = validate(newValue, input.options, input.label);\r\n    // clone from the old state\r\n    errorMessages = new Map<keyof T, string>(errorMessages);\r\n    // insert new error message\r\n    if (!errorMessage) {\r\n      errorMessages.delete(key);\r\n    } else {\r\n      errorMessages.set(key, errorMessage);\r\n    }\r\n  }\r\n  // return new state (including unaltered copy of input)\r\n  return {\r\n    posted,\r\n    errorMessages,\r\n    inputs: old.inputs,\r\n    isAfterSubmit: onSubmit,\r\n    onSubmitError,\r\n    defaultValues,\r\n  };\r\n}\r\n\r\n/*\r\n  A factory which creates Validated elements (and a Validated submit button) from the above input\r\n*/\r\n\r\nfunction createValidated<T extends object>(\r\n  state: ValidatedState<T>,\r\n  dispatch: React.Dispatch<Action<T>>,\r\n  buttonText: { label: string; noun: string }\r\n): {\r\n  mapInputs: Map<keyof T, React.ReactElement>;\r\n  button: React.ReactElement;\r\n} {\r\n  // created a Validated element for each key\r\n  const mapInputs: Map<keyof T, React.ReactElement> = new Map<keyof T, React.ReactElement>();\r\n  state.inputs.forEach((input, key) => {\r\n    // the child's onChange handler goes into the dispatcher with an added key\r\n    const handleChange: (newValue: string) => void = (newValue: string) => dispatch({ key, newValue });\r\n    // create the label\r\n    const label = createLabel(input.label, input.hideLabel);\r\n    // and other input parameters\r\n    const errorMessage: string | undefined = !state.isAfterSubmit ? undefined : state.errorMessages.get(key);\r\n    const { create } = input;\r\n    const defaultValue = \"\" + state.defaultValues[key];\r\n    // created the Validated and its child\r\n    const validated = createChild(create, defaultValue, handleChange, label, errorMessage);\r\n    mapInputs.set(key, validated);\r\n  });\r\n  // also create a button\r\n  function getButtonError(state: ValidatedState<T>): string | undefined {\r\n    const countErrors = state.errorMessages.size;\r\n    const error = countErrors === 1 ? \"error\" : \"errors\";\r\n    const rc: string | undefined = state.onSubmitError\r\n      ? state.onSubmitError\r\n      : !state.isAfterSubmit || !countErrors\r\n      ? undefined\r\n      : `Your ${buttonText.noun} couldn't be submitted. Please see the ${error} above.`;\r\n    return rc;\r\n  }\r\n  const button = getSubmitButton(\r\n    buttonText.label,\r\n    () => dispatch({ key: \"onSubmit\", newValue: \"\" }),\r\n    getButtonError(state)\r\n  );\r\n  return { mapInputs, button };\r\n}\r\n\r\n/*\r\n  Function to define standard validation options, called from createInitialState and from reducer\r\n*/\r\n\r\nfunction validate(value: string, options: ValidationOptions, label: string): string | undefined {\r\n  const isOptional = !!options.optional;\r\n  if (!isOptional && (!value || value === \"\")) {\r\n    return `${label} is missing.`;\r\n  }\r\n  const length = !value ? 0 : value.length;\r\n  if (options.minLength && length < options.minLength) {\r\n    return options.minLength <= 15\r\n      ? `${label} must be at least ${options.minLength} characters.`\r\n      : `${label} must be at least ${options.minLength} characters; you entered ${length}.`;\r\n  }\r\n  return undefined;\r\n}\r\n","import React from \"react\";\r\n\r\nexport interface Label {\r\n  element?: React.ReactElement;\r\n  name?: string;\r\n}\r\n\r\nexport function createLabel(label: string, hideLabel?: boolean): Label {\r\n  if (hideLabel) {\r\n    return { name: undefined, element: undefined };\r\n  }\r\n  const name = label\r\n    .replace(/[^A-Za-z0-9 ]/, \"\")\r\n    .replace(/ /g, \"-\")\r\n    .toLocaleLowerCase();\r\n  const element = <label htmlFor={name}>{label}</label>;\r\n  return { name, element };\r\n}\r\n","import React from \"react\";\r\nimport { Label } from \"../components\";\r\nimport { Editor } from \"./Editor\";\r\nimport { Validated } from \"./Validated\";\r\n\r\ntype CreateInput = {\r\n  type: \"input\";\r\n  placeholder: string;\r\n  attributes: React.InputHTMLAttributes<HTMLInputElement>;\r\n};\r\ntype CreateTextArea = {\r\n  type: \"textarea\";\r\n  placeholder: string;\r\n  attributes: React.TextareaHTMLAttributes<HTMLTextAreaElement>;\r\n};\r\ntype CreateEditor = {\r\n  type: \"editor\";\r\n};\r\nexport type CreateAny = CreateInput | CreateTextArea | CreateEditor;\r\n\r\nexport function createChild(\r\n  create: CreateAny,\r\n  defaultValue: string | undefined,\r\n  handleChange: (newValue: string) => void,\r\n  label: Label,\r\n  errorMessage: string | undefined\r\n): React.ReactElement {\r\n  if (create.type === \"editor\") {\r\n    return Editor({\r\n      label,\r\n      handleChange,\r\n      defaultValue,\r\n      errorMessage,\r\n    });\r\n  }\r\n  function created(): React.ReactElement {\r\n    switch (create.type) {\r\n      case \"input\": {\r\n        const attributes = create.attributes;\r\n        const type = attributes.type ? attributes.type : \"text\";\r\n        return (\r\n          <input\r\n            type={type}\r\n            {...attributes}\r\n            name={label.name}\r\n            placeholder={create.placeholder}\r\n            defaultValue={defaultValue}\r\n            onChange={(e) => handleChange(e.target.value)}\r\n          />\r\n        );\r\n      }\r\n      case \"textarea\": {\r\n        const attributes = create.attributes;\r\n        return (\r\n          <textarea\r\n            {...attributes}\r\n            name={label.name}\r\n            placeholder={create.placeholder}\r\n            defaultValue={defaultValue}\r\n            onChange={(e) => handleChange(e.target.value)}\r\n          />\r\n        );\r\n      }\r\n      default:\r\n        throw new Error(\"Unexpected type\");\r\n    }\r\n  }\r\n  const child = created();\r\n  return (\r\n    <React.Fragment>\r\n      {label.element}\r\n      <Validated errorMessage={errorMessage}>{child}</Validated>\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import \"pagedown-editor/pagedown.css\";\r\nimport \"pagedown-editor/sample-bundle\";\r\nimport React from \"react\";\r\nimport \"ui-assets/css/Editor.css\";\r\nimport { Label, Validated } from \"../components\";\r\nimport { usePagedownEditor } from \"../hooks\";\r\n\r\nexport interface ValidatedEditorProps {\r\n  label: Label;\r\n  defaultValue?: string;\r\n  errorMessage?: string;\r\n  handleChange: (newValue: string) => void;\r\n}\r\n\r\n/*\r\n  There's no README in the https://github.com/StackExchange/pagedown repo\r\n  but there's one made for it at https://github.com/mmillican/pagedown which is\r\n  copied from https://code.google.com/archive/p/pagedown/wikis/PageDown.wiki\r\n*/\r\n\r\nexport const Editor = (props: ValidatedEditorProps) => {\r\n  const { label, handleChange, defaultValue, errorMessage } = props;\r\n\r\n  // calling reload() will force a re-render, but if getPagedownEditor().run() is called\r\n  // more than once then bad things happen e.g. there would be more than one editor toolbar\r\n\r\n  // the original code embedded a <script> tag to run getPagedownEditor().run()\r\n  // but if we do that then that will run before these React elements are rendered\r\n  // so use the effect hook to specify somethng to be run after it's rendered\r\n  usePagedownEditor();\r\n\r\n  const validated = (\r\n    <React.Fragment>\r\n      <Validated errorMessage={errorMessage}>\r\n        <textarea\r\n          // ref={textareaRef}\r\n          onChange={(e) => handleChange(e.target.value)}\r\n          id=\"wmd-input\"\r\n          className=\"wmd-input\"\r\n          name={label.name}\r\n          placeholder=\"Type markdown here\"\r\n          defaultValue={defaultValue}\r\n        ></textarea>\r\n      </Validated>\r\n    </React.Fragment>\r\n  );\r\n\r\n  // these elements are copied from those in the \"pagedown-editor/sample.html\"\r\n  return (\r\n    <React.Fragment>\r\n      {label.element}\r\n      <div className=\"container\">\r\n        <div className=\"wmd-panel\">\r\n          <div>\r\n            <div id=\"wmd-preview\" className=\"wmd-preview\"></div>\r\n          </div>\r\n          <div>\r\n            <div id=\"wmd-button-bar\"></div>\r\n          </div>\r\n          {validated}\r\n        </div>\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import React from \"react\";\r\n\r\nexport function usePagedownEditor() {\r\n  const [once, setOnce] = React.useState<boolean>(false);\r\n\r\n  // calling reload() will force a re-render, but if getPagedownEditor().run() is called\r\n  // more than once then bad things happen e.g. there would be more than one editor toolbar\r\n\r\n  // the original code embedded a <script> tag to run getPagedownEditor().run()\r\n  // but if we do that then that will run before these React elements are rendered\r\n  // so use the effect hook to specify somethng to be run after it's rendered\r\n  React.useEffect(() => {\r\n    // getPagedownEditor was added to the window object by the pagedown-editor/sample-bundle.js\r\n    if (!once) {\r\n      (window as any).getPagedownEditor().run();\r\n      setOnce(true);\r\n    }\r\n  }, [once]);\r\n}\r\n","import React from \"react\";\r\nimport { ErrorMessage } from \"./ErrorMessage\";\r\n\r\nexport function getSubmitButton(label: string, onClick: () => void, errorMessage?: string) {\r\n  function handleClick(e: React.MouseEvent): void {\r\n    onClick();\r\n  }\r\n  return (\r\n    <div>\r\n      <input type=\"submit\" value={label} onClick={handleClick} />\r\n      <ErrorMessage errorMessage={errorMessage} bold={true} />\r\n    </div>\r\n  );\r\n}\r\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"none\",\n  d: \"M0 0h24v24H0V0z\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z\"\n});\n\nvar SvgOutlineEmail24Px = function SvgOutlineEmail24Px(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgOutlineEmail24Px, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/outline-email-24px.8f9caefb.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"none\",\n  d: \"M0 0h24v24H0V0z\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M4 4h16v12H5.17L4 17.17V4m0-2c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2H4zm2 10h8v2H6v-2zm0-3h12v2H6V9zm0-3h12v2H6V6z\"\n});\n\nvar SvgOutlineChat24Px = function SvgOutlineChat24Px(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgOutlineChat24Px, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/outline-chat-24px.c6c43fee.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"none\",\n  d: \"M0 0h24v24H0V0z\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z\"\n});\n\nvar SvgOutlineSearch24Px = function SvgOutlineSearch24Px(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgOutlineSearch24Px, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/outline-search-24px.63de706a.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"none\",\n  d: \"M0 0h24v24H0V0z\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M19 5v14H5V5h14m0-2H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 9c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm6 10H6v-1.53c0-2.5 3.97-3.58 6-3.58s6 1.08 6 3.58V18zm-9.69-2h7.38c-.69-.56-2.38-1.12-3.69-1.12s-3.01.56-3.69 1.12z\"\n});\n\nvar SvgOutlineAccountBox24Px = function SvgOutlineAccountBox24Px(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgOutlineAccountBox24Px, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/outline-account_box-24px.dc60d700.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"none\",\n  d: \"M0 0h24v24H0V0z\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zM7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9z\"\n});\n\nvar _ref4 = /*#__PURE__*/React.createElement(\"circle\", {\n  cx: 12,\n  cy: 9,\n  r: 2.5\n});\n\nvar SvgOutlineLocationOn24Px = function SvgOutlineLocationOn24Px(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3, _ref4);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgOutlineLocationOn24Px, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/outline-location_on-24px.b6c7e994.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"none\",\n  d: \"M0 0h24v24H0V0z\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z\"\n});\n\nvar SvgOutlineClose24Px = function SvgOutlineClose24Px(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgOutlineClose24Px, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/outline-close-24px.62e7709e.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"none\",\n  d: \"M0 0h24v24H0V0z\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z\"\n});\n\nvar SvgOutlineInfo24Px = function SvgOutlineInfo24Px(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgOutlineInfo24Px, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/outline-info-24px.59d1a698.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z\"\n});\n\nvar SvgOutlineError24Px = function SvgOutlineError24Px(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgOutlineError24Px, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/outline-error-24px.fccb5b63.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"none\",\n  d: \"M0 0h24v24H0V0z\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z\"\n});\n\nvar SvgOutlineHome24Px = function SvgOutlineHome24Px(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgOutlineHome24Px, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/outline-home-24px.5a70e98d.svg\";\nexport { ForwardRef as ReactComponent };","import React from \"react\";\r\nimport \"ui-assets/css/ErrorMessage.css\";\r\nimport { ErrorMessage, ErrorMessageProps } from \"../components\";\r\nimport * as Icon from \"../icons\";\r\n\r\ntype ValidatedProps = ErrorMessageProps & {\r\n  // https://fettblog.eu/typescript-react/children/\r\n  // https://github.com/donaldpipowitch/typed-react-children-with-typescript\r\n  children: React.ReactElement;\r\n};\r\n\r\nexport const Validated = (props: ValidatedProps) => {\r\n  const { errorMessage } = props;\r\n\r\n  // https://stackoverflow.com/questions/36750387/react-adding-props-to-an-existing-component\r\n  const className = !props.children.props.className ? \"invalid\" : \"invalid \" + props.children.props.className;\r\n  const child = !errorMessage ? props.children : React.cloneElement(props.children, { className });\r\n  const icon = !errorMessage ? undefined : <Icon.Error className=\"error\" fill=\"#dc3d4c\" />;\r\n  return (\r\n    <React.Fragment>\r\n      <div className=\"validated\">\r\n        {child}\r\n        {icon}\r\n      </div>\r\n      <ErrorMessage errorMessage={errorMessage} />\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import { Data } from \"client\";\nimport React from \"react\";\nimport \"ui-assets/css/EditorTags.css\";\nimport { useSelectTags } from \"../hooks\";\n// this is to display a little 'x' SVG -- a Close icon which is displayed on each tag -- clicking it will delete the tag\n// also to display a little '(!)' SVG -- an Error icon which is displayed in the element, if there's a validation error\nimport * as Icon from \"../icons\";\n// this simply displays red text if non-empty text is passed to its errorMessage property\nimport { ErrorMessage } from \"./ErrorMessage\";\nimport { getOnSelectTags, log, ParentCallback, RenderedElement, Validation } from \"./SelectTagsState\";\n\ntype TagCount = Data.TagCount;\n\n// this defines the properties which you pass to the EditorTags functional component\ninterface EditorTagsProps extends Validation {\n  // the input/original tags to be edited (or an empty array if there are none)\n  inputTags: string[];\n  // the results are pushed back to the parent via this callback\n  result: ParentCallback;\n  // a function to fetch all existing tags from the server (for tag dictionary lookup)\n  getAllTags: () => Promise<TagCount[]>;\n}\n\nexport const EditorTags: React.FunctionComponent<EditorTagsProps> = (props) => {\n  const { inputTags, result, getAllTags } = props;\n  // get the state\n  const { state, dispatch, tagDictionary, assert, errorMessage } = useSelectTags(inputTags, getAllTags, props);\n  // get the event handlers\n  const { onEditorClick, onDeleteTag, onTagClick, onChange, onKeyDown, onHintResult } = getOnSelectTags(\n    assert,\n    props,\n    result,\n    dispatch,\n    state,\n    tagDictionary\n  );\n\n  /*\n    inputRef (data which is used by some of the event handlers)\n  */\n\n  const inputRef = React.createRef<HTMLInputElement>();\n\n  /*\n    Event handlers (which dispatch to the reducer)\n  */\n\n  function handleEditorClick(e: React.MouseEvent) {\n    const isDiv = (e.target as HTMLElement).tagName === \"DIV\";\n    if (!isDiv) {\n      // this wasn't a click on the <div> itself, presumably instead a click on something inside the div\n      return;\n    }\n    onEditorClick(inputRef.current!);\n  }\n\n  function handleDeleteTag(index: number, e: React.MouseEvent) {\n    onDeleteTag(index, inputRef.current!);\n    e.preventDefault();\n  }\n\n  function handleTagClick(index: number, e: React.MouseEvent) {\n    onTagClick(index, inputRef.current!);\n    e.preventDefault();\n  }\n\n  function handleChange(e: React.ChangeEvent<HTMLInputElement>) {\n    onChange(e.target);\n  }\n\n  function handleKeyDown(e: React.KeyboardEvent) {\n    if (onKeyDown(e.target as HTMLInputElement, e.key, e.shiftKey)) {\n      e.preventDefault();\n    }\n  }\n\n  function handleHintResult(outputTag: string) {\n    onHintResult(inputRef.current!, outputTag);\n  }\n\n  /*\n    Tag is a FunctionComponent to render each tag\n  */\n\n  interface TagProps {\n    text: string;\n    index: number;\n    isValid: boolean;\n  }\n  const Tag: React.FunctionComponent<TagProps> = (props) => {\n    const { text, index, isValid } = props;\n    // https://reactjs.org/docs/handling-events.html#passing-arguments-to-event-handlers\n    // eslint-disable-next-line\n    const close = (\n      <a onClick={(e) => handleDeleteTag(index, e)} title=\"Remove tag\">\n        <Icon.Close height=\"12\" />\n      </a>\n    );\n    const className = isValid ? \"tag\" : \"tag invalid\";\n    return (\n      <span className={className} onClick={(e) => handleTagClick(index, e)}>\n        {text}\n        {close}\n      </span>\n    );\n  };\n\n  /*\n    The return statement which yields the JSX.Element from this function component\n  */\n\n  function showValidationResult() {\n    const showError = props.showValidationError && !!state.validationError.length;\n    if (!showError) {\n      return {\n        className: \"tag-editor\",\n        icon: undefined,\n        validationError: undefined,\n      };\n    }\n    const className = \"tag-editor invalid validated\";\n    const icon = <Icon.Error className=\"error\" />;\n    const validationErrorMessage = state.validationError;\n    // use <a href={}> instead of <Link to={}> -- https://github.com/ReactTraining/react-router/issues/6344\n    const suffix =\n      validationErrorMessage[validationErrorMessage.length - 1] !== \";\" ? undefined : (\n        <React.Fragment>\n          {\"see a list of \"}\n          <a href={props.hrefAllTags} target=\"_blank\" rel=\"noopener noreferrer\">\n            popular tags\n          </a>\n          {\".\"}\n        </React.Fragment>\n      );\n    const validationError = (\n      <p className=\"error\">\n        {validationErrorMessage} {suffix}\n      </p>\n    );\n    return { validationError, icon, className };\n  }\n  const { validationError, icon, className } = showValidationResult();\n\n  function getElement(element: RenderedElement, index: number): React.ReactElement {\n    const isValid = !props.showValidationError || element.isValid;\n    return element.type === \"tag\" ? (\n      <Tag text={element.word} index={index} key={index} isValid={isValid} />\n    ) : (\n      <input\n        type=\"text\"\n        key=\"input\"\n        ref={inputRef}\n        className={isValid ? undefined : \"invalid\"}\n        width={10}\n        onKeyDown={handleKeyDown}\n        onChange={handleChange}\n        onFocus={(e) => handleFocus(e, true)}\n        onBlur={(e) => handleFocus(e, false)}\n      />\n    );\n  }\n\n  return (\n    <div id=\"tag-both\">\n      <div className={className} onClickCapture={handleEditorClick}>\n        {state.elements.map(getElement)}\n        {icon}\n      </div>\n      <ShowHints hints={state.hints} inputValue={state.inputValue} result={handleHintResult} />\n      <ErrorMessage errorMessage={errorMessage} />\n      {validationError}\n    </div>\n  );\n};\n\n/*\n\n  ShowHints\n\n*/\n\ninterface ShowHintsProps {\n  // hints (from dictionary)\n  hints: TagCount[];\n  // the current value of the tag in the editor\n  inputValue: string;\n  // callback of tag selected from list of hints if user clicks on it\n  result: (outputTag: string) => void;\n}\nconst ShowHints: React.FunctionComponent<ShowHintsProps> = (props) => {\n  const { hints, inputValue, result } = props;\n  if (!inputValue.length) {\n    return <div className=\"tag-hints hidden\"></div>;\n  }\n  return (\n    <div className=\"tag-hints\">\n      {!hints.length\n        ? \"No results found.\"\n        : hints.map((hint) => <ShowHint hint={hint} inputValue={inputValue} result={result} key={hint.key} />)}\n    </div>\n  );\n};\n\ninterface ShowHintProps {\n  // hints (from dictionary)\n  hint: TagCount;\n  // the current value of the tag in the editor\n  inputValue: string;\n  // callback of tag selected from list of hints if user clicks on it\n  result: (outputTag: string) => void;\n}\nconst ShowHint: React.FunctionComponent<ShowHintProps> = (props) => {\n  const { hint, inputValue, result } = props;\n\n  function getTag(key: string) {\n    const index = key.indexOf(inputValue);\n    return (\n      <span className=\"tag\">\n        {index === -1 ? (\n          key\n        ) : (\n          <React.Fragment>\n            {key.substring(0, index)}\n            <span className=\"match\">{inputValue}</span>\n            {key.substring(index + inputValue.length)}\n          </React.Fragment>\n        )}\n      </span>\n    );\n  }\n  // the key with the matched letters highlighted\n  const tag = getTag(hint.key);\n  // count the number of times this tag is used elsewhere, if any\n  const count = hint.count ? <span className=\"multiplier\">×&nbsp;{hint.count}</span> : undefined;\n  // the summary, if any\n  const summary = hint.summary ? <p>{hint.summary}</p> : undefined;\n  // a link to more info i.e. the page which defines this tag\n  function getMore(key: string) {\n    const icon = <Icon.Info width=\"16\" height=\"16\" />;\n    // we use <a> here instead of <Link> because this link will open a whole new tab, i.e. another instance of this SPA\n    // in future I think it would be better to reimplement this as a split screen (two-column) view\n    const anchor = (\n      <a href={`/tags/${key}/info`} target=\"_blank\" rel=\"noopener noreferrer\">\n        {icon}\n      </a>\n    );\n    return <p className=\"more-info\">{anchor}</p>;\n  }\n  const more = getMore(hint.key);\n  return (\n    <div\n      className=\"hint\"\n      tabIndex={0}\n      key={hint.key}\n      onClick={(e) => result(hint.key)}\n      onKeyDown={(e) => {\n        if (e.key === \"Enter\") result(hint.key);\n        e.preventDefault();\n      }}\n      onFocus={(e) => handleFocus(e, true)}\n      onBlur={(e) => handleFocus(e, false)}\n    >\n      {tag}\n      {count}\n      {summary}\n      {more}\n    </div>\n  );\n};\n\n// see [Simulating `:focus-within`](./EDITORTAGS.md#simulating-focus-within)\nfunction handleFocus(e: React.FocusEvent<HTMLElement>, hasFocus: boolean) {\n  function isElement(related: EventTarget | HTMLElement): related is HTMLElement {\n    return (related as HTMLElement).tagName !== undefined;\n  }\n  // read it\n  const target = e.target;\n  const relatedTarget = e.relatedTarget;\n  // relatedTarget is of type EventTarget -- upcast from that to HTMLElement\n  const related: HTMLElement | undefined = relatedTarget && isElement(relatedTarget) ? relatedTarget : undefined;\n  // get the tagName and className of the element\n  const relatedName = !relatedTarget ? \"!target\" : !related ? \"!element\" : related.tagName;\n  const relatedClass = !related ? \"\" : related.className;\n  // log it\n  const activeElement = document.activeElement;\n  const targetName = target.tagName;\n  const activeElementName = activeElement ? activeElement.tagName : \"!activeElement\";\n  log(\"handleFocus\", {\n    hasFocus,\n    targetName,\n    activeElementName,\n    relatedName,\n    relatedClass,\n  });\n  // calculate it\n  hasFocus = hasFocus || relatedClass === \"hint\";\n  // write the result\n  const div = document.getElementById(\"tag-both\")!;\n  if (hasFocus) {\n    div.className = \"focussed\";\n  } else {\n    div.className = \"\";\n  }\n}\n","import { config, Data, Url } from \"client\";\r\nimport React from \"react\";\r\nimport { Link, NavLink } from \"react-router-dom\";\r\n\r\nexport function getDiscussionsSubtitle(\r\n  title: string,\r\n  left: string,\r\n  tag: Data.Key | undefined,\r\n  sort: Url.DiscussionsSort | \"info\"\r\n) {\r\n  const info = !tag ? undefined : <NavLink to={Url.getTagInfoUrl(tag)}>Info</NavLink>;\r\n  const links =\r\n    !tag || sort === \"info\" ? undefined : (\r\n      <div className=\"minigrid links\">\r\n        <ul>\r\n          <li>\r\n            <Link to={Url.getTagInfoUrl(tag)}>Learn more…</Link>\r\n          </li>\r\n          <li>\r\n            <Link to={Url.getTagEditUrl(tag)}>Improve tag info</Link>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    );\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <div className=\"minigrid\">\r\n        <h1>{title}</h1>\r\n        <div className=\"link\">\r\n          <Link to={Url.route.newDiscussion} className=\"linkbutton\">\r\n            {config.strNewQuestion.button}\r\n          </Link>\r\n        </div>\r\n      </div>\r\n      {links}\r\n      <div className=\"minigrid subtitle\">\r\n        <div className=\"count\">{left}</div>\r\n        <div className=\"sort\">\r\n          {info}\r\n          <NavLink\r\n            to={Url.getDiscussionsOptionsUrl({ sort: \"Newest\", tag })}\r\n            className={sort === \"Newest\" ? \"selected\" : undefined}\r\n          >\r\n            Newest\r\n          </NavLink>\r\n          <NavLink\r\n            to={Url.getDiscussionsOptionsUrl({ sort: \"Active\", tag })}\r\n            className={sort === \"Active\" ? \"selected\" : undefined}\r\n          >\r\n            Active\r\n          </NavLink>\r\n        </div>\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import { Data, Url } from \"client\";\r\nimport React from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nexport function getTagLink(tag: Data.Key): React.ReactElement {\r\n  const href = Url.getTagUrl(tag);\r\n  return (\r\n    <Link className=\"tag\" to={href}>\r\n      {tag.key}\r\n    </Link>\r\n  );\r\n}\r\n","import { Data } from \"client\";\r\nimport React from \"react\";\r\nimport { getTagLink } from \"./getTagLink\";\r\n\r\n// called from getDiscussionSummary, and getMessage (for each message within discussion)\r\nexport function getTags(tags: Data.Key[]) {\r\n  return (\r\n    <div className=\"topic\">\r\n      {tags.map((tag) => {\r\n        const link = getTagLink(tag);\r\n        // want whitespace between each tag\r\n        return <React.Fragment key={tag.key}>{link}&#32;</React.Fragment>;\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n","import { Data, Url } from \"client\";\r\nimport React from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\n\r\nexport type GravatarSize = \"small\" | \"big\" | \"huge\";\r\n\r\nexport function getUserSummary(\r\n  summary: Data.UserSummary,\r\n  option: { title: boolean; size: GravatarSize }\r\n): { userName: React.ReactElement; gravatar: React.ReactElement; key: string } {\r\n  const href = Url.getUserUrl(summary);\r\n  const userName = <NavLink to={href}>{summary.name}</NavLink>;\r\n  const size = option.size === \"small\" ? 32 : option.size === \"big\" ? 48 : 164;\r\n  // https://en.gravatar.com/site/implement/images/\r\n  const src = `https://www.gravatar.com/avatar/${summary.gravatarHash}?s=${size * 2}&d=identicon&r=PG`;\r\n  const img = <img src={src} alt={summary.name} width={size} height={size} />;\r\n  const title = option.title ? summary.name : undefined;\r\n  const gravatar = (\r\n    <NavLink to={href} title={title} className=\"gravatar\">\r\n      {img}\r\n    </NavLink>\r\n  );\r\n  return { userName, gravatar, key: href };\r\n}\r\n","import React from \"react\";\r\n\r\nexport function getWhen(when: string) {\r\n  return <div className=\"when\">{when}</div>;\r\n}\r\n","import { Data } from \"client\";\r\nimport React, { ReactElement } from \"react\";\r\nimport { getUserSummary, GravatarSize } from \"./getUserSummary\";\r\nimport { getWhen } from \"./getWhen\";\r\n\r\nexport function getUserInfo(summary: Data.UserSummary, size: GravatarSize, when?: string): ReactElement {\r\n  const { userName, gravatar, key } = getUserSummary(summary, {\r\n    title: false,\r\n    size,\r\n  });\r\n  const showWhen = !when ? undefined : getWhen(when);\r\n  return (\r\n    <div className=\"user-info\" key={key}>\r\n      {showWhen}\r\n      {gravatar}\r\n      <div className=\"details\">\r\n        {userName}\r\n        {summary.location ? <span className=\"user-location\">{summary.location}</span> : undefined}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","export function toLocaleString(date: Date): string {\r\n  const month = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"][date.getMonth()];\r\n  const year = new Date().getFullYear() === date.getFullYear() ? \"\" : ` '${(\"\" + date.getFullYear()).substring(2)}`;\r\n  const minutes = (\"\" + date.getMinutes()).padStart(2, \"0\");\r\n  return `${month} ${date.getDate()}${year} at ${date.getHours()}:${minutes}`;\r\n}\r\n","import { Data, Url } from \"client\";\r\nimport React from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\nimport type { KeyedItem } from \"../layouts\";\r\nimport { getTags } from \"./getTags\";\r\nimport { getUserInfo } from \"./getUserInfo\";\r\nimport { getWhen } from \"./getWhen\";\r\nimport { toLocaleString } from \"./toLocaleString\";\r\n\r\nexport function getDiscussionSummary(summary: Data.DiscussionSummary, short: boolean = false): KeyedItem {\r\n  const href = Url.getDiscussionUrl(summary);\r\n  const when = toLocaleString(new Date(summary.messageSummary.dateTime));\r\n  const stats = short ? undefined : (\r\n    <div className=\"stats\">\r\n      <div className=\"answers\">\r\n        <strong>{summary.nAnswers}</strong> {summary.nAnswers === 1 ? \"answer\" : \"answers\"}\r\n      </div>\r\n    </div>\r\n  );\r\n  const signature = short ? (\r\n    <div className=\"user-info\">{getWhen(when)}</div>\r\n  ) : (\r\n    getUserInfo(summary.messageSummary.userSummary, \"small\", when)\r\n  );\r\n  const element: React.ReactElement = (\r\n    <div className=\"discussion-summary\">\r\n      {stats}\r\n      <div className=\"summary\">\r\n        <h3>\r\n          <NavLink to={href}>{summary.name}</NavLink>\r\n        </h3>\r\n        <div className=\"excerpt\">{summary.messageSummary.messageExerpt}</div>\r\n        {getTags(summary.tags)}\r\n        {signature}\r\n      </div>\r\n    </div>\r\n  );\r\n  return { element, key: href };\r\n}\r\n","import { Data, toHtml } from \"client\";\r\nimport React from \"react\";\r\nimport type { KeyedItem } from \"../layouts\";\r\nimport { getTags } from \"./getTags\";\r\nimport { getUserInfo } from \"./getUserInfo\";\r\nimport { toLocaleString } from \"./toLocaleString\";\r\n\r\nfunction getMessage(message: Data.Message, index: number, tags?: Data.Key[]): KeyedItem {\r\n  const topic = tags ? getTags(tags) : undefined; // only the first message in a discussion has associated tags\r\n  const when = toLocaleString(new Date(message.dateTime));\r\n  const element = (\r\n    <React.Fragment>\r\n      <div className=\"message\">\r\n        <div dangerouslySetInnerHTML={toHtml(message.markdown)} />\r\n        {topic}\r\n        {getUserInfo(message.userSummary, \"small\", when)}\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n  return { key: \"\" + index, element };\r\n}\r\n\r\nexport function getFirstMessage(message: Data.Message, tags: Data.Key[]): KeyedItem {\r\n  return getMessage(message, 0, tags);\r\n}\r\n\r\nexport function getNextMessage(message: Data.Message, index: number): KeyedItem {\r\n  return getMessage(message, index + 1);\r\n}\r\n","import React from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\n\r\nexport function getNavLinks(\r\n  wanted: Array<{ text: string; n: number } | undefined>,\r\n  href: (page: number) => string,\r\n  title: (n: number) => string,\r\n  current: number,\r\n  spanifySelected: boolean\r\n): React.ReactElement[] {\r\n  return wanted.map((x, index) => {\r\n    if (!x) {\r\n      const before: number = (wanted[index - 1] as { text: string; n: number }).n;\r\n      return (\r\n        <span key={\"dots-\" + before} className=\"dots\">\r\n          …\r\n        </span>\r\n      );\r\n    }\r\n    const { text, n } = x;\r\n    if (spanifySelected && current === n) {\r\n      return (\r\n        <span className=\"selected\" key={text}>\r\n          {text}\r\n        </span>\r\n      );\r\n    }\r\n    const className = current === n ? \"selected\" : undefined;\r\n    return (\r\n      <NavLink to={href(n)} key={text} title={title(n)} className={className}>\r\n        {text}\r\n      </NavLink>\r\n    );\r\n  });\r\n}\r\n","import React from \"react\";\r\nimport { getNavLinks } from \"./getNavLinks\";\r\n\r\nfunction getPageNumbers(current: number, max: number): Array<{ text: string; n: number } | undefined> {\r\n  function numbers(first: number, last: number): Array<number | undefined> {\r\n    // https://stackoverflow.com/questions/3746725/how-to-create-an-array-containing-1-n\r\n    // says that convenient ways to do this are for higher versions of ES than supported in this project\r\n    const rc: number[] = [];\r\n    for (let i = first; i <= last; ++i) {\r\n      rc.push(i);\r\n    }\r\n    return rc;\r\n  }\r\n  const wanted: Array<number | undefined> =\r\n    max <= 6\r\n      ? numbers(1, max)\r\n      : current - 1 <= 3\r\n      ? numbers(1, 5).concat([undefined, max])\r\n      : max - current <= 3\r\n      ? [1, undefined].concat(numbers(max - 4, max))\r\n      : [1, undefined].concat(numbers(current - 2, current + 2)).concat(undefined, max);\r\n  const rc: Array<{ text: string; n: number } | undefined> = wanted.map((x) =>\r\n    x ? { text: \"\" + x, n: x } : undefined\r\n  );\r\n  if (current > 1) {\r\n    rc.unshift({ text: \"prev\", n: current - 1 });\r\n  }\r\n  if (current < max) {\r\n    rc.push({ text: \"next\", n: current + 1 });\r\n  }\r\n  return rc;\r\n}\r\n\r\nexport function getPageNavLinks(\r\n  current: number,\r\n  nTotal: number,\r\n  pageSize: number,\r\n  href: (page: number) => string\r\n): React.ReactElement[] {\r\n  const max = Math.floor(nTotal / pageSize) + (nTotal % pageSize ? 1 : 0);\r\n  const wanted = getPageNumbers(current, max);\r\n  return getNavLinks(wanted, href, (n) => \"go to page \" + n, current, true);\r\n}\r\n","import { Data } from \"client\";\r\nimport React from \"react\";\r\n\r\n// called from getActivityContent (nested in User)\r\nexport function getTagCount(tagCount: Data.TagCount) {\r\n  const { key, count } = tagCount;\r\n  const suffix = count && count !== 1 ? ` x ${count}` : undefined;\r\n  return (\r\n    <div className=\"topic\" key={key}>\r\n      <span className=\"tag\">{key}</span>\r\n      {suffix}\r\n    </div>\r\n  );\r\n}\r\n","import { SearchInput } from \"client\";\nimport React from \"react\";\nimport { ErrorMessage } from \"./ErrorMessage\";\nimport { useThrottledInput } from \"../hooks\";\n\ninterface ThrottledInputProps {\n  api: (input: SearchInput) => Promise<void>;\n  placeholder: string;\n}\n\nexport const ThrottledInput: React.FunctionComponent<ThrottledInputProps> = (props: ThrottledInputProps) => {\n  const { api, placeholder } = props;\n  const { value, setValue, errorMessage } = useThrottledInput(api);\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => setValue(event.target.value);\n\n  return (\n    <React.Fragment>\n      <input type=\"text\" onChange={handleChange} value={value} placeholder={placeholder} />\n      <ErrorMessage errorMessage={errorMessage} />\n    </React.Fragment>\n  );\n};\n","import React from \"react\";\r\nimport { SearchInput } from \"client\";\r\n\r\n/*\r\n  This defines a throttled input control e.g. for a Search control.\r\n\r\n  - \"Throttled\" means \"no more than x per second\"\r\n  - \"Debounced\" means \"after silence of x msec\"\r\n\r\n  I prefer a \"throttled\" UI -- a debounced UI seems laggy because continuous input (without silence) causes no updates.\r\n\r\n  So the logic is:\r\n  \r\n  - When the user changes the input then the callback is invoked immediately\r\n  - The callback can't be invoked again until the previous callback completes and some time passes\r\n*/\r\n\r\n// delay at least 100 msec between API calls\r\nconst throttleDelay = 100;\r\n\r\nexport function useThrottledInput(api: (input: SearchInput) => Promise<void>) {\r\n  const [value, setValue] = React.useState(\"\");\r\n  const [handled, setHandled] = React.useState(\"\");\r\n  const [errorMessage, setErrorMessage] = React.useState<string | undefined>(undefined);\r\n\r\n  const isRunning = React.useRef<boolean>(false);\r\n\r\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => setValue(event.target.value);\r\n\r\n  function finished(handling: string): void {\r\n    isRunning.current = false;\r\n    setHandled(handling);\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    if (isRunning.current) {\r\n      // already running ... don't run now, run again when current run has completed\r\n      return;\r\n    }\r\n    // handle the current state\r\n    const handling = value;\r\n    if (handling === handled) {\r\n      // nothing new to do\r\n      return;\r\n    }\r\n    // remember we're running so this doesn't get reentered\r\n    isRunning.current = true;\r\n    // make the API call\r\n    api({ searchInput: handling })\r\n      .then(() => {\r\n        // do nothing here -- data from the API call was already handled in the implementation of the newData function\r\n      })\r\n      .catch((reason) => {\r\n        setErrorMessage(reason.message);\r\n      })\r\n      .finally(() => {\r\n        // wait a bit (in order to \"throttle\") before allowing the next API call\r\n        setTimeout(finished, throttleDelay, handling);\r\n      });\r\n  }, [value, handled, api]);\r\n\r\n  return { value, setValue, errorMessage };\r\n}\r\n","import { config, Route } from \"client\";\nimport React from \"react\";\nimport { NavLink } from \"react-router-dom\";\nimport \"ui-assets/css/Topbar.css\";\nimport { getUserSummary } from \"../components\";\nimport { useMe } from \"../hooks\";\nimport * as Icon from \"../icons\";\n\nexport const Topbar: React.FunctionComponent = () => {\n  const me = useMe();\n  function showNotifications(e: React.MouseEvent) {\n    alert(\"To do: this can be the user's inbox where notifications are displayed\");\n    e.preventDefault();\n  }\n  return (\n    <div className=\"topbar\">\n      <div className=\"container\">\n        <ul className=\"icons\">\n          <li className=\"icon\">\n            <NavLink to=\"/home\" title=\"About\">\n              <Icon.Home width=\"24\" height=\"24\" />\n            </NavLink>\n          </li>\n          <li className=\"icon\">\n            <NavLink to={Route.tags} title={config.strTags}>\n              <Icon.Search width=\"24\" height=\"24\" />\n            </NavLink>\n          </li>\n          {me ? (\n            <React.Fragment>\n              <li className=\"icon\">\n                <NavLink to={Route.discussions} title={config.strQuestions}>\n                  <Icon.Message width=\"24\" height=\"24\" />\n                </NavLink>\n              </li>\n              <li className=\"icon\">\n                <NavLink to={Route.users} title=\"Users\">\n                  <Icon.UserProfile width=\"24\" height=\"24\" />\n                </NavLink>\n              </li>\n              <li className=\"icon\">\n                <NavLink to=\"/index\" title=\"Notifications\" onClick={showNotifications}>\n                  <Icon.Mail width=\"24\" height=\"24\" />\n                </NavLink>\n              </li>\n              <li className=\"icon\">{getUserSummary(me, { title: true, size: \"small\" }).gravatar}</li>\n            </React.Fragment>\n          ) : (\n            <li className=\"text\">\n              <NavLink to={Route.login} className=\"login\">\n                Join this community\n              </NavLink>\n            </li>\n          )}\n        </ul>\n      </div>\n    </div>\n  );\n};\n","import { config } from \"client\";\nimport React from \"react\";\nimport { NavLink } from \"react-router-dom\";\nimport \"ui-assets/css/PageLayout.css\";\nimport * as Icon from \"../icons\";\nimport { Layout, RightContent, SubTabs, Tabs } from \"./Layout\";\nimport type { MainContent, Width } from \"./Layout\";\n\n/*\n  Implementation details\n*/\n\nfunction setTitle(title: string): void {\n  document.title = `${title} - ${config.appname}`;\n}\n\nfunction renderSubTabs(subTabs: SubTabs) {\n  return (\n    <div className=\"tab-head subtabs\" key=\"subMenu\">\n      <div className=\"tabs\">\n        <h2>{subTabs.text}</h2>\n        <div>\n          {subTabs.tabs.map((tab, index) => (\n            <NavLink to={tab.href} key={\"\" + index} className={index === subTabs.selected ? \"selected\" : undefined}>\n              {tab.text}\n            </NavLink>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction renderContent(content: MainContent, subTabs?: SubTabs, footer?: React.ReactElement) {\n  if (Array.isArray(content)) {\n    const elements = content.map((x, index) => {\n      const subMenu = index === 1 && subTabs ? renderSubTabs(subTabs) : undefined;\n      const className = index === 0 && subTabs ? \"element first\" : \"element\";\n      return (\n        <React.Fragment key={\"\" + index}>\n          {subMenu}\n          <div className={className} key={x.key}>\n            {x.element}\n          </div>\n        </React.Fragment>\n      );\n    });\n    return !footer ? (\n      elements\n    ) : (\n      <React.Fragment>\n        {elements}\n        <div className=\"element\" key=\"footer\">\n          {footer}\n        </div>\n      </React.Fragment>\n    );\n  }\n  return (\n    <React.Fragment>\n      {content}\n      {footer}\n    </React.Fragment>\n  );\n}\n\nfunction renderTabs(main: Tabs, isTop: boolean) {\n  const className = !isTop ? \"tab-head\" : \"tab-head profile\";\n  const slug = main.tabbed[main.selected].slug;\n  const slugDiv = !slug ? undefined : <div className=\"slug\">{slug}</div>;\n  return (\n    <React.Fragment>\n      <div className={className}>\n        <div className=\"tabs\">\n          {main.tabbed.map((tab, index) => (\n            <NavLink\n              to={tab.navlink.href}\n              key={\"\" + index}\n              className={index === main.selected ? \"selected\" : undefined}\n            >\n              {tab.navlink.text}\n            </NavLink>\n          ))}\n          {slugDiv}\n        </div>\n      </div>\n      <div className=\"tabbed\">\n        {main.tabbed.map((tab, index) => {\n          return (\n            <div className={index !== main.selected ? \"hidden\" : undefined} key={\"\" + index}>\n              {renderContent(tab.content, tab.subTabs)}\n            </div>\n          );\n        })}\n      </div>\n    </React.Fragment>\n  );\n}\n\nfunction renderRightColumn(right?: RightContent) {\n  if (!right) {\n    return { rightColumn: null, rightButton: null };\n  }\n\n  const refDiv = React.createRef<HTMLDivElement>();\n  const refButton = React.createRef<HTMLButtonElement>();\n\n  function hideOrShow(show: boolean) {\n    const boundDiv = refDiv.current;\n    const boundButton = refButton.current;\n    if (!boundDiv || !boundButton) {\n      return;\n    }\n    if (show) {\n      boundDiv.classList.remove(\"hidden\");\n      boundButton.classList.add(\"hidden\");\n    } else {\n      boundDiv.classList.add(\"hidden\");\n      boundButton.classList.remove(\"hidden\");\n    }\n  }\n  function handleShowDiv(event: React.MouseEvent<HTMLButtonElement>): void {\n    hideOrShow(true);\n    event.preventDefault();\n  }\n  function handleHideDiv(event: React.MouseEvent<HTMLButtonElement>): void {\n    hideOrShow(false);\n    event.preventDefault();\n  }\n\n  function className(name: string, visible: boolean) {\n    return visible ? name : name + \" hidden\";\n  }\n\n  const rightButton = (\n    <button\n      className={className(\"column-right-button\", !right.visible)}\n      type=\"button\"\n      onClick={handleShowDiv}\n      ref={refButton}\n    >\n      {right.showButtonLabel}\n    </button>\n  );\n\n  const closeButton = (\n    <button className=\"column-close-button\" type=\"button\" onClick={handleHideDiv} title=\"Close\">\n      <Icon.Close width=\"16\" height=\"16\" />\n    </button>\n  );\n\n  const rightColumn = (\n    <div className={className(\"column-right\", right.visible)} style={{ width: right.width }} ref={refDiv}>\n      {closeButton}\n      {right.element}\n    </div>\n  );\n\n  return { rightColumn, rightButton };\n}\n\nfunction isTabs(main: Tabs | any): main is Tabs {\n  return (main as Tabs).tabbed !== undefined;\n}\n\nfunction switchLayout(layout: Layout) {\n  const { rightColumn, rightButton } = renderRightColumn(layout.right);\n\n  function getClassName(width: Width): string {\n    switch (width) {\n      case \"Full\":\n        return \"column-wide\";\n      case \"Grid\":\n        return \"column-text grid\";\n      case \"Closed\":\n        return \"column-text closed\";\n      case \"Open\":\n        return \"column-text open\";\n      case \"None\":\n        return \"column-text none\";\n      default:\n        throw new Error(\"not implemented\");\n    }\n  }\n  const className = getClassName(layout.width);\n\n  if (isTabs(layout.main)) {\n    // tabs are located above the header and the header is inside the first tab\n    setTitle(layout.main.title);\n    return <div className={className}>{renderTabs(layout.main, true)}</div>;\n  }\n\n  const mainColumn = renderContent(layout.main.content, layout.main.subTabs, layout.main.footer);\n  setTitle(layout.main.title);\n\n  const title = layout.main.subtitle ? layout.main.subtitle : <h1>{layout.main.title}</h1>;\n\n  if (layout.width !== \"Full\") {\n    return (\n      <React.Fragment>\n        <div className={className}>\n          {rightButton}\n          <div className=\"header\">{title}</div>\n          <div className=\"content\">{mainColumn}</div>\n        </div>\n        {rightColumn}\n      </React.Fragment>\n    );\n  } else {\n    return (\n      <React.Fragment>\n        <div className={className}>\n          {rightButton}\n          {mainColumn}\n        </div>\n        {rightColumn}\n      </React.Fragment>\n    );\n  }\n}\n\nexport function renderLayout(layout: Layout): React.ReactElement {\n  const contents = switchLayout(layout);\n  return <div className=\"all-columns\">{contents}</div>;\n}\n","import React from \"react\";\r\nimport { FetchingT } from \"../hooks\";\r\nimport { Layout } from \"./Layout\";\r\nimport { renderLayout } from \"./renderLayout\";\r\n\r\nexport type { KeyedItem, Layout, MainContent, RightContent, SubTabs, Tab, Tabs, Width } from \"./Layout\";\r\nexport { renderLayout } from \"./renderLayout\";\r\n\r\nexport interface FetchedT<TData, TParam2> {\r\n  data: TData;\r\n  reload: () => void;\r\n  newData: (param2: TParam2) => Promise<void>;\r\n}\r\n\r\nexport type ShowDataT<TData, TParam2> = (fetched: FetchedT<TData, TParam2>) => Layout;\r\n\r\nexport function getPage<TData, TParam2>(\r\n  fetched: FetchingT<TData, TParam2>,\r\n  showData: ShowDataT<TData, TParam2>\r\n): React.ReactElement {\r\n  const { data, error, reload, newData } = fetched;\r\n\r\n  const layout: Layout = data\r\n    ? showData({ data, reload, newData }) // render the data\r\n    : error\r\n    ? loadingError(error) // else render error message\r\n    : loadingContents; // else no data yet to render\r\n\r\n  return renderLayout(layout);\r\n}\r\n\r\nconst loadingContents: Layout = {\r\n  main: { title: \"Loading...\", content: \"...\" },\r\n  width: \"Closed\",\r\n};\r\n\r\nfunction loadingError(error: Error): Layout {\r\n  const url = (error as any).url;\r\n  const what = url ? <p>URL: \"{url}\"</p> : { undefined };\r\n  const content = (\r\n    <React.Fragment>\r\n      {what}\r\n      <p>Error: {error.message}</p>\r\n    </React.Fragment>\r\n  );\r\n  return { main: { title: \"Error\", content }, width: \"Open\" };\r\n}\r\n","import { Api, toHtml } from \"client\";\r\nimport React from \"react\";\r\nimport { htmlToReact } from \"../components\";\r\nimport { FetchingT, useFetchApi2 } from \"../hooks\";\r\nimport { FetchedT, getPage, Layout, ShowDataT } from \"../layouts\";\r\n\r\ntype FetchedIsHtml = { isHtml: boolean };\r\n\r\nexport const Home: React.FunctionComponent = () => {\r\n  const isHtml = false;\r\n  const filename = isHtml ? \"home.html\" : \"home.md\";\r\n  const fetching: FetchingT<string, void> = useFetchApi2(Api.getPublic, filename);\r\n  const showData: ShowDataT<string, void> = (fetched: FetchedT<string, void>) => showHome(fetched, { isHtml });\r\n  return getPage(fetching, showData);\r\n};\r\n\r\nfunction showHome(fetched: FetchedT<string, void>, extra: { isHtml: boolean }): Layout {\r\n  const { data } = fetched;\r\n  const { isHtml } = extra;\r\n  function parse() {\r\n    const lines = data.split(/\\r?\\n/);\r\n    const found = lines.find((s) => s.startsWith(isHtml ? \"<h1>\" : \"# \"));\r\n    if (found) {\r\n      const title = isHtml ? found.substring(4, found.length - 5).trim() : found.substring(2).trim();\r\n      const sliced = lines.slice(1).join(\"\\r\\n\");\r\n\r\n      return { title, sliced };\r\n    } else {\r\n      return { title: \"Untitled?\", sliced: data };\r\n    }\r\n  }\r\n  const { title, sliced } = parse();\r\n  const html = isHtml ? sliced : toHtml(sliced).__html;\r\n  // htmlToReact(html) replaces `<a>` with `<Link>` instead of using `<div dangerouslySetInnerHTML={{ __html: html }} />`\r\n  const content = htmlToReact(html);\r\n  return { main: { title, content }, width: \"Open\" };\r\n}\r\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\n// this uses the \"html-to-react\" package, to transform <a> in the HTML string to <Link> elements\n// if we didn't need that transformation we could just do <div dangerouslySetInnerHTML={html} />\n\n// [Whitespace text nodes cannot appear as a child of `<table>`](https://github.com/aknuds1/html-to-react/issues/79)\nfunction trimHtml(html: string): string {\n  // React expects no whitespace between table elements\n  html = html.replace(/<table>\\s*<thead>/g, \"<table><thead>\");\n  html = html.replace(/<table>\\s*<tbody>/g, \"<table><tbody>\");\n  html = html.replace(/<thead>\\s*<tr>/g, \"<thead><tr>\");\n  html = html.replace(/<tbody>\\s*<tr>/g, \"<tbody><tr>\");\n  html = html.replace(/<tr>\\s*<th>/g, \"<tr><th>\");\n  html = html.replace(/<tr>\\s*<td>/g, \"<tr><td>\");\n\n  html = html.replace(/<\\/thead>\\s*<tbody>/g, \"</thead><tbody>\");\n\n  html = html.replace(/<\\/thead>\\s*<\\/table>/g, \"</thead></table>\");\n  html = html.replace(/<\\/tbody>\\s*<\\/table>/g, \"</tbody></table>\");\n  html = html.replace(/<\\/tr>\\s*<\\/thead>/g, \"</tr></thead>\");\n  html = html.replace(/<\\/tr>\\s*<\\/tbody>/g, \"</tr></tbody>\");\n  html = html.replace(/<\\/th>\\s*<\\/tr>/g, \"</th></tr>\");\n  html = html.replace(/<\\/td>\\s*<\\/tr>/g, \"</td></tr>\");\n\n  html = html.replace(/<\\/tr>\\s*<tr>/g, \"</tr><tr>\");\n  html = html.replace(/<\\/th>\\s*<th>/g, \"</th><th>\");\n  html = html.replace(/<\\/td>\\s*<td>/g, \"</td><td>\");\n  return html;\n}\n\nexport function htmlToReact(html: string): React.ReactElement {\n  html = trimHtml(html);\n  // console.log(html);\n\n  var { Parser, ProcessNodeDefinitions } = require(\"html-to-react\");\n  var parser = new Parser();\n  var processNodeDefinitions = new ProcessNodeDefinitions(React);\n  var isValidNode = function () {\n    return true;\n  };\n  // these \"node\" values aren't DOM nodes, so I type them here as type \"any\"\n  // `html-to-react` uses `htmlparser2` as its parser, which uses `domhandler` for its DOM,\n  // which uses e.g. \"parent\" instead of \"parentElement\" as a property name.\n  var processingInstructions = [\n    {\n      // Custom <a> processing\n      shouldProcessNode: function (node: any) {\n        return node.name === \"a\";\n      },\n      processNode: function (node: any, children: any) {\n        var href = node.attribs[\"href\"];\n        return React.createElement(Link, { to: href }, children);\n      },\n    },\n    {\n      // Anything else\n      shouldProcessNode: function (node: Node) {\n        return true;\n      },\n      processNode: processNodeDefinitions.processDefaultNode,\n    },\n  ];\n  var reactElement = parser.parseWithInstructions(`<div>${html}</div>`, isValidNode, processingInstructions);\n  return reactElement;\n}\n","import React from \"react\";\r\nimport { Api, Data } from \"client\";\r\nimport { useFetchApi } from \"../hooks\";\r\nimport { getPage, FetchedT, Layout } from \"../layouts\";\r\nimport { getUserInfo } from \"../components\";\r\n\r\nexport const Users: React.FunctionComponent = () => {\r\n  return getPage(useFetchApi(Api.getUsers), showUsers);\r\n};\r\n\r\nfunction showUsers(fetched: FetchedT<Data.UserSummaryEx[], void>): Layout {\r\n  const { data } = fetched;\r\n  const users: React.ReactElement = (\r\n    <div className=\"all-users\">\r\n      {data.map((user) => {\r\n        return getUserInfo(user, \"big\");\r\n      })}\r\n    </div>\r\n  );\r\n  return {\r\n    main: { content: users, title: \"Users\" },\r\n    width: \"Grid\",\r\n  };\r\n}\r\n","import { Api, config, Data, Post } from \"client\";\r\nimport React from \"react\";\r\nimport { Input, useValidatedInput } from \"../hooks\";\r\n\r\ninterface AnswerDiscussionProps {\r\n  discussionId: number;\r\n  reload: () => void;\r\n}\r\nexport const AnswerDiscussion: React.FunctionComponent<AnswerDiscussionProps> = (props) => {\r\n  type T = Post.NewMessage;\r\n\r\n  // created the validated elements and the submit button\r\n  const inputs: Map<keyof T, Input> = new Map<keyof T, Input>([\r\n    [\r\n      \"markdown\",\r\n      {\r\n        label: \"Body\",\r\n        hideLabel: true,\r\n        options: { minLength: config.minLengths.body },\r\n        create: { type: \"editor\" },\r\n      },\r\n    ],\r\n  ]);\r\n  const initialState: T = { markdown: \"\" };\r\n  const buttonText = { label: \"Post Your Answer\", noun: \"answer\" };\r\n  const { currentState, isError, button, mapInputs, onSubmitError } = useValidatedInput<T>(\r\n    inputs,\r\n    initialState,\r\n    buttonText\r\n  );\r\n\r\n  const { discussionId, reload } = props;\r\n\r\n  function handleSubmit(event: React.FormEvent<HTMLFormElement>): void {\r\n    event.preventDefault();\r\n    if (isError) {\r\n      // error messages are already displayed\r\n      return;\r\n    }\r\n    Api.newMessage(discussionId, currentState)\r\n      .then((__message: Data.Message) => {\r\n        // could push the received message into the display\r\n        // but instead let's force a reload e.g. to see whether any other user has posted too\r\n        reload();\r\n      })\r\n      .catch(onSubmitError);\r\n  }\r\n\r\n  const form = (\r\n    <form className=\"editor\" onSubmit={handleSubmit}>\r\n      <h2>Your Answer</h2>\r\n      {mapInputs.get(\"markdown\")}\r\n      <div className=\"submit\">{button}</div>\r\n    </form>\r\n  );\r\n\r\n  return form;\r\n};\r\n","import { Api, Data, Post, Url } from \"client\";\r\nimport { History } from \"history\";\r\nimport React from \"react\";\r\nimport { Input, useValidatedInput } from \"../hooks\";\r\n\r\n/*\r\n  Edit Tag Info\r\n*/\r\n\r\ninterface EditTagInfoProps {\r\n  history: History;\r\n  tag: string;\r\n  summary?: string;\r\n  markdown?: string;\r\n}\r\nexport const EditTagInfo: React.FunctionComponent<EditTagInfoProps> = (props: EditTagInfoProps) => {\r\n  type T = Post.EditTagInfo;\r\n\r\n  const { min: minLength, max: maxLength } = Data.tagSummaryLength;\r\n\r\n  const inputs: Map<keyof T, Input> = new Map<keyof T, Input>([\r\n    [\r\n      \"summary\",\r\n      {\r\n        label: \"Summary\",\r\n        options: { minLength },\r\n        create: {\r\n          type: \"textarea\",\r\n          placeholder: \"\",\r\n          attributes: { rows: 7, maxLength },\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      \"markdown\",\r\n      {\r\n        label: \"Description\",\r\n        options: { optional: true },\r\n        create: { type: \"editor\" },\r\n      },\r\n    ],\r\n  ]);\r\n  // reuse the default values for the initial state\r\n  const { summary, markdown } = props;\r\n  const initialState: T = {\r\n    summary: summary ? summary : \"\",\r\n    markdown: markdown ? markdown : \"\",\r\n  };\r\n\r\n  const buttonText = { label: \"Save Edits\", noun: \"post\" };\r\n  const { currentState, isError, button, mapInputs, onSubmitError } = useValidatedInput<T>(\r\n    inputs,\r\n    initialState,\r\n    buttonText\r\n  );\r\n\r\n  function getSummaryHint(): string {\r\n    const count: number = maxLength - currentState.summary.length;\r\n    return `${count} characters left`;\r\n  }\r\n\r\n  function handleSubmit(event: React.FormEvent<HTMLFormElement>): void {\r\n    event.preventDefault();\r\n    if (isError) {\r\n      // error messages are already displayed\r\n      return;\r\n    }\r\n    // post edited profile to the server\r\n    Api.editTagInfo(props.tag, currentState)\r\n      .then((tag: Data.Key) => {\r\n        // construct the URL of the newly-edited user\r\n        const url = Url.getTagInfoUrl(tag);\r\n        // use history.push() to navigate programmatically\r\n        // https://reacttraining.com/react-router/web/api/history\r\n        // https://stackoverflow.com/questions/31079081/programmatically-navigate-using-react-router\r\n        props.history.push(url);\r\n      })\r\n      .catch(onSubmitError);\r\n  }\r\n\r\n  return (\r\n    <form className=\"editor tag-wiki\" onSubmit={handleSubmit}>\r\n      <div className=\"element\">\r\n        {mapInputs.get(\"summary\")}\r\n        <p className=\"hint\">(plain text only, no Markdown formatting)</p>\r\n        <p className=\"hint next\">{getSummaryHint()}</p>\r\n      </div>\r\n      <div className=\"element\">{mapInputs.get(\"markdown\")}</div>\r\n      <div className=\"element\">{button}</div>\r\n    </form>\r\n  );\r\n};\r\n","import { Api, Data, Post, Url } from \"client\";\r\nimport { History } from \"history\";\r\nimport React from \"react\";\r\nimport { Input, useValidatedInput } from \"../hooks\";\r\n\r\n// this is a separate function component instead of just being incide the getSettingsContent function\r\n// [because it contains hooks](https://reactjs.org/docs/hooks-rules.html#only-call-hooks-from-react-functions)\r\ninterface EditUserSettingsProps {\r\n  history: History;\r\n  name: string;\r\n  location?: string;\r\n  aboutMe?: string;\r\n  email: string;\r\n  userId: number;\r\n  gravatar: React.ReactElement;\r\n}\r\nexport const EditUserSettings: React.FunctionComponent<EditUserSettingsProps> = (props: EditUserSettingsProps) => {\r\n  type T = Post.EditUserProfile;\r\n\r\n  const inputs: Map<keyof T, Input> = new Map<keyof T, Input>([\r\n    [\r\n      \"name\",\r\n      {\r\n        label: \"Display name\",\r\n        options: {},\r\n        create: { type: \"input\", placeholder: \"required\", attributes: {} },\r\n      },\r\n    ],\r\n    [\r\n      \"location\",\r\n      {\r\n        label: \"Location (optional)\",\r\n        options: { optional: true },\r\n        create: { type: \"input\", placeholder: \"optional\", attributes: {} },\r\n      },\r\n    ],\r\n    [\r\n      \"email\",\r\n      {\r\n        label: \"Email\",\r\n        options: {},\r\n        create: { type: \"input\", placeholder: \"required\", attributes: {} },\r\n      },\r\n    ],\r\n    [\r\n      \"aboutMe\",\r\n      {\r\n        label: \"About me\",\r\n        options: { optional: true },\r\n        create: { type: \"editor\" },\r\n      },\r\n    ],\r\n  ]);\r\n  // reuse the default values for the initial state\r\n  const { name, location, email, aboutMe } = props;\r\n  const initialState: T = {\r\n    name,\r\n    location: location ? location : \"\",\r\n    email,\r\n    aboutMe: aboutMe ? aboutMe : \"\",\r\n  };\r\n  const buttonText = { label: \"Save Changes\", noun: \"changed settings\" };\r\n  const { currentState, isError, button, mapInputs, onSubmitError } = useValidatedInput<T>(\r\n    inputs,\r\n    initialState,\r\n    buttonText\r\n  );\r\n\r\n  function handleSubmit(event: React.FormEvent<HTMLFormElement>): void {\r\n    event.preventDefault();\r\n    if (isError) {\r\n      // error messages are already displayed\r\n      return;\r\n    }\r\n    // post edited profile to the server\r\n    Api.editUserProfile(props.userId, currentState)\r\n      .then((idName: Data.IdName) => {\r\n        // construct the URL of the newly-edited user\r\n        const url = Url.getUserUrl(idName);\r\n        // use history.push() to navigate programmatically\r\n        // https://reacttraining.com/react-router/web/api/history\r\n        // https://stackoverflow.com/questions/31079081/programmatically-navigate-using-react-router\r\n        props.history.push(url);\r\n      })\r\n      .catch(onSubmitError);\r\n  }\r\n\r\n  return (\r\n    <form className=\"editor settings\" onSubmit={handleSubmit}>\r\n      <h1>Edit</h1>\r\n      <h2>Public information</h2>\r\n      <div className=\"public\">\r\n        {props.gravatar}\r\n        <div className=\"column\">\r\n          {mapInputs.get(\"name\")}\r\n          {mapInputs.get(\"location\")}\r\n        </div>\r\n      </div>\r\n      {mapInputs.get(\"aboutMe\")}\r\n      <h2>Private settings</h2>\r\n      {mapInputs.get(\"email\")}\r\n      <div className=\"submit\">{button}</div>\r\n    </form>\r\n  );\r\n};\r\n","import { Api, Data, Post } from \"client\";\r\nimport React from \"react\";\r\nimport \"ui-assets/css/Login.css\";\r\nimport { Input, useSetMe, useValidatedInput } from \"../hooks\";\r\n\r\nexport const Login: React.FunctionComponent = () => {\r\n  type T = Post.Login;\r\n\r\n  const inputs: Map<keyof T, Input> = new Map<keyof T, Input>([\r\n    [\r\n      \"userName\",\r\n      {\r\n        label: \"Username\",\r\n        hideLabel: true,\r\n        options: {},\r\n        create: { type: \"input\", placeholder: \"Username\", attributes: {} },\r\n      },\r\n    ],\r\n    [\r\n      \"password\",\r\n      {\r\n        label: \"Password\",\r\n        hideLabel: true,\r\n        options: {},\r\n        create: { type: \"input\", placeholder: \"Password\", attributes: {} },\r\n      },\r\n    ],\r\n  ]);\r\n  // reuse the default values for the initial state\r\n  const initialState: T = { userName: \"\", password: \"\" };\r\n  const buttonText = { label: \"Submit\", noun: \"login\" };\r\n  const { currentState, isError, button, mapInputs, onSubmitError } = useValidatedInput<T>(\r\n    inputs,\r\n    initialState,\r\n    buttonText\r\n  );\r\n\r\n  const setMe = useSetMe();\r\n\r\n  function handleSubmit(event: React.FormEvent<HTMLFormElement>): void {\r\n    event.preventDefault();\r\n    if (isError) {\r\n      // error messages are already displayed\r\n      return;\r\n    }\r\n    Api.login(currentState)\r\n      .then((userSummary: Data.UserSummary) => setMe(userSummary))\r\n      .catch(onSubmitError);\r\n  }\r\n\r\n  const content = (\r\n    <React.Fragment>\r\n      <p>This will be a login page, with user name and password.</p>\r\n      <p>For this prototype, just press the button to simulate a login.</p>\r\n      <form className=\"login\" onSubmit={handleSubmit}>\r\n        <div className=\"p\">{mapInputs.get(\"userName\")}</div>\r\n        <div className=\"p\">{mapInputs.get(\"password\")}</div>\r\n        <div className=\"p\">{button}</div>\r\n      </form>\r\n      <h3>Only in this prototype</h3>\r\n      <p>The UI details for creating a new account are not defined yet.</p>\r\n      <p>If you refresh the page, then this application is reloaded and:</p>\r\n      <ul>\r\n        <li>The login is reset</li>\r\n        <li>Any other data you entered is reset</li>\r\n      </ul>\r\n      <p>This is a prototype of the UI, without a server: so any data you enter isn't permanently stored anywhere.</p>\r\n    </React.Fragment>\r\n  );\r\n  return content;\r\n};\r\n","import { Api, config, Data, Post, Url } from \"client\";\r\nimport { History } from \"history\";\r\nimport React from \"react\";\r\nimport { EditorTags, OutputTags } from \"../components\";\r\nimport { Input, useValidatedInput } from \"../hooks\";\r\n\r\ntype NewDiscussionProps = { history: History };\r\nexport const NewDiscussion: React.FunctionComponent<NewDiscussionProps> = (props: NewDiscussionProps) => {\r\n  type T = Post.NewDiscussion;\r\n\r\n  const inputs: Map<keyof T, Input> = new Map<keyof T, Input>([\r\n    [\r\n      \"title\",\r\n      {\r\n        label: \"Title\",\r\n        options: { minLength: config.minLengths.title },\r\n        create: { type: \"input\", placeholder: \"\", attributes: {} },\r\n      },\r\n    ],\r\n    [\r\n      \"markdown\",\r\n      {\r\n        label: \"Body\",\r\n        options: { minLength: config.minLengths.body },\r\n        create: { type: \"editor\" },\r\n      },\r\n    ],\r\n  ]);\r\n  // reuse the default values for the initial state\r\n  const initialState: T = { title: \"\", markdown: \"\", tags: [] };\r\n  const buttonText = {\r\n    label: config.strNewQuestion.button,\r\n    noun: config.strNewQuestion.noun,\r\n  };\r\n  const { currentState, isError, isAfterSubmit, button, mapInputs, onSubmitError } = useValidatedInput<T>(\r\n    inputs,\r\n    initialState,\r\n    buttonText\r\n  );\r\n\r\n  // tags are handle separately ... the validation etc. in ErrorMessage.tsx is only for string elements\r\n  // whereas tags are string[]\r\n  const [outputTags, setOutputTags] = React.useState<OutputTags>({\r\n    tags: [],\r\n    isValid: false,\r\n  });\r\n\r\n  const { history } = props;\r\n\r\n  function handleSubmit(event: React.FormEvent<HTMLFormElement>): void {\r\n    event.preventDefault();\r\n    if (isError || !outputTags.isValid) {\r\n      // error messages are already displayed\r\n      return;\r\n    }\r\n    Api.newDiscussion({ ...currentState, tags: outputTags.tags })\r\n      .then((idName: Data.IdName) => {\r\n        // construct the URL of the newly-created discussion\r\n        const url = Url.getDiscussionUrl(idName);\r\n        history.push(url);\r\n      })\r\n      .catch(onSubmitError);\r\n  }\r\n\r\n  const emptyTags: string[] = [];\r\n  const { minimum, maximum, canNewTag } = config.tagValidation;\r\n  const form = (\r\n    <form className=\"editor\" onSubmit={handleSubmit}>\r\n      <div className=\"element\">{mapInputs.get(\"title\")}</div>\r\n      <div className=\"element\">{mapInputs.get(\"markdown\")}</div>\r\n      <div className=\"element\">\r\n        <label htmlFor=\"tags\">Tags</label>\r\n        <EditorTags\r\n          inputTags={emptyTags}\r\n          result={setOutputTags}\r\n          getAllTags={Api.getAllTags}\r\n          minimum={minimum}\r\n          maximum={maximum}\r\n          canNewTag={canNewTag}\r\n          showValidationError={isAfterSubmit}\r\n          hrefAllTags={Url.route.tags}\r\n        />\r\n      </div>\r\n      <div className=\"element\">{button}</div>\r\n    </form>\r\n  );\r\n\r\n  return form;\r\n};\r\n","import React from \"react\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport { ErrorMessage } from \"../components\";\r\n\r\nexport const NotFound: React.FunctionComponent<RouteComponentProps> = (props: RouteComponentProps) => {\r\n  return notFound(props);\r\n};\r\n\r\nexport function notFound(props: RouteComponentProps, error?: string) {\r\n  const pathname = props.location.pathname;\r\n  return (\r\n    <div>\r\n      <h3>Not Found</h3>\r\n      <p>\r\n        No page found for <code>{pathname}</code>\r\n      </p>\r\n      <ErrorMessage errorMessage={error} />\r\n    </div>\r\n  );\r\n}\r\n","import { Api, config, Data, toHtml, Url } from \"client\";\r\nimport { History } from \"history\";\r\nimport React from \"react\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport { getDiscussionSummary, getTagCount, getUserSummary } from \"../components\";\r\nimport { EditUserSettings } from \"../forms\";\r\nimport { FetchingT, useFetchApi2, useMe } from \"../hooks\";\r\nimport * as Icon from \"../icons\";\r\nimport { FetchedT, getPage, KeyedItem, Layout, MainContent, ShowDataT, SubTabs, Tab, Tabs } from \"../layouts\";\r\nimport { notFound } from \"./NotFound\";\r\n\r\nexport const User: React.FunctionComponent<RouteComponentProps> = (props: RouteComponentProps) => {\r\n  const parsed = Url.isUserOptions(props.location);\r\n  const me = useMe();\r\n  if (Url.isParserError(parsed)) {\r\n    return notFound(props, parsed.error);\r\n  }\r\n  const { userTabType, user } = parsed;\r\n  const canEdit = !!me && user.id === me.id;\r\n  switch (userTabType) {\r\n    case \"Profile\":\r\n    case undefined:\r\n      return <UserProfile {...props} id={user.id} name={user.name} canEdit={canEdit} />;\r\n    case \"EditSettings\":\r\n      if (!canEdit) {\r\n        return notFound(props, \"You cannot edit another user's profile\");\r\n      }\r\n      return <UserEditSettings {...props} id={user.id} name={user.name} canEdit={canEdit} />;\r\n    case \"Activity\":\r\n      const options = Url.isUserActivityOptions(props.location);\r\n      if (Url.isParserError(options)) {\r\n        return notFound(props, options.error);\r\n      }\r\n      return <UserActivity {...props} options={options} canEdit={canEdit} />;\r\n    default:\r\n      return notFound(props, \"Unexpected userTabType\");\r\n  }\r\n};\r\n\r\n// these are used as TExtra types\r\ntype UserCanEdit = { canEdit: boolean };\r\ntype UserCanEditAndHistory = UserCanEdit & { history: History };\r\n\r\ntype UserProps = RouteComponentProps & Data.IdName & UserCanEdit;\r\nconst UserProfile: React.FunctionComponent<UserProps> = (props: UserProps) => {\r\n  const { id, name, canEdit } = props;\r\n  const idName = React.useMemo<Data.IdName>(() => {\r\n    return { id, name };\r\n  }, [id, name]);\r\n\r\n  const fetching: FetchingT<Data.User, void> = useFetchApi2(Api.getUser, idName);\r\n  const showData: ShowDataT<Data.User, void> = (fetched: FetchedT<Data.User, void>) =>\r\n    showUserProfile(fetched, { canEdit });\r\n\r\n  return getPage(fetching, showData);\r\n};\r\n\r\nconst UserEditSettings: React.FunctionComponent<UserProps> = (props: UserProps) => {\r\n  const { id, name, canEdit, history } = props;\r\n  const idName = React.useMemo<Data.IdName>(() => {\r\n    return { id, name };\r\n  }, [id, name]);\r\n\r\n  const fetching: FetchingT<Data.User, void> = useFetchApi2(Api.getUser, idName);\r\n  const showData: ShowDataT<Data.User, void> = (fetched: FetchedT<Data.User, void>) =>\r\n    showUserSettings(fetched, { canEdit, history });\r\n\r\n  return getPage(fetching, showData);\r\n  // return useGetLayout2<Data.User, Data.IdName, UserCanEditAndHistory>(Api.getUser, Page.UserSettings, idName, {\r\n  //   canEdit: props.canEdit,\r\n  //   history: props.history,\r\n  // });\r\n};\r\n\r\ntype UserActivityProps = RouteComponentProps & {\r\n  options: Url.UserActivityOptions;\r\n} & UserCanEdit;\r\nconst UserActivity: React.FunctionComponent<UserActivityProps> = (props: UserActivityProps) => {\r\n  // UserActivity may have extra search options, same as for Discussions, which the profile tab doesn't have\r\n  const { user, userTabType, sort, page } = props.options;\r\n  const { canEdit } = props;\r\n  const { id, name } = user;\r\n  const options = React.useMemo<Url.UserActivityOptions>(() => {\r\n    return { user: { id, name }, userTabType, sort, page };\r\n  }, [id, name, userTabType, sort, page]);\r\n\r\n  const fetching: FetchingT<Data.UserActivity, void> = useFetchApi2(Api.getUserActivity, options);\r\n  const showData: ShowDataT<Data.UserActivity, void> = (fetched: FetchedT<Data.UserActivity, void>) =>\r\n    showUserActivity(fetched, { canEdit });\r\n\r\n  return getPage(fetching, showData);\r\n};\r\n\r\nexport function showUserProfile(fetched: FetchedT<Data.User, void>, extra: { canEdit: boolean }): Layout {\r\n  const { data: user } = fetched;\r\n  const gravatar = getUserSummary(user, {\r\n    title: false,\r\n    size: \"huge\",\r\n  }).gravatar;\r\n  const { aboutMe, location } = user;\r\n  const aboutMeDiv = !aboutMe ? undefined : <div dangerouslySetInnerHTML={toHtml(aboutMe)} />;\r\n  const content = (\r\n    <div className=\"user-profile profile\">\r\n      {gravatar}\r\n      <div className=\"column\">\r\n        <h1>{user.name}</h1>\r\n        {location ? (\r\n          <p className=\"location\">\r\n            <Icon.Location width=\"24\" height=\"24\" /> {location}\r\n          </p>\r\n        ) : undefined}\r\n        <div className=\"about\">\r\n          <h3>About me</h3>\r\n          {aboutMeDiv}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n  return showCommonUserLayout(user, \"Profile\", content, extra.canEdit);\r\n}\r\n\r\nexport function showUserSettings(\r\n  fetched: FetchedT<Data.User, void>,\r\n  extra: { canEdit: boolean; history: History }\r\n): Layout {\r\n  const { data: user } = fetched;\r\n  const gravatar = getUserSummary(user, {\r\n    title: false,\r\n    size: \"huge\",\r\n  }).gravatar;\r\n  // EditUserSettings is a separate function component instead of just being incide the getSettingsContent function\r\n  // [because it contains hooks](https://reactjs.org/docs/hooks-rules.html#only-call-hooks-from-react-functions)\r\n  const content = (\r\n    <div className=\"user-profile settings\">\r\n      <EditUserSettings\r\n        history={extra.history}\r\n        name={user.name}\r\n        location={user.location}\r\n        aboutMe={user.aboutMe}\r\n        email={user.preferences!.email}\r\n        userId={user.id}\r\n        gravatar={gravatar}\r\n      />\r\n    </div>\r\n  );\r\n  return showCommonUserLayout(user, \"EditSettings\", content, extra.canEdit);\r\n}\r\n\r\nexport function showUserActivity(fetched: FetchedT<Data.UserActivity, void>, extra: { canEdit: boolean }): Layout {\r\n  const { data: activity } = fetched;\r\n  function getActivityContent(): ReadonlyArray<KeyedItem> {\r\n    if (!activity.summaries.length) {\r\n      return [{ element: <p>This user has not posted any messages.</p>, key: \"none\" }];\r\n    }\r\n    const tagCounts = activity.tagCounts.sort((x, y) => x.key.localeCompare(y.key));\r\n    const tags = (\r\n      <React.Fragment>\r\n        <h2>{`${activity.tagCounts.length} ${config.strTags}`}</h2>\r\n        <div className=\"tags\">{tagCounts.map(getTagCount)}</div>\r\n      </React.Fragment>\r\n    );\r\n    const first: KeyedItem = { element: tags, key: \"tags\" };\r\n    const next: KeyedItem[] = activity.summaries.map((summary) => getDiscussionSummary(summary, true));\r\n    return [first].concat(next);\r\n  }\r\n  const content = getActivityContent();\r\n\r\n  function getActivityUrl(user: Data.IdName, sort: Url.ActivitySort) {\r\n    return Url.getUserActivityUrl({ user, userTabType: \"Activity\", sort });\r\n  }\r\n  const subTabs: SubTabs = {\r\n    text: activity.summaries.length === 1 ? \"1 Message\" : `${activity.summaries.length} Messages`,\r\n    selected: activity.range.sort === \"Newest\" ? 0 : 1,\r\n    tabs: [\r\n      { text: \"newest\", href: getActivityUrl(activity.summary, \"Newest\") },\r\n      { text: \"oldest\", href: getActivityUrl(activity.summary, \"Oldest\") },\r\n    ],\r\n  };\r\n\r\n  return showCommonUserLayout(activity.summary, \"Activity\", content, extra.canEdit, subTabs);\r\n}\r\n\r\n// create a Layout that's common to all three user tabs\r\nfunction showCommonUserLayout(\r\n  summary: Data.UserSummary,\r\n  userTabType: Url.UserTabType,\r\n  content: MainContent,\r\n  canEdit: boolean,\r\n  subTabs?: SubTabs\r\n): Layout {\r\n  const gravatarSmall = getUserSummary(summary, {\r\n    title: false,\r\n    size: \"small\",\r\n  }).gravatar;\r\n  const slug = (\r\n    <React.Fragment>\r\n      <h1>{summary.name}</h1>\r\n      {gravatarSmall}\r\n    </React.Fragment>\r\n  );\r\n\r\n  // the tab definitions\r\n\r\n  const profile: Tab = {\r\n    navlink: {\r\n      href: Url.getUserOptionsUrl({ user: summary, userTabType: \"Profile\" }),\r\n      text: \"Profile\",\r\n    },\r\n    content: <p>To be supplied</p>,\r\n  };\r\n\r\n  const settings: Tab = {\r\n    navlink: {\r\n      href: Url.getUserOptionsUrl({ user: summary, userTabType: \"EditSettings\" }),\r\n      text: \"Edit\",\r\n    },\r\n    content: <p>Not authorized</p>,\r\n    slug,\r\n  };\r\n\r\n  const activity: Tab = {\r\n    navlink: {\r\n      href: Url.getUserOptionsUrl({ user: summary, userTabType: \"Activity\" }),\r\n      text: \"Activity\",\r\n    },\r\n    content: <p>To be supplied</p>,\r\n    subTabs,\r\n    slug,\r\n  };\r\n\r\n  function getSelected(): number {\r\n    switch (userTabType) {\r\n      case \"Profile\":\r\n        profile.content = content;\r\n        return 0;\r\n      case \"EditSettings\":\r\n        if (canEdit) {\r\n          settings.content = content;\r\n        }\r\n        return 1;\r\n      case \"Activity\":\r\n        activity.content = content;\r\n        return canEdit ? 2 : 1;\r\n      default:\r\n        throw new Error(\"Unexpected userTabType\");\r\n    }\r\n  }\r\n  const selected = getSelected();\r\n\r\n  const tabs: Tabs = {\r\n    selected,\r\n    title: summary.name,\r\n    tabbed: canEdit ? [profile, settings!, activity] : [profile, activity],\r\n  };\r\n\r\n  return {\r\n    main: tabs,\r\n    width: \"Closed\",\r\n  };\r\n}\r\n","import { Api, config, Data, Url } from \"client\";\r\nimport React from \"react\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport { getDiscussionsSubtitle, getDiscussionSummary, getNavLinks, getPageNavLinks } from \"../components\";\r\nimport { useFetchApi2 } from \"../hooks\";\r\nimport { FetchedT, getPage, Layout } from \"../layouts\";\r\nimport { notFound } from \"./NotFound\";\r\n\r\nexport const Discussions: React.FunctionComponent<RouteComponentProps> = (props: RouteComponentProps) => {\r\n  // get the options\r\n  const options = Url.isDiscussionsOptions(props.location);\r\n  if (Url.isParserError(options)) {\r\n    return notFound(props, options.error);\r\n  }\r\n  // split options into its components instead of passing whole options\r\n  // otherwise the eslint \"react-hooks/exhaustive-deps\" rule wil complain when we use useMemo\r\n  return <DiscussionsList sort={options.sort} pagesize={options.pagesize} page={options.page} tag={options.tag} />;\r\n};\r\n\r\nconst DiscussionsList: React.FunctionComponent<Url.DiscussionsOptions> = (props: Url.DiscussionsOptions) => {\r\n  const { sort, pagesize, page, tag } = props;\r\n  const options: Url.DiscussionsOptions = React.useMemo(() => {\r\n    return { sort, pagesize, page, tag };\r\n  }, [sort, pagesize, page, tag]);\r\n\r\n  return getPage(useFetchApi2(Api.getDiscussions, options), showDiscussions);\r\n};\r\n\r\nfunction showDiscussions(fetched: FetchedT<Data.Discussions, void>): Layout {\r\n  const { data } = fetched;\r\n  const { range, summaries } = data;\r\n  const { pageNumber, nTotal, pageSize, sort, tag } = range;\r\n  const title = !tag\r\n    ? `All ${config.strQuestions}`\r\n    : `${sort === \"Newest\" ? \"Newest\" : \"Recently Active\"} '${tag.key}' ${config.strQuestions}`;\r\n\r\n  const subtitle = getDiscussionsSubtitle(title, formatNumber(nTotal, config.strQuestions), tag, sort);\r\n\r\n  const footer = (\r\n    <React.Fragment>\r\n      <div className=\"minigrid footer\">\r\n        <div className=\"page\">\r\n          {getPageNavLinks(pageNumber, nTotal, pageSize, (page) => Url.getDiscussionsOptionsUrl({ page, sort, tag }))}\r\n        </div>\r\n        <div className=\"page\">\r\n          {getNavLinks(\r\n            [15, 30, 50].map((n) => {\r\n              return { text: \"\" + n, n };\r\n            }),\r\n            (n: number) => Url.getDiscussionsOptionsUrl({ pagesize: n as Url.PageSize, tag }),\r\n            (n: number) => `show ${n} items per page`,\r\n            pageSize,\r\n            false\r\n          )}\r\n          <span className=\"dots\">per page</span>\r\n        </div>\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n\r\n  const content = summaries.map((summary) => getDiscussionSummary(summary));\r\n\r\n  return {\r\n    main: { content, title, subtitle, footer },\r\n    width: \"Closed\",\r\n  };\r\n}\r\n\r\nfunction formatNumber(count: number, things: string) {\r\n  // https://blog.abelotech.com/posts/number-currency-formatting-javascript/\r\n  const rc = count.toString().replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, \"$1,\") + \" \" + things.toLowerCase();\r\n  return count === 1 && things[things.length - 1] === \"s\" ? rc.substring(0, rc.length - 1) : rc;\r\n}\r\n","import { Api, Data, Url } from \"client\";\r\nimport React from \"react\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport { getFirstMessage, getNextMessage, getPageNavLinks } from \"../components\";\r\nimport { AnswerDiscussion } from \"../forms\";\r\nimport { useFetchApi2 } from \"../hooks\";\r\nimport { FetchedT, getPage, KeyedItem, Layout, SubTabs } from \"../layouts\";\r\nimport { notFound } from \"./NotFound\";\r\n\r\nexport const Discussion: React.FunctionComponent<RouteComponentProps> = (props: RouteComponentProps) => {\r\n  const parsed = Url.isDiscussionOptions(props.location);\r\n  if (Url.isParserError(parsed)) {\r\n    return notFound(props, parsed.error);\r\n  }\r\n\r\n  return <DiscussionId discussion={parsed.discussion} sort={parsed.sort} page={parsed.page} />;\r\n};\r\n\r\nconst DiscussionId: React.FunctionComponent<Url.DiscussionOptions> = (props: Url.DiscussionOptions) => {\r\n  const { sort, discussion, page } = props;\r\n  const options: Url.DiscussionOptions = React.useMemo(() => {\r\n    return {\r\n      sort,\r\n      page,\r\n      discussion: { id: discussion.id, name: discussion.name },\r\n    };\r\n  }, [sort, discussion.id, discussion.name, page]);\r\n\r\n  return getPage(useFetchApi2(Api.getDiscussion, options), showDiscussion);\r\n};\r\n\r\nexport function showDiscussion(fetched: FetchedT<Data.Discussion, void>): Layout {\r\n  const { data, reload } = fetched;\r\n  const { id, name, tags, first, range, messages } = data;\r\n  const { nTotal } = range;\r\n\r\n  const subTabs: SubTabs | undefined = !nTotal\r\n    ? undefined\r\n    : {\r\n        text: nTotal === 1 ? \"1 Answer\" : `${nTotal} Answers`,\r\n        selected: data.range.sort === \"Newest\" ? 0 : 1,\r\n        tabs: [\r\n          {\r\n            text: \"newest\",\r\n            href: Url.getDiscussionOptionsUrl({\r\n              discussion: data,\r\n              sort: \"Newest\",\r\n            }),\r\n          },\r\n          {\r\n            text: \"oldest\",\r\n            href: Url.getDiscussionOptionsUrl({\r\n              discussion: data,\r\n              sort: \"Oldest\",\r\n            }),\r\n          },\r\n        ],\r\n      };\r\n\r\n  const content: KeyedItem[] = [];\r\n  content.push(getFirstMessage(first, tags));\r\n  messages.forEach((message, index) => content.push(getNextMessage(message, index)));\r\n\r\n  const footer =\r\n    range.nTotal > range.pageSize ? (\r\n      <div className=\"footer\">\r\n        <div className=\"index\">\r\n          {getPageNavLinks(range.pageNumber, range.nTotal, range.pageSize, (page) =>\r\n            Url.getDiscussionOptionsUrl({\r\n              discussion: data,\r\n              page,\r\n              sort: range.sort,\r\n            })\r\n          )}\r\n        </div>\r\n      </div>\r\n    ) : undefined;\r\n\r\n  const yourAnswer = <AnswerDiscussion discussionId={id} reload={reload} />;\r\n  content.push({ element: yourAnswer, key: \"editor\" });\r\n\r\n  return {\r\n    main: { content, title: name, subTabs, footer },\r\n    width: \"Open\",\r\n  };\r\n}\r\n","import { config } from \"client\";\r\nimport React from \"react\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport { NewDiscussion as NewDiscussionElement } from \"../forms\";\r\nimport { Layout, renderLayout } from \"../layouts\";\r\n\r\nexport const NewDiscussion: React.FunctionComponent<RouteComponentProps> = (props: RouteComponentProps) => {\r\n  // this is unusual because we don't need to fetch data before rendering this element\r\n  const content = <NewDiscussionElement history={props.history} />;\r\n  const title = config.strNewQuestion.title;\r\n  const layout: Layout = {\r\n    main: { content, title },\r\n    width: \"None\",\r\n  };\r\n  return renderLayout(layout);\r\n};\r\n","import { Api, config, Data, SearchInput, Url } from \"client\";\r\nimport React from \"react\";\r\nimport { Link, NavLink, RouteComponentProps } from \"react-router-dom\";\r\nimport { getPageNavLinks, getTagLink, ThrottledInput } from \"../components\";\r\nimport { useFetchApi2 } from \"../hooks\";\r\nimport * as Icon from \"../icons\";\r\nimport { FetchedT, getPage, Layout } from \"../layouts\";\r\nimport { notFound } from \"./NotFound\";\r\n\r\nexport const Tags: React.FunctionComponent<RouteComponentProps> = (props: RouteComponentProps) => {\r\n  // get the options\r\n  const options = Url.isTagsOptions(props.location);\r\n  if (Url.isParserError(options)) {\r\n    return notFound(props, options.error);\r\n  }\r\n  return <TagsList sort={options.sort} pagesize={options.pagesize} page={options.page} />;\r\n};\r\n\r\nconst TagsList: React.FunctionComponent<Url.TagsOptions> = (props: Url.TagsOptions) => {\r\n  const { sort, pagesize, page } = props;\r\n  const options: Url.TagsOptions = React.useMemo(() => {\r\n    return { sort, pagesize, page };\r\n  }, [sort, pagesize, page]);\r\n\r\n  return getPage(useFetchApi2(Api.getTags, options), showTags);\r\n};\r\n\r\nfunction showTags(fetched: FetchedT<Data.Tags, SearchInput>): Layout {\r\n  const { data, newData } = fetched;\r\n  const { range, tagCounts } = data;\r\n  const title = config.strTags;\r\n\r\n  // the header (subtitle) and footer are like (copy-and-pasted) those from the Discussions page\r\n\r\n  const search = (\r\n    <div className=\"search\">\r\n      <ThrottledInput api={newData} placeholder=\"Filter by tag name\" />\r\n      <Icon.Search />\r\n    </div>\r\n  );\r\n\r\n  const subtitle = (\r\n    <React.Fragment>\r\n      <div className=\"minigrid\">\r\n        <h1>{title}</h1>\r\n      </div>\r\n      <div className=\"minigrid subtitle\">\r\n        <div className=\"count\">{search}</div>\r\n        <div className=\"sort\">\r\n          <NavLink\r\n            to={Url.getTagsOptionsUrl({ sort: \"Popular\" })}\r\n            className={range.sort === \"Popular\" ? \"selected\" : undefined}\r\n          >\r\n            Popular\r\n          </NavLink>\r\n          <NavLink\r\n            to={Url.getTagsOptionsUrl({ sort: \"Name\" })}\r\n            className={range.sort === \"Name\" ? \"selected\" : undefined}\r\n          >\r\n            Name\r\n          </NavLink>\r\n        </div>\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n\r\n  const footer = (\r\n    <React.Fragment>\r\n      <div className=\"minigrid footer\">\r\n        <div className=\"page\"></div>\r\n        <div className=\"page\">\r\n          {getPageNavLinks(range.pageNumber, range.nTotal, range.pageSize, (page) =>\r\n            Url.getTagsOptionsUrl({ page, sort: range.sort })\r\n          )}\r\n        </div>\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n\r\n  function getTagInfo(tagCount: Data.TagCount) {\r\n    // similar to the ShowHint function in EditorTags.tsx\r\n    const key = tagCount.key;\r\n    const tag = getTagLink(tagCount);\r\n    const count = tagCount.count ? <span className=\"multiplier\">×&nbsp;{tagCount.count}</span> : undefined;\r\n    const summary = tagCount.summary ? <div className=\"exerpt\">{tagCount.summary}</div> : undefined;\r\n    const edit = (\r\n      <div>\r\n        <Link className=\"edit-link\" to={Url.getTagEditUrl({ key })}>\r\n          edit\r\n        </Link>\r\n      </div>\r\n    );\r\n\r\n    return (\r\n      <div className=\"tag-info\" key={key}>\r\n        {tag}\r\n        {count}\r\n        {summary}\r\n        {edit}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // the content is like that of the User page\r\n  const contentTags: React.ReactElement = (\r\n    <div className=\"all-tags\">\r\n      {tagCounts.map((tagCount) => {\r\n        return getTagInfo(tagCount);\r\n      })}\r\n    </div>\r\n  );\r\n\r\n  return {\r\n    main: { content: contentTags, title, subtitle, footer },\r\n    width: \"Grid\",\r\n  };\r\n}\r\n","import { Api, Data, toHtml, Url } from \"client\";\r\nimport { History } from \"history\";\r\nimport React from \"react\";\r\nimport { Link, RouteComponentProps } from \"react-router-dom\";\r\nimport { getDiscussionsSubtitle } from \"../components\";\r\nimport { EditTagInfo } from \"../forms\";\r\nimport { useFetchApi2 } from \"../hooks\";\r\nimport { FetchedT, getPage, Layout, ShowDataT } from \"../layouts\";\r\nimport { notFound } from \"./NotFound\";\r\n\r\nexport const Tag: React.FunctionComponent<RouteComponentProps> = (props: RouteComponentProps) => {\r\n  const info = Url.isTagInfo(props.location);\r\n  if (!Url.isParserError(info)) {\r\n    return <TagId tag={info.key} word=\"info\" history={props.history} />;\r\n  }\r\n  const edit = Url.isTagEdit(props.location);\r\n  if (!Url.isParserError(edit)) {\r\n    return <TagId tag={edit.key} word=\"edit\" history={props.history} />;\r\n  }\r\n  return notFound(props);\r\n};\r\n\r\ntype TagIdProps = Url.InfoOrEdit & { history: History; tag: string };\r\nconst TagId: React.FunctionComponent<TagIdProps> = (props: TagIdProps) => {\r\n  const { tag, word, history } = props;\r\n\r\n  // include word as a dependency because we want to re-render if word changes,\r\n  // even though { word } isn't required in the TParam parameter passed to useGetLayout2\r\n  const key: Data.Key & Url.InfoOrEdit = React.useMemo(() => {\r\n    return { key: tag, word };\r\n  }, [tag, word]);\r\n\r\n  const showData: ShowDataT<Data.TagInfo, void> = (fetched: FetchedT<Data.TagInfo, void>) =>\r\n    showTag(fetched, { word, history });\r\n  return getPage(useFetchApi2(Api.getTag, key), showData);\r\n};\r\n\r\ntype TagExtra = Url.InfoOrEdit & { history: History };\r\nfunction showTag(fetched: FetchedT<Data.TagInfo, void>, extra: TagExtra): Layout {\r\n  const { data } = fetched;\r\n  const { word } = extra;\r\n\r\n  const title = word === \"edit\" ? `Editing tag info for '${data.key}'` : `About '${data.key}'`;\r\n\r\n  const subtitle = word === \"edit\" ? undefined : getDiscussionsSubtitle(title, \"Tag Info\", data, \"info\");\r\n\r\n  function infoContent() {\r\n    const summary = data.summary ? data.summary : \"There is no summary for this tag … yet!\";\r\n    const markdown = data.markdown ? (\r\n      <div dangerouslySetInnerHTML={toHtml(data.markdown)}></div>\r\n    ) : (\r\n      <div className=\"summary none\">{\"There is no information for this tag … yet!\"}</div>\r\n    );\r\n    const buttonText = !!data.summary && !!data.markdown ? \"Edit Tag info\" : \"Create Tag Info\";\r\n    return (\r\n      <div className=\"tag-wiki\">\r\n        <div className=\"summary\">{summary}</div>\r\n        {markdown}\r\n        <div className=\"link\">\r\n          <Link to={Url.getTagEditUrl(data)} className=\"linkbutton\">\r\n            {buttonText}\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const content =\r\n    word === \"edit\" ? (\r\n      <EditTagInfo tag={data.key} history={extra.history} summary={data.summary} markdown={data.markdown} />\r\n    ) : (\r\n      infoContent()\r\n    );\r\n  const layout: Layout = {\r\n    main: { content, title, subtitle },\r\n    width: \"None\",\r\n  };\r\n  return layout;\r\n}\r\n","import React from \"react\";\nimport { Login as LoginForm } from \"../forms\";\nimport { Layout, renderLayout } from \"../layouts\";\n\nexport const Login: React.FunctionComponent = () => {\n  const content = <LoginForm />;\n  const layout: Layout = { main: { content, title: \"Login\" }, width: \"Open\" };\n  return renderLayout(layout);\n};\n","import { Api, Data } from \"client\";\r\nimport React from \"react\";\r\nimport { getImageSummary, getTagSummary } from \"../components\";\r\nimport { useFetchApi } from \"../hooks\";\r\nimport { FetchedT, getPage, KeyedItem, Layout } from \"../layouts\";\r\n\r\nexport const SiteMap: React.FunctionComponent = () => {\r\n  return getPage(useFetchApi(Api.getSiteMap), showSiteMap);\r\n};\r\n\r\nfunction showSiteMap(fetched: FetchedT<Data.SiteMap, void>): Layout {\r\n  const { data } = fetched;\r\n  const content: KeyedItem[] = [];\r\n\r\n  /*\r\n    visitors can see:\r\n    - image document[s]\r\n    - (featured) articles\r\n    - (text) sources\r\n\r\n    and cannot see:\r\n    - users\r\n    - discussions\r\n    - feaure reports\r\n    - notable omissions\r\n  */\r\n\r\n  // render the images\r\n  data.images.forEach((x) => content.push(getImageSummary(x)));\r\n\r\n  const features = (\r\n    <React.Fragment>\r\n      <h2>Features</h2>\r\n      <div className=\"features\">\r\n        {data.tags.map((tag) => {\r\n          const content = getTagSummary(tag);\r\n          /*\r\n            either we need to add whitespace between elements ...\r\n            - https://github.com/facebook/react/issues/1643\r\n            - https://reactjs.org/blog/2014/02/20/react-v0.9.html#jsx-whitespace\r\n            ... or to add whitespace between spans ...\r\n            - https://github.com/facebook/react/issues/1643#issuecomment-321439506\r\n          */\r\n          return <span key={content.key}>{content.element}</span>;\r\n        })}\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n\r\n  content.push({ element: features, key: \"Feature\" });\r\n\r\n  return { main: { title: \"Site Map\", content }, width: \"Closed\" };\r\n}\r\n","import { Data, toHtml, Url } from \"client\";\r\nimport React from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\nimport type { KeyedItem } from \"../layouts\";\r\n\r\nexport function getImageSummary(summary: Data.ImageSummary): KeyedItem {\r\n  const href = Url.getImageUrl(summary);\r\n  const element: React.ReactElement = (\r\n    <React.Fragment>\r\n      <h3>\r\n        <NavLink to={href}>{summary.name}</NavLink>\r\n      </h3>\r\n      <div dangerouslySetInnerHTML={toHtml(summary.summary)} />\r\n    </React.Fragment>\r\n  );\r\n  return { element, key: href };\r\n}\r\n","import { Data, Url } from \"client\";\r\nimport React from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\nimport type { KeyedItem } from \"../layouts\";\r\n\r\nconst nbsp = \"\\u00A0\";\r\n\r\nexport function getTagSummary(summary: Data.SiteTagCount): KeyedItem {\r\n  const href = Url.getTagUrl(summary);\r\n  const label = summary.title.replace(\" \", nbsp);\r\n  const element = <NavLink to={href}>{label}</NavLink>;\r\n  return { element, key: href };\r\n}\r\n","import { Api, Data, Url } from \"client\";\r\nimport React from \"react\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport { useFetchApi2 } from \"../hooks\";\r\nimport { FetchedT, getPage, Layout } from \"../layouts\";\r\nimport { notFound } from \"./NotFound\";\r\n\r\nexport const Image: React.FunctionComponent<RouteComponentProps> = (props: RouteComponentProps) => {\r\n  const parsed = Url.isImage(props.location);\r\n  if (Url.isParserError(parsed)) {\r\n    return notFound(props, parsed.error);\r\n  }\r\n\r\n  // see https://stackoverflow.com/questions/55990985/is-this-a-safe-way-to-avoid-did-you-accidentally-call-a-react-hook\r\n  // I'm not sure whether or why it's necessary to instantiate it like `<ImageId />` instead\r\n  // of calling it as a function like `ImageId({imageId: imageId})` but I do it anyway.\r\n  // So far as I can tell from testing, what really matters is the array of dependencies passed to useEffects.\r\n  return <ImageId id={parsed.id} name={parsed.name} />;\r\n};\r\n\r\nconst ImageId: React.FunctionComponent<Data.IdName> = (props: Data.IdName) => {\r\n  // ImageId is a separate function component because there's an `if` statement at the top of the Image cmpnent\r\n  // https://overreacted.io/a-complete-guide-to-useeffect/#but-i-cant-put-this-function-inside-an-effect\r\n\r\n  const { id, name } = props;\r\n  const idName = React.useMemo<Data.IdName>(() => {\r\n    return { id, name };\r\n  }, [id, name]);\r\n\r\n  return getPage(useFetchApi2(Api.getImage, idName), showImage);\r\n};\r\n\r\nfunction showImage(fetched: FetchedT<Data.Image, void>): Layout {\r\n  const { data } = fetched;\r\n  const images = (\r\n    <div className=\"image-images\">\r\n      <img src={data.image.src} height={data.image.height} width={data.image.width} alt=\"\" />\r\n    </div>\r\n  );\r\n  const right = !data.layers\r\n    ? undefined\r\n    : {\r\n        element: renderLayers(data.layers, 0),\r\n        width: data.layersWidth,\r\n        showButtonLabel: \"Show Layers\",\r\n        visible: true,\r\n      };\r\n  return {\r\n    main: { content: images, title: data.name },\r\n    width: \"Full\",\r\n    right,\r\n  };\r\n}\r\nfunction getLayerKey(layer: Data.LayerNode): string {\r\n  return layer.alias ? layer.alias : layer.name.toLowerCase().replace(\"&\", \"and\").replace(\" \", \"-\");\r\n}\r\n\r\nfunction handleLayerChange(event: React.ChangeEvent<HTMLInputElement>) {\r\n  const target = event.target;\r\n  const alias: string | null = target.getAttribute(\"name\");\r\n  const checked: boolean = target.checked;\r\n  alert(`In the non-prototype this would ${checked ? \"show\" : \"hide\"} the '${alias}' image layer`);\r\n}\r\n\r\nfunction renderNode(node: Data.LayerNode, alias: string): React.ReactElement {\r\n  // https://stackoverflow.com/questions/26615779/react-checkbox-not-sending-onchange\r\n  return (\r\n    <label>\r\n      <input type=\"checkbox\" defaultChecked={true} onChange={handleLayerChange} name={alias} />\r\n      {node.name}\r\n    </label>\r\n  );\r\n}\r\n\r\nfunction renderLayers(layers: Data.ImageLayers, level: number): React.ReactElement {\r\n  const className = level === 0 ? \"image-layers\" : undefined;\r\n  const listItems = layers.map((node) => {\r\n    const alias = getLayerKey(node);\r\n    return (\r\n      <li key={alias} className={node.children ? \"parent\" : undefined}>\r\n        {renderNode(node, alias)}\r\n        {node.children && renderLayers(node.children, level + 1)}\r\n      </li>\r\n    );\r\n  });\r\n  return <ul className={className}>{listItems}</ul>;\r\n}\r\n","import { config, Route } from \"client\";\nimport React from \"react\";\nimport * as ReactRouter from \"react-router-dom\";\nimport \"ui-assets/css/App.css\";\nimport { Topbar } from \"./components\";\nimport { AppContext, useCreateMe } from \"./hooks\";\nimport * as Page from \"./routes\";\n\n/*\n  This defines the App's routes\n  and the context (like global data) which is available to any chld elements which it creates.\n*/\n\nconst App: React.FunctionComponent = () => {\n  // pass the identity of the logged-in user to subcomponents via AppContext, instead of explicitly as parameter\n  const [me, setMe] = useCreateMe();\n\n  document.title = `${config.appname}`;\n\n  // plus https://reacttraining.com/react-router/web/api/BrowserRouter\n  return (\n    <AppContext.Provider value={{ me, setMe }}>\n      <ReactRouter.BrowserRouter basename={process.env.PUBLIC_URL}>\n        <AppRoutes />\n      </ReactRouter.BrowserRouter>\n    </AppContext.Provider>\n  );\n};\n\nconst AppRoutes: React.FunctionComponent = () => {\n  // https://reacttraining.com/react-router/web/api/Switch\n  return (\n    <React.Fragment>\n      <Topbar />\n      <ReactRouter.Switch>\n        <ReactRouter.Route exact path=\"/index\" component={Page.SiteMap} />\n        <ReactRouter.Route exact path=\"/\" component={Page.Discussions} />\n        <ReactRouter.Route exact path=\"/home\" component={Page.Home} />\n        <ReactRouter.Route exact path={Route.login} component={Page.Login} />\n        <ReactRouter.Route exact path={Route.siteMap} component={Page.SiteMap} />\n        <ReactRouter.Route exact path={Route.discussions} component={Page.Discussions} />\n        <ReactRouter.Route exact path={Route.newDiscussion} component={Page.NewDiscussion} />\n        <ReactRouter.Route exact path={Route.users} component={Page.Users} />\n        <ReactRouter.Route exact path={Route.tags} component={Page.Tags} />\n        <ReactRouter.Route path={Route.discussionsTagged} component={Page.Discussions} />\n        <ReactRouter.Route path={Route.users} component={Page.User} />\n        <ReactRouter.Route path={Route.images} component={Page.Image} />\n        <ReactRouter.Route path={Route.discussions} component={Page.Discussion} />\n        <ReactRouter.Route path={Route.tags} component={Page.Tag} />\n        <ReactRouter.Route component={Page.NotFound} />\n      </ReactRouter.Switch>\n    </React.Fragment>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL((process as { env: { [key: string]: string } }).env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (response.status === 404 || (contentType != null && contentType.indexOf(\"javascript\") === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\"No internet connection found. App is running in offline mode.\");\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"normalize.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result[\"default\"] = mod;\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar crypto = __importStar(require(\"crypto\"));\r\nvar server_types_1 = require(\"server-types\");\r\nvar tagIds_1 = require(\"./tagIds\");\r\nfunction createNewTopic(posted, dateTime, userId) {\r\n    return { type: \"NewTopic\", posted: posted, dateTime: dateTime, userId: userId };\r\n}\r\nexports.createNewTopic = createNewTopic;\r\nfunction createStoredTopic(stored) {\r\n    var summary = stored.summary ? stored.summary : \"\";\r\n    var markdown = stored.markdown ? stored.markdown : \"\";\r\n    var posted = { title: stored.title, summary: summary, markdown: markdown };\r\n    return {\r\n        type: \"NewTopic\",\r\n        posted: posted,\r\n        dateTime: stored.dateTime,\r\n        userId: stored.userId,\r\n    };\r\n}\r\nexports.createStoredTopic = createStoredTopic;\r\nfunction createNewTag(tag, dateTime, userId) {\r\n    var posted = {\r\n        title: tagIds_1.simulateTitle(tag),\r\n        summary: \"\",\r\n        markdown: \"\",\r\n    };\r\n    return { type: \"NewTopic\", posted: posted, dateTime: dateTime, userId: userId };\r\n}\r\nexports.createNewTag = createNewTag;\r\nfunction extractNewTopic(action) {\r\n    var dateTime = action.dateTime, userId = action.userId;\r\n    var key = server_types_1.getTagText(action.posted.title);\r\n    return __assign(__assign({}, action.posted), { dateTime: dateTime, userId: userId, key: key });\r\n}\r\nexports.extractNewTopic = extractNewTopic;\r\nfunction createNewUser(posted, dateTime, userId) {\r\n    return { type: \"NewUser\", posted: posted, dateTime: dateTime, userId: userId };\r\n}\r\nexports.createNewUser = createNewUser;\r\nfunction md5(email) {\r\n    return crypto.createHash(\"md5\").update(email).digest(\"hex\");\r\n}\r\nfunction extractNewUser(action) {\r\n    var dateTime = action.dateTime, userId = action.userId;\r\n    var _a = action.posted, name = _a.name, email = _a.email;\r\n    // https://en.gravatar.com/site/implement/hash/\r\n    // https://stackoverflow.com/questions/5878682/node-js-hash-string\r\n    var gravatarHash = md5(email.trim().toLocaleLowerCase());\r\n    var user = {\r\n        name: name,\r\n        email: email,\r\n        dateTime: dateTime,\r\n        gravatarHash: gravatarHash,\r\n        profile: {},\r\n        favourites: [],\r\n    };\r\n    return { userId: userId, user: user };\r\n}\r\nexports.extractNewUser = extractNewUser;\r\nfunction createEditUserProfile(posted, dateTime, userId) {\r\n    return { type: \"EditUserProfile\", posted: posted, dateTime: dateTime, userId: userId };\r\n}\r\nexports.createEditUserProfile = createEditUserProfile;\r\nfunction createStoredUserProfile(stored, userId) {\r\n    var location = stored.profile.location ? stored.profile.location : \"\";\r\n    var aboutMe = stored.profile.aboutMe ? stored.profile.aboutMe : \"\";\r\n    var posted = {\r\n        name: stored.name,\r\n        email: stored.email,\r\n        location: location,\r\n        aboutMe: aboutMe,\r\n    };\r\n    return { type: \"EditUserProfile\", posted: posted, dateTime: stored.dateTime, userId: userId };\r\n}\r\nexports.createStoredUserProfile = createStoredUserProfile;\r\nfunction extractEditUserProfile(action) {\r\n    var userId = action.userId, posted = action.posted;\r\n    return { userId: userId, posted: posted };\r\n}\r\nexports.extractEditUserProfile = extractEditUserProfile;\r\nfunction createNewDiscussion(posted, dateTime, userId, \r\n// created by the server database\r\ndiscussionId, \r\n// created by the server database\r\nmessageId) {\r\n    return {\r\n        type: \"NewDiscussion\",\r\n        posted: posted,\r\n        dateTime: dateTime,\r\n        userId: userId,\r\n        discussionId: discussionId,\r\n        messageId: messageId,\r\n    };\r\n}\r\nexports.createNewDiscussion = createNewDiscussion;\r\nfunction extractNewDiscussion(action) {\r\n    var dateTime = action.dateTime, userId = action.userId, discussionId = action.discussionId, messageId = action.messageId;\r\n    var _a = action.posted, title = _a.title, markdown = _a.markdown, tags = _a.tags;\r\n    var first = { dateTime: dateTime, userId: userId, messageId: messageId, markdown: markdown };\r\n    var idName = { id: discussionId, name: title };\r\n    return { idName: idName, tags: tags, first: first };\r\n}\r\nexports.extractNewDiscussion = extractNewDiscussion;\r\nfunction createNewMessage(posted, dateTime, userId, \r\n// carried in the URL\r\ndiscussionId, \r\n// created by the server database\r\nmessageId) {\r\n    return {\r\n        type: \"NewMessage\",\r\n        posted: posted,\r\n        dateTime: dateTime,\r\n        userId: userId,\r\n        messageId: messageId,\r\n        discussionId: discussionId,\r\n    };\r\n}\r\nexports.createNewMessage = createNewMessage;\r\nfunction extractNewMessage(action) {\r\n    var dateTime = action.dateTime, userId = action.userId, discussionId = action.discussionId, messageId = action.messageId;\r\n    var markdown = action.posted.markdown;\r\n    var message = { dateTime: dateTime, userId: userId, messageId: messageId, markdown: markdown };\r\n    return { discussionId: discussionId, message: message };\r\n}\r\nexports.extractNewMessage = extractNewMessage;\r\nfunction createEditTagInfo(posted, dateTime, userId, \r\n// carried in the URL\r\ntag) {\r\n    return { type: \"EditTagInfo\", posted: posted, dateTime: dateTime, userId: userId, tag: tag };\r\n}\r\nexports.createEditTagInfo = createEditTagInfo;\r\nfunction extractEditTagInfo(action) {\r\n    var tag = action.tag, posted = action.posted;\r\n    return { tag: tag, posted: posted };\r\n}\r\nexports.extractEditTagInfo = extractEditTagInfo;\r\nfunction getLoadPriority(action) {\r\n    switch (action.type) {\r\n        case \"NewUser\":\r\n            return 1;\r\n        case \"EditUserProfile\":\r\n            return 2;\r\n        case \"NewTopic\":\r\n            return 3;\r\n        case \"NewDiscussion\":\r\n            return 4;\r\n        case \"NewMessage\":\r\n            return 5;\r\n        case \"EditTagInfo\":\r\n            return 6;\r\n        default:\r\n            throw new Error(\"Unhandled type\");\r\n    }\r\n}\r\nexports.getLoadPriority = getLoadPriority;\r\n//# sourceMappingURL=actions.js.map","\"use strict\";\r\n/*\r\n  These are the public interfaces used in the ui-react code.\r\n*/\r\nfunction __export(m) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__export(require(\"./tag\"));\r\n//# sourceMappingURL=index.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction unwireSummaries(input) {\r\n    // create a Map of the users\r\n    var users = new Map(input.users.map(function (user) { return [user.id, user]; }));\r\n    var summaries = input.discussions.map(function (wire) {\r\n        return {\r\n            id: wire.id,\r\n            name: wire.name,\r\n            tags: wire.tags,\r\n            messageSummary: {\r\n                userSummary: users.get(wire.userId),\r\n                messageExerpt: wire.messageExerpt,\r\n                dateTime: wire.dateTime,\r\n            },\r\n            nAnswers: wire.nAnswers,\r\n        };\r\n    });\r\n    return summaries;\r\n}\r\nfunction unwireDiscussions(input) {\r\n    var summaries = unwireSummaries(input);\r\n    return { range: input.range, summaries: summaries };\r\n}\r\nexports.unwireDiscussions = unwireDiscussions;\r\nfunction unwireDiscussion(input) {\r\n    var users = new Map(input.users.map(function (user) { return [user.id, user]; }));\r\n    var id = input.id, name = input.name, tags = input.tags, range = input.range, first = input.first, messages = input.messages;\r\n    function unwireMessage(wire) {\r\n        return {\r\n            userSummary: users.get(wire.userId),\r\n            markdown: wire.markdown,\r\n            dateTime: wire.dateTime,\r\n        };\r\n    }\r\n    return {\r\n        id: id,\r\n        name: name,\r\n        tags: tags,\r\n        first: unwireMessage(first),\r\n        range: range,\r\n        messages: messages.map(unwireMessage),\r\n    };\r\n}\r\nexports.unwireDiscussion = unwireDiscussion;\r\nfunction unwireUserActivity(input) {\r\n    var summaries = unwireSummaries(input);\r\n    var summary = input.users[0];\r\n    var range = input.range;\r\n    return { summary: summary, summaries: summaries, tagCounts: input.tagCounts, range: range };\r\n}\r\nexports.unwireUserActivity = unwireUserActivity;\r\n//# sourceMappingURL=wire.js.map","\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/*\r\n  This interface is able to represent any URL which exists within the system.\r\n\r\n  I use it because I find it's difficult and not \"type-safe\" to work with URLs in string format\r\n  e.g. if the URL scheme (i.e. the routes supported by the system) changes or expands.\r\n\r\n  The full list of application URLs is defined by the list of Route and RouteT values defined below --\r\n  (but) several of these also support additional search/query parameters).\r\n*/\r\n// User\r\nvar routeUsers = { resourceType: \"User\" };\r\nvar routeUser = {\r\n    resourceType: \"User\",\r\n    parts: [\"id\", \"name\"],\r\n};\r\nvar routeUserEdit = {\r\n    resourceType: \"User\",\r\n    parts: [\"edit\", \"id\", \"name\"],\r\n};\r\n// Image\r\nvar routeImages = { resourceType: \"Image\" };\r\nvar routeImage = {\r\n    resourceType: \"Image\",\r\n    parts: [\"id\", \"name\"],\r\n};\r\n// Discussion\r\nvar routeDiscussions = { resourceType: \"Discussion\" };\r\nvar routeDiscussion = {\r\n    resourceType: \"Discussion\",\r\n    parts: [\"id\", \"name\"],\r\n};\r\n// SiteMap\r\nvar routeSiteMap = { resourceType: \"SiteMap\" };\r\n// Tag\r\nvar routeAllTags = { resourceType: \"Tag\", word: \"all\" };\r\nvar routeTags = { resourceType: \"Tag\" };\r\nvar routeDiscussionsTagged_ = {\r\n    resourceType: \"Discussion\",\r\n    word: \"tagged\",\r\n};\r\nvar routeDiscussionsTagged = {\r\n    resourceType: \"Discussion\",\r\n    parts: [\"tagged\", \"key\"],\r\n};\r\nvar routeTagInfo = {\r\n    resourceType: \"Tag\",\r\n    parts: [\"key\", \"info\"],\r\n};\r\nvar routeTagEdit = {\r\n    resourceType: \"Tag\",\r\n    parts: [\"key\", \"edit\"],\r\n};\r\nvar routeTagKey = { resourceType: \"Tag\", parts: [\"key\"] };\r\n// POST not GET\r\nvar routeLogin = { resourceType: \"Login\" };\r\nvar routeNewDiscussion = { resourceType: \"Discussion\", word: \"new\" };\r\nvar routeNewAnswer = {\r\n    resourceType: \"Discussion\",\r\n    parts: [\"id\", \"answer\", \"submit\"],\r\n};\r\nvar routeEditUserProfile = {\r\n    resourceType: \"User\",\r\n    parts: [\"edit\", \"id\"],\r\n};\r\nfunction isKeyword(s) {\r\n    switch (s) {\r\n        case \"new\":\r\n        case \"edit\":\r\n        case \"tagged\":\r\n        case \"info\":\r\n        case \"answer\":\r\n        case \"submit\":\r\n        case \"all\":\r\n            return true;\r\n        default:\r\n            return false;\r\n    }\r\n}\r\n/*\r\n  isUrl, isUrlT -- test whether a URL matches a route\r\n\r\n  makeUrl, makeUrlT -- make the URL for a given route\r\n*/\r\nfunction isUrlT(segments, route) {\r\n    var resourceType = route.resourceType, parts = route.parts;\r\n    if (!segments.length || segments[0] !== getRoot(resourceType)) {\r\n        return undefined;\r\n    }\r\n    if (segments.length !== 1 + parts.length) {\r\n        // handle it gracefully if the last \"name\" part of the URL is left offf\r\n        if (parts.length && parts[parts.length - 1] === \"name\" && segments.length === parts.length) {\r\n            var short = {\r\n                resourceType: resourceType,\r\n                parts: parts.slice(0, parts.length - 1),\r\n            };\r\n            var found = isUrlT(segments, short);\r\n            if (found) {\r\n                return __assign(__assign({}, found), { name: \"\" });\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n    var rc = {};\r\n    for (var segmentIndex = 1, partIndex = 0; segmentIndex < segments.length; ++segmentIndex, ++partIndex) {\r\n        var part = parts[partIndex];\r\n        var segment = segments[segmentIndex];\r\n        if (isKeyword(part)) {\r\n            // it's a string\r\n            if (segment !== part) {\r\n                return undefined;\r\n            }\r\n            // it matched\r\n            continue;\r\n        }\r\n        // else it's a key\r\n        var key = part;\r\n        switch (key) {\r\n            case \"id\":\r\n                var id = toNumber(segment);\r\n                if (!id) {\r\n                    return undefined;\r\n                }\r\n                rc = __assign(__assign({}, rc), { id: id });\r\n                break;\r\n            case \"name\":\r\n                rc = __assign(__assign({}, rc), { name: segment });\r\n                break;\r\n            case \"key\":\r\n                rc = __assign(__assign({}, rc), { key: segment });\r\n                break;\r\n            default:\r\n                return undefined;\r\n        }\r\n    }\r\n    return rc;\r\n}\r\nfunction isUrl(pathSegments, route) {\r\n    var resourceType = route.resourceType, word = route.word;\r\n    if (!pathSegments.length || pathSegments[0] !== getRoot(resourceType)) {\r\n        return false;\r\n    }\r\n    return (pathSegments.length === 1 && !word) || (pathSegments.length === 2 && pathSegments[1] === word);\r\n}\r\nfunction toNumber(s) {\r\n    var rc = +s;\r\n    return typeof rc === \"number\" ? rc : undefined;\r\n}\r\n// getTagText reuses this function\r\nfunction slugify(title) {\r\n    // preserve only alphanumeric and whitespace and hyphen, then convert all whitespace, then toLower\r\n    return title\r\n        .replace(/[^A-Za-z0-9\\- ]/g, \"\")\r\n        .replace(/ /g, \"-\")\r\n        .toLocaleLowerCase();\r\n}\r\nexports.slugify = slugify;\r\nfunction makeUrlT(route, data, queries) {\r\n    var resourceType = route.resourceType, parts = route.parts;\r\n    var rc = [];\r\n    rc.push(getRoot(resourceType));\r\n    parts.forEach(function (part) {\r\n        if (isKeyword(part)) {\r\n            rc.push(part);\r\n        }\r\n        else {\r\n            var key = part;\r\n            var value = \"\" + data[key]; // convert to string if it's a number\r\n            var safe = key === \"name\" ? (resourceType === \"User\" ? encodeURIComponent(value) : slugify(value)) : value;\r\n            rc.push(safe);\r\n        }\r\n    });\r\n    return \"/\" + rc.join(\"/\") + (queries ? queries.search() : \"\");\r\n}\r\nfunction makeUrl(route, queries) {\r\n    var resourceType = route.resourceType, word = route.word;\r\n    var rc = [];\r\n    rc.push(getRoot(resourceType));\r\n    if (word) {\r\n        rc.push(word);\r\n    }\r\n    return \"/\" + rc.join(\"/\") + (queries ? queries.search() : \"\");\r\n}\r\n/*\r\n  Helper to convert between URL fragments (used in the URL) and type string and numeric values (used in the code)\r\n\r\n  They're similar but the URL uses lower-case strings, while the code uses upper-case type strings and number values.\r\n*/\r\nvar Pairs = /** @class */ (function () {\r\n    function Pairs(array) {\r\n        this.array = array;\r\n    }\r\n    Pairs.prototype.find0 = function (wanted) {\r\n        var found = this.array.find(function (x) { return x[0] === wanted; });\r\n        return !!found ? found[1] : undefined;\r\n    };\r\n    Pairs.prototype.find1 = function (wanted) {\r\n        var found = this.array.find(function (x) { return x[1] === wanted; });\r\n        return !!found ? found[0] : undefined;\r\n    };\r\n    return Pairs;\r\n}());\r\nvar resourceTypes = new Pairs([\r\n    [\"SiteMap\", \"sitemap\"],\r\n    [\"Login\", \"login\"],\r\n    [\"Discussion\", \"discussions\"],\r\n    [\"User\", \"users\"],\r\n    [\"Image\", \"images\"],\r\n    [\"Tag\", \"tags\"],\r\n]);\r\nfunction getRoot(resourceType) {\r\n    var root = resourceTypes.find0(resourceType);\r\n    if (!root) {\r\n        throw new Error(\"Undefined ResourceType: '\" + resourceType + \"'\");\r\n    }\r\n    return root;\r\n}\r\nfunction getResourceType(location) {\r\n    var elements = new Elements(location);\r\n    return elements.getResourceType();\r\n}\r\nexports.getResourceType = getResourceType;\r\nfunction getLocation(url) {\r\n    if (url[0] !== \"/\") {\r\n        // this function is called on the server to parse a URL which the server code gets from the system run-time\r\n        // it's not used to parse a URL received directly from a user application\r\n        // so it's safe to say \"this is impossile and shouldn't happen\" and throw an exception, i.e. it's not something\r\n        // that a malicious application might have sent us, and which we should handle without throwing an exception\r\n        throw new Error(\"Expected URL to start with `/`\");\r\n    }\r\n    var splitHash = url.indexOf(\"#\");\r\n    if (splitHash !== -1) {\r\n        url = url.substring(0, splitHash);\r\n    }\r\n    var splitQuery = url.indexOf(\"?\");\r\n    var query = splitQuery !== -1 ? url.substring(splitQuery) : \"\";\r\n    if (splitQuery !== -1) {\r\n        url = url.substring(0, splitQuery);\r\n    }\r\n    return { pathname: url, search: query };\r\n}\r\nexports.getLocation = getLocation;\r\n/*\r\n  Elements\r\n\r\n  Splits the pathname and the search within a location to a more usable format\r\n  A private implementation details used only within this module\r\n*/\r\nvar Elements = /** @class */ (function () {\r\n    function Elements(location) {\r\n        // split the input parameters\r\n        var pathname = location.pathname, search = location.search;\r\n        if (search && search[0] !== \"?\") {\r\n            throw new Error(\"Expected search to start with `?`\");\r\n        }\r\n        if (pathname[0] !== \"/\") {\r\n            throw new Error(\"Expected pathname to start with `/`\");\r\n        }\r\n        this.segments = pathname.length === 1 ? [] : pathname.substring(1).split(\"/\");\r\n        this.queries = new Queries(location);\r\n    }\r\n    Elements.prototype.matchesT = function (route) {\r\n        return isUrlT(this.segments, route);\r\n    };\r\n    Elements.prototype.getQuery = function (name) {\r\n        return this.queries.get(name);\r\n    };\r\n    Elements.prototype.matches = function (route) {\r\n        return isUrl(this.segments, route);\r\n    };\r\n    Elements.prototype.getResourceType = function () {\r\n        if (!this.segments.length) {\r\n            return \"SiteMap\";\r\n        }\r\n        var resourceType = resourceTypes.find1(this.segments[0]);\r\n        if (!resourceType) {\r\n            return { error: \"Undefined ResourceType: '\" + this.segments[0] + \"'\" };\r\n        }\r\n        return resourceType;\r\n    };\r\n    return Elements;\r\n}());\r\nfunction isParserError(rc) {\r\n    return rc.error !== undefined;\r\n}\r\nexports.isParserError = isParserError;\r\nvar errorUnexpectedPath = { error: \"Unexpected path\" };\r\n/*\r\n  Queries\r\n\r\n  The optional query parameters (a.k.a. search parameters)\r\n*/\r\nvar Queries = /** @class */ (function () {\r\n    function Queries(location) {\r\n        if (location && location.search) {\r\n            var split = location.search.substring(1).split(\"&\");\r\n            this.params = split\r\n                .filter(function (s) { return s.length > 0; })\r\n                .map(function (s) {\r\n                var parts = s.split(\"=\");\r\n                return parts.length > 1 ? [parts[0], parts[1]] : [parts[0], undefined];\r\n            });\r\n        }\r\n        else {\r\n            this.params = [];\r\n        }\r\n    }\r\n    Queries.prototype.get = function (name) {\r\n        var found = this.params.find(function (x) { return x[0] === name; });\r\n        return !!found ? found[1] : undefined;\r\n    };\r\n    Queries.prototype.push = function (name, value) {\r\n        if (!value) {\r\n            throw new Error(\"Unexpected undefined search value\");\r\n        }\r\n        this.params.push([name, value]);\r\n    };\r\n    Queries.prototype.search = function () {\r\n        return !this.params.length\r\n            ? \"\"\r\n            : \"?\" + this.params.map(function (pair) { return (pair[1] ? pair[0] + \"=\" + pair[1] : pair[0]); }).join(\"&\");\r\n    };\r\n    return Queries;\r\n}());\r\n/*\r\n  User page supports 3 tabs\r\n*/\r\nvar userTabTypes = new Pairs([\r\n    [\"Profile\", \"profile\"],\r\n    [\"Activity\", \"activity\"],\r\n]);\r\nfunction isUsers(location) {\r\n    var elements = new Elements(location);\r\n    return elements.matches(routeUsers);\r\n}\r\nexports.isUsers = isUsers;\r\nfunction getUsersUrl() {\r\n    return makeUrl(routeUsers);\r\n}\r\nexports.getUsersUrl = getUsersUrl;\r\nfunction isUserOptions(location) {\r\n    var elements = new Elements(location);\r\n    var user = elements.matchesT(routeUserEdit);\r\n    if (user) {\r\n        return { user: user, userTabType: \"EditSettings\" };\r\n    }\r\n    user = elements.matchesT(routeUser);\r\n    if (!user) {\r\n        return errorUnexpectedPath;\r\n    }\r\n    var tab = elements.getQuery(\"tab\");\r\n    if (!tab) {\r\n        return { user: user };\r\n    }\r\n    var userTabType = userTabTypes.find1(tab);\r\n    if (!userTabType) {\r\n        return { error: \"Unexpected tab value\" };\r\n    }\r\n    return { user: user, userTabType: userTabType };\r\n}\r\nexports.isUserOptions = isUserOptions;\r\nfunction isUserActivityOptions(location) {\r\n    var userOptions = isUserOptions(location);\r\n    if (isParserError(userOptions)) {\r\n        return userOptions;\r\n    }\r\n    var user = userOptions.user, userTabType = userOptions.userTabType;\r\n    if (userTabType !== \"Activity\") {\r\n        return { error: \"Unexpected tab value\" };\r\n    }\r\n    function getActivityoptions(queries) {\r\n        var sort = queries.get(\"sort\");\r\n        var page = queries.get(\"page\");\r\n        return {\r\n            sort: sort ? discussionSort.find1(sort) : undefined,\r\n            page: page ? toNumber(page) : undefined,\r\n        };\r\n    }\r\n    var _a = getActivityoptions(new Queries(location)), sort = _a.sort, page = _a.page;\r\n    return { user: user, sort: sort, userTabType: userTabType, page: page };\r\n}\r\nexports.isUserActivityOptions = isUserActivityOptions;\r\nfunction getUserUrl(user) {\r\n    return makeUrlT(routeUser, user);\r\n}\r\nexports.getUserUrl = getUserUrl;\r\nfunction getUserOptionsUrl(options) {\r\n    if (options.userTabType === \"EditSettings\") {\r\n        return makeUrlT(routeUserEdit, options.user);\r\n    }\r\n    var queries = new Queries();\r\n    if (options.userTabType) {\r\n        queries.push(\"tab\", userTabTypes.find0(options.userTabType));\r\n    }\r\n    return makeUrlT(routeUser, options.user, queries);\r\n}\r\nexports.getUserOptionsUrl = getUserOptionsUrl;\r\nfunction getUserActivityUrl(options) {\r\n    var queries = new Queries();\r\n    queries.push(\"tab\", userTabTypes.find0(\"Activity\"));\r\n    if (options.sort) {\r\n        queries.push(\"sort\", discussionSort.find0(options.sort));\r\n    }\r\n    if (options.page) {\r\n        queries.push(\"page\", \"\" + options.page);\r\n    }\r\n    return makeUrlT(routeUser, options.user, queries);\r\n}\r\nexports.getUserActivityUrl = getUserActivityUrl;\r\n/*\r\n  Image page just has a numeric ID\r\n*/\r\nfunction isImage(location) {\r\n    var elements = new Elements(location);\r\n    var image = elements.matchesT(routeImage);\r\n    return image ? image : errorUnexpectedPath;\r\n}\r\nexports.isImage = isImage;\r\nfunction getImageUrl(image) {\r\n    return makeUrlT(routeImage, image);\r\n}\r\nexports.getImageUrl = getImageUrl;\r\nvar tagsSort = new Pairs([\r\n    [\"Popular\", \"popular\"],\r\n    [\"Name\", \"name\"],\r\n]);\r\nfunction isTagsOptions(location) {\r\n    var elements = new Elements(location);\r\n    if (!elements.matches(routeTags)) {\r\n        return errorUnexpectedPath;\r\n    }\r\n    var sort = elements.getQuery(\"sort\");\r\n    var page = elements.getQuery(\"page\");\r\n    return {\r\n        sort: sort ? tagsSort.find1(sort) : undefined,\r\n        pagesize: 36,\r\n        page: page ? toNumber(page) : undefined,\r\n    };\r\n}\r\nexports.isTagsOptions = isTagsOptions;\r\nfunction isAllTags(location) {\r\n    var elements = new Elements(location);\r\n    return elements.matches(routeAllTags);\r\n}\r\nexports.isAllTags = isAllTags;\r\nfunction getTagsOptionsUrl(params) {\r\n    var options = __assign(__assign({}, params), { pagesize: 36 });\r\n    var queries = new Queries();\r\n    if (options.sort) {\r\n        queries.push(\"sort\", tagsSort.find0(options.sort));\r\n    }\r\n    if (options.page) {\r\n        queries.push(\"page\", \"\" + options.page);\r\n    }\r\n    queries.push(\"pagesize\", \"\" + options.pagesize);\r\n    return makeUrl(routeTags, queries);\r\n}\r\nexports.getTagsOptionsUrl = getTagsOptionsUrl;\r\n/*\r\n  Other Tags pages\r\n*/\r\nfunction getAllTagsUrl() {\r\n    return makeUrl(routeAllTags);\r\n}\r\nexports.getAllTagsUrl = getAllTagsUrl;\r\nfunction getTagsUrl() {\r\n    return makeUrl(routeTags);\r\n}\r\nexports.getTagsUrl = getTagsUrl;\r\nfunction getTagUrl(tag) {\r\n    return getDiscussionsTaggedUrl(tag);\r\n}\r\nexports.getTagUrl = getTagUrl;\r\nfunction getTagInfoUrl(tag) {\r\n    return makeUrlT(routeTagInfo, tag);\r\n}\r\nexports.getTagInfoUrl = getTagInfoUrl;\r\nfunction getTagEditUrl(tag) {\r\n    return makeUrlT(routeTagEdit, tag);\r\n}\r\nexports.getTagEditUrl = getTagEditUrl;\r\nfunction getTagKeyUrl(tag) {\r\n    return makeUrlT(routeTagKey, tag);\r\n}\r\nexports.getTagKeyUrl = getTagKeyUrl;\r\nfunction getDiscussionsTaggedUrl(tag) {\r\n    return makeUrlT(routeDiscussionsTagged, tag);\r\n}\r\nexports.getDiscussionsTaggedUrl = getDiscussionsTaggedUrl;\r\nfunction isTagInfo(location) {\r\n    var elements = new Elements(location);\r\n    var key = elements.matchesT(routeTagInfo);\r\n    return key ? key : errorUnexpectedPath;\r\n}\r\nexports.isTagInfo = isTagInfo;\r\nfunction isTagEdit(location) {\r\n    var elements = new Elements(location);\r\n    var key = elements.matchesT(routeTagEdit);\r\n    return key ? key : errorUnexpectedPath;\r\n}\r\nexports.isTagEdit = isTagEdit;\r\nfunction isTagKey(location) {\r\n    var elements = new Elements(location);\r\n    var key = elements.matchesT(routeTagKey);\r\n    return key ? key : errorUnexpectedPath;\r\n}\r\nexports.isTagKey = isTagKey;\r\nvar discussionsSort = new Pairs([\r\n    [\"Active\", \"active\"],\r\n    [\"Newest\", \"newest\"],\r\n]);\r\nvar pageSizes = new Pairs([\r\n    [15, \"15\"],\r\n    [30, \"30\"],\r\n    [50, \"50\"],\r\n]);\r\nfunction isDiscussionsOptions(location) {\r\n    var elements = new Elements(location);\r\n    var key = elements.matchesT(routeDiscussionsTagged);\r\n    var isRoot = location.pathname === \"/\"; // Discussions is the default page for the root path\r\n    if (!key && !elements.matches(routeDiscussions) && !isRoot) {\r\n        return errorUnexpectedPath;\r\n    }\r\n    var sort = elements.getQuery(\"sort\");\r\n    var pagesize = elements.getQuery(\"pagesize\");\r\n    var page = elements.getQuery(\"page\");\r\n    return {\r\n        sort: sort ? discussionsSort.find1(sort) : undefined,\r\n        pagesize: pagesize ? pageSizes.find1(pagesize) : undefined,\r\n        page: page ? toNumber(page) : undefined,\r\n        tag: key,\r\n    };\r\n}\r\nexports.isDiscussionsOptions = isDiscussionsOptions;\r\nfunction getDiscussionsOptionsUrl(options) {\r\n    var queries = new Queries();\r\n    if (options.sort) {\r\n        queries.push(\"sort\", discussionsSort.find0(options.sort));\r\n    }\r\n    if (options.pagesize) {\r\n        queries.push(\"pagesize\", \"\" + options.pagesize);\r\n    }\r\n    if (options.page) {\r\n        queries.push(\"page\", \"\" + options.page);\r\n    }\r\n    return !options.tag ? makeUrl(routeDiscussions, queries) : makeUrlT(routeDiscussionsTagged, options.tag, queries);\r\n}\r\nexports.getDiscussionsOptionsUrl = getDiscussionsOptionsUrl;\r\nvar discussionSort = new Pairs([\r\n    [\"Oldest\", \"oldest\"],\r\n    [\"Newest\", \"newest\"],\r\n]);\r\nfunction isDiscussionOptions(location) {\r\n    var elements = new Elements(location);\r\n    var discussion = elements.matchesT(routeDiscussion);\r\n    if (!discussion) {\r\n        return errorUnexpectedPath;\r\n    }\r\n    var sort = elements.getQuery(\"sort\");\r\n    var page = elements.getQuery(\"page\");\r\n    return {\r\n        discussion: discussion,\r\n        sort: sort ? discussionSort.find1(sort) : undefined,\r\n        page: page ? toNumber(page) : undefined,\r\n    };\r\n}\r\nexports.isDiscussionOptions = isDiscussionOptions;\r\nfunction getDiscussionUrl(discussion) {\r\n    return makeUrlT(routeDiscussion, discussion);\r\n}\r\nexports.getDiscussionUrl = getDiscussionUrl;\r\nfunction getDiscussionOptionsUrl(options) {\r\n    var queries = new Queries();\r\n    if (options.sort) {\r\n        queries.push(\"sort\", discussionSort.find0(options.sort));\r\n    }\r\n    if (options.page) {\r\n        queries.push(\"page\", \"\" + options.page);\r\n    }\r\n    return makeUrlT(routeDiscussion, options.discussion, queries);\r\n}\r\nexports.getDiscussionOptionsUrl = getDiscussionOptionsUrl;\r\n/*\r\n  SiteMap\r\n*/\r\nfunction getSiteMapUrl() {\r\n    return makeUrl(routeSiteMap);\r\n}\r\nexports.getSiteMapUrl = getSiteMapUrl;\r\nfunction postLoginUrl() {\r\n    return exports.route.login;\r\n}\r\nexports.postLoginUrl = postLoginUrl;\r\nfunction postNewDiscussionUrl() {\r\n    return exports.route.newDiscussion;\r\n}\r\nexports.postNewDiscussionUrl = postNewDiscussionUrl;\r\nfunction postNewAnswerUrl(discussionId) {\r\n    return makeUrlT(routeNewAnswer, { id: discussionId });\r\n}\r\nexports.postNewAnswerUrl = postNewAnswerUrl;\r\nfunction postEditUserProfileUrl(userId) {\r\n    return makeUrlT(routeEditUserProfile, { id: userId });\r\n}\r\nexports.postEditUserProfileUrl = postEditUserProfileUrl;\r\nfunction postEditTagInfoUrl(tag) {\r\n    return makeUrlT(routeTagEdit, { key: tag });\r\n}\r\nexports.postEditTagInfoUrl = postEditTagInfoUrl;\r\nfunction isLogin(location) {\r\n    var elements = new Elements(location);\r\n    return elements.matches(routeLogin);\r\n}\r\nexports.isLogin = isLogin;\r\nfunction isNewDiscussion(location) {\r\n    var elements = new Elements(location);\r\n    return elements.matches(routeNewDiscussion);\r\n}\r\nexports.isNewDiscussion = isNewDiscussion;\r\nfunction isNewAnswer(location) {\r\n    var elements = new Elements(location);\r\n    var found = elements.matchesT(routeNewAnswer);\r\n    return found ? found.id : undefined;\r\n}\r\nexports.isNewAnswer = isNewAnswer;\r\nfunction isEditUserProfile(location) {\r\n    var elements = new Elements(location);\r\n    var found = elements.matchesT(routeEditUserProfile);\r\n    return found ? found.id : undefined;\r\n}\r\nexports.isEditUserProfile = isEditUserProfile;\r\nfunction isEditTagInfo(location) {\r\n    var elements = new Elements(location);\r\n    var found = elements.matchesT(routeTagEdit);\r\n    return found ? found.key : undefined;\r\n}\r\nexports.isEditTagInfo = isEditTagInfo;\r\n/*\r\n  Simple routes for each of the various ResourceType values\r\n*/\r\nexports.route = {\r\n    login: makeUrl(routeLogin),\r\n    siteMap: makeUrl(routeSiteMap),\r\n    discussions: makeUrl(routeDiscussions),\r\n    discussionsTagged: makeUrl(routeDiscussionsTagged_),\r\n    users: makeUrl(routeUsers),\r\n    images: makeUrl(routeImages),\r\n    newDiscussion: makeUrl(routeNewDiscussion),\r\n    tags: makeUrl(routeTags),\r\n};\r\n//# sourceMappingURL=urls.js.map"],"sourceRoot":""}